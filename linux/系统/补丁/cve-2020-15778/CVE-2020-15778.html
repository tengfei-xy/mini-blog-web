<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>CVE-2020-15778 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="CVE-2020-15778" class="main-title"></div></div></header><article><h2 id="kYUSPdcHrsTxqybQpE5RcE" class="wolai-block"><span class="inline-wrap">描述</span></h2><div id="6WzP7AT21HvgJeRxL8fUYA" class="wolai-block wolai-text"><div><span class="inline-wrap">**OpenSSH<span class="jill"></span>到<span class="jill"></span>8.3p1<span class="jill"></span>中的</span><span class="inline-wrap"><a href="https://cve.mitre.org/about/faqs.html#disputed_signify_in_cve_entry"><span>争议</span></a></span><span class="inline-wrap">**scp<span class="jill"></span>允许在<span class="jill"></span>scp.c toremote<span class="jill"></span>函数中注入命令，目标参数中的反勾字符所示。注：据报道，供应商表示，他们故意省略了对“异常参数传输”的验证，因为这“极有可能破坏现有工作流程”。</span></div></div><blockquote id="bBmfoeZvNnYpRPgCs77koa" class="wolai-block"><span class="inline-wrap">原文：** </span><span class="inline-wrap"><a href="https://cve.mitre.org/about/faqs.html#disputed_signify_in_cve_entry"><span>DISPUTED</span></a></span><span class="inline-wrap"> ** scp in OpenSSH through 8.3p1 allows command injection in the scp.c toremote function, as demonstrated by backtick characters in the destination argument. NOTE: the vendor reportedly has stated that they intentionally omit validation of &quot;anomalous argument transfers&quot; because that could &quot;stand a great chance of breaking existing workflows.&quot;</span></blockquote><h2 id="vHsDWxYRygbew271z7FBgd" class="wolai-block"><span class="inline-wrap">参考文献</span></h2><ul class="wolai-block"><li id="4ubkBo8aN7ZdWJwbebAWaT"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://security.netapp.com/advisory/ntap-20200731-0007/"><span>CONFIRM:https://security.netapp.com/advisory/ntap-20200731-0007/</span></a></span></li><li id="6Xnhb1Hnn1A79fWCmNpXib"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://github.com/cpandya2909/CVE-2020-15778/"><span>MISC:https://github.com/cpandya2909/CVE-2020-15778/</span></a></span></li><li id="7ExSZoje29bBJEaxyQzPy3"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://news.ycombinator.com/item?id=25005567"><span>MISC:https://news.ycombinator.com/item？id=25005567</span></a></span></li><li id="pVYgYH2CAa42tG1PwuDq9U"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap"><a href="https://www.openssh.com/security.html"><span>MISC:https://www.openssh.com/security.html</span></a></span></li><li id="cbWU7VjoTGLuDgHtcL4LUJ"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">漏洞行：</span><span class="inline-wrap"><a href="https://github.com/openssh/openssh-portable/blob/a2855c048b3f4b17d8787bd3f24232ec0cd79abe/scp.c#L989"><span>https://github.com/openssh/openssh-portable/blob/a2855c048b3f4b17d8787bd3f24232ec0cd79abe/scp.c#L989</span></a></span></li></ul><h2 id="kXfYUhH6BhzCSEeENB7J9y" class="wolai-block"><span class="inline-wrap">问题复现</span></h2><div id="jELdcX93Mp5M4uJKbewSc2" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>openssh&lt;=8.3p1<span class="jill"></span>的环境中：</span></div></div><div id="betQY6piRCd5UjUMmsVRuS" class="wolai-block wolai-text"><div><span class="inline-wrap">下方命令在<span class="jill"></span>192.168.245.17<span class="jill"></span>执行<span class="jill"></span>touch /root/normal.sh，并将本地的<span class="jill"></span>a.txt<span class="jill"></span>复制到远程主机/root/b.txt</span></div></div><code-block id="62aLjDauVMNF6M8QkaRNs3" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token punctuation">[</span>root@host<span class="token operator">-</span>a <span class="token operator">~</span><span class="token punctuation">]</span># scp a<span class="token punctuation">.</span><span class="token property-access">txt</span> root@<span class="token number">192.168</span><span class="token number">.245</span><span class="token number">.17</span><span class="token operator">:</span><span class="token string">'`touch /root/normal.sh`/root/b.txt'</span></pre></div></code-block><div id="bZxfzgvAjwE8pnXK3362JT" class="wolai-block wolai-text"><div><span class="inline-wrap">由于远程路径先执行了命令，再将<span class="jill"></span>a.txt<span class="jill"></span>复制到/root/b.txt,这种特殊的使用方法导致了异常结果。</span></div></div><h2 id="vdHrDnuppS5e37EmgKqY3x" class="wolai-block"><span class="inline-wrap">openssh<span class="jill"></span>供应商回应</span></h2><div id="bPuZEhLhQQKm5iUEGF2hiz" class="wolai-block wolai-text"><div><span class="inline-wrap">scp<span class="jill"></span>命令是一种历史协议（称为<span class="jill"></span>rcp），它依赖于这种类型的参数传递，并遇到扩展问题。事实证明，很难在<span class="jill"></span>scp<span class="jill"></span>模型中添加“安全性”。所有“检测”和“防止”异常参数转移的尝试都非常有可能破坏现有工作流程。是的，我们认识到情况很糟糕。但我们不想打破人们使用<span class="jill"></span>scp<span class="jill"></span>的简单模式，直到有一个普通的替代品。如果人们担心的话，他们应该使用<span class="jill"></span>rsync<span class="jill"></span>或其他东西。</span></div></div><blockquote id="q1oLTXAN8EtdFUrYNobsbq" class="wolai-block"><span class="inline-wrap">原文：</span><span class="inline-wrap">
</span><span class="inline-wrap">The scp command is a historical protocol (called rcp) which relies upon that style of argument passing and encounters expansion problems. It has proven very difficult to add &quot;security&quot; to the scp model. All attempts to &quot;detect&quot; and &quot;prevent&quot; anomalous argument transfers stand a great chance of breaking existing workflows. Yes, we recognize it the situation sucks. But we don&#39;t want to break the easy patterns people use scp for, until there is a commonplace replacement. People should use rsync or something else instead if they are concerned.</span></blockquote><h2 id="jbxhUfFAKoMswo1YHppv85" class="wolai-block"><span class="inline-wrap">解决方案</span></h2><ol class="wolai-block"><li id="58sZxxjrp5MDTRAJnU4bmD"><div class="marker"></div><span class="inline-wrap">需要将<span class="jill"></span>openssh<span class="jill"></span>升级到&gt;8.3p1，但没有针对</span><span class="inline-wrap"><a href=".net/linux/rpm2html/search.php"><span>Centos7.x<span class="jill"></span>的<span class="jill"></span>rpm</span></a></span><span class="inline-wrap">包，因此需要升级操作系统。</span></li><li id="7QJps8bA5cEQD9WUTPBrq2"><div class="marker"></div><span class="inline-wrap">供应商：单文件远程复制时直接放弃<span class="jill"></span>scp，使用<span class="jill"></span>rsync。</span></li></ol><h2 id="ratf2ceNTsVpYZa1c1tzgb" class="wolai-block"><span class="inline-wrap">个人理解</span></h2><div id="iKzb2cVjPBuVZ66XWiQg4u" class="wolai-block wolai-text"><div><span class="inline-wrap">这种在特殊的使用方式下，是会造成异常结果。在系统管理员使用<span class="jill"></span>scp<span class="jill"></span>时稍加注意即可。另外，DB02<span class="jill"></span>的备份脚本并无掺杂执行命令的额外内容，是<span class="jill"></span>scp<span class="jill"></span>的常规用法也并不触发<span class="jill"></span>Bug。</span></div></div></article><footer></footer></body></html>