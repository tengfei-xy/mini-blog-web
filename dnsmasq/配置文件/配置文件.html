<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>配置文件 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="配置文件" class="main-title"></div></div></header><article><div id="2buZChunMpY9LTDsmYN5Ep" class="wolai-block wolai-text"><div><span class="inline-wrap">Gg<span class="jill"></span>对于<span class="jill"></span>mac，默认使用/usr/local/etc/dnsmasq.conf<span class="jill"></span>配置文件</span></div></div><div id="eqjPuZMSNHWUJVRMj6gWTf" class="wolai-block wolai-text"><div><span class="inline-wrap">简略配置</span></div></div><code-block id="jm8vpzCin2pQvXiVz4JCF2" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre><span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">114.114.114.114</span>
<span class="token key attr-name">port</span><span class="token punctuation">=</span><span class="token value attr-value">53</span>
<span class="token key attr-name">listen-address</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/in.sql.test/192.168.3.45</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/in.sql.dev/192.168.3.42</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/in.sql.demo.s/116.63.237.58</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/in.sql.demo.o/116.63.43.109</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/in.virsh/192.168.4.3</span>

<span class="token key attr-name">cname</span><span class="token punctuation">=</span><span class="token value attr-value">support.bobingtech.com,in.suppor</span></pre></div></code-block><div id="5Ctv7H2xv7DTdoYQ249QvB" class="wolai-block wolai-text"><div><span class="inline-wrap">详细配置</span></div></div><code-block id="7GoNuqeGST1fr9pbWjgHSg" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre><span class="token comment"># 配置额外的上级 DNS 主机 (nameserver)</span>
<span class="token comment"># 通常会在定义的文件中配置域名服务器地址 nameserver 127.0.0.53</span>
<span class="token comment"># 如果访问没有被解析过的域名，那么就会尝试使用文件中定义的地址去解析</span>
<span class="token key attr-name">resolv-file</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/resolv.conf</span>

<span class="token comment"># 默认情况下 Dnsmasq 会发送查询到它的任何上游 DNS 服务器上，如果取消注释，则 Dnsmasq 则会严格按照 /etc/resolv.conf 中定义的 DNS Server 顺序进行查询，直到成功为止</span>
<span class="token comment"># strict-order</span>

<span class="token comment"># 如果不想 Dnsmasq 读取 /etc/resolv.conf 文件获得它的上级 servers。即不使用上级 DNS 主机配置文件 (/etc/resolv.conf 和 resolv-file）可以开启改选项</span>
<span class="token comment">#no-resolv</span>

<span class="token comment"># 不允许 Dnsmasq 通过轮询 /etc/resolv.conf 或者其他文件来获取配置的改变，则取消注释。</span>
<span class="token comment">#no-poll</span>
<span class="token comment"># 向上游所有服务器查询</span>
all-servers
<span class="token comment"># 启用转发循环检测</span>
dns-loop-detect
<span class="token comment"># 重启后清空缓存</span>
clear-on-reload
<span class="token comment"># 完整域名才向上游服务器查询，如果是主机名仅查找 hosts 文件</span>
domain-needed

<span class="token comment"># 为特定的域名指定解析它专用的 nameserver。一般是内部 dns name server</span>
<span class="token comment"># server=/myserver.com/192.168.55.1</span>

<span class="token comment"># 指定 dnsmasq 默认查询的上游服务器，此处以 Google Public DNS 为例。</span>
<span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">8.8.8.8</span>
<span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">8.8.4.4</span>

<span class="token comment"># 比如把所有.cn 的域名全部通过 114.114.114.114 这台国内 DNS 服务器来解析</span>
<span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">/cn/114.114.114.114</span>
<span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">/taobao.com/114.114.114.114</span>
<span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">/jd.com/114.114.114.114</span>
<span class="token key attr-name">server</span><span class="token punctuation">=</span><span class="token value attr-value">/qq.com/114.114.114.114</span>


<span class="token comment"># no-hosts, 默认情况下这是注释掉的，dnsmasq 会首先寻找本地的 hosts 文件，再去寻找缓存下来的域名，最后去上级 dns 服务器中寻找；而 addn-hosts 可以使用额外的 hosts 文件。</span>
<span class="token comment"># DNS 解析 hosts 时对应的 hosts 文件，对应 no-hosts</span>
<span class="token key attr-name">addn-hosts</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/hosts</span>
<span class="token comment"># DNS 缓存大小，DNS 解析条数</span>
<span class="token key attr-name">cache-size</span><span class="token punctuation">=</span><span class="token value attr-value">1024</span>
<span class="token comment"># 不缓存未知域名缓存，默认情况下 dnsmasq 会缓存未知域名并直接返回客户端</span>
no-negcache
<span class="token comment"># 指定 DNS 同时查询转发数量</span>
<span class="token key attr-name">dns-forward-max</span><span class="token punctuation">=</span><span class="token value attr-value">1000</span>

<span class="token comment"># 增加一个域名，强制解析到所指定的地址上，强行指定 domain 的 IP 地址</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/doubleclick.net/127.0.0.1</span>
<span class="token comment"># 知道这个原理之后，比如说可以屏蔽广告，把地址解析到一个本地地址</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/ad.youku.com/127.0.0.1</span>
<span class="token key attr-name">address</span><span class="token punctuation">=</span><span class="token value attr-value">/ad.iqiyi.com/127.0.0.1</span>


<span class="token comment"># 多个 IP 用逗号分隔，192.168.x.x 表示本机的 ip 地址，只有 127.0.0.1 的时候表示只有本机可以访问。</span>
<span class="token comment"># 通过这个设置就可以实现同一局域网内的设备，通过把网络 DNS 设置为本机 IP 从而实现局域网范围内的 DNS 泛解析（注：无效 IP 有可能导至服务无法启动）</span>
<span class="token comment"># 监听的服务器地址，通过该地址提供服务</span>
<span class="token key attr-name">listen-address</span><span class="token punctuation">=</span><span class="token value attr-value">192.168.x.x,127.0.0.1</span>

<span class="token comment"># 对于新添加的接口不进行绑定。仅 Linux 系统支持，其他系统等同于 bind-interfaces 选项。</span>
<span class="token comment"># bind-dynamic</span>

<span class="token comment"># hosts 中主机有多个 IP 地址，仅返回对应子网的 IP</span>
localise-queries

<span class="token comment"># 如果反向查找的是私有地址例如  192.168.x.x，仅从 hosts 文件查找，不转发到上游服务器</span>
bogus-priv

<span class="token comment"># 对于任何解析到该 IP 的域名，将响应 NXDOMAIN 使得其解析失效，可多次指定</span>
<span class="token comment"># 禁止跳转运营商广告站点</span>
<span class="token comment">#bogus-nxdomain=64.xx.xx.xx</span>

<span class="token comment"># 如果你想在某个端口只提供 dns 服务，则可以进行配置禁止 dhcp 服务</span>
<span class="token key attr-name">no-dhcp-interface</span><span class="token punctuation">=</span></pre></div></code-block></article><footer></footer></body></html>