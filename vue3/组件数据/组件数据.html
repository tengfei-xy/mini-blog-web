<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>组件数据 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="组件数据" class="main-title"></div></div></header><article><details id="aK9rxmKMi1U4nFLzM4M4Sj" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">数据计算</span></summary><div id="vhZJ494T5GtzcDHpxatJYP" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义</span><span class="inline-wrap">：计算属性是一种特殊类型的属性</span></div></div><div id="b7vE645wzcjTtn8eDQQNJn" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：计算属性可以根据属性的响应式变化而动态计算其值</span></div></div><div id="9PmFxgF7QsixuWWK5oCnYo" class="wolai-block wolai-text"><div><span class="blue inline-wrap">职责</span><span class="inline-wrap">：仅为计算和返回该值</span></div></div><div id="e3gcZZtTnJwNTJbHKKjh5g" class="wolai-block wolai-text"><div><span class="blue inline-wrap">默认</span><span class="inline-wrap">：计算属性只具有<span class="jill"></span>getter<span class="jill"></span>函数</span></div></div><details id="acg9MCCppsNqejQqAYfXAv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">优势</span></summary><ul class="wolai-block"><li id="gsaZw4JP6Z8wzyTGiME6a9"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">可以将复杂的计算逻辑封装成一个属性，使代码更加简洁易读。</span></li><li id="gHEEkHAipPocJdFS3Pxh2d"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">可以提高性能，因为计算属性只会在其依赖的属性发生变化时重新计算。</span></li><li id="5zfQLn1GWTE2xhb1EMHKrN"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">可以方便地在模板中使用，就像使用普通属性一样。</span></li></ul></details><details id="cWy4PUb3TATkcVJD1v4GXF" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">最佳实践</span></summary><details id="ouhUYhp4YrjbkP6HMae2mE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Getter<span class="jill"></span>不应具有副作用</span></summary><aside id="dZMJ4wAd1BW9GD9ZJ4uAop" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">1. 不要改变其他状态
2. 在 getter 中做异步请求或者更改 DOM！</span></aside></details><details id="hwELZ3s3y6J9h2R5f6TL8k" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">避免直接修改计算属性值</span></summary><ol class="wolai-block"><li id="4eCKPDzSPLKkfY7oTkHmHB"><div class="marker"></div><span class="inline-wrap">计算属性返回的值是派生状态，可以只读且不主动更改</span></li><li id="2VBtKG7dw6JNCY1WtpWnDT"><div class="marker"></div><span class="inline-wrap">每次源状态发生改变，都会获取新状态</span></li></ol></details></details><details id="uCuthBEf8P8EocYSaDte22" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><details id="jAQQg2EhCStRP3WZppQoRV" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">选项式<span class="jill"></span>API</span></summary><details id="cjyG2XnELQYhyiVZB6wVEg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">一般示例</span></summary><div id="f3KE6LqnDBPgZWgBjoC9PW" class="wolai-block wolai-text"><div><span class="inline-wrap">代码定义了一个计算属性 </span><span class="inline-wrap"><code>fullName</code></span><span class="inline-wrap">，它将 </span><span class="inline-wrap"><code>firstName</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>lastName</code></span><span class="inline-wrap"> 属性连接在一起</span></div></div><code-block id="a1E5UtWSnNgYoa7L2QTdK9" class="wolai-block"><div class="wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Doe'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">fullName</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">firstName</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastName</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="iMkFhGUMr1q9aBFvDWZkTh" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">具有<span class="jill"></span>get<span class="jill"></span>函数和<span class="jill"></span>set<span class="jill"></span>函数的示例</span></summary><div id="emnaWSf1cRN1LscNcRSCby" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：现在当你再运行 </span><span class="inline-wrap"><code>this.fullName = &#39;John Doe&#39;</code></span><span class="inline-wrap"> 时，setter 会被调用而 </span><span class="inline-wrap"><code>this.firstName</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>this.lastName</code></span><span class="inline-wrap"> 会随之更新。</span></div></div><code-block id="piL5oUQXB7APD6bLfDRbpv" class="wolai-block"><div class="wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">'Doe'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">fullName</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// getter</span>
      <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">firstName</span> <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastName</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// setter</span>
      <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 注意：我们这里使用的是解构赋值语法</span>
        <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">firstName</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">lastName</span><span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="gTQ8t8sxMmV8PXMPD8K8QH" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">组合式<span class="jill"></span>API / ts</span></summary><details id="3SpzgQe84it1ozs9qpqpKW" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">一般示例</span></summary><code-block id="juoWE77M6akTPqXU2teJUM" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 在 Vue 3 的写法：</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义基本的数据</span>
    <span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Gates'</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义需要计算拼接结果的数据</span>
    <span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>firstName<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastName<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token comment">// 2s 后改变某个数据的值</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      firstName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Petter'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

    <span class="token comment">// template 那边在 2s 后也会显示为 Petter Gates</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      fullName<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="pNytnS8kHEcsGELPub9Utj" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">具有<span class="jill"></span>get<span class="jill"></span>函数和<span class="jill"></span>set<span class="jill"></span>函数的示例</span></summary><code-block id="nxdfHEmBvWX7MQgYnLbEYt" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 还是这2个数据源</span>
<span class="token keyword">const</span> firstName <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Bill'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> lastName <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Gates'</span><span class="token punctuation">)</span>

<span class="token comment">// 这里配合setter的需要，改成了另外一种写法</span>
<span class="token keyword">const</span> fullName <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// getter还是返回一个拼接起来的全名</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>firstName<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastName<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// setter这里改成只更新firstName，注意参数也定义TS类型</span>
  <span class="token function">set</span><span class="token punctuation">(</span>newFirstName<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    firstName<span class="token punctuation">.</span>value <span class="token operator">=</span> newFirstName
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fullName<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 输出 Bill Gates</span>

<span class="token comment">// 2s后更新一下数据</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// 对fullName的赋值，其实更新的是firstName</span>
  fullName<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Petter'</span>

  <span class="token comment">// 此时firstName已经得到了更新</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstName<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 会输出 Petter</span>

  <span class="token comment">// 当然，由于firstName变化了，所以fullName的getter也会得到更新</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fullName<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// 会输出 Petter Gates</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span></pre></div></code-block></details></details></details></details><details id="PwsggzACSFtahNEK1gUFc" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">侦听数据</span></summary><details id="9vRDv1YpojwmZdrNKkaKxg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#watch"><span><code>watch</code></span></a></span><span class="inline-wrap"> / 组合式<span class="jill"></span>API</span></summary><div id="tkVZGaSWke7QdQHnTsA7zS" class="wolai-block wolai-text"><div><span class="blue inline-wrap">性质</span><span class="inline-wrap">：惰性</span></div></div><div id="81Q6TXvQkz9z5sNGAUmAX8" class="wolai-block wolai-text"><div><span class="blue inline-wrap">性质描述</span><span class="inline-wrap">：只有当被侦听的数据源发生变化时才执行回调。</span></div></div><div class="block-ref"><div class="decorator"></div><details id="juuX1knD56fdM3i4bfN99L" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap">的区别</span></summary><div id="tB7gPgibZPo6bz8sKQTbZc" class="wolai-block wolai-text"><div><span class="inline-wrap"> </span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap"> 是 </span><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 的一个简化操作，可以用来代替 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#批量侦听"><span>批量侦听</span></a></span><span class="inline-wrap"> </span></div></div><div id="6PrUruJGUXNQVdRSzDxzZX" class="wolai-block wolai-text"><div><span class="inline-wrap">区别：</span></div></div><ol class="wolai-block"><li id="x4uguoMRChzg2mCULNXdYo"><div class="marker"></div><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 可以访问侦听状态变化前后的值，而 </span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap"> 没有。</span></li><li id="3bCChA4WYu4fnVU3bdeobP"><div class="marker"></div><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 是在属性改变的时候才执行，而 </span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap"> 则首先默认会执行一次，然后在属性改变的时候也会执行。</span></li><li id="mQoJHhZvrPXzUMrdWG5Zve"><div class="marker"></div><span class="inline-wrap">·</span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap">不支持</span><span class="inline-wrap"><code>deep</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>immediate</code></span></li></ol></details></div><details id="dpvBDrxE3zqSo4SF9QtRvg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ts</span></summary><details id="rTacvuvRQK3xScX3iWePjg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#基础用法"><span>基本用法</span></a></span></summary><details id="xt3MXqLcjxJxnydaRUjapg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><details id="vi98i5gNyfubuEKkCztDsK" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">原型</span></summary><code-block id="7Q5jd3TTRdguDytVd1yXgT" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">watch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Immediate <span class="token keyword">extends</span> Readonly<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  source<span class="token operator">:</span> WatchSource<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span>
  cb<span class="token operator">:</span> WatchCallback<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Immediate <span class="token keyword">extends</span> <span class="token class-name"><span class="token boolean">true</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">:</span> <span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchOptions<span class="token operator">&lt;</span>Immediate<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> WatchStopHandle
<span class="token comment">// ...</span></pre></div></code-block></details><details id="umvGA1tYrqQzNn4JY5PAY2" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">输入参数</span></summary><details id="dRXTy1ZeMi5ks2C4v2gcH9" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">source</span></summary><aside id="3RRVmYhqkpzUP8SXY5SVsG" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">对于能够用于侦听的数据，是通过 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#响应式数据的变化-new"><span>响应式 API</span></a></span><span class="inline-wrap"> 定义的变量（ </span><span class="inline-wrap"><code>Ref&lt;T&gt;</code></span><span class="inline-wrap"> ），
或者是一个 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#数据的计算-new"><span>计算数据</span></a></span><span class="inline-wrap"> （ </span><span class="inline-wrap"><code>ComputedRef&lt;T&gt;</code></span><span class="inline-wrap"> ），
或者是一个 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/get"><span>getter 函数</span></a></span><span class="inline-wrap"> （ </span><span class="inline-wrap"><code>() =&gt; T</code></span><span class="inline-wrap"> ）。</span></aside><div id="8V5L5Mrq5XghzMY6avnder" class="wolai-block wolai-text"><div><span class="blue inline-wrap">是否可选</span><span class="inline-wrap">：必传</span></div></div><div id="wV1zUyndVBsR6QFHEFgQ6v" class="wolai-block wolai-text"><div><span class="blue inline-wrap">含义</span><span class="inline-wrap">：数据源（详见：</span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#要侦听的数据源"><span>要侦听的数据源</span></a></span><span class="inline-wrap">）</span></div></div><div id="nLgyMYsVCuW556mB7KkEwW" class="wolai-block wolai-text"><div><span class="blue inline-wrap">语法</span><span class="inline-wrap">：</span></div></div><code-block id="4E7bgfSYssaySvLFV8nVqe" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">WatchSource<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">|</span> ComputedRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="6Ja8LmiPVVJNX65W4iyM9T" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">callback</span></summary><div id="3rYvFD1UKH341wp9CCWpYv" class="wolai-block wolai-text"><div><span class="blue inline-wrap">是否可选</span><span class="inline-wrap">：必传</span></div></div><div id="fc25s9UEVXDoS1UBmU8aUm" class="wolai-block wolai-text"><div><span class="blue inline-wrap">含义</span><span class="inline-wrap">：侦听到变化后要执行的回调函数（详见：</span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听后的回调函数"><span>侦听后的回调函数</span></a></span><span class="inline-wrap">）</span></div></div><div id="86suEQzDCGf5QNAJeRtwoR" class="wolai-block wolai-text"><div><span class="blue inline-wrap">语法</span><span class="inline-wrap">：</span></div></div><code-block id="xkvaNJ1cynf6XkRzzmVLuk" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">WatchCallback<span class="token operator">&lt;</span><span class="token constant">V</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token constant">OV</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  value<span class="token operator">:</span> <span class="token constant">V</span><span class="token punctuation">,</span>
  oldValue<span class="token operator">:</span> <span class="token constant">OV</span><span class="token punctuation">,</span>
  onCleanup<span class="token operator">:</span> OnCleanup
<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">any</span></pre></div></code-block><details id="jqfj6qhTgWtCJf3zCCnFeu" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参数说明</span></summary><div id="keGevxC9XvRw7PUcS6HgTD" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 100px"><span class="inline-wrap">参数</span></th><th style="width: 357px"><span class="inline-wrap">作用</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">value</span></td><td><span class="inline-wrap">变化后的新值，类型和数据源保持一致</span></td></tr><tr><td><span class="inline-wrap">oldValue</span></td><td><span class="inline-wrap">变化前的旧值，类型和数据源保持一致</span></td></tr><tr><td><span class="inline-wrap">onCleanup</span></td><td><span class="inline-wrap">注册一个清理函数，详见 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听效果清理"><span>侦听效果清理</span></a></span><span class="inline-wrap"> 部分</span></td></tr></tbody></table></div></details><details id="co5SyvyZtrNJ6kAGqT9F2W" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>option</code></span></summary><details id="4HWyoLoCdN8qiAy6M4Aakq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><code-block id="sjsUMcstyLvzs4FZNQR2Hn" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">OnCleanup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function-variable function">cleanupFn</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span></pre></div></code-block></details><details id="24n3TtbpLn8ndaJPmdhtKS" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><code-block id="mgqtSt5tndFXFgdsssU2z6" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">let</span> unwatch<span class="token operator">:</span> WatchStopHandle
unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>
  message<span class="token punctuation">,</span>
  <span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> onCleanup<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要在停止侦听之前注册好清理行为</span>
    <span class="token function">onCleanup</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'侦听清理ing'</span><span class="token punctuation">)</span>
      <span class="token comment">// 根据实际的业务情况定义一些清理操作 ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// 然后再停止侦听</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> unwatch <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span></pre></div></code-block></details></details></details><details id="dacTjzsM394jg4388ZwTRn" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">option</span></summary><div id="tvALu4kZjz51QLcwY471Xg" class="wolai-block wolai-text"><div><span class="blue inline-wrap">是否可选</span><span class="inline-wrap">：可选</span></div></div><div id="ti5wKbpJVtHRskUmirDStn" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：</span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听的选项"><span>侦听选项</span></a></span></div></div><div id="6wBJ3XR5q5kCJU8zQ2iCPe" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>options</code></span><span class="inline-wrap"> 是一个对象的形式传入</span></div></div><details id="8PiTshmp2tiskrcxW1igRK" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><code-block id="mvxtLf6mRkidr2ghXgh6or" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">WatchOptions<span class="token operator">&lt;</span>Immediate <span class="token operator">=</span> <span class="token builtin">boolean</span><span class="token operator">></span></span>
  <span class="token keyword">extends</span> <span class="token class-name">WatchOptionsBase</span> <span class="token punctuation">{</span>
  immediate<span class="token operator">?</span><span class="token operator">:</span> Immediate
  deep<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>

<span class="token comment">// 继承的 base 类型</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">WatchOptionsBase</span> <span class="token keyword">extends</span> <span class="token class-name">DebuggerOptions</span> <span class="token punctuation">{</span>
  flush<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'pre'</span> <span class="token operator">|</span> <span class="token string">'post'</span> <span class="token operator">|</span> <span class="token string">'sync'</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>

<span class="token comment">// 继承的 debugger 选项类型</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">DebuggerOptions</span> <span class="token punctuation">{</span>
  onTrack<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
  onTrigger<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="ajQ2a9cXkLvxpczRWFtPAE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参数</span></summary><details id="hsEGZZr1KGm5Cfc9TkMcGX" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听选项之-deep"><span><code>deep</code></span></a></span></summary><aside id="ixNGSaJqXb1mCxWAtJnZpi" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">设置为 </span><span class="inline-wrap"><code>false</code></span><span class="inline-wrap"> 的情况下，如果直接侦听一个响应式的 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Data_structures#对象"><span>引用类型</span></a></span><span class="inline-wrap"> 数据（e.g. </span><span class="inline-wrap"><code>Object</code></span><span class="inline-wrap">、 </span><span class="inline-wrap"><code>Array</code></span><span class="inline-wrap"> … ）,不会触发触发 watch 的 callback 。</span></aside><div id="rxfToy9d8C6gDwMbQJTqWU" class="wolai-block wolai-text"><div><span class="blue inline-wrap">可选必选</span><span class="inline-wrap">：可选</span></div></div><div id="8C9N29GbnNFb3zR9A7xTaD" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：boolean</span></div></div><div id="71amYCfYCnQUxGcG4H8z2u" class="wolai-block wolai-text"><div><span class="blue inline-wrap">默认</span><span class="blue inline-wrap">参数</span><span class="inline-wrap">：false</span></div></div><div id="75oqtDAXKHuJEerAEUSyZg" class="wolai-block wolai-text"><div><span class="blue inline-wrap">可选</span><span class="blue inline-wrap">参数</span><span class="inline-wrap">：true、false</span></div></div><div id="fj2nA2tNAyK3ShQ79jkJJP" class="wolai-block wolai-text"><div><span class="blue inline-wrap">可选参数说明</span><span class="inline-wrap">：设置为 </span><span class="inline-wrap"><code>true</code></span><span class="inline-wrap"> 开启深度侦听，或者是 </span><span class="inline-wrap"><code>false</code></span><span class="inline-wrap"> 关闭深度侦听，</span></div></div><div id="6GB5KrRAAtYVU3i7ApdxXY" class="wolai-block wolai-text"><div><span class="blue inline-wrap">深度侦听</span><span class="inline-wrap">：Deep Watch<span class="jill"></span>是在<span class="jill"></span>Vue<span class="jill"></span>中用于侦听对象或数组的变化的一种方式。默认情况下，Vue<span class="jill"></span>的响应系统会追踪对象或数组的引用，而不会深入观察其内部的属性或元素。这意味着如果你修改了对象或数组的属性或元素，而不改变对象或数组本身的引用，Vue<span class="jill"></span>可能无法检测到这些变化。为了解决这个问题，Vue<span class="jill"></span>提供了一种特殊的侦听选项</span><span class="inline-wrap"><code>deep</code></span><span class="inline-wrap">，用于在对象或数组上进行深度侦听。当你将</span><span class="inline-wrap"><code>deep</code></span><span class="inline-wrap">选项设置为</span><span class="inline-wrap"><code>true</code></span><span class="inline-wrap">时，Vue<span class="jill"></span>将会递归地侦听对象内部的属性或数组内部的元素，以便能够捕获到它们的变化。</span></div></div><details id="wEuJdy6Q3RptpmTeuJW6hk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><code-block id="8CnwwuWNFWZ8mXdiDXf8vZ" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个响应式数据，注意用的是 ref 来定义</span>
    <span class="token keyword">const</span> nums <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// 2s后给这个数组添加项目</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      nums<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

      <span class="token comment">// 可以打印一下，确保数据确实变化了</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改后'</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

    <span class="token comment">// 但是这个 watch 不会按预期执行</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>
      nums<span class="token punctuation">,</span>
      <span class="token comment">// 这里的 callback 不会被触发</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'触发侦听'</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 因为关闭了 deep</span>
      <span class="token punctuation">{</span>
        deep<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details></details><details id="5UfMTia6UA1r6cUy85BvQD" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听选项之-immediate"><span><code>immediate</code></span></a></span></summary><aside id="3zLX5DgrBarPGU3S2WKWCa" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">注意，在带有 immediate 选项时，不能在第一次回调时取消该数据源的侦听，详见 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#停止侦听"><span>停止侦听</span></a></span><span class="inline-wrap"> 部分。</span></aside><div id="iNpSYCfYzsiv9yZDQecG1E" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap">是惰性的，但<span class="jill"></span>immediate<span class="jill"></span>可以直接触发侦听回调，</span></div></div><div id="ox6oUoUL89x1Wcnf5m3i1b" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：boolean</span></div></div><div id="4YengnpDaZebTWXXLnEQFX" class="wolai-block wolai-text"><div><span class="blue inline-wrap">默认</span><span class="blue inline-wrap">参数</span><span class="inline-wrap">：false</span></div></div><div id="8yM4x584Sn52NAzTTmXFLR" class="wolai-block wolai-text"><div><span class="blue inline-wrap">可选</span><span class="blue inline-wrap">参数</span><span class="inline-wrap">：true、false</span></div></div></details><details id="ecmkxAq4gtHij4TzkKevfu" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>flush</code></span></summary><div id="x38ZcmEFLp4ZGui1i7Cd8p" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：string</span></div></div><div id="p5zGCepMni4kgc5g1w6cZs" class="wolai-block wolai-text"><div><span class="blue inline-wrap">默认值</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>&#39;pre&#39;</code></span></div></div><div id="dbkipUyVoekcFZLnkWPWpr" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：用来控制 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听后的回调函数"><span>侦听回调</span></a></span><span class="inline-wrap"> 的调用时机，接受指定的字符串</span></div></div><details id="5wn8r9JUtkE7uUSLbxY87m" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">可选值</span></summary><div id="uA1XzoB3GkWcFDUiCCtZFP" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 100px"><span class="inline-wrap">可选值</span></th><th style="width: 100px"><span class="inline-wrap">回调的调用时机</span></th><th style="width: 291px"><span class="inline-wrap">使用场景</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">&#39;pre&#39;</span></td><td><span class="inline-wrap">将在渲染前被调用</span></td><td><span class="inline-wrap">允许回调在模板运行前更新了其他值</span></td></tr><tr><td><span class="inline-wrap">&#39;sync&#39;</span></td><td><span class="inline-wrap">在渲染时被同步调用</span></td><td><span class="inline-wrap">目前来说没什么好处，可以了解但不建议用…</span></td></tr><tr><td><span class="inline-wrap">&#39;post&#39;</span></td><td><span class="inline-wrap">被推迟到渲染之后调用</span></td><td><span class="inline-wrap">如果要通过 ref 操作 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#dom-元素与子组件"><span>DOM 元素与子组件</span></a></span><span class="inline-wrap"> ，需要使用这个值来启用该选项，以达到预期的执行效果</span></td></tr></tbody></table></div><div id="9pDT3vEbw8UFZkR769HaMg" class="wolai-block wolai-text"><div><span class="inline-wrap">对于 </span><span class="inline-wrap"><code>&#39;pre&#39;</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>&#39;post&#39;</code></span><span class="inline-wrap"> ，回调使用队列进行缓冲。回调只被添加到队列中一次。</span></div></div></details></details><details id="oRJzvnKgzQVshd5q8Zmmyk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>onTrack</code></span></summary><div id="vYBtATauRWzuop35iMQKYj" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>(e) =&gt; void</code></span></div></div><div id="phs4GNApskxwuswpuW549R" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：</span><span class="inline-wrap">在数据源被追踪时调用</span></div></div><div id="oMX7xWG6FYPSDEKaWaUFL9" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>e</code></span><span class="inline-wrap"> 是 debugger 事件，建议在回调内放置一个 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/debugger"><span>debugger 语句</span></a></span><span class="inline-wrap"> 以调试依赖，这两个选项仅在开发模式下生效。</span></div></div></details><details id="32adMosgiH7zsjcR5h8mjv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>onTrigger</code></span></summary><div id="xrhjUC2t19SyYvm4KkXuyZ" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>(e) =&gt; void</code></span></div></div><div id="k38HbYpfZiaAivvMCzyoKo" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：</span><span class="inline-wrap">在侦听回调被触发时调用</span></div></div><div id="w2tW1TDKUjPTsrgT9nMjh1" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>e</code></span><span class="inline-wrap"> 是 debugger 事件，建议在回调内放置一个 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/debugger"><span>debugger 语句</span></a></span><span class="inline-wrap"> 以调试依赖，这两个选项仅在开发模式下生效。</span></div></div></details></details></details></details><details id="tiFWPUgeCzyTAavrhnW5BJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">返回值</span></summary><div id="5jjagMSYGG1Xq812mJFZv1" class="wolai-block wolai-text"><div><span class="blue inline-wrap">描述</span><span class="inline-wrap">：返回一个可以用来停止侦听的函数（详见：</span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#停止侦听"><span>停止侦听</span></a></span><span class="inline-wrap">）。</span></div></div><details id="g7i1Udx42aiZjrmACXvBnb" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">函数原型</span></summary><code-block id="TbRzTHxdFnGsae1o5QJGX" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">WatchStopHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span></pre></div></code-block></details><details id="qNwGohxdXkzWqFggQn2fqm" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><details id="ihiHnVvRb6VYF87q68wTZn" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">没有启动</span><span class="inline-wrap"><code>immediate</code></span><span class="inline-wrap">选项</span></summary><code-block id="9Ka3USFG8oPu5sg3nw5MtR" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 定义一个取消观察的变量，它是一个函数</span>
<span class="token keyword">const</span> unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在合适的时期调用它，可以取消这个侦听</span>
<span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="9nmqPbwkjWGm94mDWGPq54" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">启动</span><span class="inline-wrap"><code>immediate</code></span><span class="inline-wrap">选项</span></summary><code-block id="ivPAzv61VvqGDCKfC6gc8u" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 如果不想用 any ，可以导入 TS 类型</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> WatchStopHandle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 这里改成 let ，但是要另起一行，先定义，再赋值</span>
<span class="token keyword">let</span> unwatch<span class="token operator">:</span> WatchStopHandle
unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>
  message<span class="token punctuation">,</span>
  <span class="token comment">// 侦听回调</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里加一个判断，是函数才执行它</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> unwatch <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 侦听选项</span>
  <span class="token punctuation">{</span>
    immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span></pre></div></code-block></details></details></details></details><details id="3ENZCCDsCNknzVJyCiEP9P" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><code-block id="3rFKr3JfS7pLwPRNxfE91a" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 不要忘了导入要用的 API</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个响应式数据</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 2s后改变数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Tom'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

    <span class="token doc-comment comment">/**
     * 可以直接侦听这个响应式对象
     * callback 的参数如果不用可以不写
     */</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'侦听整个 userInfo '</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token doc-comment comment">/**
     * 也可以侦听对象里面的某个值
     * 此时数据源需要写成 getter 函数
     */</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token comment">// 数据源，getter 形式</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
      <span class="token comment">// 回调函数 callback</span>
      <span class="token punctuation">(</span>newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'只侦听 name 的变化 '</span><span class="token punctuation">,</span> userInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'打印变化前后的值'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> oldValue<span class="token punctuation">,</span> newValue <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details></details><details id="3aWkSGXqmL9V5y3o4bw9rB" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#批量侦听"><span>批量侦听</span></a></span></summary><details id="aebiY2NyC6DZiLWa5TauvT" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><code-block id="nNcQvcRPCBtS5rew6Q8sth" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// watch 部分的 TS 类型</span>
<span class="token comment">// ...</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">watch</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> MultiWatchSources<span class="token punctuation">,</span>
  Immediate <span class="token keyword">extends</span> Readonly<span class="token operator">&lt;</span><span class="token builtin">boolean</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token operator">></span></span></span><span class="token punctuation">(</span>
  sources<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  cb<span class="token operator">:</span> WatchCallback<span class="token operator">&lt;</span>MapSources<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token operator">></span><span class="token punctuation">,</span> MapSources<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> Immediate<span class="token operator">>></span><span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchOptions<span class="token operator">&lt;</span>Immediate<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token operator">:</span> WatchStopHandle

<span class="token comment">// MultiWatchSources 是一个数组</span>
<span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">MultiWatchSources</span> <span class="token operator">=</span> <span class="token punctuation">(</span>WatchSource<span class="token operator">&lt;</span><span class="token builtin">unknown</span><span class="token operator">></span> <span class="token operator">|</span> object<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token comment">// ...</span></pre></div></code-block></details><div id="69BLcWJKD4k46fXBF8Eq2b" class="wolai-block wolai-text"><div><span class="blue inline-wrap">使用场景</span><span class="inline-wrap">：比如一个子组件有多个 props ，当有任意一个 prop 发生变化时，都需要执行初始化函数重置组件的状态，那么这个时候就可以用上这个功能啦！</span></div></div><details id="9BjQTM3qjwqXVWAq1t1mm4" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><div id="47JrbdXQ5KhDYgZ1daU42u" class="wolai-block wolai-text"><div><span class="blue inline-wrap">与基本用法的区别</span><span class="inline-wrap">：数据源和回调参数都变成了数组的形式。</span></div></div><code-block id="qmYPEZqAKU7NoQBEmmQfPw" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义多个数据源</span>
    <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token comment">// 2s后改变数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      message<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Hello World!'</span>
      index<span class="token punctuation">.</span>value<span class="token operator">++</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token comment">// 数据源改成了数组</span>
      <span class="token punctuation">[</span>message<span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 回调的入参也变成了数组，每个数组里面的顺序和数据源数组排序一致</span>
      <span class="token punctuation">(</span><span class="token punctuation">[</span>newMessage<span class="token punctuation">,</span> newIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>oldMessage<span class="token punctuation">,</span> oldIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message 的变化'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> newMessage<span class="token punctuation">,</span> oldMessage <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'index 的变化'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> newIndex<span class="token punctuation">,</span> oldIndex <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details></details><details id="uso6SnXjzWjEaN7Rt494Po" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">停止监听</span></summary><div id="SLMceVGMMzkCmNXcbJpnB" class="wolai-block wolai-text"><div><span class="blue inline-wrap">自动停止</span><span class="inline-wrap">：如果在 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#全新的-setup-函数-new"><span>setup</span></a></span><span class="inline-wrap"> 或者 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/efficient.html#script-setup-new"><span>script-setup</span></a></span><span class="inline-wrap"> 里使用</span><span class="red inline-wrap"><b>同步语句创建的监听器</b></span><span class="inline-wrap">的话， </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#组件的生命周期-new"><span>组件被卸载</span></a></span><span class="inline-wrap"> 的时候也会一起被停止</span></div></div><details id="g2y75a5YcVJ6HVoQJqADby" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">手动停止</span></summary><div class="block-ref"><div class="decorator"></div><div id="5jjagMSYGG1Xq812mJFZv1" class="wolai-block wolai-text"><div><span class="blue inline-wrap">描述</span><span class="inline-wrap">：返回一个可以用来停止侦听的函数（详见：</span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#停止侦听"><span>停止侦听</span></a></span><span class="inline-wrap">）。</span></div></div></div><div class="block-ref"><div class="decorator"></div><details id="g7i1Udx42aiZjrmACXvBnb" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">函数原型</span></summary><code-block id="TbRzTHxdFnGsae1o5QJGX" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">WatchStopHandle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span></pre></div></code-block></details></div><div class="block-ref"><div class="decorator"></div><details id="qNwGohxdXkzWqFggQn2fqm" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><details id="ihiHnVvRb6VYF87q68wTZn" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">没有启动</span><span class="inline-wrap"><code>immediate</code></span><span class="inline-wrap">选项</span></summary><code-block id="9Ka3USFG8oPu5sg3nw5MtR" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 定义一个取消观察的变量，它是一个函数</span>
<span class="token keyword">const</span> unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在合适的时期调用它，可以取消这个侦听</span>
<span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="9nmqPbwkjWGm94mDWGPq54" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">启动</span><span class="inline-wrap"><code>immediate</code></span><span class="inline-wrap">选项</span></summary><code-block id="ivPAzv61VvqGDCKfC6gc8u" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 如果不想用 any ，可以导入 TS 类型</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> WatchStopHandle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 这里改成 let ，但是要另起一行，先定义，再赋值</span>
<span class="token keyword">let</span> unwatch<span class="token operator">:</span> WatchStopHandle
unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>
  message<span class="token punctuation">,</span>
  <span class="token comment">// 侦听回调</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里加一个判断，是函数才执行它</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> unwatch <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 侦听选项</span>
  <span class="token punctuation">{</span>
    immediate<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span></pre></div></code-block></details></details></div></details></details><details id="eHoK5D8SsURvvCicpzpCZ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">路由侦听</span></summary><details id="gJ2j2Gj2MHD3HtU8kpEbpM" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">监听整个路由</span></summary><code-block id="mBcxVfTXM2WSKSsHwdFnaS" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 侦听整个路由</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> <span class="token punctuation">(</span>to<span class="token punctuation">,</span> from<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// 处理一些事情</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="wC4fCQPEfUmyKMXKmYsWz" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">监听某个路由的数据</span></summary><code-block id="x8J3qrPMEWVem8o1w7UkuY" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 侦听路由参数的变化</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> route<span class="token punctuation">.</span>query<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'侦听到 ID 变化'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details></details></details><details id="2bHoyV8zcgMUn23q2BUEQr" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">js</span></summary><div id="bgN8pWMT14xL131PLBeosV" class="wolai-block wolai-text"><div><span class="inline-wrap">语法</span></div></div><code-block id="6rdytr3vSV9X51N84YGw4H" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token function">watch</span><span class="token punctuation">(</span>
  source<span class="token punctuation">,</span> <span class="token comment">// 必传，要侦听的数据源</span>
  callback <span class="token comment">// 必传，侦听到变化后要执行的回调函数</span>
  <span class="token comment">// options // 可选，一些侦听选项</span>
<span class="token punctuation">)</span></pre></div></code-block><div id="xzFveeCBobGftebGpgLzGk" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details></details><details id="fBZWh5yq5FAEMmeNiEcY7C" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>watchEffect</code></span></summary><details id="juuX1knD56fdM3i4bfN99L" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap">的区别</span></summary><div id="tB7gPgibZPo6bz8sKQTbZc" class="wolai-block wolai-text"><div><span class="inline-wrap"> </span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap"> 是 </span><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 的一个简化操作，可以用来代替 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#批量侦听"><span>批量侦听</span></a></span><span class="inline-wrap"> </span></div></div><div id="6PrUruJGUXNQVdRSzDxzZX" class="wolai-block wolai-text"><div><span class="inline-wrap">区别：</span></div></div><ol class="wolai-block"><li id="x4uguoMRChzg2mCULNXdYo"><div class="marker"></div><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 可以访问侦听状态变化前后的值，而 </span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap"> 没有。</span></li><li id="3bCChA4WYu4fnVU3bdeobP"><div class="marker"></div><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 是在属性改变的时候才执行，而 </span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap"> 则首先默认会执行一次，然后在属性改变的时候也会执行。</span></li><li id="mQoJHhZvrPXzUMrdWG5Zve"><div class="marker"></div><span class="inline-wrap">·</span><span class="inline-wrap"><code>watchEffect</code></span><span class="inline-wrap">不支持</span><span class="inline-wrap"><code>deep</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>immediate</code></span></li></ol></details><details id="fVDNMswN8Vqx9zfyZgAJe9" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ts</span></summary><details id="5LpB1kyyv3HNdyPUDK2xRk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><details id="fTHr3PZZRXUDi9danyDg6w" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">输入参数</span></summary><div id="4Qwkm8sLgyAtCH9EnL6NhW" class="wolai-block wolai-text"><div><span class="blue inline-wrap">必选</span><span class="inline-wrap">：一个副作用函数（相当于 watch 的 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听后的回调函数"><span>侦听后的回调函数</span></a></span><span class="inline-wrap"> ）</span></div></div><details id="5ibPYB4NEw4uTr6Dt9Qph3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">option</span></summary><div id="sNHDKiyC6h5SaYdKvGAwg" class="wolai-block wolai-text"><div><span class="blue inline-wrap">是否可选</span><span class="inline-wrap">：可选</span></div></div><div id="3YWSpwK2krSacoe5KkMuT" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：侦听选项</span></div></div><div id="ur5kECgyw2P5ytYGLSFG2x" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>options</code></span><span class="inline-wrap"> 是一个对象的形式传入</span></div></div><details id="3g9E8GiHf6SnkmHqnoup6F" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法原型</span></summary><code-block id="qngwc19iqHfPseyL6uXGu" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 只支持 base 类型</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">WatchOptionsBase</span> <span class="token keyword">extends</span> <span class="token class-name">DebuggerOptions</span> <span class="token punctuation">{</span>
  flush<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'pre'</span> <span class="token operator">|</span> <span class="token string">'post'</span> <span class="token operator">|</span> <span class="token string">'sync'</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span>

<span class="token comment">// 继承的 debugger 选项类型</span>
<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">interface</span> <span class="token class-name">DebuggerOptions</span> <span class="token punctuation">{</span>
  onTrack<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
  onTrigger<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>
<span class="token comment">// ...</span></pre></div></code-block></details><details id="duNFWMW2z8XP1RWx8FyDmn" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参数</span></summary><div class="block-ref"><div class="decorator"></div><details id="ecmkxAq4gtHij4TzkKevfu" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>flush</code></span></summary><div id="x38ZcmEFLp4ZGui1i7Cd8p" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：string</span></div></div><div id="p5zGCepMni4kgc5g1w6cZs" class="wolai-block wolai-text"><div><span class="blue inline-wrap">默认值</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>&#39;pre&#39;</code></span></div></div><div id="dbkipUyVoekcFZLnkWPWpr" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：用来控制 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#侦听后的回调函数"><span>侦听回调</span></a></span><span class="inline-wrap"> 的调用时机，接受指定的字符串</span></div></div><details id="5wn8r9JUtkE7uUSLbxY87m" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">可选值</span></summary><div id="uA1XzoB3GkWcFDUiCCtZFP" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 100px"><span class="inline-wrap">可选值</span></th><th style="width: 100px"><span class="inline-wrap">回调的调用时机</span></th><th style="width: 291px"><span class="inline-wrap">使用场景</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">&#39;pre&#39;</span></td><td><span class="inline-wrap">将在渲染前被调用</span></td><td><span class="inline-wrap">允许回调在模板运行前更新了其他值</span></td></tr><tr><td><span class="inline-wrap">&#39;sync&#39;</span></td><td><span class="inline-wrap">在渲染时被同步调用</span></td><td><span class="inline-wrap">目前来说没什么好处，可以了解但不建议用…</span></td></tr><tr><td><span class="inline-wrap">&#39;post&#39;</span></td><td><span class="inline-wrap">被推迟到渲染之后调用</span></td><td><span class="inline-wrap">如果要通过 ref 操作 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#dom-元素与子组件"><span>DOM 元素与子组件</span></a></span><span class="inline-wrap"> ，需要使用这个值来启用该选项，以达到预期的执行效果</span></td></tr></tbody></table></div><div id="9pDT3vEbw8UFZkR769HaMg" class="wolai-block wolai-text"><div><span class="inline-wrap">对于 </span><span class="inline-wrap"><code>&#39;pre&#39;</code></span><span class="inline-wrap"> 和 </span><span class="inline-wrap"><code>&#39;post&#39;</code></span><span class="inline-wrap"> ，回调使用队列进行缓冲。回调只被添加到队列中一次。</span></div></div></details></details></div><div class="block-ref"><div class="decorator"></div><details id="oRJzvnKgzQVshd5q8Zmmyk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>onTrack</code></span></summary><div id="vYBtATauRWzuop35iMQKYj" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>(e) =&gt; void</code></span></div></div><div id="phs4GNApskxwuswpuW549R" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：</span><span class="inline-wrap">在数据源被追踪时调用</span></div></div><div id="oMX7xWG6FYPSDEKaWaUFL9" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>e</code></span><span class="inline-wrap"> 是 debugger 事件，建议在回调内放置一个 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/debugger"><span>debugger 语句</span></a></span><span class="inline-wrap"> 以调试依赖，这两个选项仅在开发模式下生效。</span></div></div></details></div><div class="block-ref"><div class="decorator"></div><details id="32adMosgiH7zsjcR5h8mjv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>onTrigger</code></span></summary><div id="xrhjUC2t19SyYvm4KkXuyZ" class="wolai-block wolai-text"><div><span class="blue inline-wrap">类型</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>(e) =&gt; void</code></span></div></div><div id="k38HbYpfZiaAivvMCzyoKo" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：</span><span class="inline-wrap">在侦听回调被触发时调用</span></div></div><div id="w2tW1TDKUjPTsrgT9nMjh1" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>e</code></span><span class="inline-wrap"> 是 debugger 事件，建议在回调内放置一个 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/debugger"><span>debugger 语句</span></a></span><span class="inline-wrap"> 以调试依赖，这两个选项仅在开发模式下生效。</span></div></div></details></div></details></details></details><details id="m3KuhvEtndtiQF6iFc7Txc" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">返回值</span></summary><div id="35CCbq1dr7mouPq5pcEpA9" class="wolai-block wolai-text"><div><span class="inline-wrap">返回一个用于 </span><span class="inline-wrap"><a href="https://vue3.chengpeiquan.com/component.html#停止侦听"><span>停止侦听</span></a></span><span class="inline-wrap"> 的函数。</span></div></div></details><details id="koSnRToXru8C2z27wThrNJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">原型</span></summary><code-block id="mCAbKCUTgQKTp11bYyzQ7x" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">type</span> <span class="token class-name">WatchEffect</span> <span class="token operator">=</span> <span class="token punctuation">(</span>onCleanup<span class="token operator">:</span> OnCleanup<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span>

<span class="token keyword">export</span> <span class="token keyword">declare</span> <span class="token keyword">function</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span>
  effect<span class="token operator">:</span> WatchEffect<span class="token punctuation">,</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchOptionsBase
<span class="token punctuation">)</span><span class="token operator">:</span> WatchStopHandle</pre></div></code-block></details></details><details id="rZiqweRXqbACmcMsLgfNQU" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><details id="4qVBrmM2KtosgTWuRoGtW" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">一般用法</span></summary><div id="6BQky2KhZfqFEFS6d1ics" class="wolai-block wolai-text"><div><span class="inline-wrap">描述：立即执行传入的一个函数，同时响应式追踪其依赖，并在其依赖变更时重新运行该函数。</span></div></div><code-block id="pNxEXt9VRSRmYvWb5KywhE" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 单独定义两个数据，后面用来分开改变数值</span>
    <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Petter'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义一个调用这两个数据的函数</span>
    <span class="token keyword">const</span> getUserInfo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token operator">:</span> name<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        age<span class="token operator">:</span> age<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2s后改变第一个数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      name<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Tom'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

    <span class="token comment">// 4s后改变第二个数据</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">20</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span>

    <span class="token comment">// 直接侦听调用函数，在每个数据产生变化的时候，它都会自动执行</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span>getUserInfo<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="oUKyDyuzhM3VMU1z98Sxn1" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">路由侦听</span></summary><div id="3qfqzsrGdWJdfLjf6BY9Vn" class="wolai-block wolai-text"><div><span class="blue inline-wrap">意义</span><span class="inline-wrap">：可以简化 </span><span class="inline-wrap"><code>watch</code></span><span class="inline-wrap"> 的行为。</span></div></div><div id="d7ryyqkxj4A2TyoB3a7UV4" class="wolai-block wolai-text"><div><span class="inline-wrap">比如定义了一个函数，通过路由的参数来获取文章 ID ，然后请求文章内容：</span></div></div><code-block id="dkunH7zAZ7c4niVe6tAPVB" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useRoute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 从接口查询文章详情</span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">queryArticleDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文章 ID 是：'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span>

      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/article/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 直接侦听包含路由参数的那个函数</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span>queryArticleDetail<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block></details></details></details></details><details id="kjjDpyrjefgAZJfKaEL2AH" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>watchPostEffect</code></span></summary><div id="cGs3jbwKMbxHYnbo8Fsj4Y" class="wolai-block wolai-text"><div><span class="blue inline-wrap">版本要求</span><span class="inline-wrap">：Vue v3.2.0 及以上版本才支持该 API 。</span></div></div></details><details id="tnWWzdqDhasRK5pfjoYLbd" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>watchSyncEffect</code></span></summary><div class="block-ref"><div class="decorator"></div><div id="cGs3jbwKMbxHYnbo8Fsj4Y" class="wolai-block wolai-text"><div><span class="blue inline-wrap">版本要求</span><span class="inline-wrap">：Vue v3.2.0 及以上版本才支持该 API 。</span></div></div></div></details><div id="jop66wduVsFzd6Mk66jjtK" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details><details id="wrBsimUpxj2SAm6UxrNgDj" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">响应式</span></summary><details id="xa1sHC38GSLDFofA8SkZHE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">选项式<span class="jill"></span>API</span></summary><details id="oQuTCefrNbMHs9TXR2dxHh" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">DOM<span class="jill"></span>更新时机</span></summary><ol class="wolai-block"><li id="usYc74ZkLdMoFBVzEaMpue"><div class="marker"></div><span class="inline-wrap">当修改了响应式状态时，DOM 会被自动更新。</span></li><li id="dXhqMMfEmo3wk1WNVBxGRA"><div class="marker"></div><span class="inline-wrap">DOM<span class="jill"></span>更新并不是同步的</span></li><li id="sYiVyVT1nnCdgu1Xd7o6of"><div class="marker"></div><span class="inline-wrap">Vue<span class="jill"></span>会在</span><span class="inline-wrap"><a href="https://cn.vuejs.org/api/general.html#nexttick"><span><code>nect tick</code></span></a></span><span class="inline-wrap">更新周期中缓冲所有状态的修改，以确保无论进行多少次状态修改，每个组件都只会更新一次。</span></li></ol><details id="oTybc1SJmTPKLWX25TMATB" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><code-block id="j8FfJjkczroeHy6Vh8wYw8" class="wolai-block"><div class="wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> nextTick <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vue'</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">++</span>
      <span class="token keyword control-flow">await</span> <span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// 现在 DOM 已经更新了</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="6d75pNxmtR2XXau9BKJ4ns" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">声明状态 / 声明值</span></summary><div id="37eLr8UMiVtVWDtqSpGj9f" class="wolai-block wolai-text"><div><span class="blue inline-wrap">方式</span><span class="inline-wrap">：通过</span><span class="inline-wrap"><code>data</code></span><span class="inline-wrap">选项来声明</span></div></div><div id="pNF2TbohdJw3LkUqQqdXE4" class="wolai-block wolai-text"><div><span class="blue inline-wrap">值</span><span class="inline-wrap">：返回一个对象的函数</span></div></div><div id="3ai61NfMZKna2ZvnTYrWzx" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：创建新组件实例的时候调用此函数，并将函数返回的对象用响应式系统进行包装。</span></div></div><div id="cq52kroM39EaHGotTw9vwk" class="wolai-block wolai-text"><div><span class="blue inline-wrap">注意</span><span class="inline-wrap">：此对象的所有顶层属性都会被代理到组件实例（即方法和生命周期的</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">）</span></div></div><details id="4riPJGm865HVqBTsHZXR9T" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><code-block id="bxLvw8xDR6okWLkL9vsECT" class="wolai-block"><div class="wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// mounted 是生命周期钩子，之后我们会讲到</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// `this` 指向当前组件实例</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token punctuation">)</span> <span class="token comment">// => 1</span>

    <span class="token comment">// 数据属性也可以被更改</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span> <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="69nWki2tNwBhzpAeHg7eRV" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">声明方法</span></summary><aside id="eRQvG7Cr7FyMDHivZiGmeD" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap"> 应是包含素有方法的对象
2. 定义</span><span class="inline-wrap"><code>methods</code></span><span class="inline-wrap">时，不建议使用箭头函数时，因为箭头函数没有自己的</span><span class="inline-wrap"><code>this</code></span><span class="inline-wrap">上下文</span></aside><details id="bJRWHQzxH4idkbYDozPjGA" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">添加方式</span></summary><div id="eHa28RwLnCT2j8sfwrLEK4" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：通过</span><span class="inline-wrap"><code>methods</code></span><span class="inline-wrap">选项来添加</span></div></div><details id="9hY6f3KTSj3RhMtPivRDv5" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">一般示例</span></summary><code-block id="mC6aakfewktWZHQD4TJCuV" class="wolai-block"><div class="wolai-pre"><div data-lang="JavaScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">count</span><span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在其他方法或是生命周期中也可以调用方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="g88bW4cLu8a4RkJwRQU129" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">使用方式</span></summary><details id="nrAk9gatkPvLe71ZYPfanJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">在模板中被访问</span></summary><code-block id="teqqZpa3GRdiqnKiULpuge" class="wolai-block"><div class="wolai-pre"><div data-lang="HTML" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>increment<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span></pre></div></code-block></details></details><div id="56J1jmCi9oq1wzBN3AYVRY" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details></details><details id="5GssxxudzGaEav3NkJrXUo" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">组件式<span class="jill"></span>API</span></summary><details id="d2zeVYgJkuCW6qokAWcHWT" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">基本<span class="jill"></span>API</span></summary><details id="sXrv5KVfVvqyYTg9WY7CRk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy"><span><code>Proxy()</code></span></a></span></summary><aside id="vzKeoFpQfrbHDdMsXXLQAA" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">Vue 3 使用 </span><span class="inline-wrap"><code>Proxy()</code></span><span class="inline-wrap"> </span></aside><div id="aRAkuxwWR2i5suERrBfWyU" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义</span><span class="inline-wrap">：是一个 JavaScript 内置的构造函数</span></div></div><div id="8yGuiQiQ7gBuaaY1UppaBX" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：用于创建代理对象。代理对象允许你拦截并自定义底层对象的操作，比如访问属性、修改属性、删除属性等。</span></div></div><div id="cR5EPGX2Ubc3B6HsiFPX5n" class="wolai-block wolai-text"><div><span class="blue inline-wrap">在<span class="jill"></span>Vue3<span class="jill"></span>中</span><span class="inline-wrap">：Vue 3 能够更有效地追踪状态的变化，并在状态发生变化时触发相应的更新，以此来实现响应式系统</span></div></div></details><details id="sDRk7dDUyZehMo1oVcDCz2" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>ref</code></span></summary><aside id="jp1rh5eDcN1dLxHDC6mdvr" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">侦听此函数的返回的变量，</span><span class="red inline-wrap">不会</span><span class="inline-wrap">默认开启深度侦听</span></aside><div id="ikaBNDesEu7ikBuWeAm6Wq" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> 是最常用的一个响应式 API，它可以用来定义所有类型的数据，包括 Node 节点和组件。</span></div></div><div id="bFLWWUa6McgJZLuWgzr1FY" class="wolai-block wolai-text"><div><span class="blue inline-wrap">适用场景</span><span class="inline-wrap">：基本数据类型</span></div></div><details id="dweKNr2ArMvSW4QaRC6JP3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ts</span></summary><div id="gMEXRs3PgS5XKV37XsePEY" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义</span><span class="inline-wrap">：接收一个泛型入参，返回一个响应式对象的函数</span></div></div><details id="qG4AEEkERs5f2hh3xPrVNQ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><div id="gnyFJeYi4HJdeUFJu1E5Xu" class="wolai-block wolai-text"><div><span class="inline-wrap">有返回值的函数定义</span></div></div><code-block id="cBKee9WMYczQg8UqQa9a2w" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span>UnwrapRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">>></span>
</pre></div></code-block><div id="bAFm3gGgo5edneHhB1jAFo" class="wolai-block wolai-text"><div><span class="inline-wrap">无返回值的函数定义</span></div></div><code-block id="TqGLfMZpMgJSyq1nTNVm4" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">interface</span> <span class="token class-name">Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="pxozHav2LcQ51t2ZJGMjHs" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">导入</span></summary><div id="s7a8ZjeS4uBfPC6pZNsvna" class="wolai-block wolai-text"><div><span class="inline-wrap">导入 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> API</span></div></div><code-block id="nvgQUzjpdFpzoh4zygacde" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
</pre></div></code-block><div id="38F6iJMDjK84NHhPiFVcGZ" class="wolai-block wolai-text"><div><span class="inline-wrap">导入 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> API 的返回值类型</span></div></div><code-block id="4sqqUwyT9kRHA29gWkBF9z" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span></pre></div></code-block></details><details id="edwq6mkBrFSgFn57qyvwFN" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">定义</span></summary><div id="ucGvzVD4ZPCiZPqAuWApEe" class="wolai-block wolai-text"><div><span class="inline-wrap">自动推导</span></div></div><code-block id="jkkNXGd8qy57kRVPjwEQXm" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span></pre></div></code-block><details id="3GW3EJUkjgdoLR4gXq4Yya" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">基本数据类型</span></summary><div id="4ZG1rSrnWNysxtTRC69tTy" class="wolai-block wolai-text"><div><span class="inline-wrap">显式指定 </span><span class="inline-wrap"><code>msg.value</code></span><span class="inline-wrap"> 是 </span><span class="inline-wrap"><code>string</code></span><span class="inline-wrap"> 类型</span></div></div><code-block id="3ZTFfkVLDPJy6SUMSPxFHC" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="rqEjw7YcbQnocXFw8F1Hxd" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">引用类型</span></summary><div id="4nt8jHuPrgU6tqGdGNeKfa" class="wolai-block wolai-text"><div><span class="inline-wrap">基本数据类型数组</span></div></div><code-block id="93eA3PfTVKnxhhbNqwmYAF" class="wolai-block"><div class="wolai-pre"><div data-lang="Vue" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 数值数组</span>
<span class="token keyword">const</span> uids <span class="token operator">=</span> ref<span class="token operator">&lt;</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 字符串数组</span>
<span class="token keyword">const</span> names <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Tom'</span><span class="token punctuation">,</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span> <span class="token string">'Andy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></div></code-block><div id="6uJUKKmDnq1YqPD3ihYjeK" class="wolai-block wolai-text"><div><span class="inline-wrap">对象数组</span></div></div><code-block id="reJjJcdktHS3BifvRkRcE2" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 声明对象的格式</span>
<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个对象数组</span>
<span class="token keyword">const</span> memberList <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>Member<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="aUgKWuTJU7ACEseSisB6sq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">空值</span></summary><aside id="pePQZ17zQ7j2ZkCEwmmgrn" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">而如果既不显式指定类型，也不赋予初始值，那么会被默认为 </span><span class="inline-wrap"><code>any</code></span><span class="inline-wrap"> 类型，除非真的无法确认类型，否则不建议这么做。</span></aside><div id="vzZFyQ93PaZGTzF9XiZkPt" class="wolai-block wolai-text"><div><span class="inline-wrap">初始化空值，对于下列代码，</span><span class="inline-wrap"><code>msg.value</code></span><span class="inline-wrap"> 是一个 </span><span class="inline-wrap"><code>string | undefined</code></span><span class="inline-wrap"> 的联合类型。</span></div></div><code-block id="ftW7LhraE1WzmKMghmTVjj" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// undefined</span>

msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Hello World!'</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// Hello World!</span></pre></div></code-block></details><details id="qUMj6LyBpcsKoRDn9diTB6" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">DOM<span class="jill"></span>元素的</span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap">属性</span></summary><blockquote id="6rtTDCRPNW3d8apGZCxq2t" class="wolai-block"><span class="inline-wrap">注意事项
1.  在 </span><span class="inline-wrap"><code>&lt;template /&gt;</code></span><span class="inline-wrap"> 代码里添加的 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> 属性的值，是对应 </span><span class="inline-wrap"><code>&lt;script /&gt;</code></span><span class="inline-wrap"> 里使用 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> API 声明的变量的名称；
2. 请保证视图渲染完毕后再执行 DOM 或组件的相关操作（需要放到生命周期的 </span><span class="inline-wrap"><code>onMounted</code></span><span class="inline-wrap"> 或者 </span><span class="inline-wrap"><code>nextTick</code></span><span class="inline-wrap"> 函数里，这一点在 Vue 2 也是一样）
3. </span><span class="inline-wrap">该 Ref 变量必须 </span><span class="inline-wrap"><code>return</code></span><span class="inline-wrap"> 出去才可以给到 </span><span class="inline-wrap"><code>&lt;template /&gt;</code></span><span class="inline-wrap"> 使用，这一点是 Vue 3 生命周期的硬性要求，子组件的数据和方法如果要给父组件操作，也要 </span><span class="inline-wrap"><code>return</code></span><span class="inline-wrap"> 出来才可以。</span></blockquote><div id="bi1ULk9NmYhmrA1XCsTZcG" class="wolai-block wolai-text"><div><span class="inline-wrap">模板代码</span></div></div><code-block id="9Afhu69ymUznHrV9BXjdCZ" class="wolai-block"><div class="wolai-pre"><div data-lang="HTML" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token comment">&lt;!-- 给 DOM 元素添加 `ref` 属性 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>msg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>请留意该节点，有一个 ref 属性<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

  <span class="token comment">&lt;!-- 子组件也是同样的方式添加 --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Child</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></pre></div></code-block><div id="gEAehedTpAsDB3KCC7PzF2" class="wolai-block wolai-text"><div><span class="inline-wrap">脚本代码</span></div></div><code-block id="qg4gi4Jp1TxriYQDK2PsRf" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> Child <span class="token keyword">from</span> <span class="token string">'@cp/Child.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  components<span class="token operator">:</span> <span class="token punctuation">{</span>
    Child<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义挂载节点，声明的类型详见下方附表</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLElement<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// InstanceType&lt;T> 是 TypeScript 提供的一个工具类型，可以获取构造函数类型的实例类型，因此将组件的类型声明为 InstanceType&lt;typeof Child> ，不仅可以得到更完善的类型提示，在编程过程中还可以让编辑器提供更完善的代码补全功能。</span>
    <span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>InstanceType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> Child<span class="token operator">>></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 请保证视图渲染完毕后再执行节点操作 e.g. `onMounted` / `nextTick`</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// 比如获取 DOM 的文本</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>value<span class="token punctuation">.</span>innerText<span class="token punctuation">)</span>

      <span class="token comment">// 或者操作子组件里的数据</span>
      child<span class="token punctuation">.</span>value<span class="token punctuation">.</span>isShowDialog <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 必须 `return` 出去才可以给到 `&lt;template />` 使用</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">,</span>
      child<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></pre></div></code-block><div id="iV9ZFEVpgFcu5m3ZR3nSwa" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details></details><details id="h8LgG3e1DZ318dL6HNrWu2" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">读取值</span></summary><div id="72kvxVm9uRWFgbKpCYzBbH" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：任何 Ref 对象的值都必须通过 </span><span class="inline-wrap"><code>xxx.value</code></span><span class="inline-wrap"> 才可以正确获取。</span></div></div><div id="eNhrMpUS4gEpvzyp32Y7r1" class="wolai-block wolai-text"><div><span class="inline-wrap">示例</span></div></div><code-block id="6U2LWj98oFgpkXWYnHg3bC" class="wolai-block"><div class="wolai-pre"><div data-lang="Vue" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 读取一个字符串</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> ref<span class="token operator">&lt;</span>string<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span>

<span class="token comment">// 读取一个数组</span>
<span class="token keyword">const</span> uids <span class="token operator">=</span> ref<span class="token operator">&lt;</span>number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>uids<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="uk5mSkwZyudDWZPApavyfW" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">复制</span></summary><code-block id="6z3tqf43n1nwqJuK1Nabc8" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 声明一个字符串变量</span>
<span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span>

<span class="token comment">// 等待 1s 后修改它的值</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">'Hello!'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span></pre></div></code-block></details><details id="hsHydDj3oCeerfyJantXXt" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><code-block id="jJuTck1MpdXN23bYKsWLk5" class="wolai-block"><div class="wolai-pre"><div data-lang="Vue" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 导入 `ref` API</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> ref <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'vue'</span>
<span class="token comment">// 导入 `ref` API 的返回值类型</span>
<span class="token keyword module">import</span> type <span class="token punctuation">{</span> <span class="token maybe-class-name">Ref</span> <span class="token punctuation">}</span> <span class="token keyword module">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 声明 `useCalculator` 函数的返回值类型</span>
<span class="token keyword">interface</span> <span class="token class-name">Calculator</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这里包含了一个 Ref 变量</span>
  <span class="token literal-property property">num</span><span class="token operator">:</span> <span class="token maybe-class-name">Ref</span><span class="token operator">&lt;</span>number<span class="token operator">></span>
  <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">void</span>
<span class="token punctuation">}</span>

<span class="token comment">// 声明一个 “使用计算器” 的函数</span>
<span class="token keyword">function</span> <span class="token function">useCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token maybe-class-name">Calculator</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> num <span class="token operator">=</span> ref<span class="token operator">&lt;</span>number<span class="token operator">></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    num<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token operator">++</span>
  <span class="token punctuation">}</span>

  <span class="token keyword control-flow">return</span> <span class="token punctuation">{</span>
    num<span class="token punctuation">,</span>
    add<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在执行使用计算器函数时，可以获取到一个 Ref 变量和其他方法</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> num<span class="token punctuation">,</span> add <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useCalculator</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">)</span> <span class="token comment">// 1</span></pre></div></code-block></details></details></details><details id="WLX2hxWATAtgPstxTLSxP" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>reactive</code></span></summary><aside id="7LSHthYreKnprpANc8ooe4" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">侦听此函数的返回的变量，</span><span class="red inline-wrap">会</span><span class="inline-wrap">默认开启深度侦听</span></aside><div id="2uzhpSfAbyihb6tNMGroyR" class="wolai-block wolai-text"><div><span class="blue inline-wrap">适用场景</span><span class="inline-wrap">：引用数据类型</span></div></div><details id="c5VGhp5A9YeqXx9z77wEnS" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ts</span></summary><div id="gdmQChBiEUCaB6qG7FGrLd" class="wolai-block wolai-text"><div><span class="inline-wrap">语法</span></div></div><code-block id="uxTxuRc5iEasUFaU5rdPDm" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">reactive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">></span></span></span><span class="token punctuation">(</span>target<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span><span class="token operator">:</span> UnwrapNestedRefs<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></pre></div></code-block><details id="x2R6UiaS9eSjkCoxep3xFN" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">定义、读取、赋值</span></summary><aside id="sxtn3fQ6F9DyMNSo4318ic" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">不要对 Reactive 数据进行 </span><span class="inline-wrap"><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment"><span>ES6 的解构</span></a></span><span class="inline-wrap"> 操作，因为解构后得到的变量会失去响应性。</span></aside><details id="cNhz7DNnu1jUABWNTKUuhj" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">对象</span></summary><code-block id="f1aqs97QQ81YpbiWGWgU8E" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 声明对象的类型</span>
<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个对象</span>
<span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 读取用户名</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

<span class="token comment">// 修改用户名</span>
userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Petter'</span></pre></div></code-block></details><details id="fH9e8jbFBoLNoTD9xyjRy5" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">数组</span></summary><aside id="epD2cmsU2GsKytFyjxrtzi" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">赋值为空，会导致失去响应式</span></aside><code-block id="aJJS4h8BBpp9XTHY46eSRg" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 定义一个普通数组</span>
<span class="token keyword">let</span> uids<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

<span class="token comment">// 从另外一个对象数组里提取数据过来</span>
uids <span class="token operator">=</span> api<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> item<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

<span class="token comment">// 合并另外一个数组</span>
<span class="token keyword">let</span> newUids<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>
uids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>uids<span class="token punctuation">,</span> <span class="token operator">...</span>newUids<span class="token punctuation">]</span>

<span class="token comment">// 重置数组，会导致失去响应式</span>
uids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// 重置数组，不破坏响应式</span>
uids<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
</pre></div></code-block></details><details id="9j14AyaPC18KxnNM6vfibj" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">对象数组</span></summary><div class="block-ref"><div class="decorator"></div><aside id="epD2cmsU2GsKytFyjxrtzi" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">赋值为空，会导致失去响应式</span></aside></div><code-block id="6v2TbSPWMipEFpKgheNkyu" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 对象数组也是先声明其中的对象类型</span>
<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 再定义一个为对象数组</span>
<span class="token keyword">const</span> userList<span class="token operator">:</span> Member<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token string">'Andy'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 重置对象数组，会导致失去响应式</span>
userList <span class="token operator">=</span> Member<span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// 重置对象数组，不破坏响应式</span>
userList<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span></pre></div></code-block></details></details></details></details></details><details id="biTpnSh7rjKVW8apNbZbDM" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">转换<span class="jill"></span>API</span></summary><details id="duU6ntzuT17PAXiwTo4AHS" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>toRef</code></span></summary><div id="hZRTHcwLvQwNzm81KQpiwF" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：用于 </span><span class="inline-wrap"><code>reactive</code></span><span class="inline-wrap"> 向 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> 转换</span></div></div><div id="w1fMGkETsYmsLa3Mfxghj3" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：创建一个新的 Ref 变量，转换 Reactive 对象的某个字段为 Ref 变量，并且新变量和原来的变量可以保持同步更新。</span></div></div><details id="j2FnzzpDhzLyvNryhxW5Fk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ts</span></summary><details id="ikaS2YeuZeZyZjbbs6ZmCJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><div id="qdkqBEWXUkDXmyyzFFfy6e" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：通过接收两个必传的参数（第一个是 </span><span class="inline-wrap"><code>reactive</code></span><span class="inline-wrap"> 对象, 第二个是要转换的 </span><span class="inline-wrap"><code>key</code></span><span class="inline-wrap"> ），返回一个 Ref 变量，在适当的时候也可以传递第三个参数，为该变量设置默认值。</span></div></div><div id="hidaYyt4LLLefAswRrUtZQ" class="wolai-block wolai-text"><div><span class="blue inline-wrap">使用场景</span><span class="inline-wrap">：最好只在功能单一、代码量少的组件里使用，比如一个表单组件，通常表单的数据都放在一个对象里。</span></div></div><div id="wfF4WUuruvZDRJzFFbdjvy" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>toRef</code></span><span class="inline-wrap"> API 的 TS 类型</span></div></div><code-block id="gqjEP4rhKGXFywmzxdcu8t" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">toRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>
  object<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span>
  key<span class="token operator">:</span> <span class="token constant">K</span><span class="token punctuation">,</span>
  defaultValue<span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token operator">:</span> ToRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">></span>
</pre></div></code-block><div id="dY9svocNHBHoq4yQwHFkg5" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>toRef</code></span><span class="inline-wrap"> API 的返回值的 TS 类型</span></div></div><code-block id="bRuwjLmCqEzvQbTd33WhJ2" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">type</span> <span class="token class-name">ToRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Ref</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></pre></div></code-block></details><details id="5DHgT7PLERckpQFj3tJTMG" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">定义</span></summary><details id="945WjfJRtJG6mvN1ZicdJp" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">默认值</span></summary><aside id="cxSajrUZmusSVMAf35DsE2" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">如果 Reactive 对象上有一个属性本身没有初始值，也可以传递第三个参数进行设置（默认值仅对 Ref 变量有效）：</span></aside><code-block id="kGmr1Qe6t3V6tHWqeyY2L6" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token comment">// 类型上新增一个属性，因为是可选的，因此默认值会是 `undefined`</span>
  age<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span>
<span class="token punctuation">}</span>

<span class="token comment">// 声明变量时省略 `age` 属性</span>
<span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 此时为了避免程序运行错误，可以指定一个初始值</span>
<span class="token comment">// 但初始值仅对 Ref 变量有效，不会影响 Reactive 字段的值</span>
<span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment">// 18</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// undefined</span>

<span class="token comment">// 除非重新赋值，才会使两者同时更新</span>
age<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">25</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">.</span>value<span class="token punctuation">)</span>  <span class="token comment">// 25</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 25</span></pre></div></code-block></details><details id="qcFkmWLwVoTj58NRqZ2aRZ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">接口</span></summary><code-block id="8NnPhGKQwT7vuYjWwve4nU" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 声明一个接口</span>
<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义一个reactive变量的Member接口</span>
<span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 经过toRef()后，name的类型是 Ref&lt;string> </span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// Petter</span></pre></div></code-block></details><details id="dR5qwCjqmUUF22gj44oxLw" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">数组</span></summary><code-block id="5PDDA4kMrYjwzRyAoKMgt4" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 声明reactive变量的数组</span>
<span class="token keyword">const</span> words <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 通过下标 `0` 转换第一个 item</span>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// a</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// a</span>

<span class="token comment">// 通过下标 `2` 转换第三个 item</span>
<span class="token keyword">const</span> c <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>words<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// c</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>words<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// c</span></pre></div></code-block></details><details id="4ksWkHqfpir7ZVc8MttX83" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">原 </span><span class="inline-wrap"><code>key</code></span><span class="inline-wrap">不存在</span></summary><div id="cjeUpschjtLUyHKWdk8gmZ" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：在 </span><span class="inline-wrap"><code>toRef</code></span><span class="inline-wrap"> 的过程中，如果使用了原对象上面不存在的 </span><span class="inline-wrap"><code>key</code></span><span class="inline-wrap"> ，那么定义出来的 Ref 变量的 </span><span class="inline-wrap"><code>.value</code></span><span class="inline-wrap"> 值将会是 </span><span class="inline-wrap"><code>undefined</code></span><span class="inline-wrap"> 。同时对这个不存在</span><span class="inline-wrap"><code>key</code></span><span class="inline-wrap">的<span class="jill"></span>Ref<span class="jill"></span>变量进行赋值，那么原来的<span class="jill"></span>Reactive 对象也会同步增加这个 </span><span class="inline-wrap"><code>key</code></span><span class="inline-wrap">，其值也会同步更新。然而这在编译无法通过<span class="jill"></span>TS<span class="jill"></span>的类型检查。如果一定要使用这种情况，可以考虑 any 类型</span></div></div><code-block id="dzDD9j8X79TqEbLautnewR" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 将该类型直接指定为 `any`</span>
<span class="token keyword">type</span> <span class="token class-name">Member</span> <span class="token operator">=</span> <span class="token builtin">any</span>
<span class="token comment">// 当然一般都是 `const userInfo: any`</span>

<span class="token comment">// 或者保持接口类型的情况下，允许任意键值</span>
<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用 `Record` 也是同理</span>
<span class="token keyword">type</span> <span class="token class-name">Member</span> <span class="token operator">=</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span></pre></div></code-block></details></details></details></details><details id="8mQ3SDyP3Tn1X66GaqtYiL" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>toRefs</code></span></summary><div class="block-ref"><div class="decorator"></div><div id="hZRTHcwLvQwNzm81KQpiwF" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：用于 </span><span class="inline-wrap"><code>reactive</code></span><span class="inline-wrap"> 向 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> 转换</span></div></div></div><div id="9xHRrg29PdjpG1r3ykpsXd" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：创建一个新的对象，它的每个字段都是 Reactive 对象各个字段的 Ref 变量，并且新变量以及解构后和原来的变量可以保持同步更新。</span></div></div><div id="c3dgfXYmDQLRTwzBKfyUK1" class="wolai-block wolai-text"><div><span class="blue inline-wrap">使用场景</span><span class="inline-wrap">：最好只在功能单一、代码量少的组件里使用，比如一个表单组件，通常表单的数据都放在一个对象里。</span></div></div><details id="kSjfoMXnyUjCWV1rd4fxRn" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ts</span></summary><details id="4ae5G46aD9FWF9Awh3w3Ac" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">语法</span></summary><div id="fRb4Rrqgg4SrytHQysYg26" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap"><code>toRefs</code></span><span class="inline-wrap"> 只接收了一个参数，是一个 </span><span class="inline-wrap"><code>reactive</code></span><span class="inline-wrap"> 变量。</span></div></div><div id="q8EcpVXZg6CtaN1wYTz2BV" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>toRefs</code></span><span class="inline-wrap"> API 的 TS 类型</span></div></div><code-block id="dMchMUGHcXEKPHjhdDFnJc" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">toRefs</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">></span></span></span><span class="token punctuation">(</span>
  object<span class="token operator">:</span> <span class="token constant">T</span>
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">K</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> ToRef<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span><span class="token operator">></span>
<span class="token punctuation">}</span></pre></div></code-block><div id="b28s1tApHKzRqcKvzwG5Z" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>toRefs</code></span><span class="inline-wrap"> API 的返回值的 TS 类型</span></div></div><code-block id="uvdh65rcgM8zGCg3NVLbTK" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">type</span> <span class="token class-name">ToRef</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">Ref</span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></pre></div></code-block></details><details id="vPXgjTdT8rw4Pm7wMighdM" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">定义</span></summary><details id="3pSaaUYuqXuyL85bEh8YPG" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">对象</span></summary><code-block id="q5iJtUrJusmtaEjgVqwyHT" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 导入 `toRefs` API 的类型</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 声明一个 Reactive 变量</span>
<span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 传给 `toRefs` 作为入参</span>
<span class="token keyword">const</span> userInfoRefs <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span>
<span class="token comment">// const userInfoRefs: ToRefs&lt;Member> = toRefs(userInfo)</span></pre></div></code-block><div id="jaj5r1nrE3ApRvu1GG6g29" class="wolai-block wolai-text"><div><span class="inline-wrap">使用新的类型</span></div></div><code-block id="6pd1KD1QedPmJF1Y3Etkks" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">// 导入 `toRefs` API 的类型</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token comment">// 新声明的类型每个字段都是一个 Ref 变量的类型</span>
<span class="token keyword">interface</span> <span class="token class-name">MemberRefs</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span>
  name<span class="token operator">:</span> Ref<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span>
<span class="token punctuation">}</span>

<span class="token comment">// 声明一个 Reactive 变量</span>
<span class="token keyword">const</span> userInfo<span class="token operator">:</span> Member <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 使用新的类型进行声明</span>
<span class="token keyword">const</span> userInfoRefs<span class="token operator">:</span> MemberRefs <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span></pre></div></code-block></details><details id="hGQbo2PaadJRHvhte1gBxD" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">数组</span></summary><div id="g7xCrvrL4CntqRbzMBhk5e" class="wolai-block wolai-text"><div><span class="inline-wrap">此时新数组的类型是 </span><span class="inline-wrap"><code>Ref&lt;string&gt;[]</code></span><span class="inline-wrap"> ，不再是原来的 </span><span class="inline-wrap"><code>string[]</code></span><span class="inline-wrap"> 类型。</span></div></div><code-block id="ncRnKgTYabhNGwmr8YgjYz" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">const</span> words <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> wordsRefs <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>words<span class="token punctuation">)</span></pre></div></code-block></details></details><details id="tE5of3nPudm66cGp7m5iL4" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><div id="i5MQcq2kuCPE9YXQoSGpC4" class="wolai-block wolai-text"><div><span class="inline-wrap">在 </span><span class="inline-wrap"><code>&lt;script /&gt;</code></span><span class="inline-wrap"> 部分：</span></div></div><ol class="wolai-block"><li id="n2KR6dMnbwgszLBYy16gRH"><div class="marker"></div><span class="inline-wrap">先用 </span><span class="inline-wrap"><code>reactive</code></span><span class="inline-wrap"> 定义一个源数据，所有的数据更新，都是修改这个对象对应的值，按照对象的写法维护数据</span></li><li id="oCbzXvwxTJ9n3x6moa64Bs"><div class="marker"></div><span class="inline-wrap">再通过 </span><span class="inline-wrap"><code>toRefs</code></span><span class="inline-wrap"> 定义一个给 </span><span class="inline-wrap"><code>&lt;template /&gt;</code></span><span class="inline-wrap"> 使用的对象，这样可以得到一个每个字段都是 Ref 变量的新对象</span></li><li id="211QkVceozpHtrwRzgJGZ2"><div class="marker"></div><span class="inline-wrap">在 </span><span class="inline-wrap"><code>return</code></span><span class="inline-wrap"> 的时候，对步骤 2 里的 </span><span class="inline-wrap"><code>toRefs</code></span><span class="inline-wrap"> 对象进行解构，这样导出去就是各个字段对应的 Ref 变量，而不是一整个对象</span></li></ol><code-block id="q5xRm5jEi9BTGeKHkCH43A" class="wolai-block"><div class="wolai-pre"><div data-lang="TypeScript" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> reactive<span class="token punctuation">,</span> toRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">interface</span> <span class="token class-name">Member</span> <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token builtin">number</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span>
  gender<span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 定义一个 reactive 对象</span>
    <span class="token keyword">const</span> userInfo <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      name<span class="token operator">:</span> <span class="token string">'Petter'</span><span class="token punctuation">,</span>
      age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
      gender<span class="token operator">:</span> <span class="token string">'male'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// 定义一个新的对象，它本身不具备响应性，但是它的字段全部是 Ref 变量</span>
    <span class="token keyword">const</span> userInfoRefs <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span>

    <span class="token comment">// 在 2s 后更新 `userInfo`</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      userInfo<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">2</span>
      userInfo<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Tom'</span>
      userInfo<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>

    <span class="token comment">// 在这里解构 `toRefs` 对象才能继续保持响应性</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>userInfoRefs<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></pre></div></code-block><div id="vgWKRyToVWmAecpXHr4u3A" class="wolai-block wolai-text"><div><span class="inline-wrap">在 </span><span class="inline-wrap"><code>&lt;template /&gt;</code></span><span class="inline-wrap"> 部分：由于 </span><span class="inline-wrap"><code>return</code></span><span class="inline-wrap"> 出来的都是 Ref 变量，所以在模板里可以直接使用 </span><span class="inline-wrap"><code>userInfo</code></span><span class="inline-wrap"> 各个字段的 </span><span class="inline-wrap"><code>key</code></span><span class="inline-wrap"> ，不再需要写很长的 </span><span class="inline-wrap"><code>userInfo.name</code></span><span class="inline-wrap"> 了。</span></div></div><code-block id="uBZ3EoGYja1Asvx52Ga6rp" class="wolai-block"><div class="wolai-pre"><div data-lang="Vue" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">&lt;</span>template<span class="token operator">></span>
  <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"user-info"</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"key"</span><span class="token operator">></span><span class="token constant">ID</span><span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"value"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> id <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>

    <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"key"</span><span class="token operator">></span>name<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"value"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> name <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>

    <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"key"</span><span class="token operator">></span>age<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"value"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> age <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>

    <span class="token operator">&lt;</span>li <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"item"</span><span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"key"</span><span class="token operator">></span>gender<span class="token operator">:</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
      <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"value"</span><span class="token operator">></span><span class="token punctuation">{</span><span class="token punctuation">{</span> gender <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span></pre></div></code-block></details><div id="vQHtTTDiCuqaPsVSP1166j" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details></details></details></details><div id="vXE1gVPNmBHT9yAGcawsrz" class="wolai-block wolai-text"><div></div></div></details></article><footer></footer></body></html>