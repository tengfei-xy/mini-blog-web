<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>Linux-11.2-经典模式 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Linux-11.2-经典模式" class="main-title"></div></div></header><article><div id="frCgashVz3hF6d6QXf7B3A" class="wolai-block wolai-text"><div><span class="inline-wrap">文档更新时间：2021<span class="jill"></span>年<span class="jill"></span>11<span class="jill"></span>月<span class="jill"></span>3<span class="jill"></span>日</span></div></div><h1 id="jw8Jn1h1ZN5KL3evwaLtjv" class="wolai-block"><span class="inline-wrap">一、补充：目标库<span class="jill"></span>DDL</span></h1><div id="hxKSXwdnHwZ1c8BBN228Am" class="wolai-block wolai-text"><div><span class="inline-wrap">如果目标库是空库，初始化之前需要先执行源库的<span class="jill"></span>DDL<span class="jill"></span>语句，</span></div></div><blockquote id="vxruwyYPbTaw5RAwwFrs2T" class="wolai-block"><span class="inline-wrap">前置语句</span></blockquote><code-block id="gCaDYpR1Nx4yDEtT3Kc193" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">set</span> long <span class="token number">99999</span>         
<span class="token keyword">set</span> pagesize <span class="token number">1000</span></pre></div></code-block><ol class="wolai-block"><li id="6SewSvyT5joAePEFcnhnm7"><div class="marker"></div><span class="inline-wrap">确定<span class="jill"></span>schema<span class="jill"></span>的表空间</span><code-block id="1o2jQSmG5NsGqPNyieiNgz" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">select</span> DEFAULT_TABLESPACE<span class="token punctuation">,</span>TEMPORARY_TABLESPACE <span class="token keyword">from</span> dba_users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'TENGFEI'</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="fVY7dkJeH8Pf9gMNbu4BLd"><div class="marker"></div><span class="inline-wrap">导出用户表空间<span class="jill"></span>DDL</span><code-block id="mEi1XZDq5FqpQmXBBZzaXQ" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span><span class="token string">'TABLESPACE'</span><span class="token punctuation">,</span> TS<span class="token punctuation">.</span>tablespace_name<span class="token punctuation">)</span> 
<span class="token keyword">FROM</span> DBA_TABLESPACES TS <span class="token keyword">where</span> ts<span class="token punctuation">.</span>tablespace_name<span class="token operator">=</span><span class="token string">'XY'</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="pgmQEJQgSQX3tZRX1PEPkT"><div class="marker"></div><span class="inline-wrap">导出<span class="jill"></span>schemaDDL</span><code-block id="x8jmekStJyJJ4pC5zftXRu" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span><span class="token string">'USER'</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span> <span class="token keyword">FROM</span> DBA_USERS <span class="token keyword">WHERE</span> USERNAME<span class="token operator">=</span><span class="token string">'TENGFEI'</span><span class="token punctuation">;</span>

<span class="token comment">-- GRANT UNLIMITED TABLESPACE TO &lt;SCHEMA></span>
<span class="token comment">-- GRANT CREATE SESSION TO &lt;SCHEMA></span></pre></div></code-block></li><li id="kdUTpCDDdexhyAf1NFjSt7"><div class="marker"></div><span class="inline-wrap">连接业务用户后，导出表、索引、存储过程<span class="jill"></span>DDL</span><code-block id="pBGoPP5UEUigTUiwdd2kR7" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SELECT</span> DBMS_METADATA<span class="token punctuation">.</span>GET_DDL<span class="token punctuation">(</span>U<span class="token punctuation">.</span>OBJECT_TYPE<span class="token punctuation">,</span> u<span class="token punctuation">.</span>object_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> USER_OBJECTS u
<span class="token keyword">where</span> U<span class="token punctuation">.</span>OBJECT_TYPE <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'TABLE'</span><span class="token punctuation">,</span><span class="token string">'INDEX'</span><span class="token punctuation">,</span><span class="token string">'PROCEDURE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="ji4g6hQY57Lu9JhQFac2HR"><div class="marker"></div><span class="inline-wrap">备库禁用所有触发器</span></li></ol><h1 id="4BkeXGi1KEA8Y8oe5cCcdL" class="wolai-block"><span class="inline-wrap">二、多端：基础配置</span></h1><h2 id="wH1ajrqj3WJ5ZMfEoBvm1h" class="wolai-block"><span class="inline-wrap">1、用户配置</span></h2><ol class="wolai-block"><li id="bV3XGdyB65id1X3ytYnBCv"><div class="marker"></div><span class="inline-wrap">创建系统用户</span><code-block id="i8tk7F9QZ7Qdou8ZKcbkGL" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> dba <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>openssl <span class="token function">passwd</span><span class="token variable">`</span></span> ogg</pre></div></code-block></li><li id="6DVkcJ55ofaTQ2eAotzRCr"><div class="marker"></div><span class="inline-wrap">修改<span class="jill"></span>ogg<span class="jill"></span>用户的.bash_profile<span class="jill"></span>配置文件，别忘记生效文件</span><code-block id="5EEyzDv3Y8WGC9is22pwh6" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token key attr-name">PATH</span><span class="token punctuation">=</span><span class="token value attr-value">/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin</span>
<span class="token key attr-name">PATH</span><span class="token punctuation">=</span><span class="token value attr-value">$PATH:$HOME/.local/bin:$HOME/bin</span>

<span class="token key attr-name">export ORACLE_SID</span><span class="token punctuation">=</span><span class="token value attr-value">oracle</span>
<span class="token key attr-name">export ORACLE_BASE</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oracle</span>
<span class="token key attr-name">export ORACLE_HOME</span><span class="token punctuation">=</span><span class="token value attr-value">$ORACLE_BASE/product/11.2.0/db_1</span>
<span class="token key attr-name">export LD_LIBRARY_PATH</span><span class="token punctuation">=</span><span class="token value attr-value">$ORACLE_HOME/lib</span>
<span class="token key attr-name">export PATH</span><span class="token punctuation">=</span><span class="token value attr-value">$PATH:$ORACLE_HOME/bin:$ORACLE_HOME/jdk/bin</span></pre></div></code-block></li></ol><h2 id="v7kQpyYA9KUH6GDfFw4FRE" class="wolai-block"><span class="inline-wrap">2、安装<span class="jill"></span>ogg</span></h2><ol class="wolai-block"><li id="tjbuN8o8MgrQsBBfcE2sQB"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>OGG<span class="jill"></span>安装目录,并解压安装<span class="jill"></span>ogg<span class="jill"></span>文件</span><code-block id="8yimBpE1RQBLVeCgGa45iV" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">mkdir</span> /u01/app/ogg
<span class="token function">tar</span> xf fbo_ggs_Linux_x64_ora11g_64bit.tar  <span class="token parameter variable">-C</span> /u01/app/ogg
<span class="token function">chown</span> <span class="token parameter variable">-R</span>  ogg:oinstall /u01/app/ogg</pre></div></code-block></li><li id="nUCm15nP44c1Vw2kwvEdAL"><div class="marker"></div><span class="inline-wrap">登录测试</span><span class="inline-wrap">
</span><span class="inline-wrap">如果 LD_LIBRARY_PATH 变量设置正确，会像上面演示一样正确进入命令行，如果提示找不到 so 文件，就</span><span class="inline-wrap">
</span><span class="inline-wrap">需要 查看 LD_LIBRARY_PATH 变量是否正确设置。</span><code-block id="bfrMq6tZYFsC12neBMSRc3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>ogg@ogg2 ogg<span class="token punctuation">]</span>$ ./ggsci 
Oracle GoldenGate Command Interpreter <span class="token keyword">for</span> Oracle
Version <span class="token number">11.2</span>.1.0.10 <span class="token number">17241368</span> OGGCORE_11.2.1.0.0OGGBP_PLATFORMS_130813.0048_FBO
Linux, x64, 64bit <span class="token punctuation">(</span>optimized<span class="token punctuation">)</span>, Oracle 11g on Aug <span class="token number">13</span> <span class="token number">2013</span> 06:04:43
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">1995</span>, <span class="token number">2013</span>, Oracle and/or its affiliates. All rights reserved.</pre></div></code-block></li><li id="u5c3exwX8snZ1jaH7A6BUE"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>ogg<span class="jill"></span>表空间,并创建用户</span><code-block id="vn39vLctRpWr2WqR7hbjda" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">tablespace</span> ogg datafile <span class="token string">'/u01/app/oracle/oradata/ogg01.dbf'</span> size <span class="token number">50</span>M autoextend <span class="token keyword">on</span><span class="token punctuation">;</span>
<span class="token keyword">Tablespace</span> created<span class="token punctuation">.</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> <span class="token keyword">user</span> ogg identified <span class="token keyword">by</span> ogg <span class="token keyword">default</span> <span class="token keyword">tablespace</span> ogg<span class="token punctuation">;</span>
<span class="token keyword">User</span> created<span class="token punctuation">.</span></pre></div></code-block></li><li id="ojDzrwkftPUP4iu8GXfGwJ"><div class="marker"></div><span class="inline-wrap">赋权</span><span class="inline-wrap">
</span><span class="inline-wrap">连接资源、查找任何字典和表、在<span class="jill"></span>dmbs<span class="jill"></span>闪回表执行、闪回修改插入更新任何表、</span><code-block id="tafBCcnadLQSgPpbEz6pA2" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">grant</span> <span class="token keyword">CONNECT</span><span class="token punctuation">,</span> RESOURCE <span class="token keyword">to</span> ogg<span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">SELECT</span> <span class="token keyword">ANY</span> DICTIONARY <span class="token keyword">to</span> ogg<span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">EXECUTE</span> <span class="token keyword">on</span> DBMS_FLASHBACK <span class="token keyword">to</span> ogg<span class="token punctuation">;</span>
<span class="token keyword">grant</span> 
<span class="token keyword">select</span> <span class="token keyword">any</span> <span class="token keyword">table</span><span class="token punctuation">,</span>
flashback <span class="token keyword">any</span> <span class="token keyword">table</span><span class="token punctuation">,</span>
<span class="token keyword">insert</span> <span class="token keyword">any</span> <span class="token keyword">table</span><span class="token punctuation">,</span>
<span class="token keyword">update</span> <span class="token keyword">any</span> <span class="token keyword">table</span><span class="token punctuation">,</span>
<span class="token keyword">alter</span> <span class="token keyword">any</span> <span class="token keyword">table</span><span class="token punctuation">,</span>
<span class="token keyword">delete</span> <span class="token keyword">any</span> <span class="token keyword">table</span> <span class="token keyword">to</span> ogg<span class="token punctuation">;</span>
</pre></div></code-block></li><li id="gmrUtsj4MEP1sy2AusHJHw"><div class="marker"></div><span class="inline-wrap">数据库操作</span><span class="inline-wrap">
</span><span class="inline-wrap">启动到<span class="jill"></span>mount<span class="jill"></span>模式</span><code-block id="i5xxzPbreTn7k6i3E4g9An" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">SQL<span class="token operator">></span> <span class="token keyword">select</span> open_mode,force_logging from <span class="token function">v</span><span class="token variable">$database</span><span class="token punctuation">;</span>
OPEN_MODE             FOR
-------------------- ---
READ WRITE           NO


SQL<span class="token operator">></span> <span class="token function">shutdown</span> immediate<span class="token punctuation">;</span> 
SQL<span class="token operator">></span> startup <span class="token function">mount</span><span class="token punctuation">;</span> </pre></div></code-block><div id="vFjKYW6phQU379RyQtzN5J" class="wolai-block wolai-text"><div><span class="inline-wrap">归档日志</span></div></div><code-block id="362MvX3NSUCbgJr2kjxuLv" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">force</span> logging<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> archivelog<span class="token punctuation">;</span>
<span class="token keyword">Database</span> altered<span class="token punctuation">.</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span><span class="token punctuation">;</span></pre></div></code-block><div id="uGeSVBWFZSNXb7P3cWCQ1Y" class="wolai-block wolai-text"><div><span class="inline-wrap">附加日志</span></div></div><code-block id="9hmeHoCvVFGpMEAFn6Urq6" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> SUPPLEMENTAL_LOG_DATA_MIN<span class="token punctuation">,</span>SUPPLEMENTAL_LOG_DATA_PK<span class="token punctuation">,</span>SUPPLEMENTAL_LOG_DATA_UI <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>

SUPPLEME SUP SUP
<span class="token comment">-------- --- ---</span>
<span class="token keyword">NO</span>       <span class="token keyword">NO</span>  <span class="token keyword">NO</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> supplemental log <span class="token keyword">data</span> <span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> supplemental log <span class="token keyword">data</span> <span class="token punctuation">(</span><span class="token keyword">primary</span> <span class="token keyword">key</span><span class="token punctuation">,</span> <span class="token keyword">unique</span><span class="token punctuation">,</span><span class="token keyword">foreign</span> <span class="token keyword">key</span><span class="token punctuation">)</span> <span class="token keyword">columns</span><span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system switch logfile<span class="token punctuation">;</span>
<span class="token comment">-- 关闭附加日志:alter database drop supplemental log data (primary key,unique,foreign key) columns;</span></pre></div></code-block></li><li id="wcZsoYE9MriELvVB8TEQXo"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>sqlplus<span class="jill"></span>安装<span class="jill"></span>marker<span class="jill"></span>表和<span class="jill"></span>Security Role</span><code-block id="7B7kcXyoY8f8UttrpbdKfb" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment">-- 进入ogg安装目录</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token variable">@marker_setup.sql</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token variable">@role_setup.sql</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">GRANT</span> GGS_GGSUSER_ROLE <span class="token keyword">TO</span> <span class="token operator">&lt;</span>loggedUser<span class="token operator">></span><span class="token punctuation">;</span></pre></div></code-block></li><li id="4TBvpQruMoFppewcNouNLy"><div class="marker"></div><span class="inline-wrap">创建管理目录</span><code-block id="gHM1eDPKCLtTZXRo6LqzMe" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">></span>  <span class="token keyword">create</span> subdirs
Creating subdirectories under <span class="token keyword">current</span> directory <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg

Parameter files                <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirprm: already <span class="token keyword">exists</span>
Report files                   <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirrpt: created
<span class="token keyword">Checkpoint</span> files               <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirchk: created
Process <span class="token keyword">status</span> files           <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirpcs: created
<span class="token keyword">SQL</span> script files               <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirsql: created
<span class="token keyword">Database</span> definitions files     <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdef: created
Extract <span class="token keyword">data</span> files             <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat: created
<span class="token keyword">Temporary</span> files                <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirtmp: created
Stdout files                   <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirout: created</pre></div></code-block></li><li id="wxgyjeazWZqXDaWpzdrURP"><div class="marker"></div><span class="inline-wrap">==源端==：从<span class="jill"></span>sqplus<span class="jill"></span>创建的用户登录<span class="jill"></span>ggsci</span><code-block id="tdoCD5CD7Vp2LSBMgDEife" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">></span> dblogin userid ogg<span class="token punctuation">,</span>password ogg
Successfully logged <span class="token keyword">into</span> <span class="token keyword">database</span><span class="token punctuation">.</span>

<span class="token comment"># 源端添加表级TRANDATA</span>
GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">></span> <span class="token keyword">add</span> trandata tengfei<span class="token punctuation">.</span><span class="token operator">*</span>
Logging <span class="token keyword">of</span> supplemental redo <span class="token keyword">data</span> enabled <span class="token keyword">for</span> <span class="token keyword">table</span> TENGFEI<span class="token punctuation">.</span>IDT<span class="token punctuation">.</span>

<span class="token comment"># 查看哪些表添加了TRANDATA</span>
GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">3</span><span class="token operator">></span> info trandata tengfei<span class="token punctuation">.</span><span class="token operator">*</span>
Logging <span class="token keyword">of</span> supplemental redo log <span class="token keyword">data</span> <span class="token operator">is</span> enabled <span class="token keyword">for</span> <span class="token keyword">table</span> TENGFEI<span class="token punctuation">.</span>IDT<span class="token punctuation">.</span>
<span class="token keyword">Columns</span> supplementally logged <span class="token keyword">for</span> <span class="token keyword">table</span> TENGFEI<span class="token punctuation">.</span>IDT: ID3<span class="token punctuation">,</span> ID2<span class="token punctuation">,</span> ID<span class="token punctuation">.</span></pre></div></code-block></li></ol><h1 id="nYg7jUxDH9iavub5QrFk3R" class="wolai-block"><span class="inline-wrap">三、多端：配置与启动管理进程</span></h1><div id="a69rfz8npG1csWNyPCajNH" class="wolai-block wolai-text"><div><span class="inline-wrap">==注：配置时需要在原先的文件夹下==</span></div></div><ol class="wolai-block"><li id="i5ky3a6P8nAMWezH9AqebF"><div class="marker"></div><span class="inline-wrap">配置<span class="jill"></span>MGR<span class="jill"></span>管理进程</span><code-block id="kxBfzWXsNTmPWRk4dddoCE" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">4</span><span class="token operator">></span> edit params mgr
port <span class="token number">7809</span>
purgeoldextracts <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token punctuation">,</span> usecheckpoints<span class="token punctuation">,</span> minkeepdays <span class="token number">7</span>
LAGREPORTHOURS <span class="token number">1</span>
LAGINFOMINUTES <span class="token number">30</span>
LAGCRITICALMINUTES <span class="token number">45</span>


<span class="token comment"># PORT 7809：OGG 管理进程监控端口。</span>
<span class="token comment"># PURGEOLDEXTRACTS：清除不需要的 trail 文件。</span>
<span class="token comment"># /ogg/dirdat：trail 文件存放位置。</span>
<span class="token comment"># USECHECKPOINTS：使用检查点队列</span>
<span class="token comment"># minkeepdays 超过7天会删除</span>
<span class="token comment"># LAGREPORTHOURS 每隔1小时检查EXTRACT的延迟情况</span>
<span class="token comment"># LAGINFOMINUTES 如果超过了30分钟就把延迟作为信息记录到错误日志中</span>
<span class="token comment"># LAGCRITICALMINUTES如果延迟超过了45分钟，则把它作为警告写到错误日志中。</span>
<span class="token comment"># 自动重启 EXTRACT进程，表示每3分钟尝试重新启动所有EXTRACT进程，共尝试5次；</span>
<span class="token comment"># AUTORESTART EXTRACT *,RETRIES5,WAITMINUTES 3</span>

</pre></div></code-block></li><li id="9Ftueqs4jxuMhdWYXPKpHZ"><div class="marker"></div><span class="inline-wrap">启动<span class="jill"></span>mgr</span><code-block id="ibL263MWJyoVFThSQDy65v" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">5</span><span class="token operator">></span> <span class="token keyword">start</span> mgr
Manager started<span class="token punctuation">.</span></pre></div></code-block></li><li id="fkcVci7SSafb4cQa1VMjJP"><div class="marker"></div><span class="inline-wrap">查看状态(如果不是下方的特定的消息可通过<span class="jill"></span>view report mgr<span class="jill"></span>查看错误)</span><code-block id="cJSF4YnPJS4MX6hJ7tXBYU" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">6</span><span class="token operator">></span> info mgr
Manager <span class="token operator">is</span> running <span class="token punctuation">(</span>IP port ogg1<span class="token punctuation">.</span><span class="token number">7809</span><span class="token punctuation">)</span><span class="token punctuation">.</span></pre></div></code-block></li></ol><h1 id="x4yTYgfRTkmSipaCboQeY7" class="wolai-block"><span class="inline-wrap">四、多端：配置与初始化进程</span></h1><ol class="wolai-block"><li id="qtVmQrv3ZEVk1MzEMpQtU5"><div class="marker"></div><span class="inline-wrap">源端添加<span class="jill"></span>EINI_1（extract<span class="jill"></span>进程）</span><code-block id="ih6Aw6Ys87e7eqrm9LaB58" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">></span> <span class="token keyword">add</span> extract eini_1<span class="token punctuation">,</span> sourceistable
EXTRACT added<span class="token punctuation">.</span>
<span class="token comment"># SOURCEISTABLE          Extracts entire records from source tables.</span></pre></div></code-block></li><li id="aVryujeqE8PJY7fzGPoXmG"><div class="marker"></div><span class="inline-wrap">目标端添加<span class="jill"></span>RINI_1（REPLICAT<span class="jill"></span>进程）</span><code-block id="i3ZqHpuXoCm8ifd2p8Ma1r" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg2<span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">></span> <span class="token keyword">ADD</span> REPLICAT RINI_1<span class="token punctuation">,</span> SPECIALRUN
REPLICAT added<span class="token punctuation">.</span>
<span class="token comment"># 将生成./dirchk/RINI_1.cpr文件</span>
<span class="token comment"># SPECIALRUN             Specifies a one-time processing task that does not checkpoint from run to run.</span></pre></div></code-block></li><li id="8zvuM9Ctw7m2paQThXeUbo"><div class="marker"></div><span class="inline-wrap">查看<span class="jill"></span>EINI_1<span class="jill"></span>的进程状态</span><span class="inline-wrap">
</span><span class="inline-wrap">还没有配置和启动时，该进程是<span class="jill"></span>STOPPED<span class="jill"></span>状态</span><code-block id="3vyytvXGspgL4WqgBhSRVA" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">9</span><span class="token operator">></span> INFO EXTRACT EINI_1

EXTRACT    EINI_1    Initialized   <span class="token number">2021</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">09</span>:<span class="token number">05</span>   <span class="token keyword">Status</span> STOPPED
<span class="token keyword">Checkpoint</span> Lag       <span class="token operator">Not</span> Available
Log <span class="token keyword">Read</span> <span class="token keyword">Checkpoint</span>  <span class="token operator">Not</span> Available
                     <span class="token keyword">First</span> Record         Record <span class="token number">0</span>
Task                 SOURCEISTABLE</pre></div></code-block></li><li id="5wpNjqNBbLwTvC6rT9DMGx"><div class="marker"></div><span class="inline-wrap">源端：配置名为</span><span class="inline-wrap"><b>EINI_1</b></span><span class="inline-wrap">的<span class="jill"></span>extract<span class="jill"></span>进程</span><span class="inline-wrap">
</span><span class="inline-wrap">==注：TABLE<span class="jill"></span>可以指定*号作为通配符==</span><code-block id="1FEPKqEAw8GtkrKtffAE98" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">10</span><span class="token operator">></span> edit params eini_1

extract <span class="token constant">EINI_1</span>
<span class="token function">setenv</span> <span class="token punctuation">(</span><span class="token constant">NLS_LANG</span><span class="token operator">=</span><span class="token constant">AMERICAN_AMERICA</span><span class="token punctuation">.</span><span class="token constant">ZHS16GBK</span><span class="token punctuation">)</span>
userid ogg<span class="token punctuation">,</span> <span class="token constant">PASSWORD</span> ogg
rmthost <span class="token number">192.168</span><span class="token number">.238</span><span class="token number">.38</span><span class="token punctuation">,</span> mgrport <span class="token number">7809</span>
rmttask replicat<span class="token punctuation">,</span> group <span class="token constant">RINI_1</span>
<span class="token constant">TABLE</span> tengfei<span class="token punctuation">.</span><span class="token property-access">idt</span><span class="token punctuation">;</span>
</pre></div></code-block></li><li id="bgMcSPFUjAVeWkJPrbkcpS"><div class="marker"></div><span class="inline-wrap">目标端：配置名为</span><span class="inline-wrap"><b>RINI_1</b></span><span class="inline-wrap">的<span class="jill"></span>REPLICAT<span class="jill"></span>进程</span><span class="inline-wrap">
</span><span class="inline-wrap">==注：map<span class="jill"></span>与<span class="jill"></span>target<span class="jill"></span>可以指定*号作为通配符==</span><code-block id="kAqboFsrcHoZ1MzYZzgu8R" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ora2<span class="token punctuation">)</span> <span class="token operator"><span class="token file-descriptor important">6</span>></span> edit params rini_1

REPLICAT RINI_1
setenv <span class="token punctuation">(</span>NLS_LANG<span class="token operator">=</span>AMERICAN_AMERICA.ZHS16GBK<span class="token punctuation">)</span>
assumetargetdefs
userid ogg,password ogg
discardfile /u01/app/ogg/RINIaa.dsc, purge
map tengfei.idt, target tengfei.idt<span class="token punctuation">;</span>

<span class="token comment"># assumetargetdefs 表示源与目标的表具有相同结构</span>
<span class="token comment"># discardfile purge 写文件之前会清除内容</span></pre></div></code-block></li></ol><div id="wkjXhwbUUBghwFS157u2Uw" class="wolai-block wolai-text"><div><span class="inline-wrap">==注：初始化数据工作只会做一次，目标端<span class="jill"></span>Rini_1<span class="jill"></span>不用手动启动==</span></div></div><ol class="wolai-block"><li id="i6S1CtBXh3F14bHspAkU9Y"><div class="marker"></div><span class="inline-wrap">源端启动</span><code-block id="ppB8Cde2fYzLHT5JPd7F5z" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">></span> start extract eini_1
<span class="token maybe-class-name">Sending</span> <span class="token constant">START</span> request to <span class="token constant">MANAGER</span> <span class="token spread operator">...</span>
<span class="token constant">EXTRACT</span> <span class="token constant">EINI_1</span> starting</pre></div></code-block></li><li id="8K6ooLwcDeduBTYS4vL4Sy"><div class="marker"></div><span class="inline-wrap">查看进程</span><code-block id="jQf5WF7yxh9K6PNN8ied7T" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">3</span><span class="token operator">></span> view report eini_1</pre></div></code-block></li></ol><div id="pw7UVgiPqTmq4e15jUVmt7" class="wolai-block wolai-text"><div><span class="inline-wrap">执行完后<span class="jill"></span>ggserr.log<span class="jill"></span>将显示：</span></div></div><blockquote id="n8auSFr2PYe1dXApnX62YQ" class="wolai-block"><span class="inline-wrap">2021-07-16 11:25:58  INFO    OGG-00991  Oracle GoldenGate Capture for Oracle, eini_1.prm:  EXTRACT EINI_1 stopped normally.</span></blockquote><h1 id="cGhwx3GRbSNEsJKw9FUrBP" class="wolai-block"><span class="inline-wrap">五、多端：配置检查点</span></h1><div id="cuGXY6rXcXN5KWZ6hyufsP" class="wolai-block wolai-text"><div><span class="inline-wrap">为了让 OGG 网络中断、服务器宕机、掉电等在突发情况也能正确断点续传，ORACLE 建议配置 OGG 的检查点队列。</span><span class="inline-wrap"><a href="http://www.dba-oracle.com/t_goldengate_checkpoint_table.htm"><span>参考文档</span></a></span></div></div><ol class="wolai-block"><li id="o9qasf5B1BabJJ61276XsK"><div class="marker"></div><span class="inline-wrap">源端和目标端配置并添加信息</span><code-block id="iftBAvDNq7uHVPEXmWXA7U" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>stream<span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">></span> <span class="token constant">EDIT</span> <span class="token constant">PARAMS</span> <span class="token punctuation">.</span><span class="token operator">/</span><span class="token constant">GLOBALS</span>
<span class="token constant">CHECKPOINTTABLE</span> ogg<span class="token punctuation">.</span><span class="token property-access">ggschkpt</span></pre></div></code-block></li><li id="bqGcUZSfGNQdJ8txXhpH6i"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>ogg<span class="jill"></span>用户登录数据库</span><code-block id="9LKMaDvAcq4NHew9m1PqFH" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">dblogin userid ogg<span class="token punctuation">,</span>password ogg </pre></div></code-block></li><li id="vt6ozx3eBW3xAJvNG9815e"><div class="marker"></div><span class="inline-wrap">创建检查点</span><code-block id="jUB9X5BoXRbSSCbG8MYCbG" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">add checkpointtable ogg<span class="token punctuation">.</span><span class="token property-access">ggschkpt</span></pre></div></code-block></li><li id="3KGUGtkuAy2MvocNTBMy92"><div class="marker"></div><span class="inline-wrap">从<span class="jill"></span>SQLPLUS<span class="jill"></span>使用<span class="jill"></span>ogg<span class="jill"></span>用户登录并查看检查点表</span><code-block id="rVA4bzrsmF2hbjVRznEMXa" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SQL</span><span class="token operator">></span> conn ogg<span class="token operator">/</span>ogg
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tab<span class="token punctuation">;</span>

TNAME                           TABTYPE  CLUSTERID
<span class="token comment">------------------------------ ------- ----------</span>
GGSCHKPT                       <span class="token keyword">TABLE</span>
GGSCHKPT_LOX                   <span class="token keyword">TABLE</span>
GGS_DDL_COLUMNS                <span class="token keyword">TABLE</span>
GGS_DDL_HIST                   <span class="token keyword">TABLE</span>
GGS_DDL_HIST_ALT               <span class="token keyword">TABLE</span>
GGS_DDL_LOG_GROUPS             <span class="token keyword">TABLE</span>
GGS_DDL_OBJECTS                <span class="token keyword">TABLE</span>
GGS_DDL_PARTITIONS             <span class="token keyword">TABLE</span>
GGS_DDL_PRIMARY_KEYS           <span class="token keyword">TABLE</span>
GGS_DDL_RULES                   <span class="token keyword">TABLE</span>
GGS_DDL_RULES_LOG               <span class="token keyword">TABLE</span>

TNAME                           TABTYPE  CLUSTERID
<span class="token comment">------------------------------ ------- ----------</span>
GGS_MARKER                     <span class="token keyword">TABLE</span>
GGS_SETUP                       <span class="token keyword">TABLE</span>
GGS_STICK                       <span class="token keyword">TABLE</span>
GGS_TEMP_COLS                   <span class="token keyword">TABLE</span>
GGS_TEMP_UK                     <span class="token keyword">TABLE</span>

<span class="token number">16</span> <span class="token keyword">rows</span> selected<span class="token punctuation">.</span></pre></div></code-block></li></ol><h1 id="9Bybxq91sqQ1izmviNUWei" class="wolai-block"><span class="inline-wrap">六、源端：配置<span class="jill"></span>Extract<span class="jill"></span>进程</span></h1><h2 id="wN14MUd7wBJUkdj4x82Bzv" class="wolai-block"><span class="inline-wrap">1、捕获进程</span></h2><ol class="wolai-block"><li id="kMesAuVe9wz9wtMMfJhL7A"><div class="marker"></div><span class="inline-wrap">源端配置<span class="jill"></span>EORA_1<span class="jill"></span>进程：</span><code-block id="exrE7puTWGHwpg9SFPeaBW" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">></span> edit params eora_1
EXTRACT EORA_1
SETENV <span class="token punctuation">(</span>NLS_LANG<span class="token operator">=</span>AMERICAN_AMERICA<span class="token punctuation">.</span>ZHS16GBK<span class="token punctuation">)</span>
USERID ogg<span class="token punctuation">,</span> PASSWORD ogg
EXTTRAIL <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>aa
<span class="token keyword">TABLE</span> tengfei<span class="token punctuation">.</span>idt<span class="token punctuation">;</span></pre></div></code-block><div id="9niN7X2MfBTTtWhHus8Kom" class="wolai-block wolai-text"><div><span class="inline-wrap">EXTTRAIL 为端的<span class="jill"></span>dirdat<span class="jill"></span>路径</span></div></div></li><li id="inhsdwtprsniWFSou4EUd7"><div class="marker"></div><span class="inline-wrap">开始捕获</span><span class="inline-wrap">
</span><span class="inline-wrap">TRAIL 文件可以理解为存放捕获进程捕获的日志文件</span><code-block id="3tEanaeC5YisERmiQzpU7E" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">></span> <span class="token keyword">add</span> extract eora_1<span class="token punctuation">,</span> tranlog<span class="token punctuation">,</span> <span class="token keyword">begin</span> now
EXTRACT added<span class="token punctuation">.</span>
<span class="token comment">## 队列大小5M</span>
GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">3</span><span class="token operator">></span> <span class="token keyword">add</span> exttrail <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>aa<span class="token punctuation">,</span> extract eora_1<span class="token punctuation">,</span> megabytes <span class="token number">5</span>
EXTTRAIL added<span class="token punctuation">.</span></pre></div></code-block><div id="jkMw7AySTE8YwUBEGtaoJz" class="wolai-block wolai-text"><div><span class="inline-wrap">EXTTRAIL 参数是 TRAIL 队列文件存放的路径和命名格式</span></div></div></li><li id="xieWxUx1SmtCNRZT6JShht"><div class="marker"></div><span class="inline-wrap">启动进程</span><code-block id="1rrTmZGgFqFm8hLNaKQwh1" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">4</span><span class="token operator">></span> <span class="token keyword">start</span> extract eora_1

Sending <span class="token keyword">START</span> request <span class="token keyword">to</span> MANAGER <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
EXTRACT EORA_1 <span class="token keyword">starting</span></pre></div></code-block><div id="9VbW1emsG5ZxCmBxocS1qm" class="wolai-block wolai-text"><div><span class="inline-wrap">查看进程：</span><span class="inline-wrap"><code>info extract eora_1</code></span></div></div></li></ol><h2 id="1tpmA5QbP7t6fWMGR5jXo9" class="wolai-block"><span class="inline-wrap">2、PUMP<span class="jill"></span>传输进程</span></h2><ol class="wolai-block"><li id="hcGrVpmMhgsdGQKqTTfuXd"><div class="marker"></div><span class="inline-wrap">源端配置</span><span class="inline-wrap">
</span><span class="inline-wrap">此步骤也是非必须的，如果不配置传输进程，OGG 会通过 EXTRACT 进程传输 TRAIL 队列文件，但是和检查点队列一样，为了保证断点续传 ORACLE 建议配置 PUMP 传输进程。</span><code-block id="cMNMWCH5bLpLJrajM1ZEhP" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">></span> <span class="token constant">EDIT</span> <span class="token constant">PARAMS</span> <span class="token constant">PORA_1</span>
<span class="token constant">EXTRACT</span> <span class="token constant">PORA_1</span>
<span class="token constant">SETENV</span> <span class="token punctuation">(</span><span class="token constant">NLS_LANG</span><span class="token operator">=</span><span class="token constant">AMERICAN_AMERICA</span><span class="token punctuation">.</span><span class="token constant">ZHS16GBK</span><span class="token punctuation">)</span>
<span class="token constant">PASSTHRU</span>
<span class="token constant">RMTHOST</span> <span class="token number">192.168</span><span class="token number">.249</span><span class="token number">.38</span><span class="token punctuation">,</span> <span class="token constant">MGRPORT</span> <span class="token number">7809</span>
<span class="token constant">RMTTRAIL</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>pa
<span class="token constant">TABLE</span> tengfei<span class="token punctuation">.</span><span class="token property-access">idt</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="2VZkHkqdeHk4GfqAVvpYGA"><div class="marker"></div><span class="inline-wrap">添加<span class="jill"></span>pump<span class="jill"></span>进程到<span class="jill"></span>OGG，并指定本地的<span class="jill"></span>TRAIL<span class="jill"></span>文件</span><code-block id="rhVcg2VqhcnWhtmSmseMmU" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> <span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">3</span><span class="token operator">></span> <span class="token constant">ADD</span> <span class="token constant">EXTRACT</span> <span class="token constant">PORA_1</span><span class="token punctuation">,</span> <span class="token constant">EXTTRAILSOURCE</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>aa</pre></div></code-block></li><li id="7dXJYRwdovMYrrDjheV88U"><div class="marker"></div><span class="inline-wrap">查看状态</span><code-block id="bsrbUnSUmEVvaBCevZN9G9" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">4</span><span class="token operator">></span> <span class="token constant">INFO</span> <span class="token constant">EXTRACT</span> <span class="token constant">PORA_1</span>

<span class="token constant">EXTRACT</span>    <span class="token constant">PORA_1</span>    <span class="token maybe-class-name">Initialized</span>   <span class="token number">2021</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">38</span>   <span class="token maybe-class-name">Status</span> <span class="token constant">STOPPED</span>
<span class="token maybe-class-name">Checkpoint</span> <span class="token maybe-class-name">Lag</span>       <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token punctuation">(</span>updated <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">35</span> ago<span class="token punctuation">)</span>
<span class="token maybe-class-name">Log</span> <span class="token maybe-class-name">Read</span> <span class="token maybe-class-name">Checkpoint</span>  <span class="token maybe-class-name">File</span> <span class="token comment">//u01/app/ogg/dirdat/aa000000</span>
                     <span class="token maybe-class-name">First</span> <span class="token maybe-class-name">Record</span>  <span class="token constant">RBA</span> <span class="token number">0</span></pre></div></code-block></li><li id="2f6okpsDW8kPFmiv3Ft19Y"><div class="marker"></div><span class="inline-wrap">为 PUMP 进程 PORA_1 指定将本地 TRAIL 文件传输到目标端后保存成目标端 TRAIL 文件的名字</span><code-block id="9WWisZB4QmHx7cDqnQrSq3" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">5</span><span class="token operator">></span> <span class="token constant">ADD</span> <span class="token constant">RMTTRAIL</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>pa<span class="token punctuation">,</span> <span class="token constant">EXTRACT</span> <span class="token constant">PORA_1</span><span class="token punctuation">,</span> <span class="token constant">MEGABYTES</span> <span class="token number">100</span>
<span class="token constant">RMTTRAIL</span> added<span class="token punctuation">.</span></pre></div></code-block></li><li id="iJSpM3HUC4xKzHA4oaLf6C"><div class="marker"></div><span class="inline-wrap">启动进程</span><code-block id="5EnRt8Kg2oCZs8zrcbbu95" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">GGSCI <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">6</span><span class="token operator">></span> <span class="token keyword">start</span> extract pora_1
Sending <span class="token keyword">START</span> request <span class="token keyword">to</span> MANAGER <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
EXTRACT PORA_1 <span class="token keyword">starting</span></pre></div></code-block></li><li id="12GVf43Qsw8beSdcaRQUsn"><div class="marker"></div><span class="inline-wrap">查看状态</span><span class="inline-wrap">
</span><span class="inline-wrap">注：正常情况将在目标端<span class="jill"></span>dirdata<span class="jill"></span>文件夹下生成<span class="jill"></span>pa000000<span class="jill"></span>文件</span><code-block id="81jAq7r5zqiN3dW39dmE8J" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg1<span class="token punctuation">)</span> <span class="token number">5</span><span class="token operator">></span> info extract pora_1

<span class="token constant">EXTRACT</span>    <span class="token constant">PORA_1</span>    <span class="token maybe-class-name">Last</span> <span class="token maybe-class-name">Started</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">05</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">54</span>   <span class="token maybe-class-name">Status</span> <span class="token constant">RUNNING</span>
<span class="token maybe-class-name">Checkpoint</span> <span class="token maybe-class-name">Lag</span>       <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> <span class="token punctuation">(</span>updated <span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">07</span> ago<span class="token punctuation">)</span>
<span class="token maybe-class-name">Log</span> <span class="token maybe-class-name">Read</span> <span class="token maybe-class-name">Checkpoint</span>  <span class="token maybe-class-name">File</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>aa000000
                     <span class="token maybe-class-name">First</span> <span class="token maybe-class-name">Record</span>  <span class="token constant">RBA</span> <span class="token number">1043</span></pre></div></code-block><div id="5r3UPjn55zWJBTvgHuh3Fm" class="wolai-block wolai-text"><div><span class="inline-wrap">注：当状态为<span class="jill"></span>abended<span class="jill"></span>时，可通过查看<span class="jill"></span>ggserr.log<span class="jill"></span>检查报错</span></div></div></li></ol><h1 id="rWM1MCDLRMAroJasPTY8Sp" class="wolai-block"><span class="inline-wrap">七、目标端：配置<span class="jill"></span>Replicat<span class="jill"></span>进程</span></h1><ol class="wolai-block"><li id="cEqgJmZiBj8s2kRFzYiZuT"><div class="marker"></div><span class="inline-wrap">添加进程</span><code-block id="4zbz5hWUgGXxME2FgMYDyq" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg2<span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">></span>  <span class="token constant">ADD</span> <span class="token constant">REPLICAT</span> <span class="token constant">RRA_1</span><span class="token punctuation">,</span> exttrail <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirdat<span class="token operator">/</span>pa<span class="token punctuation">,</span> checkpointtable ogg<span class="token punctuation">.</span><span class="token property-access">ggschkpt</span>
<span class="token constant">REPLICAT</span> added<span class="token punctuation">.</span></pre></div></code-block></li><li id="1iHneudrinADQQ9ANNs1rp"><div class="marker"></div><span class="inline-wrap">编辑进程</span><code-block id="pSjXFbw7v9PcQ6U6fntNVw" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg2<span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">></span> edit params rora_1
<span class="token constant">REPLICAT</span> <span class="token constant">RORA_1</span>
<span class="token constant">SETENV</span> <span class="token punctuation">(</span><span class="token constant">NLS_LANG</span><span class="token operator">=</span><span class="token constant">AMERICAN_AMERICA</span><span class="token punctuation">.</span><span class="token constant">ZHS16GBK</span><span class="token punctuation">)</span>
<span class="token constant">USERID</span> ogg<span class="token punctuation">,</span> <span class="token constant">PASSWORD</span> ogg
<span class="token constant">ASSUMETARGETDEFS</span>
<span class="token constant">DISCARDFILE</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>ogg<span class="token operator">/</span>dirrpt<span class="token operator">/</span><span class="token maybe-class-name">RORA_aa</span><span class="token punctuation">.</span><span class="token constant">DSC</span><span class="token punctuation">,</span> <span class="token constant">PURGE</span>
<span class="token constant">MAP</span> tengfei<span class="token punctuation">.</span><span class="token property-access">idt</span><span class="token punctuation">,</span> <span class="token constant">TARGET</span> tengfei<span class="token punctuation">.</span><span class="token property-access">idt</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="qdS2rgTG8P7c53d33Vmox2"><div class="marker"></div><span class="inline-wrap">启动进程</span><code-block id="1tmjgmGiB7EjrQ6ZrYGDQW" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg2<span class="token punctuation">)</span> <span class="token number">3</span><span class="token operator">></span> start replicat rora_1
<span class="token maybe-class-name">Sending</span> <span class="token constant">START</span> request to <span class="token constant">MANAGER</span> <span class="token spread operator">...</span>
<span class="token constant">REPLICAT</span> <span class="token constant">RORA_1</span> starting</pre></div></code-block></li><li id="nbcbqzm1Ezu5AxzNk18aHA"><div class="marker"></div><span class="inline-wrap">查看进程（running<span class="jill"></span>状态正常）</span><code-block id="3AhRXvHk8L3NQbyxFA7kdp" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token constant">GGSCI</span> <span class="token punctuation">(</span>ogg2<span class="token punctuation">)</span> <span class="token number">4</span><span class="token operator">></span> info replicat rora_1</pre></div></code-block></li></ol><div id="9BrKvEFuhgjcHsodxJLtXL" class="wolai-block wolai-text"><div><span class="inline-wrap">到此配置完成，可检查数据同步情况！</span></div></div></article><footer></footer></body></html>