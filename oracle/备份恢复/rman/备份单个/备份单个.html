<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>备份单个 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="备份单个" class="main-title"></div></div></header><article><h2 id="nvn19JJyx5qDNAt8Qi8BnY" class="wolai-block"><span class="inline-wrap">数据库文件和归档重做日志</span></h2><code-block id="osvgtbaGXege9Ww64a7MCh" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">RMAN</span><span class="token operator">></span> backup incremental level<span class="token operator">=</span><span class="token number">0</span> database plus archive<span class="token punctuation">;</span></pre></div></code-block><h2 id="jecnEarR9Qj5S5V9z2pFWN" class="wolai-block"><span class="inline-wrap">数据库</span></h2><div id="nW72WyVWvcs3AUWzPaQLwz" class="wolai-block wolai-text"><div><span class="inline-wrap">手动备份数据库</span></div></div><code-block id="sRJaU1Fotqgh7hT3wbuEYE" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">backup</span> <span class="token keyword">database</span><span class="token punctuation">;</span></pre></div></code-block><div id="uzs9wsq3FHpcSt215i1yUA" class="wolai-block wolai-text"><div><span class="inline-wrap">手动备份数据库并包括控制文件</span></div></div><code-block id="4n6VRgqF7LPhjm6xMXx8Uy" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> INCLUDE <span class="token keyword">CURRENT</span> CONTROLFILE<span class="token punctuation">;</span></pre></div></code-block><div id="ucTbPzxm89dKLJoAYhLykS" class="wolai-block wolai-text"><div><span class="inline-wrap">手动备份数据库包括归档日志</span></div></div><code-block id="iemGCESX8U7fm6QxFTnsW9" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">BACKUP</span> <span class="token keyword">DATABASE</span> PLUS ARCHIVELOG<span class="token punctuation">;</span>
<span class="token comment">-- 1. 运行 ALTER SYSTEM ARCHIVE LOG CURRENT 语句对当前 redolog 进行归档</span>
<span class="token comment">-- 2. 执行 BACKUP ARCHIVELOG ALL 命令备份所有已归档日志。</span>
<span class="token comment">-- 3. 执行 BACKUP 命令对指定项进行备份。</span>
<span class="token comment">-- 4. 再次运行 ALTER SYSTEM ARCHIVE LOG CURRENT 对当前 redolog 归档</span>
<span class="token comment">-- 5. 对新生成的尚未备份的归档文件进行备份。</span></pre></div></code-block><div id="jNqLXTK343h14H5aKCVYhx" class="wolai-block wolai-text"><div><span class="inline-wrap">查看备份</span></div></div><code-block id="6kacWrHzWRAe9wCrcmWhfZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> list <span class="token keyword">backup</span> <span class="token keyword">of</span> <span class="token keyword">database</span><span class="token punctuation">;</span></pre></div></code-block><h2 id="hquXV8Th2Yas7FEcKpnVxg" class="wolai-block"><span class="inline-wrap">备份表空间</span></h2><div id="dTHrnjvYL1YCH3JRGMn88T" class="wolai-block wolai-text"><div><span class="inline-wrap">手动备份</span></div></div><code-block id="4n2hUFutPn54n7L3vMR9FX" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">backup</span> <span class="token keyword">tablespace</span> system<span class="token punctuation">,</span>sysaux<span class="token punctuation">;</span></pre></div></code-block><div id="pr6DYTqVPM2RQaPdYXuUfa" class="wolai-block wolai-text"><div><span class="inline-wrap">查看备份</span></div></div><code-block id="9asXRp4ZFmgMDMwLU9odJB" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> LIST <span class="token keyword">BACKUP</span> <span class="token keyword">OF</span> <span class="token keyword">TABLESPACE</span> system<span class="token punctuation">;</span></pre></div></code-block><h2 id="mNomUcJiqT5vNbpLHoni6R" class="wolai-block"><span class="inline-wrap">备份数据文件</span></h2><code-block id="fW2iobtW6Vzf9nW3oU76if" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">backup</span> datafile <span class="token string">'*.dbf'</span><span class="token punctuation">;</span>
<span class="token comment"># 使用文件编号</span>
RMAN<span class="token operator">></span> <span class="token keyword">backup</span> datafile <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">;</span>
<span class="token comment"># 使用镜像副本</span>
RMAN<span class="token operator">></span> <span class="token keyword">backup</span> <span class="token keyword">as</span> copy datafile <span class="token string">'*.dbf'</span><span class="token punctuation">;</span>
<span class="token comment"># 使用增量备份</span>
RMAN<span class="token operator">></span> <span class="token keyword">backup</span> incremental <span class="token keyword">level</span> <span class="token number">1</span> datafile <span class="token string">'*.dbf'</span><span class="token punctuation">;</span></pre></div></code-block><div id="q9QFz6KzwvSqQ3s3apsE9o" class="wolai-block wolai-text"><div><span class="inline-wrap">查看表空间、数据文件名称和数据文件编号</span></div></div><code-block id="p8Zf29edCYgVeBSEhvYVjA" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> report <span class="token keyword">schema</span><span class="token punctuation">;</span></pre></div></code-block><h2 id="gtc52FuxeCP9eMMvMUMw1i" class="wolai-block"><span class="inline-wrap">备份控制文件</span></h2><div id="tDV6nWFtQ5agWyob2a9AJF" class="wolai-block wolai-text"><div><span class="inline-wrap">手动备份</span></div></div><code-block id="cFzy9GihdzmqDoCoqXxbAL" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">backup</span> <span class="token keyword">current</span> controlfile<span class="token punctuation">;</span></pre></div></code-block><div id="4TdaeiJ7K98A3tN7VGDzeN" class="wolai-block wolai-text"><div><span class="inline-wrap">查看控制文件备份信息</span></div></div><code-block id="7DGB9qyMp29bjhWgo8quL7" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> list <span class="token keyword">backup</span> <span class="token keyword">of</span> CONTROLFILE<span class="token punctuation">;</span></pre></div></code-block><div id="rM1j31vSSHhyjjcWWRNGhH" class="wolai-block wolai-text"><div><span class="inline-wrap">打开自动备份（参数文件和控制文件）</span></div></div><code-block id="enLBf1TbHFwCtdTh1mF3W1" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>CONFIGURE CONTROLFILE AUTOBACKUP <span class="token keyword">ON</span><span class="token punctuation">;</span></pre></div></code-block><div id="iEKu6qQb3j224UVf6wmpuD" class="wolai-block wolai-text"><div><span class="inline-wrap">修改控制文件的存储位置</span></div></div><code-block id="tpP3nxqZhJ9YaXv491m8YW" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> configure controlfile autobackup format <span class="token keyword">for</span> device <span class="token keyword">type</span> <span class="token keyword">disk</span> <span class="token keyword">to</span> <span class="token string">'*.bk'</span><span class="token punctuation">;</span></pre></div></code-block><div id="vhvFnynqnviM4P7Bv28nZ7" class="wolai-block wolai-text"><div><span class="inline-wrap">恢复控制文件的存储位置</span></div></div><code-block id="5RzvbH35X8NKqjtgDg9pc5" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> configure controlfile autobackup format <span class="token keyword">for</span> device <span class="token keyword">type</span> <span class="token keyword">disk</span> clear<span class="token punctuation">;</span></pre></div></code-block><h2 id="62E95uLBU3PzBmTC4eSGmC" class="wolai-block"><span class="inline-wrap">备份参数文件</span></h2><div id="6jAUeguVh4yDmeUxr5vSKx" class="wolai-block wolai-text"><div><span class="inline-wrap">手动备份参数文件</span></div></div><code-block id="qxU4GKeihHCncRfYXCL1Rg" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>RMAN<span class="token operator">></span> <span class="token keyword">backup</span> spfile<span class="token punctuation">;</span></pre></div></code-block><div id="5SwFmPbtXgJo65XYgCMcya" class="wolai-block wolai-text"><div><span class="inline-wrap">启动控制文件的自动备份后，执行<span class="jill"></span>BACKUP<span class="jill"></span>或<span class="jill"></span>COPY<span class="jill"></span>是，spfile<span class="jill"></span>与控制文件一起会被备份，存储于控制文件的位置。</span></div></div><div id="4Gwg1Ef6qpYLwunQzSZgqf" class="wolai-block wolai-text"><div><span class="inline-wrap">注：如果实例使用<span class="jill"></span>spfile<span class="jill"></span>启动，那么<span class="jill"></span>RMAN<span class="jill"></span>只会备份<span class="jill"></span>spfile</span></div></div><h2 id="6b7JFGizzLMfof6HChokUy" class="wolai-block"><span class="inline-wrap">备份归档日志</span></h2><div id="sFNidgajKZxLZ8L3oBQfGR" class="wolai-block wolai-text"><div><span class="inline-wrap">备份归档日志</span></div></div><code-block id="uCDZqqsexWBkNM728Vy85g" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 备份所有归档日志</span>
RMAN<span class="token operator">></span> <span class="token keyword">backup</span> archivelog <span class="token keyword">all</span><span class="token punctuation">;</span>
<span class="token comment">-- 备份580这个归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">backup</span> archivelog sequence <span class="token number">580</span> 
<span class="token comment">-- 备份580到584的归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">backup</span> archivelog sequence <span class="token operator">between</span> <span class="token number">580</span> <span class="token operator">and</span> <span class="token number">584</span><span class="token punctuation">;</span>
<span class="token comment">-- 备份580开始的所有归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">backup</span> archivelog <span class="token keyword">from</span> sequence <span class="token number">580</span><span class="token punctuation">;</span>
<span class="token comment">-- 备份580到584的归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">backup</span> archivelog <span class="token keyword">from</span> sequence <span class="token number">580</span> until sequence <span class="token number">584</span><span class="token punctuation">;</span></pre></div></code-block><div id="p69MzgMaYntrwH4hK4qTh7" class="wolai-block wolai-text"><div><span class="inline-wrap">恢复归档日志</span></div></div><code-block id="4NaLCetBQL2syfDLKZupL3" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 恢复所有归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">restore</span> archivelog <span class="token keyword">all</span><span class="token punctuation">;</span>
<span class="token comment">-- 恢复580这个归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">restore</span> archivelog sequence <span class="token number">580</span><span class="token punctuation">;</span>
<span class="token comment">-- 恢复580到584的归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">restore</span> archivelog sequence <span class="token operator">between</span> <span class="token number">580</span> <span class="token operator">and</span> <span class="token number">584</span><span class="token punctuation">;</span>
<span class="token comment">-- 恢复580开始的所有归档日志</span>
Rman<span class="token operator">></span><span class="token keyword">restore</span> archivelog <span class="token keyword">from</span> sequence <span class="token number">580</span><span class="token punctuation">;</span>
<span class="token comment">-- 恢复580到584的归档日志</span>
Rman<span class="token operator">></span> <span class="token keyword">restore</span> archivelog <span class="token keyword">from</span> sequence <span class="token number">580</span> until sequence <span class="token number">584</span><span class="token punctuation">;</span>
<span class="token comment">-- 根据时间还原需要的备份集：</span>
RMAN<span class="token operator">></span> run {
<span class="token keyword">set</span> archivelog destination <span class="token keyword">to</span> <span class="token string">'/u01/backup'</span><span class="token punctuation">;</span>
<span class="token keyword">SQL</span> <span class="token string">'ALTER SESSION SET NLS_DATE_FORMAT="YYYY-MM-DD HH24:MI:SS"'</span><span class="token punctuation">;</span>
<span class="token keyword">restore</span> archivelog <span class="token keyword">time</span> <span class="token operator">between</span> <span class="token string">'2014-04-24 11:00:00'</span> <span class="token operator">and</span> <span class="token string">'2014-04-24 15:00:00'</span><span class="token punctuation">;</span>
}</pre></div></code-block><div id="fktLZSMaZC5fsVzVPo3YvL" class="wolai-block wolai-text"><div><span class="inline-wrap">查看归档日志</span></div></div><code-block id="gBd7aEVUdmu9Lz3Ft3QtYM" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 根据时间查看需要的备份集：</span>
RMAN<span class="token operator">></span> run{
<span class="token keyword">SQL</span> <span class="token string">'ALTER SESSION SET NLS_DATE_FORMAT="YYYY-MM-DD HH24:MI:SS"'</span><span class="token punctuation">;</span>
list <span class="token keyword">backup</span> <span class="token keyword">of</span> archivelog <span class="token keyword">time</span> <span class="token operator">between</span> <span class="token string">"to_date('2014-04-24 11:00:00','yyyy-mm-dd hh24:mi:ss')"</span> <span class="token operator">and</span> <span class="token string">"to_date('2014-04-24 14:30','yyyy-mm-dd hh24:mi:ss')"</span><span class="token punctuation">;</span>
}</pre></div></code-block><h3 id="tTZyGQ9BV3PmwduPDENZrU" class="wolai-block"><span class="inline-wrap">关于控制文件快照</span></h3><div id="1x3yzeEmPAVonTsuVw5Pf1" class="wolai-block wolai-text"><div><span class="inline-wrap">显示当前控制文件快照细节</span></div></div><code-block id="6ySSUoUXQe7a5uR1dvviTm" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">RMAN</span><span class="token operator">></span> show snapshot controlfile name<span class="token punctuation">;</span></pre></div></code-block><div id="a1EtrL4XaQeV2mFfpVMpzu" class="wolai-block wolai-text"><div><span class="inline-wrap">修改控制文件快照存储位置</span></div></div><code-block id="fB4GSkQ4mLuzFXSxpGDxQL" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">RMAN</span><span class="token operator">></span> configure snapshot control file name to <span class="token string">'*.ctl'</span></pre></div></code-block><div id="ovFS1KbgQkakYyoY9XkxG2" class="wolai-block wolai-text"><div><span class="inline-wrap">存储位置恢复默认值</span></div></div><code-block id="vjvY2Uf9o4JHzdbSKg42W4" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">RMAN</span><span class="token operator">></span> configure snapshot controlfile name clear<span class="token punctuation">;</span></pre></div></code-block></article><footer></footer></body></html>