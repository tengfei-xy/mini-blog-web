<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>19c-shell - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="19c-shell" class="main-title"></div></div></header><article><h1 id="fjeFxwjrGTQPnoExfsDA4A" class="wolai-block"><span class="inline-wrap">Centos7 shell<span class="jill"></span>安装<span class="jill"></span>19c rac</span></h1><div id="4LqS82Xg5NYKgBYo9B6WRL" class="wolai-block wolai-text"><div><span class="inline-wrap">注：如果你没有成功手动部署过<span class="jill"></span>rac，请出门左转</span></div></div><h2 id="uYmXkQskmqfFyVRYfXhLPt" class="wolai-block"><span class="inline-wrap">参考文档</span></h2><div id="2Zs71QZya9ozZYr4jceJ5M" class="wolai-block wolai-text"><div><span class="inline-wrap">本文使用的<span class="jill"></span>OracleShellInstall.sh<span class="jill"></span>的<span class="jill"></span>md5<span class="jill"></span>为</span></div></div><code-block id="5ZboVy8sqZp72wWSRqdS1N" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">6f1b731204f71a18b00263214385f60d</pre></div></code-block><h2 id="hfX9wNF76sgj86Xc3bDdLD" class="wolai-block"><span class="inline-wrap">环境准备</span></h2><div id="s6JWsz6QQB3BE2jFcbzV6p" class="wolai-block wolai-text"><div><span class="inline-wrap">双节点（Centos7.6），每个节点需要</span></div></div><ol class="wolai-block"><li id="3HrTpDH7j6pdTKfvA2tWuu"><div class="marker"></div><span class="inline-wrap">有两张网卡（作为公网<span class="jill"></span>IP<span class="jill"></span>和私网<span class="jill"></span>IP）</span></li><li id="wDisCnUD87zLgvEMH7uaY7"><div class="marker"></div><span class="inline-wrap">共享盘就绪</span></li><li id="7aeAYW1T7wRnQbqWup1X8s"><div class="marker"></div><span class="inline-wrap">CD<span class="jill"></span>系统盘连接</span></li></ol><h2 id="bKajtmfZpyV1xuia2HtsEx" class="wolai-block"><span class="inline-wrap">脚本使用步骤</span></h2><div id="nNrqbZP5YNvSNMZxx7gmno" class="wolai-block wolai-text"><div><span class="inline-wrap">安装依赖包</span></div></div><code-block id="gNPRt1gwbN3QQaMTntapcN" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum <span class="token operator">-</span>y <span class="token operator">-</span>q install bc gcc gcc<span class="token operator">-</span>c<span class="token operator">++</span>  binutils  make gdb cmake  glibc ksh elfutils<span class="token operator">-</span>libelf elfutils<span class="token operator">-</span>libelf<span class="token operator">-</span>devel fontconfig<span class="token operator">-</span>devel glibc<span class="token operator">-</span>devel libaio libXrender libXrender<span class="token operator">-</span>devel libX11 libXau sysstat libXi libXtst libgcc librdmacm<span class="token operator">-</span>devel libstdc<span class="token operator">++</span> libstdc<span class="token operator">++</span><span class="token operator">-</span>devel libxcb net<span class="token operator">-</span>tools nfs<span class="token operator">-</span>utils compat<span class="token operator">-</span>libcap1 smartmontools  targetcli python python<span class="token operator">-</span>configshell python<span class="token operator">-</span>rtslib python<span class="token operator">-</span>six  unixODBC unixODBC<span class="token operator">-</span>devel iscsi<span class="token operator">-</span>initiator<span class="token operator">-</span>utils unbound bind<span class="token operator">-</span>utils kde<span class="token operator">-</span>l10n<span class="token operator">-</span><span class="token maybe-class-name">Chinese</span><span class="token punctuation">.</span><span class="token property-access">noarch</span> xclock lsof expect unzip redhat<span class="token operator">-</span>lsb telnep ntsysv strace dos2unix ncurses<span class="token operator">-</span>devel</pre></div></code-block><div id="78Q6SzVbSNMYmsKvPt47rD" class="wolai-block wolai-text"><div><span class="inline-wrap">以及额外依赖包</span></div></div><code-block id="9V6WbCbKZWYCRX8MZvRmsh" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">compat<span class="token operator">-</span>libstdc<span class="token operator">++</span><span class="token operator">-</span><span class="token number">33</span><span class="token operator">-</span><span class="token number">3.2</span><span class="token number">.3</span><span class="token operator">-</span><span class="token number">72</span><span class="token punctuation">.</span><span class="token property-access">el7</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span><span class="token punctuation">.</span><span class="token property-access">rpm</span>
libaio<span class="token operator">-</span>devel<span class="token operator">-</span><span class="token number">0.3</span><span class="token number">.109</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">.</span><span class="token property-access">el7</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span><span class="token punctuation">.</span><span class="token property-access">rpm</span></pre></div></code-block><div id="fTB5eR7vreCFRQic9R5LZY" class="wolai-block wolai-text"><div><span class="inline-wrap">定义初始化变量（三个表决盘、一个数据盘的非<span class="jill"></span>CDB<span class="jill"></span>模式的参数）</span></div></div><code-block id="b2ZhpLw8ci9Wx3npoxTv7c" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">i</span><span class="token operator">=</span><span class="token number">172.16</span>.83.130     <span class="token comment"># node1 Public ip(本机执行脚本的IP)</span>
<span class="token assign-left variable">n</span><span class="token operator">=</span>ora               <span class="token comment"># rac hostname prefix</span>
<span class="token assign-left variable">c</span><span class="token operator">=</span>true              <span class="token comment"># 判断是否为CDB模式</span>
<span class="token assign-left variable">pb</span><span class="token operator">=</span>rac              <span class="token comment"># 创建PDB的名称</span>
<span class="token assign-left variable">o</span><span class="token operator">=</span>rac               <span class="token comment"># oraclesid</span>
<span class="token assign-left variable">rs</span><span class="token operator">=</span>tengfei          <span class="token comment"># root password</span>
<span class="token assign-left variable">op</span><span class="token operator">=</span>oracle           <span class="token comment"># oracle password</span>
<span class="token assign-left variable">gp</span><span class="token operator">=</span>grid             <span class="token comment"># grid password</span>
<span class="token assign-left variable">b</span><span class="token operator">=</span>/u01/app          <span class="token comment"># install basedir</span>
<span class="token assign-left variable">s</span><span class="token operator">=</span>AL32UTF8          <span class="token comment"># characterset</span>
<span class="token assign-left variable">ns</span><span class="token operator">=</span>UTF8             <span class="token comment"># national characterset</span>
<span class="token assign-left variable">pb1</span><span class="token operator">=</span><span class="token variable">$i</span>              <span class="token comment"># node1 public ip</span>
<span class="token assign-left variable">pb2</span><span class="token operator">=</span><span class="token number">172.16</span>.83.131   <span class="token comment"># node2 public ip</span>
<span class="token assign-left variable">vi1</span><span class="token operator">=</span><span class="token number">172.16</span>.83.132   <span class="token comment"># node1 virtual ip</span>
<span class="token assign-left variable">vi2</span><span class="token operator">=</span><span class="token number">172.16</span>.83.133   <span class="token comment"># node2 virtual ip</span>
<span class="token assign-left variable">pi1</span><span class="token operator">=</span><span class="token number">192.168</span>.207.133 <span class="token comment"># node1 private ip</span>
<span class="token assign-left variable">pi2</span><span class="token operator">=</span><span class="token number">192.168</span>.207.149 <span class="token comment"># node2 private ip</span>
<span class="token assign-left variable">si</span><span class="token operator">=</span><span class="token number">172.16</span>.83.134    <span class="token comment"># scan ip</span>
<span class="token assign-left variable">od</span><span class="token operator">=</span><span class="token string">"/dev/sdc,/dev/sde,/dev/sdf"</span> <span class="token comment"># asm ocr disk</span>
<span class="token assign-left variable">dd</span><span class="token operator">=</span><span class="token string">"/dev/sdd"</span>       <span class="token comment"># asm data disk</span>
<span class="token assign-left variable">on</span><span class="token operator">=</span>OCR              <span class="token comment"># asm ocr diskgroupname</span>
<span class="token assign-left variable">dn</span><span class="token operator">=</span>DATA             <span class="token comment"># asm data diskgroupname</span>
<span class="token assign-left variable">or</span><span class="token operator">=</span>NORMAL           <span class="token comment"># asm ocr redundancy</span>
<span class="token assign-left variable">dr</span><span class="token operator">=</span>EXTERNAL         <span class="token comment"># asm data redundancy</span>
<span class="token assign-left variable">puf</span><span class="token operator">=</span>ens33           <span class="token comment"># 主机的公网IP对应的网卡名称</span>
<span class="token assign-left variable">prf</span><span class="token operator">=</span>ens36           <span class="token comment"># 主机的私有IP对应的网卡名称</span>
<span class="token assign-left variable">iso</span><span class="token operator">=</span>y               <span class="token comment"># 配置yum源</span></pre></div></code-block><div id="r1eKHKigGBLJoZXxzXA2QG" class="wolai-block wolai-text"><div><span class="inline-wrap">执行脚本</span></div></div><code-block id="kWNK95cpX8rYyP75v6rtkd" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./OracleShellInstall.sh <span class="token parameter variable">-i</span> <span class="token variable">$i</span> <span class="token parameter variable">-n</span> <span class="token variable">$n</span> <span class="token parameter variable">-c</span> <span class="token variable">$c</span> <span class="token parameter variable">-pb</span> <span class="token variable">$pb</span> <span class="token parameter variable">-o</span> <span class="token variable">$o</span> <span class="token parameter variable">-rs</span> <span class="token variable">$rs</span> <span class="token parameter variable">-op</span> <span class="token variable">$op</span> <span class="token parameter variable">-gp</span> <span class="token variable">$gp</span> <span class="token parameter variable">-b</span> <span class="token variable">$b</span> <span class="token parameter variable">-s</span> <span class="token variable">$s</span> <span class="token parameter variable">-ns</span> <span class="token variable">$ns</span> <span class="token parameter variable">-pb1</span> <span class="token variable">$pb1</span> <span class="token parameter variable">-pb2</span> <span class="token variable">$pb2</span> <span class="token parameter variable">-vi1</span> <span class="token variable">$vi1</span> <span class="token parameter variable">-vi2</span> <span class="token variable">$vi2</span> <span class="token parameter variable">-pi1</span> <span class="token variable">$pi1</span> <span class="token parameter variable">-pi2</span> <span class="token variable">$pi2</span> <span class="token parameter variable">-si</span> <span class="token variable">$si</span> <span class="token parameter variable">-od</span> <span class="token variable">$od</span> <span class="token parameter variable">-dd</span> <span class="token variable">$dd</span> <span class="token parameter variable">-on</span> <span class="token variable">$on</span> <span class="token parameter variable">-dn</span> <span class="token variable">$dn</span> <span class="token parameter variable">-or</span> <span class="token variable">$or</span> <span class="token parameter variable">-dr</span> <span class="token variable">$dr</span> <span class="token parameter variable">-puf</span> <span class="token variable">$puf</span> <span class="token parameter variable">-prf</span> <span class="token variable">$prf</span> <span class="token parameter variable">-iso</span> <span class="token variable">$iso</span></pre></div></code-block><h2 id="8PL7oUohWxUjtB1yAnXY4j" class="wolai-block"><span class="inline-wrap">问题列表</span></h2><ul class="wolai-block"><li id="47k6zvH9xRfWyA3xUki9GY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">gi、oracle<span class="jill"></span>的安装包和<span class="jill"></span>OracleShellInstall.sh<span class="jill"></span>放在/soft<span class="jill"></span>或/tmp<span class="jill"></span>下，请勿放到<span class="jill"></span>root<span class="jill"></span>下</span></li><li id="nZPNq4om9VSdcRQGZWYp2q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">安装包真实存在,但提示找不到包时</span><code-block id="ouKCGC5tmWSmVvXXAM3KKr" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">rm <span class="token operator">-</span>rf <span class="token operator">/</span>u01</pre></div></code-block></li><li id="6eBTsbdHuuwijKbJHADw85"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">gi<span class="jill"></span>安装失败是因<span class="jill"></span>ocr<span class="jill"></span>或<span class="jill"></span>data<span class="jill"></span>的初始参数设置错误时，需要删除如下内容，调整初始参数后重新执行脚本</span><code-block id="iejhHmB6VWES1vFqhscgWN" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">rm <span class="token operator">-</span>f <span class="token operator">/</span>etc<span class="token operator">/</span>udev<span class="token operator">/</span>rules<span class="token punctuation">.</span><span class="token property-access">d</span><span class="token operator">/</span><span class="token number">99</span><span class="token operator">-</span>oracle<span class="token operator">-</span>asmdevices<span class="token punctuation">.</span><span class="token property-access">rules</span>
rm <span class="token operator">-</span>f <span class="token operator">/</span>etc<span class="token operator">/</span>multipath<span class="token punctuation">.</span><span class="token property-access">conf</span>
rm <span class="token operator">-</span>rf <span class="token operator">/</span>u01</pre></div></code-block></li></ul><h2 id="mEZMiwSQ2ZBHZGc8Wo2NZS" class="wolai-block"><span class="inline-wrap">脚本<span class="jill"></span>bug</span></h2><div id="iuNEni1etXgwya8hFBm6a7" class="wolai-block wolai-text"><div><span class="inline-wrap">在未经过任何修改的脚本中，存在如下问题</span></div></div><ol class="wolai-block"><li id="6p8FRzzCjzEvnzcpD34vMJ"><div class="marker"></div><span class="inline-wrap">grep<span class="jill"></span>过滤的关键词包含多个<span class="jill"></span>iso<span class="jill"></span>时会出错</span><span class="inline-wrap">
</span><span class="inline-wrap">默认（864<span class="jill"></span>行左右）：</span><code-block id="o8iY9i9f9qP3ksXSSRZWbb" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">mountPatch<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>mount <span class="token operator">|</span> grep <span class="token operator">-</span><span class="token constant">E</span> <span class="token string">"iso|ISO"</span> <span class="token operator">|</span> awk <span class="token string">'{print $3}'</span><span class="token punctuation">)</span></pre></div></code-block><div id="oBcWiWBoDJdGfWLEnkWQNS" class="wolai-block wolai-text"><div><span class="inline-wrap">改为：</span></div></div><code-block id="gVi7kzeBar9Mzc6AL2JRmA" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">mountPatch<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>mount <span class="token operator">-</span>l <span class="token operator">|</span> grep <span class="token operator">-</span>i <span class="token string">"iso9660"</span> <span class="token operator">|</span> awk <span class="token string">'{print $3}'</span><span class="token punctuation">)</span></pre></div></code-block></li><li id="qCNh4YyURd1KpWZ6tP1p55"><div class="marker"></div><span class="inline-wrap">当根目录挂载于/dev/vda<span class="jill"></span>时，iscsi<span class="jill"></span>的共享磁盘就会从<span class="jill"></span>sda<span class="jill"></span>开始,此时/dev/sda<span class="jill"></span>不能加入黑名单</span><span class="inline-wrap">
</span><span class="inline-wrap">默认（1603<span class="jill"></span>行左右）</span><code-block id="cMMm9GKQPmsp3LwyNticf1" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">devnode <span class="token string">"^sda"</span></pre></div></code-block><div id="j47B3uojYMwof4YdhNARax" class="wolai-block wolai-text"><div><span class="inline-wrap">改为：</span></div></div><code-block id="872GZVrKhtvytmUC9CZK8K" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">#devnode <span class="token string">"^sda"</span></pre></div></code-block></li></ol></article><footer></footer></body></html>