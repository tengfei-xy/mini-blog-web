<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>19c-docker - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="19c-docker" class="main-title"></div></div></header><article><h1 id="tGsiTtmbRCW6cRSjgzqWLd" class="wolai-block"><span class="inline-wrap">Centos7 Docker 安装 19.3 RAC</span></h1><ol class="wolai-block"><li id="wysLw6BQF1iw9ez31GjzQh"><div class="marker"></div><span class="inline-wrap">全程联网（需要连接<span class="jill"></span>yum.oralce.com）</span></li><li id="fsz5Hn9qu51YW8HgWzU1wP"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>DNS、存储服务器均从容器构建</span></li><li id="oyhkWfNBsRAJFgGu8QsgAR"><div class="marker"></div><span class="inline-wrap">单主机搭建<span class="jill"></span>rac<span class="jill"></span>节点</span></li><li id="jtgUbRHKEvJwoamG4jY1to"><div class="marker"></div><span class="inline-wrap"><a href="https://github.com/oracle/docker-images/tree/main/OracleDatabase/RAC/OracleRealApplicationClusters"><span>Github</span></a></span></li></ol><div id="k7SjRdC7D5YA2QfR4rEgQ8" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 370px"><span class="inline-wrap">名称</span></th><th style="width: 370px"><span class="inline-wrap">IP</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">nfs</span></td><td><span class="inline-wrap">192.168.17.25</span></td></tr><tr><td><span class="inline-wrap">dns</span></td><td><span class="inline-wrap">172.16.1.25</span></td></tr><tr><td><span class="inline-wrap">rac node1</span></td><td><span class="inline-wrap">17.16.1.150</span></td></tr><tr><td><span class="inline-wrap">rac node2</span></td><td><span class="inline-wrap">17.16.1.151</span></td></tr></tbody></table></div><h1 id="hZ3E84MKkcXvKft2Gu1Y7e" class="wolai-block"><span class="inline-wrap">环境准备</span></h1><div id="2umsrr4iZSHxn7R7s56uXy" class="wolai-block wolai-text"><div><span class="inline-wrap">每个节点<span class="jill"></span>8G<span class="jill"></span>的内存，硬盘空间：至少<span class="jill"></span>50G（否则安装失败），数据默认保存在/oradata。不支持挂载点/oradata</span></div></div><div id="atQ9zQcJ1Jv3z7Z8rhyQqW" class="wolai-block wolai-text"><div><span class="inline-wrap">安装<span class="jill"></span>docker（20<span class="jill"></span>版本以上）</span></div></div><code-block id="7Le4awDAb5rehJDoXp6vfP" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>curl <span class="token operator">-</span>fsSL https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>get<span class="token punctuation">.</span><span class="token property-access">docker</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token operator">/</span> <span class="token operator">|</span> sh</pre></div></code-block><div id="sGpCauT1xi4poMDW8fVsKD" class="wolai-block wolai-text"><div><span class="inline-wrap">在/usr/lib/systemd/system/docker.service<span class="jill"></span>文件的<span class="jill"></span>ExecStart=行尾添加，并启动<span class="jill"></span>docker</span></div></div><code-block id="pYay3KcczPc8VZya431KLK" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token operator">--</span>selinux<span class="token operator">-</span>enabled <span class="token operator">--</span>cpu<span class="token operator">-</span>rt<span class="token operator">-</span>runtime<span class="token operator">=</span><span class="token number">950000</span></pre></div></code-block><div id="cK3NH2efqe7v2CRQXhsT3W" class="wolai-block wolai-text"><div><span class="inline-wrap">构建<span class="jill"></span>docker<span class="jill"></span>网络</span></div></div><code-block id="ikG9pQvrbQbJx7CDV3Yfbj" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker network create <span class="token operator">--</span>driver<span class="token operator">=</span>bridge <span class="token operator">--</span>subnet<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> rac_pub1_nw
docker network create <span class="token operator">--</span>driver<span class="token operator">=</span>bridge <span class="token operator">--</span>subnet<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.0</span><span class="token operator">/</span><span class="token number">24</span> rac_priv1_nw</pre></div></code-block><div id="eaW5MD3REBaTk1JD3uRLMY" class="wolai-block wolai-text"><div><span class="inline-wrap">设置内核参数</span></div></div><code-block id="aWN67eDtmydGWFxnLyn3cL" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>fs<span class="token punctuation">.</span><span class="token property-access">file</span><span class="token operator">-</span>max <span class="token operator">=</span> <span class="token number">6815744</span>
net<span class="token punctuation">.</span><span class="token property-access">core</span><span class="token punctuation">.</span><span class="token property-access">rmem_max</span> <span class="token operator">=</span> <span class="token number">4194304</span>
net<span class="token punctuation">.</span><span class="token property-access">core</span><span class="token punctuation">.</span><span class="token property-access">rmem_default</span> <span class="token operator">=</span> <span class="token number">262144</span>
net<span class="token punctuation">.</span><span class="token property-access">core</span><span class="token punctuation">.</span><span class="token property-access">wmem_max</span> <span class="token operator">=</span> <span class="token number">1048576</span>
net<span class="token punctuation">.</span><span class="token property-access">core</span><span class="token punctuation">.</span><span class="token property-access">wmem_default</span> <span class="token operator">=</span> <span class="token number">262144</span>
net<span class="token punctuation">.</span><span class="token property-access">core</span><span class="token punctuation">.</span><span class="token property-access">rmem_default</span> <span class="token operator">=</span> <span class="token number">262144</span></pre></div></code-block><h1 id="2JS7db99YCtsmKo1BoozUt" class="wolai-block"><span class="inline-wrap">ConnectionManager</span></h1><div id="4Ms81nB1rRrBtH3gqJqYqB" class="wolai-block wolai-text"><div><span class="inline-wrap">复制安装包(LINUX.X64_193000_client.zip)到<span class="jill"></span>OracleConnectionManager/19.3.0</span></div></div><div id="ngxzGoCfA3mSifPcEt2tJ9" class="wolai-block wolai-text"><div><span class="inline-wrap">构建镜像</span></div></div><code-block id="abCKMEAs8Yz4KU5wJgE7hc" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>cd <span class="token maybe-class-name">OracleConnectionManager</span><span class="token operator">/</span>dockerfiles
<span class="token punctuation">.</span><span class="token operator">/</span>buildDockerImage<span class="token punctuation">.</span><span class="token property-access">sh</span> <span class="token operator">-</span>v <span class="token number">19.3</span><span class="token number">.0</span></pre></div></code-block><div id="pDz7M1HYYXQMZ5g6dDT2L8" class="wolai-block wolai-text"><div><span class="inline-wrap">构建容器</span></div></div><code-block id="iHzzwMuwWLQkov5Nrkf3Kw" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>docker run <span class="token operator">-</span>d <span class="token operator">--</span>hostname racnode<span class="token operator">-</span>cman1 <span class="token operator">--</span>dns<span class="token operator">-</span>search<span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span> \
<span class="token operator">--</span>network<span class="token operator">=</span>rac_pub1_nw <span class="token operator">--</span>ip<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span> \
<span class="token operator">-</span>e <span class="token constant">DOMAIN</span><span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span> <span class="token operator">-</span>e <span class="token constant">PUBLIC_IP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span> \
<span class="token operator">-</span>e <span class="token constant">PUBLIC_HOSTNAME</span><span class="token operator">=</span>racnode<span class="token operator">-</span>cman1 <span class="token operator">-</span>e <span class="token constant">SCAN_NAME</span><span class="token operator">=</span>racnode<span class="token operator">-</span>scan \
<span class="token operator">-</span>e <span class="token constant">SCAN_IP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.70</span> <span class="token operator">--</span>privileged<span class="token operator">=</span><span class="token boolean">false</span> \
<span class="token operator">-</span>p <span class="token number">1521</span><span class="token operator">:</span><span class="token number">1521</span> <span class="token operator">--</span>name racnode<span class="token operator">-</span>cman oracle<span class="token operator">/</span>client<span class="token operator">-</span>cman<span class="token operator">:</span><span class="token number">19.3</span><span class="token number">.0</span></pre></div></code-block><div id="vvPWxY7ZYHcRHYZ4ZRPVYW" class="wolai-block wolai-text"><div><span class="inline-wrap">查看日志</span></div></div><code-block id="siZtSf3JGbYs5gsfBeCBJR" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker logs <span class="token operator">-</span>f racnode<span class="token operator">-</span>cman</pre></div></code-block><div id="p6aaKJihVP4BRdyWRV7gby" class="wolai-block wolai-text"><div><span class="inline-wrap">完成<span class="jill"></span>racnode-cman<span class="jill"></span>容器设置时，您应该会看到以下内容：</span></div></div><code-block id="kdM5XYMZ5e2ZjUEEzVCa1s" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> ################################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span>  <span class="token constant">CONNECTION</span> <span class="token constant">MANAGER</span> <span class="token constant">IS</span> <span class="token constant">READY</span> <span class="token constant">TO</span> <span class="token constant">USE</span><span class="token operator">!</span>            
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> ################################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">29</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> cman started sucessfully</pre></div></code-block><h1 id="qu5ov38FuXCjgyBuXnPbxi" class="wolai-block"><span class="inline-wrap">stronge</span></h1><div id="k2w3M3pWDqAKQnvPvErAQZ" class="wolai-block wolai-text"><div><span class="inline-wrap">构建存储服务器镜像</span></div></div><code-block id="eGki2V1HKDE6Fm1MFVVWk6" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>cd <span class="token maybe-class-name">OracleRACStorageServer</span><span class="token operator">/</span>dockerfiles
<span class="token punctuation">.</span><span class="token operator">/</span>buildDockerImage<span class="token punctuation">.</span><span class="token property-access">sh</span> <span class="token operator">-</span>v <span class="token number">19.3</span><span class="token number">.0</span></pre></div></code-block><div id="oPWTqBN6HYEFMv3tQjauix" class="wolai-block wolai-text"><div><span class="inline-wrap">关闭<span class="jill"></span>selinux</span></div></div><code-block id="unXZ4K66a2ZypNNvQmX2Dn" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>sed <span class="token operator">-</span>i <span class="token string">'s/=enforcing/=disabled/g'</span>  <span class="token operator">/</span>etc<span class="token operator">/</span>selinux<span class="token operator">/</span>config <span class="token operator">&amp;&amp;</span> setenforce <span class="token number">0</span></pre></div></code-block><div id="1BBe9yqXhTjyUojMWob8nB" class="wolai-block wolai-text"><div><span class="inline-wrap">宿主系统安装<span class="jill"></span>nfs</span></div></div><code-block id="rJtFB1KvKnkgp2cyRNFwFL" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>yum <span class="token operator">-</span>y install nfs<span class="token operator">-</span>utils</pre></div></code-block><div id="6ZsB21c868Y8UUyYW7ZL9N" class="wolai-block wolai-text"><div><span class="inline-wrap">构建存储服务器容器</span></div></div><code-block id="7RsKuaqyN6FjRvEFk9FX8F" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker run <span class="token operator">-</span>d <span class="token operator">-</span>t <span class="token operator">--</span>hostname racnode<span class="token operator">-</span>storage \
<span class="token operator">--</span>dns<span class="token operator">-</span>search<span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span>  <span class="token operator">--</span>cap<span class="token operator">-</span>add <span class="token constant">SYS_ADMIN</span> \
<span class="token operator">--</span>volume <span class="token operator">/</span>docker_volumes<span class="token operator">/</span>asm_vol<span class="token operator">/</span>$<span class="token constant">ORACLE_SID</span><span class="token operator">:</span><span class="token operator">/</span>oradata <span class="token operator">--</span>init \
<span class="token operator">--</span>network<span class="token operator">=</span>rac_priv1_nw <span class="token operator">--</span>ip<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.25</span> <span class="token operator">--</span>tmpfs<span class="token operator">=</span><span class="token operator">/</span>run  \
<span class="token operator">--</span>volume <span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup<span class="token operator">:</span><span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup<span class="token operator">:</span>ro \
<span class="token operator">--</span>name racnode<span class="token operator">-</span>storage oracle<span class="token operator">/</span>rac<span class="token operator">-</span>storage<span class="token operator">-</span>server<span class="token operator">:</span><span class="token number">19.3</span><span class="token number">.0</span></pre></div></code-block><div id="rvp95HQcoT6WzS1kerPskH" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>重要信息：</b></span></div></div><ol class="wolai-block"><li id="7EQVRN2Q2PsRudanKMAJay"><div class="marker"></div><span class="inline-wrap">在容器启动期间，将在/oradata<span class="jill"></span>下创建名为<span class="jill"></span>asm_disk0[1-5].img<span class="jill"></span>的<span class="jill"></span>5<span class="jill"></span>个文件。如果文件已经存在，则不会重新创建。这些文件可用于<span class="jill"></span>RAC<span class="jill"></span>容器中的<span class="jill"></span>ASM<span class="jill"></span>存储。</span></li><li id="vkybXiR4pM4m3baTzsBkeg"><div class="marker"></div><span class="inline-wrap">将目录暴露给至少有<span class="jill"></span>60GB<span class="jill"></span>的容器。在上述示例中，我们使用/docker_volumes/asm_vol/$ORACLE_SID，您需要根据您的环境更改值。在容器内，它将是/oradata，不要更改此。</span></li></ol><div id="cxKVtB3wXwV8ZTeiVqHG8x" class="wolai-block wolai-text"><div><span class="inline-wrap">查看日志</span></div></div><code-block id="boeqRxYpxsPwR623riKAZL" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker logs <span class="token operator">-</span>f racnode<span class="token operator">-</span>storage</pre></div></code-block><div id="qJiRpeW3NiRi5NEwiHjiZ6" class="wolai-block wolai-text"><div><span class="inline-wrap">您应该在<span class="jill"></span>docker<span class="jill"></span>日志输出中看到以下内容：</span></div></div><code-block id="3MVBovAP84yT6iQbK1iJWE" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>####################################################
 <span class="token constant">NFS</span> <span class="token maybe-class-name">Server</span> is up and running                       
 <span class="token maybe-class-name">Create</span> <span class="token constant">NFS</span> volume <span class="token keyword control-flow">for</span> <span class="token operator">/</span>oradata<span class="token operator">/</span>         
####################################################
<span class="token number">0</span></pre></div></code-block><div id="wtgULpwv7LZnQdVF3CmHeb" class="wolai-block wolai-text"><div><span class="inline-wrap">创建<span class="jill"></span>NFS<span class="jill"></span>卷</span></div></div><code-block id="27sjapNyzZhVHQEbBiF7Cr" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker volume create <span class="token operator">--</span>driver local \
<span class="token operator">--</span>opt type<span class="token operator">=</span>nfs \
<span class="token operator">--</span>opt   o<span class="token operator">=</span>addr<span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.25</span><span class="token punctuation">,</span>rw<span class="token punctuation">,</span>bg<span class="token punctuation">,</span>hard<span class="token punctuation">,</span>tcp<span class="token punctuation">,</span>vers<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span>timeo<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">,</span>rsize<span class="token operator">=</span><span class="token number">32768</span><span class="token punctuation">,</span>wsize<span class="token operator">=</span><span class="token number">32768</span><span class="token punctuation">,</span>actimeo<span class="token operator">=</span><span class="token number">0</span> \
<span class="token operator">--</span>opt device<span class="token operator">=</span><span class="token operator">:</span><span class="token operator">/</span>oradata racstorage</pre></div></code-block><h1 id="1Xrxcab89y25eEMxMhYi1q" class="wolai-block"><span class="inline-wrap">DNS</span></h1><div id="wu6vaJpuCuqvy7StnUsg5Q" class="wolai-block wolai-text"><div><span class="inline-wrap">构建镜像</span></div></div><code-block id="aTxcBsiAWoTCe6K7GwLnwi" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>cd <span class="token maybe-class-name">OracleDNSServer</span><span class="token operator">/</span>dockerfiles
<span class="token punctuation">.</span><span class="token operator">/</span>buildContainerImage<span class="token punctuation">.</span><span class="token property-access">sh</span> <span class="token operator">-</span>v latest</pre></div></code-block><div id="hmSQ8x1uECryKYdP1SPuAp" class="wolai-block wolai-text"><div><span class="inline-wrap">构建<span class="jill"></span>DNS<span class="jill"></span>服务器容器</span></div></div><code-block id="qCm3hobFV8UqgvtKcZ841S" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker run <span class="token operator">-</span>d  <span class="token operator">--</span>name racdns \
 <span class="token operator">--</span>hostname rac<span class="token operator">-</span>dns  \
 <span class="token operator">--</span>dns<span class="token operator">-</span>search<span class="token operator">=</span><span class="token string">"example.com"</span> \
 <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">SYS_ADMIN</span>  \
 <span class="token operator">--</span>network  rac_pub1_nw \
 <span class="token operator">--</span>ip <span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.25</span> \
 <span class="token operator">--</span>sysctl net<span class="token punctuation">.</span><span class="token property-access">ipv6</span><span class="token punctuation">.</span><span class="token property-access">conf</span><span class="token punctuation">.</span><span class="token property-access">all</span><span class="token punctuation">.</span><span class="token property-access">disable_ipv6</span><span class="token operator">=</span><span class="token number">1</span> \
 <span class="token operator">--</span>env <span class="token constant">SETUP_DNS_CONFIG_FILES</span><span class="token operator">=</span><span class="token string">"setup_true"</span> \
 <span class="token operator">--</span>env <span class="token constant">DOMAIN_NAME</span><span class="token operator">=</span><span class="token string">"example.com"</span> \
 <span class="token operator">--</span>env <span class="token constant">RAC_NODE_NAME_PREFIX</span><span class="token operator">=</span><span class="token string">"racnode"</span> \
 oracle<span class="token operator">/</span>rac<span class="token operator">-</span>dnsserver<span class="token operator">:</span>latest</pre></div></code-block><div id="cHwu9yWpLfGdg6P3Dtop66" class="wolai-block wolai-text"><div><span class="inline-wrap">查看日志</span></div></div><code-block id="wEeMRq2fgtikG6srf8RFzB" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker logs <span class="token operator">-</span>f racdns</pre></div></code-block><div id="o41fV89Ma5EcbVdbKiYAiB" class="wolai-block wolai-text"><div><span class="inline-wrap">完成时应输出</span></div></div><code-block id="isdURUkwCmC9Z7jds6KpAW" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span><span class="token number">12</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> ################################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span><span class="token number">12</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span>  <span class="token constant">DNS</span> <span class="token maybe-class-name">Server</span> <span class="token constant">IS</span> <span class="token constant">READY</span> <span class="token constant">TO</span> <span class="token constant">USE</span><span class="token operator">!</span>            
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span><span class="token number">12</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> ################################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">57</span><span class="token operator">:</span><span class="token number">12</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token constant">DNS</span> <span class="token maybe-class-name">Server</span> <span class="token maybe-class-name">Started</span> <span class="token maybe-class-name">Successfully</span></pre></div></code-block><h1 id="8mzTLLaEUbkKj2mgdf67bp" class="wolai-block"><span class="inline-wrap">RAC Database</span></h1><div id="bBepDFWTZSmMoibmBqT8hn" class="wolai-block wolai-text"><div><span class="inline-wrap">复制安装包</span></div></div><code-block id="wUctSVjejPXFL7pXDMxJGH" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token literal-property property">安装包</span><span class="token operator">:</span>
<span class="token constant">LINUX</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">X64_193000_grid_home</span></span><span class="token punctuation">.</span><span class="token property-access">zip</span> <span class="token constant">LINUX</span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">X64_193000_db_home</span></span><span class="token punctuation">.</span><span class="token property-access">zip</span> 
<span class="token literal-property property">目的路径</span><span class="token operator">:</span>
<span class="token maybe-class-name">OracleRealApplicationClusters</span><span class="token operator">/</span>dockerfiles<span class="token operator">/</span><span class="token number">19.3</span></pre></div></code-block><div id="q8M2DGLNka1jjsPpP6t6Q1" class="wolai-block wolai-text"><div><span class="inline-wrap">构建镜像</span></div></div><code-block id="4RJAn2nUHEEgVSUDZQTrJQ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>cd <span class="token maybe-class-name">OracleRealApplicationClusters</span><span class="token operator">/</span>dockerfiles<span class="token operator">/</span>
<span class="token punctuation">.</span><span class="token operator">/</span>buildContainerImage<span class="token punctuation">.</span><span class="token property-access">sh</span> <span class="token operator">-</span>v <span class="token number">19.3</span><span class="token number">.0</span>
# <span class="token operator">/</span>opt<span class="token operator">/</span>scripts<span class="token operator">/</span>install<span class="token operator">/</span>installGridBinaries<span class="token punctuation">.</span><span class="token property-access">sh</span><span class="token operator">:</span> line <span class="token number">57</span><span class="token operator">:</span>  <span class="token operator">:</span> command not found</pre></div></code-block><div id="cZondGQR1aKCE6P4WGGadi" class="wolai-block wolai-text"><div><span class="inline-wrap">参考：</span><span class="inline-wrap"><a href="https://github.com/oracle/docker-images/tree/main/OracleDatabase/RAC/OracleRealApplicationClusters"><span>github<span class="jill"></span>文档</span></a></span></div></div><div id="nzXnKWqpa5rv1oi3QsLGp1" class="wolai-block wolai-text"><div><span class="inline-wrap">仅创建不修改容器的<span class="jill"></span>hosts<span class="jill"></span>文件</span></div></div><code-block id="14pGRyBuBmW1iEhkbm5dXj" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>mkdir <span class="token operator">/</span>opt<span class="token operator">/</span>containers
touch <span class="token operator">/</span>opt<span class="token operator">/</span>containers<span class="token operator">/</span>rac_host_file</pre></div></code-block><div id="wzFCQJ6FbCPiH8wdCFozBb" class="wolai-block wolai-text"><div><span class="inline-wrap">设定常用密码</span></div></div><code-block id="qXkpEwe9aasYFsW86yPDnY" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>mkdir <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>
openssl rand <span class="token operator">-</span>hex <span class="token number">64</span> <span class="token operator">-</span>out <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>pwd<span class="token punctuation">.</span><span class="token property-access">key</span>
echo <span class="token string">"oracle"</span> <span class="token operator">></span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">opt</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>common_os_pwdfile</pre></div></code-block><div id="sbSdfgsKd3bhRX57uUaPVT" class="wolai-block wolai-text"><div><span class="inline-wrap">加密文件</span></div></div><code-block id="spqttzaBB5h9xqMCceDqHE" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>openssl enc <span class="token operator">-</span>aes<span class="token operator">-</span><span class="token number">256</span><span class="token operator">-</span>cbc <span class="token operator">-</span>salt <span class="token operator">-</span><span class="token keyword">in</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>common_os_pwdfile <span class="token operator">-</span>out <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>common_os_pwdfile<span class="token punctuation">.</span><span class="token property-access">enc</span> <span class="token operator">-</span>pass file<span class="token operator">:</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">opt</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>pwd<span class="token punctuation">.</span><span class="token property-access">key</span>
rm <span class="token operator">-</span>f <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>common_os_pwdfile
chmod <span class="token number">400</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>common_os_pwdfile<span class="token punctuation">.</span><span class="token property-access">enc</span>
chmod <span class="token number">400</span> <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">/</span>pwd<span class="token punctuation">.</span><span class="token property-access">key</span></pre></div></code-block><div id="cpgCcML5na3DkjtSLbWKsm" class="wolai-block wolai-text"><div><span class="inline-wrap">如果您使用<span class="jill"></span>Oracle Connection Manager<span class="jill"></span>从主机外部访问<span class="jill"></span>Oracle RAC<span class="jill"></span>数据库，您需要在容器创建命令中添加以下变量。</span></div></div><code-block id="egSEUJZr6UiKP4kXMNtZt1" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token operator">-</span>e <span class="token constant">CMAN_HOSTNAME</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token constant">CMAN_HOSTNAME</span><span class="token punctuation">)</span> <span class="token operator">-</span>e <span class="token constant">CMAN_IP</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token constant">CMAN_IP</span><span class="token punctuation">)</span></pre></div></code-block><div id="a5aDPEwhi7yMfmqrQLkz42" class="wolai-block wolai-text"><div><span class="inline-wrap">使用<span class="jill"></span>oracle rac strong<span class="jill"></span>容器构建<span class="jill"></span>racnode1</span></div></div><code-block id="cQ9ZmKENY6N1He1SLHeJbH" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker create <span class="token operator">-</span>t <span class="token operator">-</span>i \
  <span class="token operator">--</span>hostname racnode1 \
  <span class="token operator">--</span>volume <span class="token operator">/</span>boot<span class="token operator">:</span><span class="token operator">/</span>boot<span class="token operator">:</span>ro \
  <span class="token operator">--</span>volume <span class="token operator">/</span>dev<span class="token operator">/</span>shm \
  <span class="token operator">--</span>tmpfs <span class="token operator">/</span>dev<span class="token operator">/</span>shm<span class="token operator">:</span>rw<span class="token punctuation">,</span>exec<span class="token punctuation">,</span>size<span class="token operator">=</span>4G \
  <span class="token operator">--</span>volume <span class="token operator">/</span>opt<span class="token operator">/</span>containers<span class="token operator">/</span>rac_host_file<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>hosts  \
  <span class="token operator">--</span>volume <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">:</span><span class="token operator">/</span>run<span class="token operator">/</span>secrets<span class="token operator">:</span>ro \
  <span class="token operator">--</span>dns<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.25</span> \
  <span class="token operator">--</span>dns<span class="token operator">-</span>search<span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span> \
  <span class="token operator">--</span>privileged<span class="token operator">=</span><span class="token boolean">false</span> \
  <span class="token operator">--</span>volume racstorage<span class="token operator">:</span><span class="token operator">/</span>oradata \
  <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">SYS_NICE</span> \
  <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">SYS_RESOURCE</span> \
  <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">NET_ADMIN</span> \
  <span class="token operator">-</span>e <span class="token constant">DNS_SERVERS</span><span class="token operator">=</span><span class="token string">"172.16.1.25"</span> \
  <span class="token operator">-</span>e <span class="token constant">NODE_VIP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.160</span>  \
  <span class="token operator">-</span>e <span class="token constant">VIP_HOSTNAME</span><span class="token operator">=</span>racnode1<span class="token operator">-</span>vip  \
  <span class="token operator">-</span>e <span class="token constant">PRIV_IP</span><span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.150</span>  \
  <span class="token operator">-</span>e <span class="token constant">PRIV_HOSTNAME</span><span class="token operator">=</span>racnode1<span class="token operator">-</span>priv \
  <span class="token operator">-</span>e <span class="token constant">PUBLIC_IP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.150</span> \
  <span class="token operator">-</span>e <span class="token constant">PUBLIC_HOSTNAME</span><span class="token operator">=</span>racnode1  \
  <span class="token operator">-</span>e <span class="token constant">SCAN_NAME</span><span class="token operator">=</span>racnode<span class="token operator">-</span>scan \
  <span class="token operator">-</span>e <span class="token constant">OP_TYPE</span><span class="token operator">=</span><span class="token constant">INSTALL</span> \
  <span class="token operator">-</span>e <span class="token constant">DOMAIN</span><span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span> \
  <span class="token operator">-</span>e <span class="token constant">ASM_DISCOVERY_DIR</span><span class="token operator">=</span><span class="token operator">/</span>oradata \
  <span class="token operator">-</span>e <span class="token constant">ASM_DEVICE_LIST</span><span class="token operator">=</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk01<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk02<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk03<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk04<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk05<span class="token punctuation">.</span><span class="token property-access">img</span>  \
  <span class="token operator">-</span>e <span class="token constant">CMAN_HOSTNAME</span><span class="token operator">=</span>racnode<span class="token operator">-</span>cman1 \
  <span class="token operator">-</span>e <span class="token constant">CMAN_IP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span> \
  <span class="token operator">-</span>e <span class="token constant">COMMON_OS_PWD_FILE</span><span class="token operator">=</span>common_os_pwdfile<span class="token punctuation">.</span><span class="token property-access">enc</span> \
  <span class="token operator">-</span>e <span class="token constant">PWD_KEY</span><span class="token operator">=</span>pwd<span class="token punctuation">.</span><span class="token property-access">key</span> \
  <span class="token operator">--</span>restart<span class="token operator">=</span>always \
  <span class="token operator">--</span>tmpfs<span class="token operator">=</span><span class="token operator">/</span>run <span class="token operator">-</span>v <span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup<span class="token operator">:</span><span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup<span class="token operator">:</span>ro \
  <span class="token operator">--</span>cpu<span class="token operator">-</span>rt<span class="token operator">-</span>runtime<span class="token operator">=</span><span class="token number">95000</span> \
  <span class="token operator">--</span>ulimit rtprio<span class="token operator">=</span><span class="token number">99</span>  \
  <span class="token operator">--</span>name racnode1 \
  oracle<span class="token operator">/</span>database<span class="token operator">-</span>rac<span class="token operator">:</span><span class="token number">19.3</span><span class="token number">.0</span>
</pre></div></code-block><div id="tDUibWErnVPr5ce572TF6j" class="wolai-bookmark wolai-block"><a href="https://github.com/oracle/docker-images/issues/1658">https://github.com/oracle/docker-images/issues/1658</a><div class="info-box"><div class="text-pane"><div data-title="https://github.com/oracle/docker-images/issues/1658"></div><div class="icon-host"></div></div><div class="preview-pane"></div></div></div><div id="98tAAkpLyXmXZ8teGY6CPr" class="wolai-block wolai-text"><div><span class="inline-wrap">将网络分配给<span class="jill"></span>RAC<span class="jill"></span>容器</span></div></div><code-block id="sm4pxbmNcxrRzcHr2mnirr" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker network disconnect bridge racnode1
docker network connect rac_pub1_nw <span class="token operator">--</span>ip <span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.150</span> racnode1
docker network connect rac_priv1_nw <span class="token operator">--</span>ip <span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.150</span>  racnode1</pre></div></code-block><div id="o7DRsSzS8JWV8qjfvpPczr" class="wolai-block wolai-text"><div><span class="inline-wrap">启动第一个容器(听说需要<span class="jill"></span>40<span class="jill"></span>分钟)</span></div></div><code-block id="n3s76z6uvG9LEwSzoMNMcr" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker start racnode1</pre></div></code-block><div id="cd6zeCJrv6LtLaXgN3mKBx" class="wolai-block wolai-text"><div><span class="inline-wrap">查看日志</span></div></div><code-block id="djhS59DcYMthu7p9qnsUmY" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker logs <span class="token operator">-</span>f racnode1</pre></div></code-block><div id="7cDRQ9XmXNyhcQudebP8wp" class="wolai-block wolai-text"><div><span class="inline-wrap">您应该会在末尾看到数据库创建成功消息：</span></div></div><code-block id="pxnubejCcDWEE9a3SfdhvA" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">36</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token maybe-class-name">Generating</span> <span class="token constant">DB</span> <span class="token maybe-class-name">Responsefile</span> <span class="token maybe-class-name">Running</span> <span class="token constant">DB</span> creation
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">36</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token maybe-class-name">Running</span> <span class="token constant">DB</span> creation

<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token maybe-class-name">Checking</span> <span class="token constant">DB</span> status
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> #################################################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span>  <span class="token maybe-class-name">Oracle</span> <span class="token maybe-class-name">Database</span> <span class="token constant">ORCLCDB</span> is up and running on racnode1    
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> #################################################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token maybe-class-name">Running</span> <span class="token maybe-class-name">User</span> <span class="token maybe-class-name">Script</span> oracle user
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token maybe-class-name">Setting</span> <span class="token maybe-class-name">Remote</span> <span class="token maybe-class-name">Listener</span>
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.15</span>
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">03</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token maybe-class-name">Executing</span> script to <span class="token keyword">set</span> the remote listener
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">05</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> ####################################
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">05</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> <span class="token constant">ORACLE</span> <span class="token constant">RAC</span> <span class="token constant">DATABASE</span> <span class="token constant">IS</span> <span class="token constant">READY</span> <span class="token constant">TO</span> <span class="token constant">USE</span><span class="token operator">!</span>
<span class="token number">11</span><span class="token operator">-</span><span class="token number">05</span><span class="token operator">-</span><span class="token number">2021</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">23</span><span class="token operator">:</span><span class="token number">05</span> <span class="token constant">UTC</span> <span class="token operator">:</span>  <span class="token operator">:</span> ####################################</pre></div></code-block><div id="hZQSifaQYVqyKpjapYtnsF" class="wolai-block wolai-text"><div><span class="inline-wrap">如安装失败，可登录容器，查看</span><span class="inline-wrap"><code>/tmp/orod.log</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>$GRID_BASE/diag/crs</code></span></div></div><code-block id="x5tUCjifVUZUvU8c2vPS66" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker exec <span class="token operator">-</span>i <span class="token operator">-</span>t racnode1 <span class="token operator">/</span>bin<span class="token operator">/</span>bash</pre></div></code-block><div id="neAyrJtqGkWpR4XSjpdsFD" class="wolai-block wolai-text"><div><span class="inline-wrap">oracle<span class="jill"></span>用户变量</span></div></div><code-block id="iBzE8nTpX8RXzupebkakYD" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/oracle/product/19.3.0/dbhome_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">OPATCH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/OPatch
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>ORCLCDB1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ORACLE_HOME</span>/bin:<span class="token variable">$OPATCH</span></pre></div></code-block><div id="9Cg5QmgY3pHxHhcaqrdmB3" class="wolai-block wolai-text"><div><span class="inline-wrap">创建第二个节点</span></div></div><code-block id="iPWGgftdc62fLsQFkExaaA" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker create <span class="token operator">-</span>t <span class="token operator">-</span>i \
  <span class="token operator">--</span>hostname racnode2 \
  <span class="token operator">--</span>volume <span class="token operator">/</span>dev<span class="token operator">/</span>shm \
  <span class="token operator">--</span>tmpfs <span class="token operator">/</span>dev<span class="token operator">/</span>shm<span class="token operator">:</span>rw<span class="token punctuation">,</span>exec<span class="token punctuation">,</span>size<span class="token operator">=</span>4G  \
  <span class="token operator">--</span>volume <span class="token operator">/</span>boot<span class="token operator">:</span><span class="token operator">/</span>boot<span class="token operator">:</span>ro \
  <span class="token operator">--</span>dns<span class="token operator">-</span>search<span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span>  \
  <span class="token operator">--</span>volume <span class="token operator">/</span>opt<span class="token operator">/</span>containers<span class="token operator">/</span>rac_host_file<span class="token operator">:</span><span class="token operator">/</span>etc<span class="token operator">/</span>hosts \
  <span class="token operator">--</span>volume <span class="token operator">/</span>opt<span class="token operator">/</span><span class="token punctuation">.</span><span class="token property-access">secrets</span><span class="token operator">:</span><span class="token operator">/</span>run<span class="token operator">/</span>secrets<span class="token operator">:</span>ro \
  <span class="token operator">--</span>dns<span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.25</span> \
  <span class="token operator">--</span>dns<span class="token operator">-</span>search<span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span> \
  <span class="token operator">--</span>privileged<span class="token operator">=</span><span class="token boolean">false</span> \
  <span class="token operator">--</span>volume racstorage<span class="token operator">:</span><span class="token operator">/</span>oradata \
  <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">SYS_NICE</span> \
  <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">SYS_RESOURCE</span> \
  <span class="token operator">--</span>cap<span class="token operator">-</span>add<span class="token operator">=</span><span class="token constant">NET_ADMIN</span> \
  <span class="token operator">-</span>e <span class="token constant">DNS_SERVERS</span><span class="token operator">=</span><span class="token string">"172.16.1.25"</span> \
  <span class="token operator">-</span>e <span class="token constant">EXISTING_CLS_NODES</span><span class="token operator">=</span>racnode1 \
  <span class="token operator">-</span>e <span class="token constant">NODE_VIP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.161</span>  \
  <span class="token operator">-</span>e <span class="token constant">VIP_HOSTNAME</span><span class="token operator">=</span>racnode2<span class="token operator">-</span>vip  \
  <span class="token operator">-</span>e <span class="token constant">PRIV_IP</span><span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.151</span>  \
  <span class="token operator">-</span>e <span class="token constant">PRIV_HOSTNAME</span><span class="token operator">=</span>racnode2<span class="token operator">-</span>priv \
  <span class="token operator">-</span>e <span class="token constant">PUBLIC_IP</span><span class="token operator">=</span><span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.151</span>  \
  <span class="token operator">-</span>e <span class="token constant">PUBLIC_HOSTNAME</span><span class="token operator">=</span>racnode2  \
  <span class="token operator">-</span>e <span class="token constant">DOMAIN</span><span class="token operator">=</span>example<span class="token punctuation">.</span><span class="token property-access">com</span> \
  <span class="token operator">-</span>e <span class="token constant">SCAN_NAME</span><span class="token operator">=</span>racnode<span class="token operator">-</span>scan \
  <span class="token operator">-</span>e <span class="token constant">ASM_DISCOVERY_DIR</span><span class="token operator">=</span><span class="token operator">/</span>oradata \
  <span class="token operator">-</span>e <span class="token constant">ASM_DEVICE_LIST</span><span class="token operator">=</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk01<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk02<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk03<span class="token punctuation">.</span><span class="token property-access">imgv</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk04<span class="token punctuation">.</span><span class="token property-access">img</span><span class="token punctuation">,</span><span class="token operator">/</span>oradata<span class="token operator">/</span>asm_disk05<span class="token punctuation">.</span><span class="token property-access">img</span> \
  <span class="token operator">-</span>e <span class="token constant">ORACLE_SID</span><span class="token operator">=</span><span class="token constant">ORCLCDB</span> \
  <span class="token operator">-</span>e <span class="token constant">OP_TYPE</span><span class="token operator">=</span><span class="token constant">ADDNODE</span> \
  <span class="token operator">-</span>e <span class="token constant">COMMON_OS_PWD_FILE</span><span class="token operator">=</span>common_os_pwdfile<span class="token punctuation">.</span><span class="token property-access">enc</span> \
  <span class="token operator">-</span>e <span class="token constant">PWD_KEY</span><span class="token operator">=</span>pwd<span class="token punctuation">.</span><span class="token property-access">key</span> \
  <span class="token operator">--</span>tmpfs<span class="token operator">=</span><span class="token operator">/</span>run <span class="token operator">-</span>v <span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup<span class="token operator">:</span><span class="token operator">/</span>sys<span class="token operator">/</span>fs<span class="token operator">/</span>cgroup<span class="token operator">:</span>ro \
  <span class="token operator">--</span>cpu<span class="token operator">-</span>rt<span class="token operator">-</span>runtime<span class="token operator">=</span><span class="token number">95000</span> \
  <span class="token operator">--</span>ulimit rtprio<span class="token operator">=</span><span class="token number">99</span>  \
  <span class="token operator">--</span>restart<span class="token operator">=</span>always \
  <span class="token operator">--</span>name racnode2 \
  oracle<span class="token operator">/</span>database<span class="token operator">-</span>rac<span class="token operator">:</span><span class="token number">19.3</span><span class="token number">.0</span></pre></div></code-block><div id="bspFsnufJEELQ8Y4eK9QrD" class="wolai-block wolai-text"><div><span class="inline-wrap">将网络分配给<span class="jill"></span>RAC<span class="jill"></span>容器</span></div></div><code-block id="k3crkZdKS26PVR5ufZX61d" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker network disconnect bridge racnode2
docker network connect rac_pub1_nw <span class="token operator">--</span>ip <span class="token number">172.16</span><span class="token number">.1</span><span class="token number">.151</span> racnode2
docker network connect rac_priv1_nw <span class="token operator">--</span>ip <span class="token number">192.168</span><span class="token number">.17</span><span class="token number">.151</span>  racnode2</pre></div></code-block><div id="qE6q1Rjqd8cwghXVKE4myS" class="wolai-block wolai-text"><div><span class="inline-wrap">启动第一个容器(听说需要<span class="jill"></span>40<span class="jill"></span>分钟)</span></div></div><code-block id="dswgp26QUXxq2HkEhGENPF" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker start racnode2</pre></div></code-block><div id="eyCpVozyNqS2AH95zkYatX" class="wolai-block wolai-text"><div><span class="inline-wrap">查看日志</span></div></div><code-block id="tPtADc4BKv6bX9fUhqpfHv" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker logs <span class="token operator">-</span>f racnode2</pre></div></code-block><div id="dCrckpYLHdcgTWiDLQ43m8" class="wolai-block wolai-text"><div><span class="inline-wrap">您应该会在末尾看到数据库创建成功消息：</span></div></div><code-block id="hewKTNcR5aRHeFkQDLqLZj" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>####################################
<span class="token constant">ORACLE</span> <span class="token constant">RAC</span> <span class="token constant">DATABASE</span> <span class="token constant">IS</span> <span class="token constant">READY</span> <span class="token constant">TO</span> <span class="token constant">USE</span><span class="token operator">!</span>
####################################</pre></div></code-block><div id="8jg3YxRmsqq7feQV8FgQvk" class="wolai-block wolai-text"><div><span class="inline-wrap">如安装失败，可登录容器，查看</span><span class="inline-wrap"><code>/tmp/orod.log</code></span><span class="inline-wrap">或</span><span class="inline-wrap"><code>$GRID_BASE/diag/crs</code></span></div></div><code-block id="viKv59KskUksAEk2aN5aA3" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>docker exec <span class="token operator">-</span>i <span class="token operator">-</span>t racnode2 <span class="token operator">/</span>bin<span class="token operator">/</span>bash</pre></div></code-block></article><footer></footer></body></html>