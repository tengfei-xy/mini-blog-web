<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>12c - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="12c" class="main-title"></div></div></header><article><h1 id="wsV6YDyspfum7wLXFcfV89" class="wolai-block"><span class="inline-wrap">Centos7.9<span class="jill"></span>静默安装<span class="jill"></span>12c RAC</span></h1><div id="o8B29qb4YYH5LTb9R8d8FG" class="wolai-block wolai-text"><div><span class="inline-wrap">文档更新时间：2021<span class="jill"></span>年<span class="jill"></span>11<span class="jill"></span>月<span class="jill"></span>22<span class="jill"></span>日</span></div></div><h1 id="vrn5PpDCrPw6RMdjNiGYXY" class="wolai-block"><span class="inline-wrap">一、基本信息</span></h1><div id="mTFsxmTFBrx3aFM8CFqXye" class="wolai-block wolai-text"><div><span class="inline-wrap">节点基本信息：</span></div></div><div id="ae9Tq1oihXBmDoWDRCgY8M" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 246.66666666666666px"><br/></th><th style="width: 246.66666666666666px"><span class="inline-wrap">节点一</span></th><th style="width: 246.66666666666666px"><span class="inline-wrap">节点二</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">主机名</span></td><td><span class="inline-wrap">ora1</span></td><td><span class="inline-wrap">ora2</span></td></tr><tr><td><span class="inline-wrap">操作系统</span></td><td><span class="inline-wrap">Centos7.9</span></td><td><span class="inline-wrap">Centos7.9</span></td></tr><tr><td><span class="inline-wrap">grid<span class="jill"></span>用户名/密码</span></td><td><span class="inline-wrap">grid</span></td><td><span class="inline-wrap">grid</span></td></tr><tr><td><span class="inline-wrap">Oracle<span class="jill"></span>用户名/密码</span></td><td><span class="inline-wrap">oracle</span></td><td><span class="inline-wrap">oracle</span></td></tr><tr><td><span class="inline-wrap">Oracle 版本</span></td><td><span class="inline-wrap">12c Enterprise Edition Release 12.2.0.1.0</span></td><td><span class="inline-wrap">12c Enterprise Edition Release 12.2.0.1.0</span></td></tr><tr><td><span class="inline-wrap">oracle<span class="jill"></span>用户<span class="jill"></span>SID</span></td><td><span class="inline-wrap">oracle1</span></td><td><span class="inline-wrap">oracle2</span></td></tr><tr><td><span class="inline-wrap">grid<span class="jill"></span>用户<span class="jill"></span>SID</span></td><td><span class="inline-wrap">+ASM1</span></td><td><span class="inline-wrap">+ASM2</span></td></tr><tr><td><span class="inline-wrap">GI<span class="jill"></span>安装位置</span></td><td><span class="inline-wrap">/u01/app/grid/base</span></td><td><span class="inline-wrap">/u01/app/grid/base</span></td></tr><tr><td><span class="inline-wrap">数据库安装位置</span></td><td><span class="inline-wrap">/u01/app/oracle</span></td><td><span class="inline-wrap">/u01/app/oracle</span></td></tr><tr><td><span class="inline-wrap">公网<span class="jill"></span>IP</span></td><td><span class="inline-wrap">192.168.3.74/24</span></td><td><span class="inline-wrap">192.168.3.75/24</span></td></tr><tr><td><span class="inline-wrap">私网<span class="jill"></span>IP</span></td><td><span class="inline-wrap">192.168.8.1/24</span></td><td><span class="inline-wrap">192.168.8.2/24</span></td></tr></tbody></table></div><div id="4YyZMqvBtLuy9BFiezcAi1" class="wolai-block wolai-text"><div><span class="inline-wrap">准备文件</span></div></div><div id="u46NcjK8mmoimscg51xYTE" class="wolai-block wolai-text"><div><span class="inline-wrap">注：zip<span class="jill"></span>放置节点一的<span class="jill"></span>$ORACHLE_HOME<span class="jill"></span>即可</span></div></div><code-block id="otiv6DtiZgdY36rL7hi9yF" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">V840012-01-Grid-Infrastucture.zip
V839960-01-Oracle-Database-12.2.0.1.0-for-Linux x86-64.zip
libaio-devel-0.3.109-13.el7.x86_64.rpm
compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm</pre></div></code-block><h1 id="nbmd6WwnCdtzQbUxDULp1m" class="wolai-block"><span class="inline-wrap">二、系统调整</span></h1><h2 id="7ZTaT7K8zcavre1PsPaj34" class="wolai-block"><span class="inline-wrap">1、网络设置</span></h2><ul class="wolai-block"><li id="anuQXPBst98HZUJqqkCVKU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">修改/etc/hosts（注：具体<span class="jill"></span>ip<span class="jill"></span>根据实际情况填写）</span><span class="inline-wrap">
</span><span class="inline-wrap">参考文档：RAC<span class="jill"></span>的几种<span class="jill"></span>IP：</span><span class="inline-wrap"><a href="https://cloud.tencent.com/developer/article/1578494"><span>https://cloud.tencent.com/developer/article/1578494</span></a></span><code-block id="e522PYc2jvWeVUfFJB7snY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># public</span>
<span class="token number">192.168</span>.3.74 ora1
<span class="token number">192.168</span>.3.75 ora2

<span class="token comment"># private</span>
<span class="token number">192.168</span>.8.1 ora1-priv
<span class="token number">192.168</span>.8.2 ora2-priv

<span class="token comment"># virtual</span>
<span class="token number">192.168</span>.3.76 ora1-vip
<span class="token number">192.168</span>.3.77 ora2-vip
 
<span class="token comment"># scan</span>
<span class="token number">192.168</span>.3.78 ora-scan</pre></div></code-block></li></ul><h2 id="quRcAh5aKSeFY38Dsu15D3" class="wolai-block"><span class="inline-wrap">2、用户/组配置</span></h2><ul class="wolai-block"><li id="eK1WkZaZzFUmAna9V4CWke"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">用户组</span><code-block id="6RtfPBy918CtuaNhT41jj2" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">groupadd</span> dba
<span class="token function">groupadd</span> oinstall
<span class="token function">groupadd</span> oper
<span class="token function">groupadd</span> asmoper
<span class="token function">groupadd</span> asmdba
<span class="token function">groupadd</span> asmadmin
<span class="token function">groupadd</span> backupdba
<span class="token function">groupadd</span> dgdba
<span class="token function">groupadd</span> kmdba</pre></div></code-block></li><li id="d1pMdNst6PXSM5ciFwgu4n"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">gird<span class="jill"></span>用户</span><span class="inline-wrap">
</span><span class="inline-wrap">创建用户</span><span class="inline-wrap">
</span><span class="inline-wrap">==注：节点一的<span class="jill"></span>ORACLE_SID<span class="jill"></span>为<span class="jill"></span>+ASM1，节点二的<span class="jill"></span>ORACLE_SID<span class="jill"></span>为<span class="jill"></span>+ASM2==</span><code-block id="oknB9L2kSL15tomdxu9rEw" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>openssl <span class="token function">passwd</span> <span class="token parameter variable">-1</span> <span class="token string">"grid"</span><span class="token variable">`</span></span> <span class="token parameter variable">-G</span> asmadmin,asmdba,asmoper,dba <span class="token parameter variable">-d</span> /home/grid <span class="token parameter variable">-m</span> grid</pre></div></code-block><div id="3X14S2MDjh8p6qqxpinypk" class="wolai-block wolai-text"><div><span class="inline-wrap">编辑/home/grid/.bash_profile</span></div></div><code-block id="3FVjNCQYv2GsqQ2dJ3MM2D" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/grid/base
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/grid/home
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>+ASM1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CRS_HOME</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">OPATCH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/OPatch
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ORACLE_HOME</span>/bin:<span class="token variable">$OPATCH</span></pre></div></code-block></li><li id="f25uG2cvZ73Y7AZcGfkXYE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">oracle 用户</span><span class="inline-wrap">
</span><span class="inline-wrap">创建用户</span><span class="inline-wrap">
</span><span class="inline-wrap">==注：节点一的<span class="jill"></span>ORACLE_SID<span class="jill"></span>为<span class="jill"></span>oracle1，节点二的<span class="jill"></span>ORACLE_SID<span class="jill"></span>为<span class="jill"></span>oracle2==</span><code-block id="tBYCmGcT9jkcvLgv2rKvNN" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-p</span> <span class="token variable"><span class="token variable">`</span>openssl <span class="token function">passwd</span> <span class="token parameter variable">-1</span> <span class="token string">"oracle"</span><span class="token variable">`</span></span> <span class="token parameter variable">-G</span> dba,asmdba,oper,kmdba,backupdba,dgdba <span class="token parameter variable">-d</span> /home/oracle <span class="token parameter variable">-m</span> oracle</pre></div></code-block><div id="2DkQnRJ9LQJNru4DYwyTsu" class="wolai-block wolai-text"><div><span class="inline-wrap">编辑/home/oracle/.bash_profile</span></div></div><code-block id="7F44MqFj82G6BveM5VXouq" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/oracle/product/12.2.0/db_1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">OPATCH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/OPatch
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>oracle1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$ORACLE_HOME</span>/bin:<span class="token variable">$OPATCH</span></pre></div></code-block></li><li id="bNBD49TYmFnZgprkhYSaJx"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">赋权</span><code-block id="gixcXppbEhWNFc61uZb6iB" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/12.2.0/db_1
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/grid/base /u01/app/grid/home
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /u01/app/grid
<span class="token function">mkdir</span> /u01/app/oraInventory
<span class="token function">chown</span> grid:oinstall /u01/app/oraInventory <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token number">775</span> /u01/app/oraInventory</pre></div></code-block></li></ul><div id="2oKtYwJWsexdACSDBno45z" class="wolai-block wolai-text"><div><span class="inline-wrap">此时可以解压<span class="jill"></span>zip<span class="jill"></span>到各自用户的<span class="jill"></span>ORACLE_HOME<span class="jill"></span>之下</span></div></div><h2 id="bkajdLwi2dmWfNZGxzZq9C" class="wolai-block"><span class="inline-wrap">3、swap<span class="jill"></span>设置</span></h2><ol class="wolai-block"><li id="rLQ613vx7j5t39NvHVpF9n"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>swap<span class="jill"></span>文件</span><code-block id="bcLPAXCprTsfyGV8sJAcTN" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>/dev/zero <span class="token assign-left variable">of</span><span class="token operator">=</span>/rac-swap <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M <span class="token assign-left variable">count</span><span class="token operator">=</span><span class="token number">16384</span></pre></div></code-block></li><li id="iqJN5t2HVzYs6awggx2FVL"><div class="marker"></div><span class="inline-wrap">设置可访问权限</span><code-block id="rusM9P7QU5KNRaRmLfebYT" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">chmod</span> <span class="token number">600</span> /rac-swap</pre></div></code-block></li><li id="oDiYvcqWV5UexZecy2VUtn"><div class="marker"></div><span class="inline-wrap">格式化文件</span><code-block id="xudm9D3yxKiqKqzuNCawtv" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">mkswap</span> /rac-swap</pre></div></code-block></li><li id="uXY8mhFn8zbt1FTfASynvk"><div class="marker"></div><span class="inline-wrap">激活<span class="jill"></span>swap<span class="jill"></span>空间(每次<span class="jill"></span>swapon<span class="jill"></span>可以叠加<span class="jill"></span>swap<span class="jill"></span>空间)</span><code-block id="7mKLgjd4jDydefcd8fnbjs" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">swapon</span> /rac-swap</pre></div></code-block></li><li id="jEJ5BVcZbMZQcwFmkqLhB7"><div class="marker"></div><span class="inline-wrap">开机自动启用<span class="jill"></span>swap<span class="jill"></span>空间，追加下面内容到/etc/fstab</span><code-block id="w2tn3XBvVPJMhhgJt7U2Kc" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">echo</span> <span class="token string">"/rac-swap swap swap default 0 0"</span> <span class="token operator">>></span>/etc/fstab</pre></div></code-block></li></ol><h2 id="s5Bztrc67MfZcdNVFnPWMu" class="wolai-block"><span class="inline-wrap">4、依赖</span></h2><ol class="wolai-block"><li id="kdRx69fqAi6EZJFN1hKiL5"><div class="marker"></div><span class="inline-wrap">yum 安装</span><code-block id="wt9Vwc3nWSBHWfeA5ykC8J" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum install <span class="token operator">-</span>y binutils<span class="token punctuation">.</span><span class="token property-access">x86_64</span> compat<span class="token operator">-</span>libcap1<span class="token punctuation">.</span><span class="token property-access">x86_64</span> gcc<span class="token punctuation">.</span><span class="token property-access">x86_64</span> gcc<span class="token operator">-</span>c<span class="token operator">++</span><span class="token punctuation">.</span><span class="token property-access">x86_64nglibc</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span> glibc<span class="token operator">-</span>devel<span class="token punctuation">.</span><span class="token property-access">x86_64</span> libaio<span class="token punctuation">.</span><span class="token property-access">x86_64</span> libaio<span class="token operator">-</span>devel<span class="token punctuation">.</span><span class="token property-access">x86_64</span> libgcc<span class="token punctuation">.</span><span class="token property-access">x86_64</span>  libstdc<span class="token operator">++</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span> libstdc<span class="token operator">++</span><span class="token operator">-</span>devel<span class="token punctuation">.</span><span class="token property-access">x86_64</span> libXi<span class="token punctuation">.</span><span class="token property-access">x86_64</span> libXtst<span class="token punctuation">.</span><span class="token property-access">x86_64</span> make<span class="token punctuation">.</span><span class="token property-access">x86_64</span> sysstat<span class="token punctuation">.</span><span class="token property-access">x86_64</span> compat<span class="token operator">-</span>libstdc<span class="token operator">++</span><span class="token operator">-</span><span class="token number">33</span> elfutils<span class="token operator">-</span>libelf<span class="token operator">-</span>devel psk net<span class="token operator">-</span>tools telnet unzip gcc<span class="token operator">-</span>c<span class="token operator">++</span> ksh smartmontools</pre></div></code-block></li><li id="xqPExbW639axqmA9m6X5hB"><div class="marker"></div><span class="inline-wrap">额外依赖安装</span><code-block id="ibHSe2gS9VuuY6GPiqUNrp" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">libaio<span class="token operator">-</span>devel<span class="token operator">-</span><span class="token number">0.3</span><span class="token number">.109</span><span class="token operator">-</span><span class="token number">13</span><span class="token punctuation">.</span><span class="token property-access">el7</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span><span class="token punctuation">.</span><span class="token property-access">rpm</span>
compat<span class="token operator">-</span>libstdc<span class="token operator">++</span><span class="token operator">-</span><span class="token number">33</span><span class="token operator">-</span><span class="token number">3.2</span><span class="token number">.3</span><span class="token operator">-</span><span class="token number">72</span><span class="token punctuation">.</span><span class="token property-access">el7</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span><span class="token punctuation">.</span><span class="token property-access">rpm</span></pre></div></code-block></li></ol><h2 id="6FyT6NfZDfkRYkhexKNy2H" class="wolai-block"><span class="inline-wrap">5、内核参数和资源限制</span></h2><ol class="wolai-block"><li id="v8g8RVZKGa7MdhauketRPY"><div class="marker"></div><span class="inline-wrap">计算<span class="jill"></span>shmall<span class="jill"></span>和<span class="jill"></span>shmmax</span><code-block id="53BcyGXEBEWpGqiMvsZd83" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># kernel.shmall</span>
<span class="token assign-left variable">shmall</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /proc/meminfo <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"MemTotal"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span> / (<span class="token variable"><span class="token variable">`</span>getconf PAGESIZE<span class="token variable">`</span></span> / 1024)"</span> <span class="token operator">|</span> <span class="token function">bc</span><span class="token variable">)</span></span>

<span class="token comment"># kernel.shmmax(内存的80%)</span>
<span class="token assign-left variable">shmmax</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /proc/meminfo <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"MemTotal"</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span> * 1024 * 0.8"</span> <span class="token operator">|</span> <span class="token function">bc</span>  <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s#\..*$##'</span><span class="token variable">)</span></span></pre></div></code-block></li><li id="w6bTWQEXA6aeqmz8f133Tz"><div class="marker"></div><span class="inline-wrap">修改参数</span><code-block id="vmndeMF7nuq5EVaQqTEVW1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">cat</span> <span class="token operator">>></span> /etc/sysctl.conf<span class="token operator">&lt;&lt;</span><span class="token string">EOF
fs.aio-max-nr = 3145728
fs.file-max = 6815744
kernel.shmall = <span class="token variable">${shmall}</span>
kernel.shmmax = <span class="token variable">${shmmax}</span>
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048586
vm.min_free_kbytes = 524288
EOF</span></pre></div></code-block></li><li id="hHo2Y7jnTKtS7sEqbWW7xr"><div class="marker"></div><span class="inline-wrap">生效内核参数</span><code-block id="iJ9zfoJpo4tRqZxhoUmuk3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">sysctl</span> <span class="token parameter variable">-p</span></pre></div></code-block></li><li id="1EDKB6TJQqgkcP68VVDCo3"><div class="marker"></div><span class="inline-wrap">资源限制：修改/etc/security/limits.conf</span><code-block id="2xaexg5UYyeU8qDcZqJwBw" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">cat</span> <span class="token operator">>></span> /etc/security/limits.conf<span class="token operator">&lt;&lt;</span> <span class="token string">EOF
grid soft nproc 16384
grid hard nproc 16384
grid soft nofile 65536
grid hard nofile 65536
grid soft stack 10240
grid hard stack 32768
oracle soft nproc 16384
oracle hard nproc 16384
oracle soft nofile 65536
oracle hard nofile 65536
oracle soft stack 10240
oracle hard stack 32768
* soft memlock unlimited
* hard memlock unlimited
EOF</span></pre></div></code-block></li><li id="fRiayk4pyXG1SNYUrjsmVo"><div class="marker"></div><span class="inline-wrap">修改/etc/security/limits.d/20-nproc.conf</span><code-block id="nqDnspZpmuNokpzMscVsPD" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">"s/4096/16384/g"</span> /etc/security/limits.d/20-nproc.conf
<span class="token builtin class-name">echo</span> <span class="token string">"* hard nproc 16384"</span> <span class="token operator">>></span> /etc/security/limits.d/20-nproc.conf</pre></div></code-block></li></ol><h2 id="ivzGH77NijRSA51MbVaBjo" class="wolai-block"><span class="inline-wrap">6、关闭<span class="jill"></span>selinux<span class="jill"></span>和禁用服务</span></h2><code-block id="q4wf8A5n28uoPiZaGNM9HM" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/SELINUX=enforcing/SELINUX=disabled/'</span> /etc/selinux/config
setenforce <span class="token number">0</span>
systemctl stop firewalld.service
systemctl disable firewalld
systemctl stop avahi-daemon
systemctl disable avahi-daemon
systemctl disable bluetooth
systemctl disable cpuspeed
systemctl disable cups
systemctl disable firstboot
systemctl disable ip6tables
systemctl disable iptables
systemctl disable pcmcia
systemctl <span class="token builtin class-name">enable</span> rc-local
systemctl start rc-local
systemctl stop NetworkManager
systemctl disable NetworkManager</pre></div></code-block><h2 id="ewS7p3WSE5nrSSk7Ehc6YT" class="wolai-block"><span class="inline-wrap">7、其他设置</span></h2><ol class="wolai-block"><li id="tEuFQ8epDMo8qsGkuoyb11"><div class="marker"></div><span class="inline-wrap">取消<span class="jill"></span>ctl+alt+delete<span class="jill"></span>重启</span><code-block id="7a7APqDgX4drcnsNWgG6ZP" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">rm</span> <span class="token parameter variable">-f</span> /usr/lib/systemd/system/ctrl-alt-del.target</pre></div></code-block></li><li id="vxwCvSBbrUkJBws6GWNj9N"><div class="marker"></div><span class="inline-wrap">关闭<span class="jill"></span>Transparent HugePages</span><code-block id="dPDmw7Vy7d74mxewyLVvP2" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">echo</span> never <span class="token operator">></span> /sys/kernel/mm/transparent_hugepage/enabled
<span class="token builtin class-name">echo</span> never <span class="token operator">></span> /sys/kernel/mm/transparent_hugepage/defrag</pre></div></code-block></li><li id="hotUkHh2sKsoeVLKeYRgcj"><div class="marker"></div><span class="inline-wrap">设置<span class="jill"></span>RemoveIPC，编辑/etc/systemd/logind.conf</span><code-block id="6VLNedM5VRdVFcwjueSFew" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">RemoveIPC</span><span class="token operator">=</span>no</pre></div></code-block></li><li id="7m6p6Ku93BzL5vEyKsqn7z"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="g27Z1gGy2uPuiSJDXGudfA" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl daemon-reload
systemctl restart systemd-logind</pre></div></code-block></li><li id="eTHK82biyCxYvtwiqiR6yF"><div class="marker"></div><span class="inline-wrap">设定挂载（如果存在/dev/shm<span class="jill"></span>的话）</span><code-block id="p3vaSpnwjHNxb46Rs7ob9k" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">echo</span> <span class="token string">"tmpfs /dev/shm tmpfs defaults 0 0"</span> <span class="token operator">>></span> /etc/fstab</pre></div></code-block></li><li id="9EEVUEaLYpu1buWxBqNVqb"><div class="marker"></div><span class="inline-wrap">禁用路由</span><code-block id="3BS3gwKHc4vbs7ziuCeMVC" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">cat<span class="token operator">>></span> /etc/sysconfig/network<span class="token operator">&lt;&lt;</span><span class="token string">EOF
NOZEROCONF=yes
EOF</span></pre></div></code-block></li><li id="cmyHNhK4zaGDhZALGAXGLp"><div class="marker"></div><span class="inline-wrap">(可选)NTP<span class="jill"></span>网络时间服务器</span></li></ol><h1 id="briMcQ8BWKobdwBecw3Ecp" class="wolai-block"><span class="inline-wrap">三、共享磁盘配置</span></h1><div id="bX6NLJyVDB6gFvDMmxSkC6" class="wolai-block wolai-text"><div><span class="inline-wrap">除配置<span class="jill"></span>iscsi<span class="jill"></span>服务端外，其他步骤</span><span class="inline-wrap"><b>每个节点执行</b></span></div></div><div id="9u5zpdHosyoVoqYRZ8XyzT" class="wolai-block wolai-text"><div><span class="inline-wrap">参考：</span><span class="inline-wrap"><a href="https://blog.csdn.net/cuichongxin/article/details/103982207"><span>iscsi<span class="jill"></span>安装参考文档</span></a></span></div></div><div id="ntYZf8ivvC2tJbNLQW1yZK" class="wolai-block wolai-text"><div><span class="inline-wrap">==注：首先配置的<span class="jill"></span>asm<span class="jill"></span>表决盘三块应该是相同大小。==</span></div></div><h2 id="6TadDQNbmy9yc6jGRD3CzS" class="wolai-block"><span class="inline-wrap">1、配置<span class="jill"></span>iscsi<span class="jill"></span>服务端</span></h2><ol class="wolai-block"><li id="sx3V5LXt8iLoh1TasCSbqz"><div class="marker"></div><span class="inline-wrap">安装</span><code-block id="dPUCVjr2ZcdHGo63GoAic4" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> target*</pre></div></code-block></li><li id="9UtLYtGvNfPWr29LLtqPSF"><div class="marker"></div><span class="inline-wrap">启动并自启</span><code-block id="rB698cDRb2yTkeqoaRR2er" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl <span class="token builtin class-name">enable</span> target
systemctl start target</pre></div></code-block></li><li id="nthQzifirkCfmztHMeuouV"><div class="marker"></div><span class="inline-wrap">将未格式化、未分区的硬盘进行分区通过</span><span class="inline-wrap"><code>fdisk -l</code></span><span class="inline-wrap">检查到</span><span class="inline-wrap"><code>/dev/sdb</code></span><span class="inline-wrap">是我们需要进行共享的磁盘，先将它分区,但不需要格式化</span><code-block id="qmjptik24bgQ5LX9cEe7mU" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 grid<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdb</span>
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
分区号 <span class="token punctuation">(</span><span class="token number">1</span>-4，默认 <span class="token number">1</span><span class="token punctuation">)</span>：1
起始 扇区 <span class="token punctuation">(</span><span class="token number">2048</span>-41943039，默认为 <span class="token number">2048</span><span class="token punctuation">)</span>：2048
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">2048</span>-41943039，默认为 <span class="token number">41943039</span><span class="token punctuation">)</span>：13981696

命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
分区号 <span class="token punctuation">(</span><span class="token number">2</span>-4，默认 <span class="token number">2</span><span class="token punctuation">)</span>：2
起始 扇区 <span class="token punctuation">(</span><span class="token number">13981697</span>-41943039，默认为 <span class="token number">13983744</span><span class="token punctuation">)</span>：13983744
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">13983744</span>-41943039，默认为 <span class="token number">41943039</span><span class="token punctuation">)</span>：27962026

命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
分区号 <span class="token punctuation">(</span><span class="token number">3,4</span>，默认 <span class="token number">3</span><span class="token punctuation">)</span>：3
起始 扇区 <span class="token punctuation">(</span><span class="token number">13981697</span>-41943039，默认为 <span class="token number">27963392</span><span class="token punctuation">)</span>：27963392
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">27963392</span>-41943039，默认为 <span class="token number">41943039</span><span class="token punctuation">)</span>：41943039

命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：w
The partition table has been altered<span class="token operator">!</span>
Calling ioctl<span class="token punctuation">(</span><span class="token punctuation">)</span> to re-read partition table.
正在同步磁盘。</pre></div></code-block></li><li id="fET5SYSTvKQWo2DmrjxChr"><div class="marker"></div><span class="inline-wrap">查看分区</span><code-block id="gS3QBDMHuiEhF1i6qVtXCw" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">ora1 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
├─sdb1            <span class="token number">8</span>:17   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
├─sdb2            <span class="token number">8</span>:18   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
└─sdb3            <span class="token number">8</span>:19   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom  
loop0             <span class="token number">7</span>:0    <span class="token number">0</span>  <span class="token number">4</span>.5G  <span class="token number">1</span> loop /mnt/iso</pre></div></code-block></li><li id="ggnNpUEjefwccc3t9cmh9X"><div class="marker"></div><span class="inline-wrap">进入子系统</span><code-block id="5htdmsidXWsudsKVCqvMXT" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># targetcli</span></pre></div></code-block></li><li id="3JAarnC7itFuS55Dm2sP8t"><div class="marker"></div><span class="inline-wrap">添加硬盘信息格式</span><code-block id="aUMp6t4wLAHPxRAgeHCWkK" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/<span class="token operator">></span> /backstores/block create DB1 /dev/sdb1
/<span class="token operator">></span> /backstores/block create DB2 /dev/sdb2
/<span class="token operator">></span> /backstores/block create DB3 /dev/sdb3
/<span class="token operator">></span> /backstores/block create DB4 /dev/sdb4</pre></div></code-block></li><li id="2QrgRbwSoD8ks2ERPVU7pF"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>iscsi，格式：/iscsi create 格式.年份-月份. *.com.自定义名称</span><span class="inline-wrap">创建<span class="jill"></span>iscsi，格式：/iscsi create 格式.年份-月份. *.com.自定义名称</span><code-block id="nk3KozUwimD12Hc3WGwQfB" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/<span class="token operator">></span> /iscsi create iqn.2021-10.21.com.oracle</pre></div></code-block></li><li id="tmJkpbGbEdgicULNqRHYKT"><div class="marker"></div><span class="inline-wrap">关联<span class="jill"></span>block<span class="jill"></span>和<span class="jill"></span>target</span><code-block id="2uHEyK1WR2yno5yScSXwUt" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/<span class="token operator">></span> /iscsi/iqn.2021-10.21.com.oracle/tpg1/luns create /backstores/block/DB1
/<span class="token operator">></span> /iscsi/iqn.2021-10.21.com.oracle/tpg1/luns create /backstores/block/DB2
/<span class="token operator">></span> /iscsi/iqn.2021-10.21.com.oracle/tpg1/luns create /backstores/block/DB3
/<span class="token operator">></span> /iscsi/iqn.2021-10.21.com.oracle/tpg1/luns create /backstores/block/DB4</pre></div></code-block></li><li id="pEr1FJhLCmDXPMigRBg3WS"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>acl</span><code-block id="i1qRG9uYaQgqzE9RF5Pa2P" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/<span class="token operator">></span> /iscsi/iqn.2021-10.21.com.oracle/tpg1/acls create iqn.2021-10.21.com.oracle:ora</pre></div></code-block></li><li id="wooGHVeRViNuqTNHAt8TRw"><div class="marker"></div><span class="inline-wrap">退出</span><code-block id="i22A6CDG926ToejU5jQTK1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/<span class="token operator">></span> <span class="token builtin class-name">exit</span>
Global pref <span class="token assign-left variable">auto_save_on_exit</span><span class="token operator">=</span>true
Configuration saved to /etc/target/saveconfig.json</pre></div></code-block></li><li id="93AxuTtmLsMFpPSUeHvDN3"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="gAZTxXpyEXiNZTVreAkVqY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl restart target</pre></div></code-block><div id="pVEhvYG8ax2kPE6hbFuW8b" class="wolai-block wolai-text"><div><span class="inline-wrap">注：此时会有端口开放</span></div></div><code-block id="x38tMqFAx3tNbBkkxSqSFt" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># netstat -tunlp |grep 3260</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:3260            <span class="token number">0.0</span>.0.0:*               LISTEN      - </pre></div></code-block></li></ol><h2 id="9SAX7JhqB7AcGmKjHxVYP7" class="wolai-block"><span class="inline-wrap">2、配置<span class="jill"></span>iscsi<span class="jill"></span>客户端</span></h2><ol class="wolai-block"><li id="rVB2iY4QwhXiReFaRrosz3"><div class="marker"></div><span class="inline-wrap">安装</span><code-block id="vBZJhvrsHw4VJZD8W6DZE6" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> iscsi*</pre></div></code-block></li><li id="3nx26Bsn29LPztyhaGgQwh"><div class="marker"></div><span class="inline-wrap">开机自启</span><code-block id="xc93oehnxR2b9mFMFTCLgq" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl <span class="token builtin class-name">enable</span> iscsid</pre></div></code-block></li><li id="czZTBXCf4U5NNzLtPeVXGt"><div class="marker"></div><span class="inline-wrap">发现<span class="jill"></span>target</span><span class="inline-wrap">
</span><span class="inline-wrap">注：有输出才是被发现，-p 后面的参数是<span class="jill"></span>iscsi<span class="jill"></span>服务端的<span class="jill"></span>ip</span><code-block id="wmCLP3YdXkRjNWZzSBcSag" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># iscsiadm -m discovery -t st -p 192.168.3.74</span>
<span class="token number">192.168</span>.3.74:3260,1 iqn.2021-10.21.com.oracle</pre></div></code-block></li><li id="mXYRitPadan1wFyagJJL1a"><div class="marker"></div><span class="inline-wrap">修改/etc/iscsi/initiatorname.iscsi</span><code-block id="uXJFrF6VekcyQaAi9hqVxs" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">InitiatorName</span><span class="token operator">=</span>iqn.2021-10.21.com.oracle:ora</pre></div></code-block></li><li id="dLgVGFjCYxrgw9ojUUiZpT"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="jD7UvpTwaAjAtudc4dXLWv" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl restart iscsid</pre></div></code-block></li><li id="dmtpY94ELm7WsuC6tnmkEQ"><div class="marker"></div><span class="inline-wrap">登录</span><span class="inline-wrap">
</span><span class="inline-wrap">注：需要发现后，才能登陆</span><code-block id="nsZrNnEQ88z5mqci1uNqZR" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">iscsiadm <span class="token parameter variable">-m</span> <span class="token function">node</span> <span class="token parameter variable">-T</span> iqn.2021-10.21.com.oracle <span class="token parameter variable">-p</span> <span class="token number">192.168</span>.3.74 <span class="token parameter variable">-l</span></pre></div></code-block><div id="bf4cCJtxDsJc5sBmQrwz8Y" class="wolai-block wolai-text"><div><span class="inline-wrap">如果在主机<span class="jill"></span>A<span class="jill"></span>格式化了共享盘，在<span class="jill"></span>B<span class="jill"></span>上其实有了，但可能需要重新登录后，才能在</span><span class="inline-wrap"><code>lsblk</code></span><span class="inline-wrap">中看见，不登录也可以直接用格式化的磁盘</span></div></div></li><li id="b5modNzmBTvHkXUZemXQ41"><div class="marker"></div><span class="inline-wrap">检查,其中<span class="jill"></span>sdc,sdd,sde<span class="jill"></span>就是我们共享盘啦</span><code-block id="369s7SrLaFHYS8Aa2mVvKW" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sdb1            <span class="token number">8</span>:17   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
├─sdb2            <span class="token number">8</span>:18   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
├─sdb3            <span class="token number">8</span>:19   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
└─sdb4            <span class="token number">8</span>:20   <span class="token number">0</span>   26G  <span class="token number">0</span> part 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
└─sdc1            <span class="token number">8</span>:33   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sdd               <span class="token number">8</span>:48   <span class="token number">0</span>    1K  <span class="token number">0</span> disk 
sde               <span class="token number">8</span>:64   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
sdf               <span class="token number">8</span>:80   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom  
loop0             <span class="token number">7</span>:0    <span class="token number">0</span>  <span class="token number">4</span>.5G  <span class="token number">1</span> loop /mnt/iso</pre></div></code-block></li><li id="9kpW6VUefENk1aajoeuEy5"><div class="marker"></div><span class="inline-wrap">（可选步骤）在节点一分区，并在节点二重新登录</span><span class="inline-wrap">
</span><span class="inline-wrap">节点一：</span><code-block id="wKinR8QbEHn8qANePFGWuw" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdc</span>
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdd</span>
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sde</span>
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdf</span></pre></div></code-block><div id="tDvC2HN8zdDSHuw6e4JXjz" class="wolai-block wolai-text"><div><span class="inline-wrap">节点二：</span></div></div><code-block id="igH9ZuMBR1FSa55iXHVVTm" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 注销</span>
<span class="token punctuation">[</span>root@ora2 ~<span class="token punctuation">]</span><span class="token comment"># iscsiadm -m node -T iqn.2021-10.21.com.oracle -p 192.168.3.74 -u</span>
Logging out of session <span class="token punctuation">[</span>sid: <span class="token number">6</span>, target: iqn.2021-10.21.com.oracle, portal: <span class="token number">192.168</span>.3.74,3260<span class="token punctuation">]</span>
Logout of <span class="token punctuation">[</span>sid: <span class="token number">6</span>, target: iqn.2021-10.21.com.oracle, portal: <span class="token number">192.168</span>.3.74,3260<span class="token punctuation">]</span> successful.
<span class="token comment"># 重新登录</span>
<span class="token punctuation">[</span>root@ora2 ~<span class="token punctuation">]</span><span class="token comment"># iscsiadm -m node -T iqn.2021-10.21.com.oracle -p 192.168.3.74 -l</span>
Logging <span class="token keyword">in</span> to <span class="token punctuation">[</span>iface: default, target: iqn.2021-10.21.com.oracle, portal: <span class="token number">192.168</span>.3.74,3260<span class="token punctuation">]</span> <span class="token punctuation">(</span>multiple<span class="token punctuation">)</span>
Login to <span class="token punctuation">[</span>iface: default, target: iqn.2021-10.21.com.oracle, portal: <span class="token number">192.168</span>.3.74,3260<span class="token punctuation">]</span> successful.
<span class="token comment"># 可以看到磁盘被分区了</span>
<span class="token punctuation">[</span>root@ora2 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
└─sdb1            <span class="token number">8</span>:17   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>   26G  <span class="token number">0</span> disk 
└─sdc1            <span class="token number">8</span>:33   <span class="token number">0</span>   26G  <span class="token number">0</span> part 
sdd               <span class="token number">8</span>:48   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
└─sdd1            <span class="token number">8</span>:49   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sde               <span class="token number">8</span>:64   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
└─sde1            <span class="token number">8</span>:65   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom </pre></div></code-block></li></ol><h2 id="jApXfQBxDqWaQ7E6wfy8R1" class="wolai-block"><span class="inline-wrap">3、配置多路径</span></h2><div id="asxy6rbKUtSmaNXV2RUtjb" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文档：</span></div></div><div id="u8ugTwDYwFigVQ2Ai7Snrg" class="wolai-bookmark wolai-block"><a href="https://www.huaweicloud.com/articles/14b07cc5cc28d2bc19d3b6330ed05f09.html">很抱歉，您访问的页面已下线-华为云</a><div class="info-box"><div class="text-pane"><div data-title="很抱歉，您访问的页面已下线-华为云"></div><div data-desc="很抱歉，您访问的页面已下线"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://www.huaweicloud.com/favicon.ico&quot;)"></div><div data-hostname="www.huaweicloud.com"></div></div></div><div class="preview-pane"></div></div></div><div id="phXEtYW9SxYTAWsN7NWqPT" class="wolai-bookmark wolai-block"><a href="https://blog.csdn.net/cuiyan1982/article/details/79082805">Oracle RAC 搭建——使用多路径（Multipath）_oracle rac 判断是否使用多路径_叽哩古哩的博客-CSDN博客</a><div class="info-box"><div class="text-pane"><div data-title="Oracle RAC 搭建——使用多路径（Multipath）_oracle rac 判断是否使用多路径_叽哩古哩的博客-CSDN博客"></div><div data-desc="原文地址：http://blog.163.com/donfang_jianping/blog/static/136473951201410228567115/在http://blog.163.com/donfang_jianping/blog/static/136473951201311111384468/，http://blog.163.com/donfang_jianping/blog_ora"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://g.csdnimg.cn/static/logo/favicon32.ico&quot;)"></div><div data-hostname="blog.csdn.net"></div></div></div><div class="preview-pane"></div></div></div><ol class="wolai-block"><li id="rHp5XoWfPmQEpUFk3QrMkH"><div class="marker"></div><span class="inline-wrap">安装软件（如果没有安装）</span><code-block id="kzk8wRuNq9cQa8ctW2uKgi" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum <span class="token function">install</span> device-mapper* <span class="token parameter variable">-y</span></pre></div></code-block></li><li id="6vQrut3PABE9aTqy31Ri1t"><div class="marker"></div><span class="inline-wrap">启用模块</span><code-block id="5YC32tJbVYCTbr2dHveCLZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> modprobe dm-multipath
 modprobe dm-round-robin</pre></div></code-block></li><li id="51Pwv916CAdmiRoaPZwrWp"><div class="marker"></div><span class="inline-wrap">查看是否启用</span><code-block id="k62TLyPgpSRS15vHgzUnpT" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># lsmod | grep ^dm_m[uo]</span>
dm_multipath           <span class="token number">27792</span>  <span class="token number">1</span> dm_round_robin
dm_mod                <span class="token number">124501</span>  <span class="token number">9</span> dm_multipath,dm_log,dm_mirror</pre></div></code-block></li><li id="iyaHTh1SiZjfutnhppmxKv"><div class="marker"></div><span class="inline-wrap">生成<span class="jill"></span>Multipath<span class="jill"></span>而配置文件</span><code-block id="2pagACo1XaYq9cCGws81zM" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> mpathconf <span class="token parameter variable">--enable</span> <span class="token parameter variable">--find_multipaths</span> y <span class="token parameter variable">--with_module</span> y <span class="token parameter variable">--with_multipathd</span> y</pre></div></code-block></li><li id="mRsWhMUqFaKSvyYK6rM4qw"><div class="marker"></div><span class="inline-wrap">添加共享磁盘的<span class="jill"></span>wwid</span><code-block id="3abGkdMdsdBeUxUjkZ5UTB" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 将添加到/etc/multipath/wwid</span>
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdc</span>
wwid <span class="token string">'36001405845f59a2eb5e43b6b20604d27'</span> added
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdd</span>
wwid <span class="token string">'36001405b381f6cd51044a1b89aab5fbe'</span> added
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sde</span>
wwid <span class="token string">'36001405146055fb6230434b9ec999dc7'</span> added
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdf</span>
wwid <span class="token string">'360014059099bfbbcb9349b081de121e8'</span> added</pre></div></code-block></li><li id="mFVnYUSbMbYvBiDoUQU8G8"><div class="marker"></div><span class="inline-wrap">修改/etc/multipath.conf<span class="jill"></span>配置文件</span><span class="inline-wrap">
</span><span class="inline-wrap"><a href="https://www.cnblogs.com/azyb/p/10809490.html"><span>多路径配置文件详解</span></a></span><span class="inline-wrap">
</span><span class="inline-wrap">==注：将本地磁盘排除,注意如果直接复制文件到另一节点注意被排除的硬盘==</span><code-block id="eYpu89MVFuWm7A62ULH328" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">defaults <span class="token punctuation">{</span>
        user_friendly_names <span class="token function">yes</span>
        find_multipaths <span class="token function">yes</span>
        path_grouping_policy multibus
        path_selector <span class="token string">"round-robin 0"</span>
        failback manual
        rr_weight priorities
        no_path_retry <span class="token number">5</span>
<span class="token punctuation">}</span>
blacklist <span class="token punctuation">{</span>
       devnode <span class="token string">"sr0"</span>
<span class="token punctuation">}</span>
multipaths <span class="token punctuation">{</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405845f59a2eb5e43b6b20604d27
              <span class="token builtin class-name">alias</span> RAC-OCRVOTE1
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405146055fb6230434b9ec999dc7
              <span class="token builtin class-name">alias</span> RAC-OCRVOTE2
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 360014059099bfbbcb9349b081de121e8
              <span class="token builtin class-name">alias</span> RAC-OCRVOTE3
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405b381f6cd51044a1b89aab5fbe
              <span class="token builtin class-name">alias</span> RAC-DATA
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="ijbtUikw7pKT5NnPADPg8J"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="s7WHv3vUxeqbKBYDZ46EQq" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl restart multipathd</pre></div></code-block></li><li id="egDvY16Z8esP9aRUniWRqu"><div class="marker"></div><span class="inline-wrap">检查</span><span class="inline-wrap">
</span><span class="inline-wrap">此时查看</span><span class="inline-wrap"><code>multipath -v3 | grep &quot;not in wwids file, skipping&quot; </code></span><span class="inline-wrap">，没有报错。</span><span class="inline-wrap">
</span><span class="inline-wrap">查看</span><code-block id="98DgpgZGJmx23nUEWdXTnV" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># ll /dev/mapper/RAC-*</span>
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-DATA -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-8
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">8</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-DATA1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-10
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-OCRVOTE1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-7
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-OCRVOTE1p1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-9
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-OCRVOTE2 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-4
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-OCRVOTE2p1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-6
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-OCRVOTE3 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-3
lrwxrwxrwx. <span class="token number">1</span> root root <span class="token number">7</span> Oct <span class="token number">21</span> 02:59 /dev/mapper/RAC-OCRVOTE3p1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-5</pre></div></code-block><div id="9LA4THTh33YpWYSxsTga3a" class="wolai-block wolai-text"><div><span class="inline-wrap">查看</span></div></div><code-block id="sT6TfhTu45fxSAdiKCNJJK" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># multipathd show paths</span>
hcil    dev dev_t pri dm_st  chk_st dev_st  next_check     
<span class="token number">4</span>:0:0:0 sdc <span class="token number">8</span>:32  <span class="token number">1</span>   active ready  running XXXXXXX<span class="token punctuation">..</span>. <span class="token number">15</span>/20
<span class="token number">4</span>:0:0:1 sdf <span class="token number">8</span>:80  <span class="token number">1</span>   active ready  running XXXXXXX<span class="token punctuation">..</span>. <span class="token number">15</span>/20
<span class="token number">4</span>:0:0:2 sde <span class="token number">8</span>:64  <span class="token number">1</span>   active ready  running XXXXXXX<span class="token punctuation">..</span>. <span class="token number">15</span>/20
<span class="token number">4</span>:0:0:3 sdd <span class="token number">8</span>:48  <span class="token number">1</span>   active ready  running XXXXXXX<span class="token punctuation">..</span>. <span class="token number">15</span>/20</pre></div></code-block><div id="m15jPwsmmELqTMTNoSWaGC" class="wolai-block wolai-text"><div><span class="inline-wrap">到此<span class="jill"></span>multipath 配置完成！</span></div></div></li></ol><h2 id="8YJwh5TpSZpZj1GKVaLzVr" class="wolai-block"><span class="inline-wrap">4、配置<span class="jill"></span>udev</span></h2><div id="2rVqW2j4qME4kDP8obNes9" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文档：</span><span class="inline-wrap"><a href="http://blog.itpub.net/25469263/viewspace-2156439/"><span>udev<span class="jill"></span>简介及配置</span></a></span></div></div><div id="amRDUuVRX2we8jT7ToE5Zk" class="wolai-block wolai-text"><div><span class="inline-wrap">通过<span class="jill"></span>UDEV<span class="jill"></span>配置，能够让<span class="jill"></span>Oracle<span class="jill"></span>对磁盘名进行持久化并改变磁盘访问权限为<span class="jill"></span>grid:asmadmin。这样在<span class="jill"></span>ASM<span class="jill"></span>的配置过程中能够看到磁盘。今后增加磁盘也不会改变原有的磁盘名称。该步骤可使用<span class="jill"></span>ASMLIB</span></div></div><ol class="wolai-block"><li id="enQoYzmfvss2VeG5fACBKb"><div class="marker"></div><span class="inline-wrap">批量生成配置文件并添加到/etc/udev/rules.d/99-oracle-asmdevices.rules</span><span class="inline-wrap">
</span><span class="inline-wrap">模板：</span><code-block id="wsuVpMdwaFKdAZdBuFQXS1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># KERNEL=="dm-*",SYMLINK+="",ENV{DM_UUID}=="",OWNER="grid",GROUP="asmadmin",MODE="0660" ENV{DM_UUID}==""依次为上诉查找的结果，SYMLINK（该名称作为/dev/.....）</span></pre></div></code-block><div id="jVmDNJUXHV38owagybmxVD" class="wolai-block wolai-text"><div><span class="inline-wrap">具体命令：</span></div></div><code-block id="1kqCBVV5TUCrTxtB59uTMh" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> RAC-DATA RAC-OCRVOTE1 RAC-OCRVOTE2 RAC-OCRVOTE3<span class="token punctuation">;</span> <span class="token keyword">do</span>
<span class="token builtin class-name">printf</span> <span class="token string">"KERNEL==<span class="token entity" title="\&quot;">\"</span>dm-*<span class="token entity" title="\&quot;">\"</span>,SYMLINK+=<span class="token entity" title="\&quot;">\"</span>%s<span class="token entity" title="\&quot;">\"</span>,ENV{DM_UUID}==<span class="token entity" title="\&quot;">\"</span>%s<span class="token entity" title="\&quot;">\"</span>,OWNER=<span class="token entity" title="\&quot;">\"</span>grid<span class="token entity" title="\&quot;">\"</span>,GROUP=<span class="token entity" title="\&quot;">\"</span>asmadmin<span class="token entity" title="\&quot;">\"</span>,MODE=<span class="token entity" title="\&quot;">\"</span>0660<span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">$i</span>"</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>udevadm info <span class="token parameter variable">--query</span><span class="token operator">=</span>all <span class="token parameter variable">--name</span><span class="token operator">=</span>/dev/mapper/$i <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-o</span> dm_uuid.*<span class="token variable">)</span></span>"</span><span class="token punctuation">;</span> 
<span class="token keyword">done</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s\"DM_UUID=\"\g'</span><span class="token operator">></span>/etc/udev/rules.d/99-oracle-asmdevices.rules</pre></div></code-block><div id="wdRJ1FoizaTrLNAaD2rEGy" class="wolai-block wolai-text"><div><span class="inline-wrap">一下内容上方命令的输出</span></div></div><code-block id="csNanhxEmRCyucjXBQcY68" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"RAC-DATA"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"mpath-36001405b381f6cd51044a1b89aab5fbe"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span> 
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"RAC-OCRVOTE1"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"mpath-36001405845f59a2eb5e43b6b20604d27"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span> 
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"RAC-OCRVOTE2"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"mpath-36001405146055fb6230434b9ec999dc7"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span> 
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"RAC-OCRVOTE3"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"mpath-360014059099bfbbcb9349b081de121e8"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span> </pre></div></code-block></li><li id="wzFZrArZJCV6YAmuiVGGKy"><div class="marker"></div><span class="inline-wrap">双节点配置完完规则后,重启<span class="jill"></span>udev<span class="jill"></span>服务</span><code-block id="ngfTiAvM8GVXpYgyqH1nRH" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">udevadm control --reload-rules
udevadm trigger <span class="token parameter variable">--type</span><span class="token operator">=</span>devices <span class="token parameter variable">--action</span><span class="token operator">=</span>change</pre></div></code-block></li><li id="kKPtjFZMCCfrzYYnbPYD6L"><div class="marker"></div><span class="inline-wrap">测试文件是否生效</span><span class="inline-wrap">
</span><span class="inline-wrap">在查看</span><span class="inline-wrap"><code>ll /dev/mapper/</code></span><span class="inline-wrap">时，能够发现</span><span class="inline-wrap"><code>RAC-FRA1 -&gt; ../dm-5</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>RAC-OCRVOTE1 -&gt; ../dm-6</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>RAC-DATA1 -&gt; ../dm-7</code></span><span class="inline-wrap">，针对<span class="jill"></span>dm-5、dm-6、dm-7<span class="jill"></span>进行查看。</span><code-block id="8YRYynxZiDYEuX1TNuKWVv" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">udevadm <span class="token builtin class-name">test</span> /sys/block/dm-5</pre></div></code-block><div id="7ynN2Sdk33oDzSGcvE6Dkd" class="wolai-block wolai-text"><div><span class="inline-wrap">查看权限分配是否正确</span></div></div><code-block id="ppckby29EvvsqA4H66mwzP" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 rules.d<span class="token punctuation">]</span><span class="token comment"># ll /dev/dm-5</span>
brw-rw---- <span class="token number">1</span> grid asmadmin <span class="token number">253</span>, <span class="token number">5</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">14</span>:06 /dev/dm-5</pre></div></code-block></li></ol><h1 id="dpsuesUAbVVvSMvB7RkHFg" class="wolai-block"><span class="inline-wrap">四、安装<span class="jill"></span>Grid Infrastructure</span></h1><ol class="wolai-block"><li id="uPyp2ERjYSgi2NnHeefb8F"><div class="marker"></div><span class="inline-wrap">互信：在<span class="jill"></span>grid<span class="jill"></span>的安装包下，使用<span class="jill"></span>grid<span class="jill"></span>用户执行</span><code-block id="bHF8nfNiuFfEnKGhXzJF5U" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./oui/prov/resources/scripts/sshUserSetup.sh <span class="token parameter variable">-hosts</span> <span class="token string">"ora1 ora2"</span> <span class="token parameter variable">-user</span> grid <span class="token parameter variable">-advanced</span> <span class="token parameter variable">-noPromptPassphrase</span></pre></div></code-block></li><li id="4X5ZEogDj7jP1VjGXxdjt6"><div class="marker"></div><span class="inline-wrap">编辑./install/response/gridsetup.rsp<span class="jill"></span>资源文件</span></li></ol><code-block id="51F4GmQBpBvJbsjrLFJ1yk" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">oracle.install.responseFileVersion</span><span class="token operator">=</span>/oracle/install/rspfmt_crsinstall_response_schema_v12.2.0
<span class="token assign-left variable">INVENTORY_LOCATION</span><span class="token operator">=</span>/u01/app/oraInventory
<span class="token assign-left variable">oracle.install.option</span><span class="token operator">=</span>CRS_CONFIG
<span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/grid/base
<span class="token assign-left variable">oracle.install.asm.OSDBA</span><span class="token operator">=</span>asmdba
<span class="token assign-left variable">oracle.install.asm.OSOPER</span><span class="token operator">=</span>asmoper
<span class="token assign-left variable">oracle.install.asm.OSASM</span><span class="token operator">=</span>asmadmin
<span class="token comment"># scan name</span>
<span class="token assign-left variable">oracle.install.crs.config.gpnp.scanName</span><span class="token operator">=</span>ora-scan
<span class="token assign-left variable">oracle.install.crs.config.gpnp.scanPort</span><span class="token operator">=</span><span class="token number">1521</span>
<span class="token assign-left variable">oracle.install.crs.config.ClusterConfiguration</span><span class="token operator">=</span>STANDALONE
<span class="token assign-left variable">oracle.install.crs.config.configureAsExtendedCluster</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.config.memberClusterManifestFile</span><span class="token operator">=</span>
<span class="token comment"># 集群名可以默认</span>
<span class="token assign-left variable">oracle.install.crs.config.clusterName</span><span class="token operator">=</span>ora-scan
<span class="token assign-left variable">oracle.install.crs.config.gpnp.configureGNS</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.config.autoConfigureClusterNodeVIP</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.config.gpnp.gnsOption</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.config.gpnp.gnsClientDataFile</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.config.gpnp.gnsSubDomain</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.config.gpnp.gnsVIPAddress</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.config.sites</span><span class="token operator">=</span>
<span class="token comment"># 主机名</span>
<span class="token assign-left variable">oracle.install.crs.config.clusterNodes</span><span class="token operator">=</span>ora1:ora1-vip:HUB,ora2:ora2-vip:HUB
<span class="token comment"># 1:public,5:ASM&amp;private,3:not use</span>
<span class="token assign-left variable">oracle.install.crs.config.networkInterfaceList</span><span class="token operator">=</span>eth0:192.168.0.0:1,eth1:192.168.8.0:5
<span class="token assign-left variable">oracle.install.asm.configureGIMRDataDG</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.config.storageOption</span><span class="token operator">=</span>FLEX_ASM_STORAGE
<span class="token assign-left variable">oracle.install.crs.config.useIPMI</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.config.ipmi.bmcUsername</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.config.ipmi.bmcPassword</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.storageOption</span><span class="token operator">=</span>ASM
<span class="token assign-left variable">oracle.install.asmOnNAS.ocrLocation</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asmOnNAS.configureGIMRDataDG</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asmOnNAS.gimrLocation</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.SYSASMPassword</span><span class="token operator">=</span>Password@1
<span class="token comment"># 仅用于OCR（DATA盘后续添加）</span>
<span class="token assign-left variable">oracle.install.asm.diskGroup.name</span><span class="token operator">=</span>OCR
<span class="token assign-left variable">oracle.install.asm.diskGroup.redundancy</span><span class="token operator">=</span>NORMAL
<span class="token assign-left variable">oracle.install.asm.diskGroup.AUSize</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token assign-left variable">oracle.install.asm.diskGroup.FailureGroups</span><span class="token operator">=</span>
<span class="token comment"># OCR磁盘组</span>
<span class="token assign-left variable">oracle.install.asm.diskGroup.disksWithFailureGroupNames</span><span class="token operator">=</span>/dev/RAC-OCRVOTE1,,/dev/RAC-OCRVOTE2,,/dev/RAC-OCRVOTE3,
<span class="token comment"># 指定OCR磁盘组</span>
<span class="token assign-left variable">oracle.install.asm.diskGroup.disks</span><span class="token operator">=</span>/dev/RAC-OCRVOTE1,/dev/RAC-OCRVOTE2,/dev/RAC-OCRVOTE3
<span class="token assign-left variable">oracle.install.asm.diskGroup.quorumFailureGroupNames</span><span class="token operator">=</span>
<span class="token comment"># 磁盘组发现</span>
<span class="token assign-left variable">oracle.install.asm.diskGroup.diskDiscoveryString</span><span class="token operator">=</span>dev/RAC-*
<span class="token assign-left variable">oracle.install.asm.monitorPassword</span><span class="token operator">=</span>Password@1
<span class="token assign-left variable">oracle.install.asm.gimrDG.name</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.gimrDG.redundancy</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.gimrDG.AUSize</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.gimrDG.FailureGroups</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.gimrDG.disksWithFailureGroupNames</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.gimrDG.disks</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.gimrDG.quorumFailureGroupNames</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.asm.configureAFD</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.configureRHPS</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.config.ignoreDownNodes</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.config.managementOption</span><span class="token operator">=</span>NONE
<span class="token assign-left variable">oracle.install.config.omsHost</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.config.omsPort</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">oracle.install.config.emAdminUser</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.config.emAdminPassword</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.rootconfig.executeRootScript</span><span class="token operator">=</span>false
<span class="token assign-left variable">oracle.install.crs.rootconfig.configMethod</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.rootconfig.sudoPath</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.rootconfig.sudoUserName</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.config.batchinfo</span><span class="token operator">=</span>
<span class="token assign-left variable">oracle.install.crs.app.applicationAddress</span><span class="token operator">=</span></pre></div></code-block><ol class="wolai-block"><li id="g6XGBtXG2zrGTszVJYKzK4"><div class="marker"></div><span class="inline-wrap">检索安装环境</span><blockquote id="hjTU5PZjNDyoBMh2vr6Za4" class="wolai-block"><span class="inline-wrap">一些<span class="jill"></span>CVU<span class="jill"></span>检查需要根特权才能从系统中检索所需的信息。在这种情况下，当根凭据不可用时，用户会收到“PRVG-11250”等消息的通知：检查“RPM<span class="jill"></span>软件包管理器数据库”没有执行，因为它需要“根”用户特权。</span><span class="inline-wrap"><a href="https://support.oracle.com/knowledge/Oracle%20Database%20Products/2548970_1.html"><span>MOS<span class="jill"></span>文档</span></a></span></blockquote><code-block id="tA1N9hZejb4NzCBnXUe4Fa" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./runcluvfy.sh stage <span class="token parameter variable">-pre</span> crsinst <span class="token parameter variable">-n</span> ora1,ora2 <span class="token parameter variable">-method</span> root</pre></div></code-block></li><li id="8KRSTdPSxCw9FxVvUvLJ1K"><div class="marker"></div><span class="inline-wrap">安装验证，根据日志过滤</span><span class="inline-wrap"><code>VERIFICATION_FAILED</code></span><code-block id="qp3Edt9u9uM4xxXYGG1Eg1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> ./gridSetup.sh  <span class="token parameter variable">-silent</span> <span class="token parameter variable">-responseFile</span> ./install/response/gridsetup.rsp <span class="token parameter variable">-executePrereqs</span></pre></div></code-block></li></ol><blockquote id="wnW3uxAJhPhtWZWvFVwL3K" class="wolai-block"><span class="inline-wrap">安装前的注意事项：</span></blockquote><ol class="wolai-block"><li id="ma1BhusACvcQQQ6Txeov6G"><div class="marker"></div><span class="inline-wrap">安装之前请确保其他节点的<span class="jill"></span>$ORACLE_HOME<span class="jill"></span>没有文件</span></li><li id="jALoi5tqmN1GNQEDLLT988"><div class="marker"></div><span class="inline-wrap">安装包别放到/tmp<span class="jill"></span>之下，建议放到<span class="jill"></span>$ORACLE_HOME</span></li><li id="o4tZvy1T9Y8s6A9jDYNis1"><div class="marker"></div><span class="inline-wrap">网卡 私有网卡应该是<span class="jill"></span>private<span class="jill"></span>和<span class="jill"></span>asm</span></li><li id="24nmYEDSGWhgCNu2C1nwLt"><div class="marker"></div><span class="inline-wrap">脚本执行顺序为在节点一、二<span class="jill"></span>orainstRoot.sh、再节点一、二执行脚本<span class="jill"></span>root.sh</span></li><li id="cnAfFzutfjGxWSTHdj7ZL3"><div class="marker"></div><span class="inline-wrap">仅在确定检测的日志无严重错误时才能使用</span><span class="inline-wrap"><code>-ignorePrereqFailure</code></span><span class="inline-wrap">参数</span></li><li id="n5w74sZdezoiaeSJyKQh2z"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>grid<span class="jill"></span>用户，进入家目录后开始安装</span><code-block id="mqBHR5HTeetqR6Dg3acQoT" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> /u01/app/oraInventory/* <span class="token operator">&amp;&amp;</span>  ./gridSetup.sh <span class="token parameter variable">-silent</span> <span class="token parameter variable">-responsefile</span> ./install/response/gridsetup.rsp <span class="token parameter variable">-ignoreInternalDriverError</span> <span class="token parameter variable">-ignorePrereqFailure</span></pre></div></code-block></li><li id="mjwNWY9M2MbWUPvk6uiKdT"><div class="marker"></div><span class="inline-wrap">HAIP：如果使用云服务器搭建，最好关闭<span class="jill"></span>HAIP，否则会造成无法连接节点的<span class="jill"></span>169.254<span class="jill"></span>地址，其他节点的<span class="jill"></span>+ASM<span class="jill"></span>实例无法启动</span><code-block id="5gZx1F5VtXx2yxpzSfaWu6" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">export</span> <span class="token assign-left variable">HAIP_UNSUPPORTED</span><span class="token operator">=</span>YES</pre></div></code-block></li><li id="aRyUxqDtmpDt9y7YnD8vjw"><div class="marker"></div><span class="inline-wrap">root.sh 和<span class="jill"></span>oraInst.sh<span class="jill"></span>执行顺序：</span><code-block id="3MhUYfPWmzBzmrWToY16oW" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">Execute /u01/app/oraInventory/orainstRoot.sh on the following nodes: 
<span class="token punctuation">[</span>ora1, ora2<span class="token punctuation">]</span>
Execute /u01/app/grid/home/root.sh on the following nodes: 
<span class="token punctuation">[</span>ora1, ora2<span class="token punctuation">]</span></pre></div></code-block></li><li id="6Ld6TjyDm3aczftx8cKakK"><div class="marker"></div><span class="inline-wrap">检查实例状态：任何<span class="jill"></span>grid<span class="jill"></span>用户执行</span><span class="inline-wrap"><code>lsnrctl staatus</code></span><span class="inline-wrap">均有实例启动</span><code-block id="jrpuPFpYfJrwcjFaf7pXno" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">Services Summary<span class="token punctuation">..</span>.
Service <span class="token string">"+ASM"</span> has <span class="token number">1</span> instance<span class="token punctuation">(</span>s<span class="token punctuation">)</span>.
  Instance <span class="token string">"+ASM2"</span>, status READY, has <span class="token number">1</span> handler<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> this service<span class="token punctuation">..</span>.
Service <span class="token string">"+ASM_OCR"</span> has <span class="token number">1</span> instance<span class="token punctuation">(</span>s<span class="token punctuation">)</span>.
  Instance <span class="token string">"+ASM2"</span>, status READY, has <span class="token number">1</span> handler<span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> this service<span class="token punctuation">..</span>.
The <span class="token builtin class-name">command</span> completed successfully</pre></div></code-block></li><li id="fjUuNdjKQS1FfznA4MXcW5"><div class="marker"></div><span class="inline-wrap">安装完成后使用<span class="jill"></span>grid<span class="jill"></span>用户执行，可能会有<span class="jill"></span>Configuration failed，关系不大</span><code-block id="dfnDFYzA7zbY94e8Nx9imf" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/u01/app/grid/home/gridSetup.sh <span class="token parameter variable">-executeConfigTools</span> <span class="token parameter variable">-responseFile</span> ./install.rsp <span class="token parameter variable">-silent</span></pre></div></code-block></li></ol><h1 id="5gPpU1hzrWwYRhAZK7jLoT" class="wolai-block"><span class="inline-wrap">五、安装<span class="jill"></span>oracle<span class="jill"></span>软件</span></h1><ol class="wolai-block"><li id="az3uiq2cJPiWyDzsEjSmy5"><div class="marker"></div><span class="inline-wrap">oracle<span class="jill"></span>用户互信</span><code-block id="rK1Hhb9bSHd8uYvgtEXhzP" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./oui/prov/resources/scripts/sshUserSetup.sh <span class="token parameter variable">-hosts</span> <span class="token string">"ora1 ora2"</span> <span class="token parameter variable">-user</span> oracle <span class="token parameter variable">-advanced</span> <span class="token parameter variable">-noPromptPassphrase</span></pre></div></code-block></li><li id="dpTRTJgqZxc3xpLrLAfKJt"><div class="marker"></div><span class="inline-wrap">rsp<span class="jill"></span>资源文件</span><code-block id="iix4b7xh6Xd1j5Fzp1rgMM" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token key attr-name">oracle.install.responseFileVersion</span><span class="token punctuation">=</span><span class="token value attr-value">/oracle/install/rspfmt_dbinstall_response_schema__v12.2.0</span>
<span class="token key attr-name">oracle.install.option</span><span class="token punctuation">=</span><span class="token value attr-value">INSTALL_DB_SWONLY</span>
<span class="token key attr-name">UNIX_GROUP_NAME</span><span class="token punctuation">=</span><span class="token value attr-value">oinstall</span>
<span class="token key attr-name">INVENTORY_LOCATION</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oraInventory</span>
<span class="token comment"># oracle的用户$ORACLE_HOME</span>
<span class="token key attr-name">ORACLE_HOME</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oracle/product/12.2.0/db_1</span>
<span class="token comment"># oracle的用户$ORACLE_BASE</span>
<span class="token key attr-name">ORACLE_BASE</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oracle</span>
<span class="token key attr-name">oracle.install.db.InstallEdition</span><span class="token punctuation">=</span><span class="token value attr-value">EE</span>
<span class="token key attr-name">oracle.install.db.OSDBA_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">dba</span>
<span class="token key attr-name">oracle.install.db.OSOPER_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">oper</span>
<span class="token key attr-name">oracle.install.db.OSBACKUPDBA_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">backupdba</span>
<span class="token key attr-name">oracle.install.db.OSDGDBA_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">dgdba</span>
<span class="token key attr-name">oracle.install.db.OSKMDBA_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">kmdba</span>
<span class="token key attr-name">oracle.install.db.OSRACDBA_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">dba</span>
<span class="token key attr-name">oracle.install.db.rootconfig.executeRootScript</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.rootconfig.configMethod</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.rootconfig.sudoPath</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.rootconfig.sudoUserName</span><span class="token punctuation">=</span>
<span class="token comment"># 节点主机名</span>
<span class="token key attr-name">oracle.install.db.CLUSTER_NODES</span><span class="token punctuation">=</span><span class="token value attr-value">ora1,ora2</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.type</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.globalDBName</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.SID</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.ConfigureAsContainerDB</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.PDBName</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.characterSet</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.memoryOption</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.memoryLimit</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.installExampleSchemas</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.ALL</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.SYS</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.SYSTEM</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.DBSNMP</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.PDBADMIN</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.managementOption</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.omsHost</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.omsPort</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.emAdminUser</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.emAdminPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.enableRecovery</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.storageType</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.asm.diskGroup</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.asm.ASMSNMPPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">SECURITY_UPDATES_VIA_MYORACLESUPPORT</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">DECLINE_SECURITY_UPDATES</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">PROXY_HOST</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_PORT</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_USER</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_PWD</span><span class="token punctuation">=</span>
<span class="token key attr-name">COLLECTOR_SUPPORTHUB_URL</span><span class="token punctuation">=</span></pre></div></code-block></li><li id="oj9LHvk3jNHTXp6EwJ9VTY"><div class="marker"></div><span class="inline-wrap">执行安装验证</span><code-block id="gswRGAZcp2jGm5FR1qApLp" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./runInstaller  <span class="token parameter variable">-executePrereqs</span> <span class="token parameter variable">-silent</span> <span class="token parameter variable">-responsefile</span> ./ora.rsp</pre></div></code-block><div id="8Xa9o7CQbo5BNZJMWNH8oz" class="wolai-block wolai-text"><div><span class="inline-wrap">==注： 其他节点需要清空<span class="jill"></span>$ORACLE_HOME==</span></div></div></li><li id="cqyYSWmWWD28bUPz2J1XD4"><div class="marker"></div><span class="inline-wrap">执行安装</span><code-block id="oApuoaHqanb9QoGBij6YvH" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./runInstaller  <span class="token parameter variable">-silent</span> <span class="token parameter variable">-ignorePrereqFailure</span> <span class="token parameter variable">-responsefile</span> ./ora.rsp</pre></div></code-block></li><li id="gd8zSamb6WM5N63VuxftvQ"><div class="marker"></div><span class="inline-wrap">按照以下顺序执行<span class="jill"></span>root.sh</span><code-block id="wE5LN9X7tG89QtJDxfPaLW" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">As a root user, execute the following script<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:
  <span class="token number">1</span>. /u01/app/oracle/product/12.2.0/db_1/root.sh

Execute /u01/app/oracle/product/12.2.0/db_1/root.sh on the following nodes: 
<span class="token punctuation">[</span>ora1, ora2<span class="token punctuation">]</span></pre></div></code-block></li></ol><h1 id="fbo8Zru9KmRy1QBhtE48qB" class="wolai-block"><span class="inline-wrap">六、创建磁盘组</span></h1><ol class="wolai-block"><li id="mfohSD4Cxm2iFGJyuSku9V"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>grid<span class="jill"></span>用户创建<span class="jill"></span>DATA<span class="jill"></span>磁盘组</span><code-block id="vSSa6PFNVrXBrdkUw1tjYY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>grid@ora1 ~<span class="token punctuation">]</span>$ asmca <span class="token parameter variable">-silent</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-sysAsmPassword</span> Password@1 <span class="token punctuation">\</span>
<span class="token parameter variable">-asmsnmpPassword</span> Password@1 <span class="token punctuation">\</span>
<span class="token parameter variable">-createDiskGroup</span> <span class="token parameter variable">-diskGroupName</span> DATA <span class="token punctuation">\</span>
<span class="token comment"># 根据实际情况填写disk参数</span>
<span class="token parameter variable">-disk</span> /dev/RAC-DATA <span class="token punctuation">\</span>
<span class="token parameter variable">-redundancy</span> EXTERNAL <span class="token parameter variable">-au_size</span> <span class="token number">4</span> <span class="token parameter variable">-compatible.asm</span> <span class="token number">12.0</span>.0.0.0 <span class="token parameter variable">-compatible.rdbms</span> <span class="token number">12.0</span>.0.0.0</pre></div></code-block></li></ol><h1 id="12HsUZPZ86hnqpEuFPCqF1" class="wolai-block"><span class="inline-wrap">七、创建数据库实例</span></h1><ol class="wolai-block"><li id="wsZHjGWb3fmKJHE7s8gAJh"><div class="marker"></div><span class="inline-wrap">dbca.rsp<span class="jill"></span>资源文件，参考参数</span><code-block id="wyqy3411zUKq7nRuNqS1FK" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token key attr-name">responseFileVersion</span><span class="token punctuation">=</span><span class="token value attr-value">/oracle/assistants/rspfmt_dbca_response_schema_v12.2.0</span>
<span class="token comment"># gdb</span>
<span class="token key attr-name">gdbName</span><span class="token punctuation">=</span><span class="token value attr-value">oracle</span>
<span class="token comment"># SID</span>
<span class="token key attr-name">sid</span><span class="token punctuation">=</span><span class="token value attr-value">oracle</span>
<span class="token key attr-name">databaseConfigType</span><span class="token punctuation">=</span><span class="token value attr-value">RAC</span>
<span class="token key attr-name">RACOneNodeServiceName</span><span class="token punctuation">=</span>
<span class="token key attr-name">policyManaged</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">createServerPool</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">serverPoolName</span><span class="token punctuation">=</span>
<span class="token key attr-name">cardinality</span><span class="token punctuation">=</span>
<span class="token key attr-name">force</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">pqPoolName</span><span class="token punctuation">=</span>
<span class="token key attr-name">pqCardinality</span><span class="token punctuation">=</span>
<span class="token key attr-name">createAsContainerDatabase</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">numberOfPDBs</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token key attr-name">pdbName</span><span class="token punctuation">=</span>
<span class="token key attr-name">useLocalUndoForPDBs</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">pdbAdminPassword</span><span class="token punctuation">=</span>
<span class="token comment"># 节点主机名</span>
<span class="token key attr-name">nodelist</span><span class="token punctuation">=</span><span class="token value attr-value">ora1,ora2</span>
<span class="token key attr-name">templateName</span><span class="token punctuation">=</span><span class="token value attr-value">General_Purpose.dbc</span>
<span class="token comment"># sys密码</span>
<span class="token key attr-name">sysPassword</span><span class="token punctuation">=</span><span class="token value attr-value">Password@1</span>
<span class="token comment"># syspass密码</span>
<span class="token key attr-name">systemPassword</span><span class="token punctuation">=</span><span class="token value attr-value">Password@1</span>
<span class="token key attr-name">serviceUserPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">emConfiguration</span><span class="token punctuation">=</span>
<span class="token key attr-name">emExpressPort</span><span class="token punctuation">=</span><span class="token value attr-value">5500</span>
<span class="token key attr-name">runCVUChecks</span><span class="token punctuation">=</span><span class="token value attr-value">FALSE</span>
<span class="token key attr-name">dbsnmpPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">omsHost</span><span class="token punctuation">=</span>
<span class="token key attr-name">omsPort</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token key attr-name">emUser</span><span class="token punctuation">=</span>
<span class="token key attr-name">emPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">dvConfiguration</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">dvUserName</span><span class="token punctuation">=</span>
<span class="token key attr-name">dvUserPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">dvAccountManagerName</span><span class="token punctuation">=</span>
<span class="token key attr-name">dvAccountManagerPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">olsConfiguration</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">datafileJarLocation</span><span class="token punctuation">=</span>
<span class="token key attr-name">datafileDestination</span><span class="token punctuation">=</span><span class="token value attr-value">+DATA/{DB_UNIQUE_NAME}/</span>
<span class="token key attr-name">recoveryAreaDestination</span><span class="token punctuation">=</span>
<span class="token key attr-name">storageType</span><span class="token punctuation">=</span><span class="token value attr-value">ASM</span>
<span class="token key attr-name">diskGroupName</span><span class="token punctuation">=</span><span class="token value attr-value">+DATA/{DB_UNIQUE_NAME}/</span>
<span class="token key attr-name">asmsnmpPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">recoveryGroupName</span><span class="token punctuation">=</span>
<span class="token comment"># 字符集</span>
<span class="token key attr-name">characterSet</span><span class="token punctuation">=</span><span class="token value attr-value">AL32UTF8</span>
<span class="token comment"># 国家字符集</span>
<span class="token key attr-name">nationalCharacterSet</span><span class="token punctuation">=</span><span class="token value attr-value">AL16UTF16</span>
<span class="token key attr-name">registerWithDirService</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">dirServiceUserName</span><span class="token punctuation">=</span>
<span class="token key attr-name">dirServicePassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">walletPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">listeners</span><span class="token punctuation">=</span><span class="token value attr-value">LISTENER</span>
<span class="token key attr-name">variablesFile</span><span class="token punctuation">=</span>
<span class="token key attr-name">variables</span><span class="token punctuation">=</span>
<span class="token key attr-name">initParams</span><span class="token punctuation">=</span>
<span class="token key attr-name">sampleSchema</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">memoryPercentage</span><span class="token punctuation">=</span><span class="token value attr-value">40</span>
<span class="token key attr-name">databaseType</span><span class="token punctuation">=</span><span class="token value attr-value">MULTIPURPOSE</span>
<span class="token key attr-name">automaticMemoryManagement</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">totalMemory</span><span class="token punctuation">=</span><span class="token value attr-value">0</span></pre></div></code-block></li><li id="3b2KTdBgqNGALsA4YNGXWy"><div class="marker"></div><span class="inline-wrap">安装前检查</span><span class="inline-wrap">
</span><span class="inline-wrap">==注：如果有错误，可以从<span class="jill"></span>List of failed Tasks<span class="jill"></span>开始看==</span><code-block id="aSZVpSEVYBEMrR9nfcQzUJ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">dbca <span class="token operator">-</span>silent <span class="token operator">-</span>responsefile assistants<span class="token operator">/</span>dbca<span class="token operator">/</span>dbca<span class="token punctuation">.</span><span class="token property-access">rsp</span> <span class="token operator">-</span>executePrereqs <span class="token operator">-</span>databaseConfigType <span class="token constant">RAC</span></pre></div></code-block></li><li id="iYeigcrYGpaj3AQpHRLoS7"><div class="marker"></div><span class="inline-wrap">执行安装</span><code-block id="cXAnMtDKR85sSZNxjZPNsG" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">dbca <span class="token operator">-</span>silent <span class="token operator">-</span>responsefile assistants<span class="token operator">/</span>dbca<span class="token operator">/</span>dbca<span class="token punctuation">.</span><span class="token property-access">rsp</span>  <span class="token operator">-</span>createDatabase <span class="token operator">-</span>ignorePrereqFailure</pre></div></code-block></li></ol><div id="fGDEP1rp1ajfmD3dThPuGu" class="wolai-block wolai-text"><div><span class="inline-wrap">到此安装完毕，oracle<span class="jill"></span>用户通过</span><span class="inline-wrap"><code>sqlplus</code></span><span class="inline-wrap">尝试连接实例，grid<span class="jill"></span>用户通过</span><span class="inline-wrap"><code>crs status res -t</code></span><span class="inline-wrap">检查状态</span></div></div></article><footer></footer></body></html>