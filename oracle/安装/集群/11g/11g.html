<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>11g - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="11g" class="main-title"></div></div></header><article><h1 id="2KxWNqZgz2LhxgWFp56Aax" class="wolai-block"><span class="inline-wrap">Centos7.8<span class="jill"></span>静默安装<span class="jill"></span>11gRAC</span></h1><div id="51cRxKKVYjt4CyPEtSVu5t" class="wolai-block wolai-text"><div><span class="inline-wrap">文档更新时间：2021<span class="jill"></span>年<span class="jill"></span>10<span class="jill"></span>月<span class="jill"></span>3<span class="jill"></span>日</span></div></div><h1 id="i82Eu2DthJTpLNdvW5f1kE" class="wolai-block"><span class="inline-wrap">一、基本信息与配置</span></h1><div id="cApLfUgx73MN78PFor39Q7" class="wolai-block wolai-text"><div><span class="inline-wrap">节点基本信息：</span></div></div><div id="d8hAuifbeXLmmxGrbYC9bH" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 246.66666666666666px"><br/></th><th style="width: 246.66666666666666px"><span class="inline-wrap">节点一</span></th><th style="width: 246.66666666666666px"><span class="inline-wrap">节点二</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">主机名</span></td><td><span class="inline-wrap">ora1</span></td><td><span class="inline-wrap">ora2</span></td></tr><tr><td><span class="inline-wrap">操作系统</span></td><td><span class="inline-wrap">Centos7.8</span></td><td><span class="inline-wrap">Centos7.8</span></td></tr><tr><td><span class="inline-wrap">grid<span class="jill"></span>用户名/密码</span></td><td><span class="inline-wrap">grid</span></td><td><span class="inline-wrap">grid</span></td></tr><tr><td><span class="inline-wrap">Oracle<span class="jill"></span>用户名/密码</span></td><td><span class="inline-wrap">oracle</span></td><td><span class="inline-wrap">oracle</span></td></tr><tr><td><span class="inline-wrap">Oracle 版本</span></td><td><span class="inline-wrap">11g Enterprise Edition Release 11.2.0.4.0</span></td><td><span class="inline-wrap">11g Enterprise Edition Release 11.2.0.4.0</span></td></tr><tr><td><span class="inline-wrap">oracle<span class="jill"></span>用户<span class="jill"></span>SID</span></td><td><span class="inline-wrap">rac1</span></td><td><span class="inline-wrap">rac2</span></td></tr><tr><td><span class="inline-wrap">grid<span class="jill"></span>用户<span class="jill"></span>SID</span></td><td><span class="inline-wrap">+ASM1</span></td><td><span class="inline-wrap">+ASM2</span></td></tr><tr><td><span class="inline-wrap">GI<span class="jill"></span>安装位置</span></td><td><span class="inline-wrap">/u01/app/grid/base</span></td><td><span class="inline-wrap">/u01/app/grid/base</span></td></tr><tr><td><span class="inline-wrap">数据库安装位置</span></td><td><span class="inline-wrap">/u01/app/oracle/base</span></td><td><span class="inline-wrap">/u01/app/oracle/base</span></td></tr><tr><td><span class="inline-wrap">公网<span class="jill"></span>IP</span></td><td><span class="inline-wrap">192.168.3.64/21</span></td><td><span class="inline-wrap">192.168.3.65/21</span></td></tr><tr><td><span class="inline-wrap">私网<span class="jill"></span>IP</span></td><td><span class="inline-wrap">192.168.122.2/24</span></td><td><span class="inline-wrap">192.168.122.3/24</span></td></tr></tbody></table></div><div id="nCFNGqP2RWLjRmPMwysQxb" class="wolai-block wolai-text"><div><span class="inline-wrap">需要准备的文件</span></div></div><code-block id="hbwewFuyRZNoxkWv1sKiFe" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 安装包</span>
p13390677_112040_Linux-x86-64_1of7.zip
p13390677_112040_Linux-x86-64_2of7.zip
p13390677_112040_Linux-x86-64_3of7.zip

<span class="token comment"># 补丁</span>
p19404309_112040_Linux-x86-64.zip
p18370031_112040_Linux-x86-64.zip

<span class="token comment"># rpm</span>
pdksh-5.2.14-37.el5_8.1.x86_64.rpm
compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm</pre></div></code-block><div id="jTFFAsKfTToMzVzuaQJo4a" class="wolai-block wolai-text"><div><span class="inline-wrap">同时挂载本地系统镜像方便<span class="jill"></span>yum<span class="jill"></span>安装，本文档需要安装的大部分依赖在本地系统镜像中足够安装。</span></div></div><h2 id="nBztRdbh5uq7WoEzxSY9sy" class="wolai-block"><span class="inline-wrap">1、用户配置</span></h2><ul class="wolai-block"><li id="5ig9cza4664r1xHSnPtg8H"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">gird<span class="jill"></span>用户配置</span><ol class="wolai-block"><li id="2pNYRTNo82q6SqcTvyp3pq"><div class="marker"></div><span class="inline-wrap">创建用户</span><code-block id="d3ARYTrzfEPYDfvLeCFrRR" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">groupadd</span> oinstall
<span class="token function">groupadd</span> dba
<span class="token function">groupadd</span> oper
<span class="token function">groupadd</span> asmadmin 
<span class="token function">groupadd</span> asmdba
<span class="token function">groupadd</span> asmoper

<span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> asmadmin,asmdba,asmoper,dba grid
<span class="token builtin class-name">echo</span> <span class="token string">"grid"</span> <span class="token operator">|</span> <span class="token function">passwd</span> grid <span class="token parameter variable">--stdin</span></pre></div></code-block></li><li id="vmGUivPcCyPkZ8TDuzCGuS"><div class="marker"></div><span class="inline-wrap">编辑<span class="jill"></span>Grid<span class="jill"></span>用户的 </span><span class="inline-wrap"><code>.bash_profile</code></span><span class="inline-wrap">
</span><span class="inline-wrap">注： ora1<span class="jill"></span>的<span class="jill"></span>grid<span class="jill"></span>用户的<span class="jill"></span>ORACLE_SID=+ASM1，ora2<span class="jill"></span>的<span class="jill"></span>grid<span class="jill"></span>用户的<span class="jill"></span>ORACLE_SID=+ASM2</span><code-block id="pcm36sRZMRoiwptZyrMebX" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/grid/base
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/grid/home
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>+ASM1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/lib:/lib:/usr/lib
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$ORACLE_HOME</span>/JRE:<span class="token variable">$ORACLE_HOME</span>/jlib:<span class="token variable">$ORACLE_HOME</span>/rdbms/jlib

<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/.local/bin:<span class="token environment constant">$HOME</span>/bin:<span class="token variable">$ORACLE_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span></pre></div></code-block></li><li id="v4iQMH7EohWLxts3SCfHiz"><div class="marker"></div><span class="inline-wrap">生效环境变量</span><code-block id="bmHNSvFyxHWuDXLQVVE1Z3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">.</span> ~/.bash_profile</pre></div></code-block></li></ol></li><li id="gVsnXhyMQouCpPEVHX4J8B"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">oracle 用户配置</span><ol class="wolai-block"><li id="amxHSkwA3apkM9nvhQYVkW"><div class="marker"></div><span class="inline-wrap">新建<span class="jill"></span>oracle<span class="jill"></span>用户</span><code-block id="eYGyb556emXdzoYLzJ37fM" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">useradd</span> <span class="token parameter variable">-g</span> oinstall <span class="token parameter variable">-G</span> oper,dba,asmdba <span class="token parameter variable">-d</span> /home/oracle oracle
<span class="token builtin class-name">echo</span> <span class="token string">"oracle"</span> <span class="token operator">|</span> <span class="token function">passwd</span> oracle <span class="token parameter variable">--stdin</span></pre></div></code-block></li><li id="gTbdBvriQ972pNK4yCJaj8"><div class="marker"></div><span class="inline-wrap">编辑<span class="jill"></span>oracle<span class="jill"></span>用户的</span><span class="inline-wrap"><code>.bash_profile</code></span><span class="inline-wrap">
</span><span class="inline-wrap">注：ora1<span class="jill"></span>的<span class="jill"></span>ORACLE_SID=rac1，ora2<span class="jill"></span>的<span class="jill"></span>ORACLE_SID=rac2</span><code-block id="oXwtgWsni6TphsbcS24RyZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_SID</span><span class="token operator">=</span>rac1
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_BASE</span><span class="token operator">=</span>/u01/app/oracle
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ORACLE_HOME</span><span class="token operator">=</span>/u01/app/oracle/product/11.2.0/db_1

<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token environment constant">$HOME</span>/.local/bin:<span class="token environment constant">$HOME</span>/bin:<span class="token variable">$ORACLE_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span></pre></div></code-block></li></ol></li></ul><h2 id="uY61e63vYKN9UhWvSdf42t" class="wolai-block"><span class="inline-wrap">2、文件夹设置</span></h2><ol class="wolai-block"><li id="gqvzS9MaZ8tte8jRosXzm5"><div class="marker"></div><span class="inline-wrap">双库创建相同的文件夹结构(root<span class="jill"></span>用户执行)</span><code-block id="q7h4FK9sdMntuxzy5JdAo3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/oracle/product/11.2.0/db_1
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/grid/base
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /u01/app/grid/home
<span class="token function">chown</span> <span class="token parameter variable">-R</span> grid:oinstall /u01
<span class="token function">chown</span> <span class="token parameter variable">-R</span> oracle:oinstall /u01/app/oracle</pre></div></code-block></li><li id="7GiP6Demo155xipeMtULfL"><div class="marker"></div><span class="inline-wrap">文件放置，zip<span class="jill"></span>包自行解压</span><span class="inline-wrap">
</span><span class="inline-wrap">root<span class="jill"></span>家目录下的文件（双节点）</span><code-block id="791yigXAVVDE7KsQBpoqkW" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">pdksh<span class="token operator">-</span><span class="token number">5.2</span><span class="token number">.14</span><span class="token operator">-</span><span class="token number">37</span><span class="token punctuation">.</span><span class="token property-access">el5_8</span><span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span><span class="token punctuation">.</span><span class="token property-access">rpm</span>
compat<span class="token operator">-</span>libstdc<span class="token operator">++</span><span class="token operator">-</span><span class="token number">33</span><span class="token operator">-</span><span class="token number">3.2</span><span class="token number">.3</span><span class="token operator">-</span><span class="token number">72</span><span class="token punctuation">.</span><span class="token property-access">el7</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span><span class="token punctuation">.</span><span class="token property-access">rpm</span></pre></div></code-block><div id="eRrf2fbybRsFroKQRAWYBH" class="wolai-block wolai-text"><div><span class="inline-wrap">grid<span class="jill"></span>家目录下的文件（仅节点一）</span></div></div><code-block id="wP9SgagWdqAj7jnrVZ31We" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">p13390677_112040_Linux<span class="token operator">-</span>x86<span class="token operator">-</span>64_3of7<span class="token punctuation">.</span><span class="token property-access">zip</span>
p19404309_112040_Linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">.</span><span class="token property-access">zip</span>
p18370031_112040_Linux<span class="token operator">-</span>x86<span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">.</span><span class="token property-access">zip</span></pre></div></code-block><div id="2rHer1LKG7gtxTYzGJL5CM" class="wolai-block wolai-text"><div><span class="inline-wrap">oracle<span class="jill"></span>家目录下的文件（仅节点一）</span></div></div><code-block id="umwmRbxZd5Xj12nYb3QaYQ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">p13390677_112040_Linux<span class="token operator">-</span>x86<span class="token operator">-</span>64_1of7<span class="token punctuation">.</span><span class="token property-access">zip</span>
p13390677_112040_Linux<span class="token operator">-</span>x86<span class="token operator">-</span>64_2of7<span class="token punctuation">.</span><span class="token property-access">zip</span></pre></div></code-block></li></ol><h2 id="a9Trxc9JTCiqaDsKfRHzMf" class="wolai-block"><span class="inline-wrap">3、系统配置</span></h2><ol class="wolai-block"><li id="36qAs9HFzMmCNmMsuBa2tA"><div class="marker"></div><span class="inline-wrap">修改每个节点的/etc/hosts（IP<span class="jill"></span>根据实际情况填写）</span><span class="inline-wrap">
</span><span class="inline-wrap">参考文档：RAC<span class="jill"></span>的几种<span class="jill"></span>IP：</span><span class="inline-wrap"><a href="https://cloud.tencent.com/developer/article/1578494"><span>https://cloud.tencent.com/developer/article/1578494</span></a></span><code-block id="4SZZgu8zti2hhpvFSse3jf" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token number">192.168</span>.3.64 ora1
<span class="token number">192.168</span>.3.65 ora2

<span class="token number">192.168</span>.122.2 ora1-priv
<span class="token number">192.168</span>.122.3 ora2-priv

<span class="token comment"># 以下三个IP交给安装包进行配置，所以安装之前无需ping通以下IP</span>
<span class="token number">192.168</span>.3.88 ora1-vip
<span class="token number">192.168</span>.3.89 ora2-vip
<span class="token number">192.168</span>.3.90 ora-scan</pre></div></code-block></li><li id="e8EvtWqvQhUS7peaG6stFA"><div class="marker"></div><span class="inline-wrap">关闭防火墙和<span class="jill"></span>SELinux</span><code-block id="pwXNQpw8fxuvXfgPVPKnrj" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl disable firewalld
systemctl stop firewalld
<span class="token comment"># 永久关闭SELINUX且临时关闭</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">'s/=enforcing/=disabled/g'</span>  /etc/selinux/config <span class="token operator">&amp;&amp;</span> setenforce <span class="token number">0</span>
<span class="token comment"># 重启（可选）</span>
<span class="token function">reboot</span></pre></div></code-block></li></ol><h2 id="7BKND1ou9DgtxWUQVXVVJo" class="wolai-block"><span class="inline-wrap">4、内核参数</span></h2><ol class="wolai-block"><li id="8tFzLJ6CQYKoiCCWHgtsFb"><div class="marker"></div><span class="inline-wrap">修改内核参数文件/etc/sysctl.conf</span><code-block id="wCt4b78e2V4QZRC3Xb3wiu" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/sysctl.conf</span>
fs.aio-max-nr = 1048576
fs.file-max = 6815744
kernel.shmall = 16451328
kernel.shmmax = 33692319744
kernel.shmmni = 4096
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
EOF</span></pre></div></code-block></li><li id="hTy92EBc2w2pAyX28zuywT"><div class="marker"></div><span class="inline-wrap">生效内核参数</span><code-block id="dBuHL3dTjTq31nwPPWTf5r" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">sysctl <span class="token operator">-</span>p</pre></div></code-block></li><li id="u5ezFEeeiqDSQugQEgG1r8"><div class="marker"></div><span class="inline-wrap">修改/etc/security/limits.conf</span><code-block id="d2itUoY8pHsjHoQmS5fTd5" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">cat <span class="token operator">&lt;&lt;</span> <span class="token constant">EOF</span> <span class="token operator">></span> <span class="token operator">/</span>etc<span class="token operator">/</span>security<span class="token operator">/</span>limits<span class="token punctuation">.</span><span class="token property-access">conf</span>
oracle   soft   nproc    <span class="token number">131072</span>
oracle   hard   nproc    <span class="token number">131072</span>
oracle   soft   nofile   <span class="token number">131072</span>
oracle   hard   nofile   <span class="token number">131072</span>
oracle   soft   core     unlimited
oracle   hard   core     unlimited
oracle   soft   memlock  <span class="token number">50000000</span>
oracle   hard   memlock  <span class="token number">50000000</span>
grid soft nproc <span class="token number">2047</span>
grid hard nproc <span class="token number">16384</span>
grid soft nofile <span class="token number">1024</span>
grid hard nofile <span class="token number">65536</span>
<span class="token constant">EOF</span></pre></div></code-block></li><li id="vP3XY6TQym4VHoo4ixbaFE"><div class="marker"></div><span class="inline-wrap">在/etc/pam.d/login<span class="jill"></span>下添加</span><code-block id="cV9PrRxdQiLQPzzt1gTkaA" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">session required pam_limits<span class="token punctuation">.</span><span class="token property-access">so</span></pre></div></code-block><div id="sUCoJRTwWBdbHVRXhcDdf9" class="wolai-block wolai-text"><div><span class="inline-wrap">这使得用户将加载<span class="jill"></span>PAM<span class="jill"></span>的<span class="jill"></span>pam_limits.so，设置用户登录的硬性设置</span></div></div></li></ol><h2 id="wt2HYBdo4S9BkdYDVzC8VH" class="wolai-block"><span class="inline-wrap">5、安装依赖</span></h2><ol class="wolai-block"><li id="sgnX2ba9uK9BFVEGa3jo8F"><div class="marker"></div><span class="inline-wrap">本地系统镜像中可直接安装(双节点执行)</span><code-block id="xtkBSKDchV8ZTHso5y8Kvg" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> binutils-* libc* compat-libstdc++-* elfutils-libelf-* elfutils-libelf-* elfutils-libelf-devel-static-* gcc-* gcc-c++-* glibc-* glibc-common-* glibc-devel-* glibc-headers-* kernel-headers-* libaio-* libaio-devel-* libgcc-* libgomp-* libstdc++-* libstdc++-devel-* make-* sysstat-* compat-libcap* smartmontools <span class="token function">expect</span> net-tools</pre></div></code-block></li><li id="1YyMj9AFEbvdn8ceXQciUM"><div class="marker"></div><span class="inline-wrap">额外需要（双节点执行）</span><code-block id="dRc7coQZK5nkzr7MdUfGhy" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> compat-libstdc++-33-3.2.3-72.el7.x86_64.rpm
<span class="token comment"># 如果 pdksh 与 (已安裝) ksh-20120801-142.el7.x86_64 冲突</span>
<span class="token comment"># rpm -e ksh-20120801-142.el7.x86_64</span>
<span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> pdksh-5.2.14-37.el5_8.1.x86_64.rpm</pre></div></code-block></li><li id="h2snHDdGT9AwLrT7AV1GJc"><div class="marker"></div><span class="inline-wrap">推荐安装</span><code-block id="7qi67MYYrR28h7YgrgUMVC" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum install <span class="token operator">-</span>y <span class="token operator">-</span>q net<span class="token operator">-</span>tools telnet unzip</pre></div></code-block></li><li id="n5yXEuuHuueDFQTHR9FDYb"><div class="marker"></div><span class="inline-wrap">安装<span class="jill"></span>cvuqdisk<span class="jill"></span>包（仅节点一）</span><code-block id="s53y2afcafp2tW8ZsUBPsc" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"># 进入安装文件夹
cd grid<span class="token operator">/</span>
rpm <span class="token operator">-</span>ivh rpm<span class="token operator">/</span>cvuqdisk<span class="token operator">-</span><span class="token number">1.0</span><span class="token number">.9</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token property-access">rpm</span></pre></div></code-block></li></ol><h1 id="iTmY68SGQGksssm8MqwA1f" class="wolai-block"><span class="inline-wrap">二、配置共享磁盘</span></h1><div id="3rdfLeLEGq6Bhsz9KyXrff" class="wolai-block wolai-text"><div><span class="inline-wrap">除<span class="jill"></span>iscsi<span class="jill"></span>服务端外，其他步骤</span><span class="inline-wrap"><b>双节点执行</b></span></div></div><div id="hwQmfq43ULvEAxnVP6pd75" class="wolai-block wolai-text"><div><span class="inline-wrap">参考：</span><span class="inline-wrap"><a href="https://blog.csdn.net/cuichongxin/article/details/103982207"><span>iscsi<span class="jill"></span>安装参考文档</span></a></span></div></div><h2 id="5LBJc14YdrKx5cjzwwzGZk" class="wolai-block"><span class="inline-wrap">1、配置<span class="jill"></span>iscsi<span class="jill"></span>服务端</span></h2><ol class="wolai-block"><li id="i7n4toxV98aF9F5NJZaDpF"><div class="marker"></div><span class="inline-wrap">安装</span><code-block id="kpNZBeJHahajBHtGkm6FZE" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum install <span class="token operator">-</span>y target<span class="token operator">*</span></pre></div></code-block></li><li id="aYG9MdehhjWTEq7ebqQD8x"><div class="marker"></div><span class="inline-wrap">启动并自启</span><code-block id="2U2BF9AsjaqoWBSWGYnQcZ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl enable target
systemctl start target</pre></div></code-block></li><li id="4hpGJz2CP9Ldzn97y9F77P"><div class="marker"></div><span class="inline-wrap">将未格式化、未分区的硬盘进行分区通过</span><span class="inline-wrap"><code>fdisk -l</code></span><span class="inline-wrap">检查到</span><span class="inline-wrap"><code>/dev/sdb</code></span><span class="inline-wrap">是我们需要进行共享的磁盘，先将它分区,但不需要格式化</span><code-block id="v2xVq66cWwpSbLUH1aRjde" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 grid<span class="token punctuation">]</span># fdisk <span class="token operator">/</span>dev<span class="token operator">/</span>sdb
<span class="token function">命令</span><span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
<span class="token function"><span class="token maybe-class-name">Select</span></span> <span class="token punctuation">(</span><span class="token keyword module">default</span> p<span class="token punctuation">)</span><span class="token operator">:</span> p
<span class="token function">分区号</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">4</span>，默认 <span class="token number">1</span><span class="token punctuation">)</span>：<span class="token number">1</span>
起始 <span class="token function">扇区</span> <span class="token punctuation">(</span><span class="token number">2048</span><span class="token operator">-</span><span class="token number">41943039</span>，默认为 <span class="token number">2048</span><span class="token punctuation">)</span>：<span class="token number">2048</span>
<span class="token maybe-class-name">Last</span> 扇区<span class="token punctuation">,</span> <span class="token operator">+</span>扇区 or <span class="token operator">+</span>size<span class="token punctuation">{</span><span class="token constant">K</span><span class="token punctuation">,</span><span class="token constant">M</span><span class="token punctuation">,</span><span class="token constant">G</span><span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">2048</span><span class="token operator">-</span><span class="token number">41943039</span>，默认为 <span class="token number">41943039</span><span class="token punctuation">)</span>：<span class="token number">13981696</span>

<span class="token function">命令</span><span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
<span class="token function"><span class="token maybe-class-name">Select</span></span> <span class="token punctuation">(</span><span class="token keyword module">default</span> p<span class="token punctuation">)</span><span class="token operator">:</span> p
<span class="token function">分区号</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">4</span>，默认 <span class="token number">2</span><span class="token punctuation">)</span>：<span class="token number">2</span>
起始 <span class="token function">扇区</span> <span class="token punctuation">(</span><span class="token number">13981697</span><span class="token operator">-</span><span class="token number">41943039</span>，默认为 <span class="token number">13983744</span><span class="token punctuation">)</span>：<span class="token number">13983744</span>
<span class="token maybe-class-name">Last</span> 扇区<span class="token punctuation">,</span> <span class="token operator">+</span>扇区 or <span class="token operator">+</span>size<span class="token punctuation">{</span><span class="token constant">K</span><span class="token punctuation">,</span><span class="token constant">M</span><span class="token punctuation">,</span><span class="token constant">G</span><span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">13983744</span><span class="token operator">-</span><span class="token number">41943039</span>，默认为 <span class="token number">41943039</span><span class="token punctuation">)</span>：<span class="token number">27962026</span>

<span class="token function">命令</span><span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
<span class="token function"><span class="token maybe-class-name">Select</span></span> <span class="token punctuation">(</span><span class="token keyword module">default</span> p<span class="token punctuation">)</span><span class="token operator">:</span> p
<span class="token function">分区号</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span>，默认 <span class="token number">3</span><span class="token punctuation">)</span>：<span class="token number">3</span>
起始 <span class="token function">扇区</span> <span class="token punctuation">(</span><span class="token number">13981697</span><span class="token operator">-</span><span class="token number">41943039</span>，默认为 <span class="token number">27963392</span><span class="token punctuation">)</span>：<span class="token number">27963392</span>
<span class="token maybe-class-name">Last</span> 扇区<span class="token punctuation">,</span> <span class="token operator">+</span>扇区 or <span class="token operator">+</span>size<span class="token punctuation">{</span><span class="token constant">K</span><span class="token punctuation">,</span><span class="token constant">M</span><span class="token punctuation">,</span><span class="token constant">G</span><span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">27963392</span><span class="token operator">-</span><span class="token number">41943039</span>，默认为 <span class="token number">41943039</span><span class="token punctuation">)</span>：<span class="token number">41943039</span>

<span class="token function">命令</span><span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：w
<span class="token maybe-class-name">The</span> partition table has been altered<span class="token operator">!</span>
<span class="token maybe-class-name">Calling</span> <span class="token function">ioctl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> to re<span class="token operator">-</span>read partition table<span class="token punctuation">.</span>
<span class="token property-access">正在同步磁盘。</span></pre></div></code-block></li><li id="uDcZdgXTCYa4KGCs3WynbA"><div class="marker"></div><span class="inline-wrap">查看分区</span><code-block id="aNDc5HstMSbtvng8CHM8cd" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">ora1 <span class="token operator">~</span><span class="token punctuation">]</span># lsblk
<span class="token constant">NAME</span>            <span class="token constant">MAJ</span><span class="token operator">:</span><span class="token constant">MIN</span> <span class="token constant">RM</span>  <span class="token constant">SIZE</span> <span class="token constant">RO</span> <span class="token constant">TYPE</span> <span class="token constant">MOUNTPOINT</span>
sda               <span class="token number">8</span><span class="token operator">:</span><span class="token number">0</span>    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span><span class="token operator">:</span><span class="token number">1</span>    <span class="token number">0</span>    1G  <span class="token number">0</span> part <span class="token operator">/</span>boot
└─sda2            <span class="token number">8</span><span class="token operator">:</span><span class="token number">2</span>    <span class="token number">0</span>   49G  <span class="token number">0</span> part 
  ├─centos<span class="token operator">-</span>root <span class="token number">253</span><span class="token operator">:</span><span class="token number">0</span>    <span class="token number">0</span> <span class="token number">45</span><span class="token punctuation">.</span>1G  <span class="token number">0</span> lvm  <span class="token operator">/</span>
  └─centos<span class="token operator">-</span>swap <span class="token number">253</span><span class="token operator">:</span><span class="token number">1</span>    <span class="token number">0</span>  <span class="token number">3</span><span class="token punctuation">.</span>9G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span><span class="token constant">SWAP</span><span class="token punctuation">]</span>
sdb               <span class="token number">8</span><span class="token operator">:</span><span class="token number">16</span>   <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
├─sdb1            <span class="token number">8</span><span class="token operator">:</span><span class="token number">17</span>   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
├─sdb2            <span class="token number">8</span><span class="token operator">:</span><span class="token number">18</span>   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
└─sdb3            <span class="token number">8</span><span class="token operator">:</span><span class="token number">19</span>   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sr0              <span class="token number">11</span><span class="token operator">:</span><span class="token number">0</span>    <span class="token number">1</span>  <span class="token number">4</span><span class="token punctuation">.</span>5G  <span class="token number">0</span> rom  
loop0             <span class="token number">7</span><span class="token operator">:</span><span class="token number">0</span>    <span class="token number">0</span>  <span class="token number">4</span><span class="token punctuation">.</span>5G  <span class="token number">1</span> loop <span class="token operator">/</span>mnt<span class="token operator">/</span>iso</pre></div></code-block></li><li id="xjijrSvY7TGXWsMciewVte"><div class="marker"></div><span class="inline-wrap">进入子系统</span><code-block id="fdDyGWkkbt7Y4cuWSERyuE" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 <span class="token operator">~</span><span class="token punctuation">]</span># targetcli</pre></div></code-block></li><li id="8saSsxbzN29p3qhA8E6REK"><div class="marker"></div><span class="inline-wrap">添加硬盘信息格式</span><code-block id="2dekzFNk9XWRGWbVh23EKJ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>backstores<span class="token operator">/</span>block create <span class="token constant">DB1</span> <span class="token operator">/</span>dev<span class="token operator">/</span>sdb1
<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>backstores<span class="token operator">/</span>block create <span class="token constant">DB2</span> <span class="token operator">/</span>dev<span class="token operator">/</span>sdb2
<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>backstores<span class="token operator">/</span>block create <span class="token constant">DB3</span> <span class="token operator">/</span>dev<span class="token operator">/</span>sdb3</pre></div></code-block></li><li id="ngippjFibF7vMDHZ3n7Ec4"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>iscsi</span><code-block id="d55hFFcy8hpPQUGD7MqLnP" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">格式：<span class="token operator">/</span>iscsi create 格式<span class="token punctuation">.</span><span class="token property-access">年份</span><span class="token operator">-</span>月份<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">自定义名称</span>
<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>iscsi create iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">06.30</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span></pre></div></code-block></li><li id="mcPCynALi3qbN216VBXxz9"><div class="marker"></div><span class="inline-wrap">关联<span class="jill"></span>block<span class="jill"></span>和<span class="jill"></span>target</span><code-block id="24Ck4yWP9B3x3fW5TaqFqJ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">06.30</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">/</span>tpg1<span class="token operator">/</span>luns create <span class="token operator">/</span>backstores<span class="token operator">/</span>block<span class="token operator">/</span><span class="token constant">DB1</span>
<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">06.30</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">/</span>tpg1<span class="token operator">/</span>luns create <span class="token operator">/</span>backstores<span class="token operator">/</span>block<span class="token operator">/</span><span class="token constant">DB2</span>
<span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">06.30</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">/</span>tpg1<span class="token operator">/</span>luns create <span class="token operator">/</span>backstores<span class="token operator">/</span>block<span class="token operator">/</span><span class="token constant">DB3</span></pre></div></code-block></li><li id="8MDjtY96A8fAHduzjFeHA5"><div class="marker"></div><span class="inline-wrap">创建<span class="jill"></span>acl</span><code-block id="hLEg1Xk52Jw431zk7amZgy" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span><span class="token operator">></span> <span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">06.30</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">/</span>tpg1<span class="token operator">/</span>acls create iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">06.30</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">:</span>ora1</pre></div></code-block></li><li id="kDhZEfkeeU5F7vFU8n51gm"><div class="marker"></div><span class="inline-wrap">退出</span><code-block id="kbwjsmFh6sqZVWF5oAnBKA" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span><span class="token operator">></span> exit
<span class="token maybe-class-name">Global</span> pref auto_save_on_exit<span class="token operator">=</span><span class="token boolean">true</span>
<span class="token maybe-class-name">Configuration</span> saved to <span class="token operator">/</span>etc<span class="token operator">/</span>target<span class="token operator">/</span>saveconfig<span class="token punctuation">.</span><span class="token property-access">json</span></pre></div></code-block></li><li id="wi8GLsn4K8SmHnB6Qkhhzs"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="dn5g9uL2xMeyoehNz1dWFt" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl restart target</pre></div></code-block><div id="uSrg6swTjvLsaf7hbF5aMU" class="wolai-block wolai-text"><div><span class="inline-wrap">注：此时会有端口开放</span></div></div><code-block id="xyWskgfahB8uGVvReXBHhV" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 <span class="token operator">~</span><span class="token punctuation">]</span># netstat <span class="token operator">-</span>tunlp <span class="token operator">|</span>grep <span class="token number">3260</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">3260</span>            <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token operator">*</span>               <span class="token constant">LISTEN</span>      <span class="token operator">-</span> </pre></div></code-block></li></ol><h2 id="42PjvMpKERAQ75PWCTrCjo" class="wolai-block"><span class="inline-wrap">2、配置<span class="jill"></span>iscsi<span class="jill"></span>客户端</span></h2><ol class="wolai-block"><li id="bbwiYPsnAkwFhafVRXwjYZ"><div class="marker"></div><span class="inline-wrap">安装</span><code-block id="dZExWMgRuj19VbybNbVhqz" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> iscsi*</pre></div></code-block></li><li id="d6kHtBQxKsYJMT7oJ5S8yd"><div class="marker"></div><span class="inline-wrap">开机自启</span><code-block id="cAmtpqFo7s1G4giRaiTuhY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl <span class="token builtin class-name">enable</span> iscsid</pre></div></code-block></li><li id="1R4WkuMthPYbjHFtYRs6xX"><div class="marker"></div><span class="inline-wrap">发现<span class="jill"></span>target</span><span class="inline-wrap">
</span><span class="inline-wrap">注：有输出才是被发现，-p 后面的参数是<span class="jill"></span>iscsi<span class="jill"></span>服务端的<span class="jill"></span>ip</span><code-block id="d77jCPDbzzyDBryE93V2or" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># iscsiadm -m discovery -t st -p 192.168.3.64</span>
<span class="token number">192.168</span>.3.64:3260,1 iqn.2021-06.30.com.oracle</pre></div></code-block></li><li id="1H3fiNgSmaYEZwdwBBUbyr"><div class="marker"></div><span class="inline-wrap">修改/etc/iscsi/initiatorname.iscsi</span><code-block id="vmwSdZPrvEbhrRR3js8JN5" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">InitiatorName</span><span class="token operator">=</span>iqn.2021-06.30.com.oracle:ora1</pre></div></code-block></li><li id="shqUgXVDGGt81XALFfWgWw"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="asD7gBmCTT4dz2eqjTgGaD" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl restart iscsid</pre></div></code-block></li><li id="17gcanss6shewDpmYRiWtn"><div class="marker"></div><span class="inline-wrap">登录</span><span class="inline-wrap">
</span><span class="inline-wrap">注：需要发现后，才能登陆</span><code-block id="t4R7yuRQUsBkKgsQS8rcKj" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">iscsiadm <span class="token parameter variable">-m</span> <span class="token function">node</span> <span class="token parameter variable">-T</span> iqn.2021-06.30.com.oracle <span class="token parameter variable">-p</span> <span class="token number">192.168</span>.3.64 <span class="token parameter variable">-l</span></pre></div></code-block><div id="aZZenxpH6L3iCyDQsuTkNR" class="wolai-block wolai-text"><div><span class="inline-wrap">如果在主机<span class="jill"></span>A<span class="jill"></span>格式化了共享盘，在<span class="jill"></span>B<span class="jill"></span>上其实有了，但可能需要重新登录后，才能在</span><span class="inline-wrap"><code>lsblk</code></span><span class="inline-wrap">中看见，不登录也可以直接用格式化的磁盘</span></div></div></li><li id="opQmcuPWoATKRMnQQSShX3"><div class="marker"></div><span class="inline-wrap">检查,其中<span class="jill"></span>sdc,sdd,sde<span class="jill"></span>就是我们共享盘啦</span><code-block id="rfNCzSYNqqbBktCQty8Yt6" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
├─sdb1            <span class="token number">8</span>:17   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
├─sdb2            <span class="token number">8</span>:18   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
└─sdb3            <span class="token number">8</span>:19   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>    6G  <span class="token number">0</span> disk 
sdd               <span class="token number">8</span>:48   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
sde               <span class="token number">8</span>:64   <span class="token number">0</span>    6G  <span class="token number">0</span> disk 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom  
loop0             <span class="token number">7</span>:0    <span class="token number">0</span>  <span class="token number">4</span>.5G  <span class="token number">1</span> loop /mnt/iso</pre></div></code-block></li><li id="bS4r6NvqMBF6kK74kyziEd"><div class="marker"></div><span class="inline-wrap">在节点一分区（），并在节点二重新登录</span><span class="inline-wrap">
</span><span class="inline-wrap">节点一：</span><code-block id="uZhNk3oQPBZpfLppC9KzVa" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdc</span>

命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Partition type:p
分区号 <span class="token punctuation">(</span><span class="token number">1</span>-4，默认 <span class="token number">1</span><span class="token punctuation">)</span>：1
起始 扇区 <span class="token punctuation">(</span><span class="token number">2048</span>-13978965，默认为 <span class="token number">2048</span><span class="token punctuation">)</span>：2048
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">2048</span>-13978965，默认为 <span class="token number">13978965</span><span class="token punctuation">)</span>：13978965
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：w
The partition table has been altered<span class="token operator">!</span>
正在同步磁盘。

<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdd</span>
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Partition type:
   p   primary <span class="token punctuation">(</span><span class="token number">0</span> primary, <span class="token number">0</span> extended, <span class="token number">4</span> <span class="token function">free</span><span class="token punctuation">)</span>
   e   extended
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: 
起始 扇区 <span class="token punctuation">(</span><span class="token number">2048</span>-13980330，默认为 <span class="token number">2048</span><span class="token punctuation">)</span>：
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">2048</span>-13980330，默认为 <span class="token number">13980330</span><span class="token punctuation">)</span>：
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：w
The partition table has been altered<span class="token operator">!</span>
正在同步磁盘。

<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sde</span>
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Partition type:
分区号 <span class="token punctuation">(</span><span class="token number">1</span>-4，默认 <span class="token number">1</span><span class="token punctuation">)</span>：1
起始 扇区 <span class="token punctuation">(</span><span class="token number">2048</span>-13979647，默认为 <span class="token number">2048</span><span class="token punctuation">)</span>：2048
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">2048</span>-13979647，默认为 <span class="token number">13979647</span><span class="token punctuation">)</span>：13979647
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：w
The partition table has been altered<span class="token operator">!</span>
正在同步磁盘。</pre></div></code-block><div id="wPWMtZnSKBEHyfro4cE5kZ" class="wolai-block wolai-text"><div><span class="inline-wrap">节点二：</span></div></div><code-block id="48dRNJXkkVGfrhwAScZovb" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 注销</span>
<span class="token punctuation">[</span>root@ora2 ~<span class="token punctuation">]</span><span class="token comment"># iscsiadm -m node -T iqn.2021-06.30.com.oracle -p 192.168.3.64 -u</span>
Logging out of session <span class="token punctuation">[</span>sid: <span class="token number">6</span>, target: iqn.2021-06.30.com.oracle, portal: <span class="token number">192.168</span>.3.64,3260<span class="token punctuation">]</span>
Logout of <span class="token punctuation">[</span>sid: <span class="token number">6</span>, target: iqn.2021-06.30.com.oracle, portal: <span class="token number">192.168</span>.3.64,3260<span class="token punctuation">]</span> successful.
<span class="token comment"># 重新登录</span>
<span class="token punctuation">[</span>root@ora2 ~<span class="token punctuation">]</span><span class="token comment"># iscsiadm -m node -T iqn.2021-06.30.com.oracle -p 192.168.3.64 -l</span>
Logging <span class="token keyword">in</span> to <span class="token punctuation">[</span>iface: default, target: iqn.2021-06.30.com.oracle, portal: <span class="token number">192.168</span>.3.64,3260<span class="token punctuation">]</span> <span class="token punctuation">(</span>multiple<span class="token punctuation">)</span>
Login to <span class="token punctuation">[</span>iface: default, target: iqn.2021-06.30.com.oracle, portal: <span class="token number">192.168</span>.3.64,3260<span class="token punctuation">]</span> successful.
<span class="token comment"># 可以看到磁盘被分区了</span>
<span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk 
├─sda1            <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part /boot
└─sda2            <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part 
  ├─centos-root <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm  /
  └─centos-swap <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm  <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb               <span class="token number">8</span>:16   <span class="token number">0</span>   20G  <span class="token number">0</span> disk 
├─sdb1            <span class="token number">8</span>:17   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
├─sdb2            <span class="token number">8</span>:18   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
└─sdb3            <span class="token number">8</span>:19   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sdc               <span class="token number">8</span>:32   <span class="token number">0</span>    6G  <span class="token number">0</span> disk 
└─sdc1            <span class="token number">8</span>:33   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
sdd               <span class="token number">8</span>:48   <span class="token number">0</span>    8G  <span class="token number">0</span> disk 
└─sdd1            <span class="token number">8</span>:49   <span class="token number">0</span>    8G  <span class="token number">0</span> part 
sde               <span class="token number">8</span>:64   <span class="token number">0</span>    6G  <span class="token number">0</span> disk 
└─sde1            <span class="token number">8</span>:65   <span class="token number">0</span>    6G  <span class="token number">0</span> part 
sr0              <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom  
loop0             <span class="token number">7</span>:0    <span class="token number">0</span>  <span class="token number">4</span>.5G  <span class="token number">1</span> loop /mnt/iso</pre></div></code-block></li></ol><h2 id="xpV2qsjnZGVSeF8Pgcpd96" class="wolai-block"><span class="inline-wrap">3、配置多路径</span></h2><div id="6iZxiLzQsnoK4C4bwQYqLQ" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文档：</span></div></div><div id="waZVRoUhRSZNRFYgtpXmes" class="wolai-bookmark wolai-block"><a href="https://www.huaweicloud.com/articles/14b07cc5cc28d2bc19d3b6330ed05f09.html">很抱歉，您访问的页面已下线-华为云</a><div class="info-box"><div class="text-pane"><div data-title="很抱歉，您访问的页面已下线-华为云"></div><div data-desc="很抱歉，您访问的页面已下线"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://www.huaweicloud.com/favicon.ico&quot;)"></div><div data-hostname="www.huaweicloud.com"></div></div></div><div class="preview-pane"></div></div></div><div id="dKTLDTmcA75ggbghRzJQgZ" class="wolai-bookmark wolai-block"><a href="https://blog.csdn.net/cuiyan1982/article/details/79082805">Oracle RAC 搭建——使用多路径（Multipath）_oracle rac 判断是否使用多路径_叽哩古哩的博客-CSDN博客</a><div class="info-box"><div class="text-pane"><div data-title="Oracle RAC 搭建——使用多路径（Multipath）_oracle rac 判断是否使用多路径_叽哩古哩的博客-CSDN博客"></div><div data-desc="原文地址：http://blog.163.com/donfang_jianping/blog/static/136473951201410228567115/在http://blog.163.com/donfang_jianping/blog/static/136473951201311111384468/，http://blog.163.com/donfang_jianping/blog_ora"></div><div class="icon-host"><div class="icon icon-image" style="background-image: url(&quot;https://g.csdnimg.cn/static/logo/favicon32.ico&quot;)"></div><div data-hostname="blog.csdn.net"></div></div></div><div class="preview-pane"></div></div></div><ol class="wolai-block"><li id="aokVAiseBfBnAZF1VwyaLx"><div class="marker"></div><span class="inline-wrap">安装软件</span><code-block id="jq9U6Qs97N4P4dQH31nPyy" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">yum install device<span class="token operator">-</span>mapper<span class="token operator">*</span> <span class="token operator">-</span>y</pre></div></code-block></li><li id="1GdoZryEVHiT78gszzFhqj"><div class="marker"></div><span class="inline-wrap">启用模块</span><code-block id="ufwC3fwDGyszxcHLxBHsnb" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> modprobe dm<span class="token operator">-</span>multipath
 modprobe dm<span class="token operator">-</span>round<span class="token operator">-</span>robin</pre></div></code-block></li><li id="mAgeo5oocEhzjaQkwYy5X2"><div class="marker"></div><span class="inline-wrap">查看是否启用</span><code-block id="8YLcTKupNpPa9KmActXuZn" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># lsmod | grep ^dm_m[uo]</span>
dm_multipath           <span class="token number">27792</span>  <span class="token number">1</span> dm_round_robin
dm_mod                <span class="token number">124501</span>  <span class="token number">9</span> dm_multipath,dm_log,dm_mirror</pre></div></code-block></li><li id="fpGrMDtaB4DtE5uFZto6qj"><div class="marker"></div><span class="inline-wrap">生成<span class="jill"></span>Multipath<span class="jill"></span>而配置文件</span><code-block id="8ZuEgerzXtGrmNKeNMWki4" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> mpathconf <span class="token operator">--</span>enable <span class="token operator">--</span>find_multipaths y <span class="token operator">--</span>with_module y <span class="token operator">--</span>with_multipathd y</pre></div></code-block></li><li id="5FFn16DF5PmtcLw4SunjZ1"><div class="marker"></div><span class="inline-wrap">添加共享磁盘的<span class="jill"></span>wwid</span><code-block id="owpBrmAerrqE6DmpwBMWZE" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 将添加到/etc/multipath/wwid</span>
<span class="token punctuation">[</span>root@ora2 multipath<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdb</span>
wwid <span class="token string">'3600140579f3599c229346da8e86734e4'</span> added
<span class="token punctuation">[</span>root@ora2 multipath<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdc</span>
wwid <span class="token string">'36001405faacac4444884193b7de477e6'</span> added
<span class="token punctuation">[</span>root@ora2 multipath<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdd</span>
wwid <span class="token string">'36001405c8e49d885e6843d9bdc448d26'</span> added</pre></div></code-block></li><li id="29y8dzF8xyf5pTGVzwBLoP"><div class="marker"></div><span class="inline-wrap">修改/etc/multipath.conf<span class="jill"></span>配置文件</span><span class="inline-wrap">
</span><span class="inline-wrap"><a href="https://www.cnblogs.com/azyb/p/10809490.html"><span>多路径配置文件详解</span></a></span><code-block id="jrxmGHJD8H8SkfJa9d9qA2" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">defaults <span class="token punctuation">{</span>
        user_friendly_names yes
        # 启用多路径策略
        path_grouping_policy multibus 
        find_multipaths yes
        path_selector <span class="token string">"round-robin 0"</span>
        failback manual
        rr_weight priorities
        no_path_retry <span class="token number">5</span>
<span class="token punctuation">}</span>

# 将本地磁盘排除
blacklist <span class="token punctuation">{</span>
       devnode <span class="token string">"^sd[ab]"</span> 
       devnode <span class="token string">"sr0"</span>
<span class="token punctuation">}</span>
multipaths <span class="token punctuation">{</span>
       multipath <span class="token punctuation">{</span>
              # 根据multipath <span class="token operator">-</span>a <span class="token operator">/</span>dev<span class="token operator">/</span>命令输出的wwid
              # 或根据<span class="token operator">/</span>lib<span class="token operator">/</span>udev<span class="token operator">/</span>scsi_id <span class="token operator">-</span>g <span class="token operator">-</span>u <span class="token operator">/</span>dev<span class="token operator">/</span>sdb 中每个磁盘的<span class="token constant">WWID</span>来对应
              wwid 3600140579f3599c229346da8e86734e4
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">OCRVOTE</span> 
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405faacac4444884193b7de477e6
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">FRA</span>
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405c8e49d885e6843d9bdc448d26
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">DATA</span>
       <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="326ZXtqAbR5HZdbeoKkhT6"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="9dCYqq4zYJaxpNevYgAazH" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl restart multipathd</pre></div></code-block></li><li id="vBXNzzjoeK7DSqd6mpvbMW"><div class="marker"></div><span class="inline-wrap">检查</span><span class="inline-wrap">
</span><span class="inline-wrap">此时查看</span><span class="inline-wrap"><code>multipath -v3 | grep &quot;not in wwids file, skipping&quot; </code></span><span class="inline-wrap">，没有报错。</span><span class="inline-wrap">
</span><span class="inline-wrap">查看</span><code-block id="9H1YvfRAs8BuaxRxXRZteM" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># ll /dev/mapper/</span>
总用量 <span class="token number">0</span>
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:13 centos-root -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-0
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:13 centos-swap -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-1
crw------- <span class="token number">1</span> root root <span class="token number">10</span>, <span class="token number">236</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:13 control
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:32 RAC-DATA -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-4
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:32 RAC-DATA1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-7
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:32 RAC-FRA -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-2
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:32 RAC-FRA1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-5
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:32 RAC-OCRVOTE -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-3
lrwxrwxrwx <span class="token number">1</span> root root       <span class="token number">7</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">13</span>:32 RAC-OCRVOTE1 -<span class="token operator">></span> <span class="token punctuation">..</span>/dm-6</pre></div></code-block><div id="hi66wCSZH6bQhS1QjCNAJL" class="wolai-block wolai-text"><div><span class="inline-wrap">查看</span></div></div><code-block id="xrzcowrEksSxzJW2ee9noc" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># multipathd show paths</span>
hcil    dev dev_t pri dm_st  chk_st dev_st  next_check     
<span class="token number">3</span>:0:0:2 sdd <span class="token number">8</span>:48  <span class="token number">1</span>   active ready  running <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token number">1</span>/20
<span class="token number">3</span>:0:0:0 sdc <span class="token number">8</span>:32  <span class="token number">1</span>   active ready  running <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token number">1</span>/20
<span class="token number">3</span>:0:0:1 sde <span class="token number">8</span>:64  <span class="token number">1</span>   active ready  running <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token number">1</span>/20</pre></div></code-block><div id="hX8bAvF3mCtrAUGd8hurq8" class="wolai-block wolai-text"><div><span class="inline-wrap">到此<span class="jill"></span>multipath 配置完成！</span></div></div></li></ol><h2 id="198uMF75gSWSkycGLTdvdf" class="wolai-block"><span class="inline-wrap">4、配置<span class="jill"></span>udev</span></h2><div id="fzanzYXc1tNisxxnUmbJJW" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文档：</span><span class="inline-wrap"><a href="http://blog.itpub.net/25469263/viewspace-2156439/"><span>udev<span class="jill"></span>简介及配置</span></a></span></div></div><div id="ib2Dijvo6qS25NetCgd1KG" class="wolai-block wolai-text"><div><span class="inline-wrap">通过<span class="jill"></span>UDEV<span class="jill"></span>配置，能够让<span class="jill"></span>Oracle<span class="jill"></span>对磁盘名进行持久化并改变磁盘访问权限为<span class="jill"></span>grid:asmadmin。这样在<span class="jill"></span>ASM<span class="jill"></span>的配置过程中能够看到磁盘。今后增加磁盘也不会改变原有的磁盘名称。该步骤可使用<span class="jill"></span>ASMLIB</span></div></div><ol class="wolai-block"><li id="4FUjM2DwSY48phBaXEfJ27"><div class="marker"></div><span class="inline-wrap">根据共享盘查看<span class="jill"></span>dm_uuid</span><code-block id="2zmwfySTGjPXGgPLNUcUfW" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> <span class="token punctuation">[</span>root@ora1 ~<span class="token punctuation">]</span><span class="token comment"># for i in RAC-OCRVOTE1 RAC-DATA1 RAC-FRA1; do</span>
 <span class="token builtin class-name">printf</span> <span class="token string">"%s %s<span class="token entity" title="\n">\n</span>"</span> <span class="token string">"<span class="token variable">$i</span>"</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>udevadm info <span class="token parameter variable">--query</span><span class="token operator">=</span>all <span class="token parameter variable">--name</span><span class="token operator">=</span>/dev/mapper/$i <span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-o</span> dm_uuid.*<span class="token variable">)</span></span>"</span><span class="token punctuation">;</span> 
 <span class="token keyword">done</span>

RAC-OCRVOTE1 <span class="token assign-left variable">DM_UUID</span><span class="token operator">=</span>part1-mpath-3600140579f3599c229346da8e86734e4
RAC-DATA1 <span class="token assign-left variable">DM_UUID</span><span class="token operator">=</span>part1-mpath-36001405c8e49d885e6843d9bdc448d26
RAC-FRA1 <span class="token assign-left variable">DM_UUID</span><span class="token operator">=</span>part1-mpath-36001405faacac4444884193b7de477e6</pre></div></code-block></li><li id="9GPjL9s38p32pjJ4Tzj5LP"><div class="marker"></div><span class="inline-wrap">添加<span class="jill"></span>udev<span class="jill"></span>规则</span><span class="inline-wrap">
</span><span class="inline-wrap">编辑/etc/udev/rules.d/99-oracle-asmdevices.rules</span><span class="inline-wrap">
</span><span class="inline-wrap">ENV{DM_UUID}==&quot;&quot;依次为上诉查找的结果，SYMLINK（该名称作为/dev/.....）依次为</span><span class="inline-wrap"><b>asm-ocrvote</b></span><span class="inline-wrap">，</span><span class="inline-wrap"><b>asm-data</b></span><span class="inline-wrap">，</span><span class="inline-wrap"><b>asm-fra</b></span><code-block id="rpyqtSt5MsZ8GVGmHoJhGd" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 模板</span>
<span class="token comment"># KERNEL=="dm-*",SYMLINK+="",ENV{DM_UUID}=="",OWNER="grid",GROUP="asmadmin",MODE="0660"</span>
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"part1-mpath-3600140579f3599c229346da8e86734e4"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"asm-ocrvote"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span>
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"part1-mpath-36001405c8e49d885e6843d9bdc448d26"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"asm-data"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span>
<span class="token assign-left variable">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span>,ENV<span class="token punctuation">{</span>DM_UUID<span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"part1-mpath-36001405faacac4444884193b7de477e6"</span>,SYMLINK<span class="token operator">+=</span><span class="token string">"asm-fra"</span>,OWNER<span class="token operator">=</span><span class="token string">"grid"</span>,GROUP<span class="token operator">=</span><span class="token string">"asmadmin"</span>,MODE<span class="token operator">=</span><span class="token string">"0660"</span></pre></div></code-block></li><li id="7wHuyQbNnEk9GxhDcm7bvz"><div class="marker"></div><span class="inline-wrap">双节点添加完规则后,重启<span class="jill"></span>udev<span class="jill"></span>服务</span><code-block id="g9ZU7D8AZmBTU5n6WDBrjd" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">udevadm control --reload-rules
udevadm trigger <span class="token parameter variable">--type</span><span class="token operator">=</span>devices <span class="token parameter variable">--action</span><span class="token operator">=</span>change</pre></div></code-block></li><li id="vwJmwKkJZhdtxKiCUzbBU7"><div class="marker"></div><span class="inline-wrap">测试文件是否生效</span><span class="inline-wrap">
</span><span class="inline-wrap">在查看</span><span class="inline-wrap"><code>ll /dev/mapper/</code></span><span class="inline-wrap">时，能够发现</span><span class="inline-wrap"><code>RAC-FRA1 -&gt; ../dm-5</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>RAC-OCRVOTE1 -&gt; ../dm-6</code></span><span class="inline-wrap">，</span><span class="inline-wrap"><code>RAC-DATA1 -&gt; ../dm-7</code></span><span class="inline-wrap">，针对<span class="jill"></span>dm-5、dm-6、dm-7<span class="jill"></span>进行查看。</span><code-block id="sfEPxD8hyMy2eing5KhJ12" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">udevadm test <span class="token operator">/</span>sys<span class="token operator">/</span>block<span class="token operator">/</span>dm<span class="token operator">-</span><span class="token number">5</span></pre></div></code-block><div id="vWBMM8MvagR8e6HdAbZ71u" class="wolai-block wolai-text"><div><span class="inline-wrap">查看权限分配是否正确</span></div></div><code-block id="e4G8QQ8XKMnRyM78Ms6qYD" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>root@ora1 rules.d<span class="token punctuation">]</span><span class="token comment"># ll /dev/dm-5</span>
brw-rw---- <span class="token number">1</span> grid asmadmin <span class="token number">253</span>, <span class="token number">5</span> <span class="token number">7</span>月   <span class="token number">4</span> <span class="token number">14</span>:06 /dev/dm-5</pre></div></code-block></li></ol><h1 id="uNfX9TARpM27tgG1qQngDN" class="wolai-block"><span class="inline-wrap">三、安装<span class="jill"></span>Grid Infrastructure</span></h1><div id="dscBJ1VL3CckEPK9Z6pWnP" class="wolai-block wolai-text"><div><span class="inline-wrap">标题无特殊特殊说明的步骤，均使用<span class="jill"></span>grid<span class="jill"></span>用户执行</span></div></div><h2 id="jDC22JaVN3fw8Buxgx6itb" class="wolai-block"><span class="inline-wrap">1、grid<span class="jill"></span>用户互信</span></h2><div id="upDc9vYv9q39wigbkzoHLP" class="wolai-block wolai-text"><div><span class="inline-wrap">配置<span class="jill"></span>RAC<span class="jill"></span>的节点互信，注：在主节点执行一次即可，验证互信的方式：</span><span class="inline-wrap"><code>ssh 主机名 date</code></span><span class="inline-wrap">，能免密执行。</span></div></div><code-block id="s3vPjpuFCP1vHUYViE6uEG" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">sshsetup/sshUserSetup.sh <span class="token parameter variable">-hosts</span> <span class="token string">"ora1 ora2"</span> <span class="token parameter variable">-user</span> grid <span class="token parameter variable">-advanced</span> <span class="token parameter variable">-noPromptPassphrase</span></pre></div></code-block><h2 id="9oTnv7EWB8p9R782LF7ERd" class="wolai-block"><span class="inline-wrap">2、配置<span class="jill"></span>GI</span></h2><ol class="wolai-block"><li id="5WEHdqmg4Y5psBtMoXpFhP"><div class="marker"></div><span class="inline-wrap">执行检查</span><code-block id="gs5QHwJTdCXLJuQEtWyko7" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./runcluvfy.sh stage <span class="token parameter variable">-pre</span> crsinst <span class="token parameter variable">-n</span> ora1,ora2 <span class="token parameter variable">-fixup</span> <span class="token parameter variable">-verbose</span></pre></div></code-block></li><li id="jLTEgHnvGH6HvYCUr4ScS4"><div class="marker"></div><span class="inline-wrap">修改<span class="jill"></span>response/grid_install.rsp</span><span class="inline-wrap">
</span><span class="inline-wrap">注：主节点修改该文件即可，其他节点将被复制安装文件</span><code-block id="rNcgF4v6j8gr54qoH92jou" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token key attr-name">oracle.install.responseFileVersion</span><span class="token punctuation">=</span><span class="token value attr-value">/oracle/install/rspfmt_crsinstall_response_schema_v11_2_0</span>
<span class="token comment"># 主机名</span>
<span class="token key attr-name">ORACLE_HOSTNAME</span><span class="token punctuation">=</span><span class="token value attr-value">ora1</span>
<span class="token comment"># INVENTORY 目录</span>
<span class="token key attr-name">INVENTORY_LOCATION</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/grid/oraInventory</span>
<span class="token key attr-name">SELECTED_LANGUAGES</span><span class="token punctuation">=</span><span class="token value attr-value">en</span>
<span class="token key attr-name">oracle.install.option</span><span class="token punctuation">=</span><span class="token value attr-value">CRS_CONFIG</span>
<span class="token comment"># ORACLE_HOME:不能在ORACLE_BASE之下且不相同</span>
<span class="token key attr-name">ORACLE_BASE</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/grid/base</span>
<span class="token key attr-name">ORACLE_HOME</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/grid/home</span>
<span class="token key attr-name">oracle.install.asm.OSDBA</span><span class="token punctuation">=</span><span class="token value attr-value">asmdba</span>
<span class="token key attr-name">oracle.install.asm.OSOPER</span><span class="token punctuation">=</span><span class="token value attr-value">asmoper</span>
<span class="token key attr-name">oracle.install.asm.OSASM</span><span class="token punctuation">=</span><span class="token value attr-value">asmadmin</span>
<span class="token comment"># scanName:scan ip</span>
<span class="token key attr-name">oracle.install.crs.config.gpnp.scanName</span><span class="token punctuation">=</span><span class="token value attr-value">ora-scan</span>
<span class="token key attr-name">oracle.install.crs.config.gpnp.scanPort</span><span class="token punctuation">=</span><span class="token value attr-value">1521</span>
<span class="token comment"># cluster Name:集群名</span>
<span class="token key attr-name">oracle.install.crs.config.clusterName</span><span class="token punctuation">=</span><span class="token value attr-value">rac</span>
<span class="token key attr-name">oracle.install.crs.config.gpnp.configureGNS</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.crs.config.gpnp.gnsSubDomain</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.crs.config.gpnp.gnsVIPAddress</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.crs.config.autoConfigureClusterNodeVIP</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token comment"># cluster node:前者公网，后者VIP</span>
<span class="token key attr-name">oracle.install.crs.config.clusterNodes</span><span class="token punctuation">=</span><span class="token value attr-value">ora1:ora1-vip,ora2:ora2-vip</span>
<span class="token comment"># networkInterfaceList:填写网关,前者公网，后者私网，均为真实网卡，填写该IP的网段号，接口3是未被使用</span>
<span class="token key attr-name">oracle.install.crs.config.networkInterfaceList</span><span class="token punctuation">=</span><span class="token value attr-value">eth0:192.168.0.0:1,eth5:192.168.122.0:2</span>
<span class="token key attr-name">oracle.install.crs.config.storageOption</span><span class="token punctuation">=</span><span class="token value attr-value">ASM_STORAGE</span>
<span class="token key attr-name">oracle.install.crs.config.sharedFileSystemStorage.diskDriveMapping</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.crs.config.sharedFileSystemStorage.votingDiskLocations</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.crs.config.sharedFileSystemStorage.votingDiskRedundancy</span><span class="token punctuation">=</span><span class="token value attr-value">NORMAL</span>
<span class="token key attr-name">oracle.install.crs.config.sharedFileSystemStorage.ocrLocations</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.crs.config.sharedFileSystemStorage.ocrRedundancy</span><span class="token punctuation">=</span><span class="token value attr-value">NORMAL</span>
<span class="token key attr-name">oracle.install.crs.config.useIPMI</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.crs.config.ipmi.bmcUsername</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.crs.config.ipmi.bmcPassword</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.asm.SYSASMPassword</span><span class="token punctuation">=</span><span class="token value attr-value">Oracle123</span>
<span class="token comment"># 表决盘</span>
<span class="token key attr-name">oracle.install.asm.diskGroup.name</span><span class="token punctuation">=</span><span class="token value attr-value">OCRVOTE</span>
<span class="token comment"># NORMAL模式需要指定三块，EXTERNAL模式只需要制定一块盘</span>
<span class="token comment"># 剩下2块盘，留作创建磁盘组</span>
<span class="token key attr-name">oracle.install.asm.diskGroup.redundancy</span><span class="token punctuation">=</span><span class="token value attr-value">EXTERNAL</span>
<span class="token key attr-name">oracle.install.asm.diskGroup.AUSize</span><span class="token punctuation">=</span><span class="token value attr-value">1</span>
<span class="token comment"># 指定表决盘盘路径,根据ll /dev/RAC-ORAVOTE指向的路径</span>
<span class="token key attr-name">oracle.install.asm.diskGroup.disks</span><span class="token punctuation">=</span><span class="token value attr-value">/dev/dm-7</span>
<span class="token comment"># 发现其他asm磁盘</span>
<span class="token key attr-name">oracle.install.asm.diskGroup.diskDiscoveryString</span><span class="token punctuation">=</span><span class="token value attr-value">/dev/dm-*</span>
<span class="token comment"># password</span>
<span class="token key attr-name">oracle.install.asm.monitorPassword</span><span class="token punctuation">=</span><span class="token value attr-value">Oracle123</span>
<span class="token key attr-name">oracle.install.crs.upgrade.clusterNodes</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.asm.upgradeASM</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.installer.autoupdates.option</span><span class="token punctuation">=</span><span class="token value attr-value">SKIP_UPDATES</span>
<span class="token key attr-name">oracle.installer.autoupdates.downloadUpdatesLoc</span><span class="token punctuation">=</span>
<span class="token key attr-name">AUTOUPDATES_MYORACLESUPPORT_USERNAME</span><span class="token punctuation">=</span>
<span class="token key attr-name">AUTOUPDATES_MYORACLESUPPORT_PASSWORD</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_HOST</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_PORT</span><span class="token punctuation">=</span><span class="token value attr-value">0</span>
<span class="token key attr-name">PROXY_USER</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_PWD</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_REALM</span><span class="token punctuation">=</span></pre></div></code-block></li><li id="euGswdYHdXdfD3oY8QGvXW"><div class="marker"></div><span class="inline-wrap">进入安装文件夹，并执行下列命令，开始静默安装（约十分钟）</span><span class="inline-wrap">
</span><span class="inline-wrap">注：通过</span><span class="inline-wrap"><code>echo $?</code></span><span class="inline-wrap">是否返回</span><span class="inline-wrap"><code>0</code></span><span class="inline-wrap">来判断安装成功，一般出现</span><span class="inline-wrap"><code>CAUSE: </code></span><span class="inline-wrap">就是失败了</span><code-block id="ueRAJTiqyBzJEXWfdH4JVC" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./runInstaller <span class="token parameter variable">-ignorePrereq</span> <span class="token parameter variable">-silent</span> <span class="token parameter variable">-force</span> <span class="token parameter variable">-responseFile</span> <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/response/grid_install.rsp  <span class="token parameter variable">-showprogress</span></pre></div></code-block><div id="jZzcSQNQjQqw5Cp1Nhkry6" class="wolai-block wolai-text"><div><span class="inline-wrap">注：图形化安装窗口异常的问题解决命令：</span><span class="inline-wrap"><code>./runInstaller -jreLoc /etc/alternatives/jre_1.8.0</code></span></div></div></li></ol><h2 id="iTmSJQPgoqZRXz5kVrBHQg" class="wolai-block"><span class="inline-wrap">3、关于执行<span class="jill"></span>root.sh<span class="jill"></span>前的补丁<span class="jill"></span>p18370031</span></h2><div id="tXatJZxeDBBvWcM5RbQvkU" class="wolai-block wolai-text"><div><span class="inline-wrap">该脚本针对</span><span class="inline-wrap"><b>CentOS7</b></span><span class="inline-wrap">的服务</span></div></div><ul class="wolai-block"><li id="76DRJuuxcqAxu7HFaZVzFU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">没有补丁的解决方案</span><span class="inline-wrap">
</span><span class="inline-wrap">不打补丁时，执行<span class="jill"></span>root.sh<span class="jill"></span>将提示</span><span class="inline-wrap"><b>Adding Clusterware entries to inittab</b></span><ol class="wolai-block"><li id="7KNPxTBNkAREFt7WfGoU5T"><div class="marker"></div><span class="inline-wrap">编写启动脚本</span><code-block id="9YwrMjupoviPKvaXNTM2Fx" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /usr/lib/systemd/system/ohasd.service</span>
[Unit]
Description=Oracle High Availability Services
After=syslog.target
[Service]
ExecStart=/etc/init.d/init.ohasd run >/dev/null 2>&amp;1 Type=simple
Restart=always
[Install]
WantedBy=multi-user.target
EOF</span></pre></div></code-block></li><li id="gLYexnPbj1KJM3DPtoVni2"><div class="marker"></div><span class="inline-wrap">修改服务</span><code-block id="uUKTf9eAFdCN65m6uBKys6" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">chmod</span> <span class="token number">755</span> /usr/lib/systemd/system/ohasd.service
systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> ohasd.service</pre></div></code-block></li><li id="1aZ7rTqGTCEnYWNhRmSKFz"><div class="marker"></div><span class="inline-wrap">在运行<span class="jill"></span>root.sh<span class="jill"></span>时，</span><span class="inline-wrap"><code>/etc/init.d/</code></span><span class="inline-wrap">目录出现</span><span class="inline-wrap"><code>inint.ohasd</code></span><span class="inline-wrap">时启动服务</span><code-block id="5A22M87XbRCMGTrT5ZyEmi" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">systemctl start ohasd<span class="token punctuation">.</span><span class="token property-access">service</span></pre></div></code-block></li></ol></li><li id="u2sG2n3BLNQPcZkhm9ZgcP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">有补丁的解决方案</span><span class="inline-wrap">
</span><span class="inline-wrap">打补丁后，执行<span class="jill"></span>root.sh<span class="jill"></span>将提示</span><span class="inline-wrap"><b>Adding Clusterware entries to oracle-ohasd.service</b></span><span class="inline-wrap">
</span><span class="inline-wrap">注：节点一打补丁后，根据可以选择是否在其他节点上执行</span><ol class="wolai-block"><li id="cXzzYHBg35ZfwiMQEJZG1J"><div class="marker"></div><span class="inline-wrap">进入补丁目录</span><code-block id="6VCJc1qauU1RUevKb9vkuk" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">cd</span> <span class="token number">18370031</span>/</pre></div></code-block></li><li id="xiJxig6oTh8bPDGudXg1Uk"><div class="marker"></div><span class="inline-wrap">安装补丁</span><span class="inline-wrap">
</span><span class="inline-wrap">安装过程中</span><code-block id="jV5Z8n7i27svXqYyhagbs7" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>grid<span class="token operator">/</span>home<span class="token operator">/</span><span class="token maybe-class-name">OPatch</span><span class="token operator">/</span>opatch apply</pre></div></code-block></li><li id="gdPqRaLPPMpXzoS2mvJXuD"><div class="marker"></div><span class="inline-wrap">检查安装历史记录</span><code-block id="1yU2BoavCm1zYaDQzfYcAP" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>grid<span class="token operator">/</span>home<span class="token operator">/</span><span class="token maybe-class-name">OPatch</span><span class="token operator">/</span>opatch lshistory</pre></div></code-block></li></ol></li></ul><h2 id="pyaQ7F5gH7R6refNepshjj" class="wolai-block"><span class="inline-wrap">4、执行脚本（root<span class="jill"></span>用户执行）</span></h2><ol class="wolai-block"><li id="co5c4fVFZdYb2DZHp1LCVs"><div class="marker"></div><span class="inline-wrap">以<span class="jill"></span>root<span class="jill"></span>用户执行</span><span class="inline-wrap">
</span><span class="inline-wrap">注：第一个节点执行完俩条命令后，再去二个节点执行，务必双节点执行。否则安装数据库找不到没有执行<span class="jill"></span>root.sh<span class="jill"></span>的主机</span><span class="inline-wrap">
</span><span class="inline-wrap">注，出错时多检查日志，执行完毕后可</span><span class="inline-wrap"><code>ehco $?</code></span><span class="inline-wrap">查看返回值，0<span class="jill"></span>则正确</span><code-block id="ePHEhnRcaMkP65g8ruEcZo" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/u01/app/grid/oraInventory/orainstRoot.sh
<span class="token comment"># 约十分钟</span>
/u01/app/grid/home/root.sh</pre></div></code-block><div id="tTZLVzyFUKDN5QNZzEwcNv" class="wolai-block wolai-text"><div><span class="inline-wrap">完美执行脚本<span class="jill"></span>Root.sh 日志如下，仅供参考</span></div></div><code-block id="thac6VD7CxAHVrtubBUXTJ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token maybe-class-name">Creating</span> <span class="token operator">/</span>etc<span class="token operator">/</span>oratab file<span class="token spread operator">...</span>
<span class="token maybe-class-name">Entries</span> will be added to the <span class="token operator">/</span>etc<span class="token operator">/</span>oratab file <span class="token keyword module">as</span> needed by
<span class="token maybe-class-name">Database</span> <span class="token maybe-class-name">Configuration</span> <span class="token maybe-class-name">Assistant</span> when a database is created
<span class="token maybe-class-name">Finished</span> running generic part <span class="token keyword">of</span> root script<span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Now</span></span> product<span class="token operator">-</span>specific root actions will be performed<span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Using</span></span> configuration parameter file<span class="token operator">:</span> <span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>grid<span class="token operator">/</span>home<span class="token operator">/</span>crs<span class="token operator">/</span>install<span class="token operator">/</span>crsconfig_params
<span class="token maybe-class-name">Creating</span> trace directory
<span class="token maybe-class-name">User</span> ignored <span class="token maybe-class-name">Prerequisites</span> during installation
<span class="token maybe-class-name">Installing</span> <span class="token maybe-class-name">Trace</span> <span class="token maybe-class-name">File</span> <span class="token maybe-class-name">Analyzer</span>
<span class="token constant">OLR</span> initialization <span class="token operator">-</span> successful
  root wallet
  root wallet cert
  root cert <span class="token keyword module">export</span>
  peer wallet
  profile reader wallet
  pa wallet
  peer wallet keys
  pa wallet keys
  peer cert request
  pa cert request
  peer cert
  pa cert
  peer root cert <span class="token constant">TP</span>
  profile reader root cert <span class="token constant">TP</span>
  pa root cert <span class="token constant">TP</span>
  peer pa cert <span class="token constant">TP</span>
  pa peer cert <span class="token constant">TP</span>
  profile reader pa cert <span class="token constant">TP</span>
  profile reader peer cert <span class="token constant">TP</span>
  peer user cert
  pa user cert
<span class="token maybe-class-name">Adding</span> <span class="token maybe-class-name">Clusterware</span> entries to oracle<span class="token operator">-</span>ohasd<span class="token punctuation">.</span><span class="token property-access">service</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.mdnsd'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.mdnsd'</span> on <span class="token string">'ora1'</span> succeeded
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.gpnpd'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.gpnpd'</span> on <span class="token string">'ora1'</span> succeeded
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.cssdmonitor'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.gipcd'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.cssdmonitor'</span> on <span class="token string">'ora1'</span> succeeded
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.gipcd'</span> on <span class="token string">'ora1'</span> succeeded
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.cssd'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.diskmon'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.diskmon'</span> on <span class="token string">'ora1'</span> succeeded
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.cssd'</span> on <span class="token string">'ora1'</span> succeeded

已成功创建并启动 <span class="token constant">ASM</span>。

已成功创建磁盘组<span class="token constant">OCRVOTE</span>。

<span class="token literal-property property">clscfg</span><span class="token operator">:</span> <span class="token operator">-</span>install mode specified
<span class="token maybe-class-name">Successfully</span> accumulated necessary <span class="token constant">OCR</span> keys<span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Creating</span></span> <span class="token constant">OCR</span> keys <span class="token keyword control-flow">for</span> user <span class="token string">'root'</span><span class="token punctuation">,</span> privgrp <span class="token string">'root'</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Operation</span></span> successful<span class="token punctuation">.</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">4256</span><span class="token operator">:</span> <span class="token maybe-class-name">Updating</span> the profile
<span class="token maybe-class-name">Successful</span> addition <span class="token keyword">of</span> voting disk 214e1a35dd694f02bf891fa4259699f3<span class="token punctuation">.</span>
<span class="token property-access"><span class="token maybe-class-name">Successfully</span></span> replaced voting disk group <span class="token keyword">with</span> <span class="token operator">+</span><span class="token constant">OCRVOTE</span><span class="token punctuation">.</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">4256</span><span class="token operator">:</span> <span class="token maybe-class-name">Updating</span> the profile
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">4266</span><span class="token operator">:</span> <span class="token maybe-class-name">Voting</span> <span class="token function">file</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> successfully replaced
##  <span class="token constant">STATE</span>    <span class="token maybe-class-name">File</span> <span class="token maybe-class-name">Universal</span> <span class="token maybe-class-name">Id</span>                <span class="token maybe-class-name">File</span> <span class="token maybe-class-name">Name</span> <span class="token maybe-class-name">Disk</span> group
<span class="token operator">--</span>  <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
 <span class="token number">1.</span> <span class="token constant">ONLINE</span>   <span class="token number">214</span><span class="token function">e1a35dd694f02bf891fa4259699f3</span> <span class="token punctuation">(</span><span class="token operator">/</span>dev<span class="token operator">/</span>dm<span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token constant">OCRVOTE</span><span class="token punctuation">]</span>
<span class="token maybe-class-name">Located</span> <span class="token number">1</span> voting <span class="token function">disk</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.asm'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.asm'</span> on <span class="token string">'ora1'</span> succeeded
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2672</span><span class="token operator">:</span> <span class="token maybe-class-name">Attempting</span> to start <span class="token string">'ora.OCRVOTE.dg'</span> on <span class="token string">'ora1'</span>
<span class="token constant">CRS</span><span class="token operator">-</span><span class="token number">2676</span><span class="token operator">:</span> <span class="token maybe-class-name">Start</span> <span class="token keyword">of</span> <span class="token string">'ora.OCRVOTE.dg'</span> on <span class="token string">'ora1'</span> succeeded
软件包准备中<span class="token spread operator">...</span>
cvuqdisk<span class="token operator">-</span><span class="token number">1.0</span><span class="token number">.9</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">.</span><span class="token property-access">x86_64</span>
<span class="token maybe-class-name">Configure</span> <span class="token maybe-class-name">Oracle</span> <span class="token maybe-class-name">Grid</span> <span class="token maybe-class-name">Infrastructure</span> <span class="token keyword control-flow">for</span> a <span class="token maybe-class-name">Cluster</span> <span class="token spread operator">...</span> succeeded</pre></div></code-block></li><li id="oqG8gwbsC49UGDCDYGTSAu"><div class="marker"></div><span class="inline-wrap">在主节点以<span class="jill"></span>grid<span class="jill"></span>用户执行</span><span class="inline-wrap">
</span><span class="inline-wrap">注：plug-in Automatic Storage Management Configuration Assistan<span class="jill"></span>失败关系不大($?返回<span class="jill"></span>3)</span><span class="inline-wrap">
</span><span class="inline-wrap">注：如果不执行该语句，安装数据库时会提示没有安装<span class="jill"></span>GI，因此务必执行。</span><code-block id="ew24m7qXhnynMgbxbRnNK9" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">/u01/app/grid/home/cfgtoollogs/configToolAllCommands <span class="token assign-left variable">RESPONSE_FILE</span><span class="token operator">=</span><span class="token operator">&lt;</span>response_file<span class="token operator">></span></pre></div></code-block><div id="oYtwjmbtkzcXYTBVNmaRtE" class="wolai-block wolai-text"><div><span class="inline-wrap">注：response_file<span class="jill"></span>请使用绝对路径</span></div></div></li></ol><h1 id="fL5cfmR7FbKzQVatWgyzhK" class="wolai-block"><span class="inline-wrap">四、安装并创建数据库</span></h1><h2 id="cVfdv2oeab1jNgBFzsbV6p" class="wolai-block"><span class="inline-wrap">1、安装<span class="jill"></span>oracle<span class="jill"></span>软件（oracle<span class="jill"></span>用户）</span></h2><ol class="wolai-block"><li id="kDd6ysbCo95WFDctecdZ12"><div class="marker"></div><span class="inline-wrap">oracle<span class="jill"></span>用户互信</span><code-block id="nN5WcwCfHwcpmjBxm2SQYs" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token comment"># 进入安装目录</span>
<span class="token builtin class-name">cd</span> database
sshsetup/sshUserSetup.sh <span class="token parameter variable">-hosts</span> <span class="token string">"ora1 ora2"</span> <span class="token parameter variable">-user</span> oracle <span class="token parameter variable">-advanced</span> <span class="token parameter variable">-noPromptPassphrase</span></pre></div></code-block><div id="khCdvuYeKJBjFUz4YFmzbZ" class="wolai-block wolai-text"><div><span class="inline-wrap">注：互信检查方式为：</span><span class="inline-wrap"><code>ssh 主机名 date</code></span><span class="inline-wrap">,能免密执行</span></div></div></li><li id="bx8wAGL3J1N88mMdkAZKKB"><div class="marker"></div><span class="inline-wrap">资源文件操作</span><span class="inline-wrap">
</span><span class="inline-wrap">备份资源文件</span><code-block id="csZRE1JU9os53xNuFhsHha" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">cp</span> response/db_install.rsp response/db_install.rsp.save</pre></div></code-block><div id="je48aaQwdChVNHh137bdQS" class="wolai-block wolai-text"><div><span class="inline-wrap">修改<span class="jill"></span>response/db_install.rsp</span></div></div><code-block id="5VwtdJqSNAtqXDWGzwVU3c" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token key attr-name">oracle.install.responseFileVersion</span><span class="token punctuation">=</span><span class="token value attr-value">/oracle/install/rspfmt_dbinstall_response_schema_v11_2_0</span>
<span class="token key attr-name">oracle.install.option</span><span class="token punctuation">=</span><span class="token value attr-value">INSTALL_DB_SWONLY</span>
<span class="token comment"># hostname</span>
<span class="token key attr-name">ORACLE_HOSTNAME</span><span class="token punctuation">=</span><span class="token value attr-value">ora1</span>
<span class="token key attr-name">UNIX_GROUP_NAME</span><span class="token punctuation">=</span><span class="token value attr-value">oinstall</span>
<span class="token key attr-name">INVENTORY_LOCATION</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oracle/Inventory</span>
<span class="token key attr-name">SELECTED_LANGUAGES</span><span class="token punctuation">=</span><span class="token value attr-value">en</span>
<span class="token comment"># ORACLE_HOME</span>
<span class="token key attr-name">ORACLE_HOME</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oracle/product/11.2.0/db_1</span>
<span class="token key attr-name">ORACLE_BASE</span><span class="token punctuation">=</span><span class="token value attr-value">/u01/app/oracle</span>
<span class="token key attr-name">oracle.install.db.InstallEdition</span><span class="token punctuation">=</span><span class="token value attr-value">EE</span>
<span class="token key attr-name">oracle.install.db.EEOptionsSelection</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.optionalComponents</span><span class="token punctuation">=</span><span class="token value attr-value">oracle.rdbms.partitioning:11.2.0.4.0,oracle.oraolap:11.2.0.4.0,oracle.rdbms.dm:11.2.0.4.0,oracle.rdbms.dv:11.2.0.4.0,o</span>
<span class="token key attr-name">oracle.install.db.DBA_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">dba</span>
<span class="token key attr-name">oracle.install.db.OPER_GROUP</span><span class="token punctuation">=</span><span class="token value attr-value">dba</span>
<span class="token comment"># node</span>
<span class="token key attr-name">oracle.install.db.CLUSTER_NODES</span><span class="token punctuation">=</span><span class="token value attr-value">ora1,ora2</span>
<span class="token key attr-name">oracle.install.db.isRACOneInstall</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.racOneServiceName</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.type</span><span class="token punctuation">=</span><span class="token value attr-value">GENERAL_PURPOSE</span>
<span class="token comment"># globalDBName</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.globalDBName</span><span class="token punctuation">=</span><span class="token value attr-value">racdb</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.SID</span><span class="token punctuation">=</span><span class="token value attr-value">rac</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.characterSet</span><span class="token punctuation">=</span><span class="token value attr-value">AL32UTF8</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.memoryOption</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.memoryLimit</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.installExampleSchemas</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.enableSecuritySettings</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.ALL</span><span class="token punctuation">=</span><span class="token value attr-value">Oracle#123</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.SYS</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.SYSTEM</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.SYSMAN</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.password.DBSNMP</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.control</span><span class="token punctuation">=</span><span class="token value attr-value">DB_CONTROL</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.gridcontrol.gridControlServiceURL</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.automatedBackup.enable</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.automatedBackup.osuid</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.automatedBackup.ospwd</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.storageType</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.fileSystemStorage.dataLocation</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.starterdb.fileSystemStorage.recoveryLocation</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.asm.diskGroup</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.install.db.config.asm.ASMSNMPPassword</span><span class="token punctuation">=</span><span class="token value attr-value">Oracle#123</span>
<span class="token key attr-name">MYORACLESUPPORT_USERNAME</span><span class="token punctuation">=</span>
<span class="token key attr-name">MYORACLESUPPORT_PASSWORD</span><span class="token punctuation">=</span>
<span class="token key attr-name">SECURITY_UPDATES_VIA_MYORACLESUPPORT</span><span class="token punctuation">=</span><span class="token value attr-value">false</span>
<span class="token key attr-name">DECLINE_SECURITY_UPDATES</span><span class="token punctuation">=</span><span class="token value attr-value">true</span>
<span class="token key attr-name">PROXY_HOST</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_PORT</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_USER</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_PWD</span><span class="token punctuation">=</span>
<span class="token key attr-name">PROXY_REALM</span><span class="token punctuation">=</span>
<span class="token key attr-name">COLLECTOR_SUPPORTHUB_URL</span><span class="token punctuation">=</span>
<span class="token key attr-name">oracle.installer.autoupdates.option</span><span class="token punctuation">=</span><span class="token value attr-value">SKIP_UPDATES</span>
<span class="token key attr-name">oracle.installer.autoupdates.downloadUpdatesLoc</span><span class="token punctuation">=</span>
<span class="token key attr-name">AUTOUPDATES_MYORACLESUPPORT_USERNAME</span><span class="token punctuation">=</span>
<span class="token key attr-name">AUTOUPDATES_MYORACLESUPPORT_PASSWORD</span><span class="token punctuation">=</span></pre></div></code-block></li><li id="ecY35pejvbVqukVk9NCJeS"><div class="marker"></div><span class="inline-wrap">节点<span class="jill"></span>1<span class="jill"></span>执行进行安装</span><span class="inline-wrap">
</span><span class="inline-wrap">注：其他远程节点会自动复制，远程节点的<span class="jill"></span>$ORACLE_HOME<span class="jill"></span>大约有<span class="jill"></span>4.2G，可查看进度（大约十五分钟）</span><span class="inline-wrap">
</span><span class="inline-wrap">注：安装之间再检查下<span class="jill"></span>oracle<span class="jill"></span>用户是否属于<span class="jill"></span>dba<span class="jill"></span>组，否则安装失败，会提示</span><span class="inline-wrap"><code> CAUSE: The installation user account must be a member of all groups required for installation.</code></span><span class="inline-wrap">
</span><span class="inline-wrap">注：不要输出</span><span class="inline-wrap"><code>........94% Done</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>Setup files successful.</code></span><span class="inline-wrap">作为安装结束的标志，多等一会。。每个节点的文件大小基本相同，刚出这两条日志时，节点二还没达到<span class="jill"></span>4.2G<span class="jill"></span>的大小</span><code-block id="4mXfiBAvCMvPDmT1r5B8gz" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">./runInstaller <span class="token parameter variable">-ignorePrereq</span> <span class="token parameter variable">-silent</span> <span class="token parameter variable">-force</span> <span class="token parameter variable">-responseFile</span> <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/response/db_install.rsp <span class="token parameter variable">-showProgress</span></pre></div></code-block><div id="xbeQBbZdTPXkJMhzHrYDaB" class="wolai-block wolai-text"><div><span class="inline-wrap">注：每个节点需要有相同文件结构(已实施)</span></div></div></li><li id="p3k18bw8CPYnLoK7EJgiSL"><div class="marker"></div><span class="inline-wrap">HAIP：如果使用云服务器搭建，最好关闭<span class="jill"></span>HAIP，否则会造成无法连接节点的<span class="jill"></span>169.254<span class="jill"></span>地址，节点二的<span class="jill"></span>+ASM2<span class="jill"></span>实例无法启动</span><code-block id="7Eyk7eLRkohJdxinSRhugi" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword module">export</span> <span class="token constant">HAIP_UNSUPPORTED</span><span class="token operator">=</span><span class="token constant">YES</span></pre></div></code-block></li><li id="jdSEFcXsrs6GTjN9oJeqeF"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>root<span class="jill"></span>用户执行<span class="jill"></span>root.sh<span class="jill"></span>脚本</span><code-block id="t6D4FMbyV8csZptwPcUWfh" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">/</span>u01<span class="token operator">/</span>app<span class="token operator">/</span>oracle<span class="token operator">/</span>product<span class="token operator">/</span><span class="token number">11.2</span><span class="token number">.0</span><span class="token operator">/</span>db_1<span class="token operator">/</span>root<span class="token punctuation">.</span><span class="token property-access">sh</span></pre></div></code-block></li></ol><h2 id="6Ys2jzozawv7MEtmL3vUzT" class="wolai-block"><span class="inline-wrap">2、创建磁盘组（grid<span class="jill"></span>用户）</span></h2><ol class="wolai-block"><li id="sVkZHaEhDbyjkFuojm5n3Q"><div class="marker"></div><span class="inline-wrap">以<span class="jill"></span>grid<span class="jill"></span>用户进入<span class="jill"></span>SQLPLUS，其中节点<span class="jill"></span>1<span class="jill"></span>的<span class="jill"></span>ORALCE_SID=+ASM1，节点二的<span class="jill"></span>ORALCE_SID=+ASM2</span><code-block id="6yuRkENJwMRg5pG2ZCtrdi" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> sqlplus <span class="token operator">/</span> <span class="token keyword module">as</span> sysasm</pre></div></code-block></li><li id="mLVR7Tr3L4gqMiSheXaZvG"><div class="marker"></div><span class="inline-wrap">查看当前磁盘组</span><code-block id="7K3F3whMERT4xytkLeNj1T" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"> <span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> group_number<span class="token punctuation">,</span>name<span class="token punctuation">,</span>state<span class="token punctuation">,</span>total_mb<span class="token punctuation">,</span>free_mb <span class="token keyword">from</span> v$asm_diskgroup<span class="token punctuation">;</span>
GROUP_NUMBER NAME                                  STATE            TOTAL_MB    FREE_MB
<span class="token comment">------------ ------------------------------ ----------- ---------- ----------</span>
             <span class="token number">1</span> OCRVOTE                              MOUNTED              <span class="token number">6140</span>         <span class="token number">5744</span></pre></div></code-block></li><li id="32b9bhksJtBaQW23xbfkeA"><div class="marker"></div><span class="inline-wrap">创建磁盘组</span><code-block id="hHr3QgRCjV1ToLRPHbgCEB" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">CREATE</span> DISKGROUP <span class="token keyword">DATA</span> external REDUNDANCY <span class="token keyword">disk</span> <span class="token string">'/dev/dm-6'</span> ATTRIBUTE <span class="token string">'au_size'</span><span class="token operator">=</span><span class="token string">'1M'</span><span class="token punctuation">,</span><span class="token string">'compatible.asm'</span><span class="token operator">=</span><span class="token string">'11.2'</span><span class="token punctuation">;</span>
Diskgroup created<span class="token punctuation">.</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">CREATE</span> DISKGROUP FRA external REDUNDANCY <span class="token keyword">disk</span> <span class="token string">'/dev/dm-5'</span> ATTRIBUTE <span class="token string">'au_size'</span><span class="token operator">=</span><span class="token string">'1M'</span><span class="token punctuation">,</span><span class="token string">'compatible.asm'</span><span class="token operator">=</span><span class="token string">'11.2'</span><span class="token punctuation">;</span>
 Diskgroup created<span class="token punctuation">.</span></pre></div></code-block></li><li id="k6vwNYJD6opmvc6ccMmqBo"><div class="marker"></div><span class="inline-wrap">再次查看当前磁盘组</span><code-block id="6VBUidXaq4frdgm8yyCGgE" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> group_number<span class="token punctuation">,</span>name<span class="token punctuation">,</span>state<span class="token punctuation">,</span>total_mb<span class="token punctuation">,</span>free_mb <span class="token keyword">from</span> v$asm_diskgroup<span class="token punctuation">;</span>

GROUP_NUMBER NAME                                  STATE            TOTAL_MB    FREE_MB
<span class="token comment">------------ ------------------------------ ----------- ---------- ----------</span>
             <span class="token number">1</span> OCRVOTE                              MOUNTED              <span class="token number">6140</span>         <span class="token number">5744</span>
             <span class="token number">2</span> <span class="token keyword">DATA</span>                                  MOUNTED              <span class="token number">6140</span>         <span class="token number">6088</span>
             <span class="token number">3</span> FRA                                  MOUNTED              <span class="token number">8187</span>         <span class="token number">8135</span></pre></div></code-block><div id="x2GnfWejVTPYwDCxsJke1z" class="wolai-block wolai-text"><div><span class="inline-wrap">注：另一节点上也可看到创建的磁盘组</span></div></div></li></ol><h2 id="4U8FvmRcB2Dqnc637jjbCk" class="wolai-block"><span class="inline-wrap">3、安装数据库（oracle<span class="jill"></span>用户）</span></h2><ol class="wolai-block"><li id="2qKnW2fA6eg35pB95J1ZSu"><div class="marker"></div><span class="inline-wrap">备份资源文件</span><code-block id="cJF7bcJPNNVkiyDdW6gieP" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token builtin class-name">cd</span> <span class="token variable">$ORACLE_HOME</span>
<span class="token function">cp</span> assistants/dbca/dbca.rsp <span class="token operator">!</span><span class="token comment">#:1.save</span></pre></div></code-block></li><li id="v4ustJB6r7mPy2Q69F9oAn"><div class="marker"></div><span class="inline-wrap">修改<span class="jill"></span>$ORACLE_HOME/assistants/dbca/dbca.rsp</span><code-block id="aJpvbbsgaNGNHYejNoezZz" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">CREATEDATABASE</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">GDBNAME</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">racdb</span>"</span>
<span class="token key attr-name">templateName</span><span class="token punctuation">=</span><span class="token value attr-value">General_Purpose.dbc</span>
<span class="token comment"># 该文件SID指定的是前缀</span>
<span class="token comment"># 所以oracle的用户的ORACLE_SID应该是rac1与rac2</span>
<span class="token key attr-name">SID</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">rac</span>"</span>
<span class="token key attr-name">NODELIST</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">ora1,ora2</span>"</span>
<span class="token key attr-name">SYSPASSWORD</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">password</span>"</span>
<span class="token key attr-name">SYSTEMPASSWORD</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">password</span>"</span>
<span class="token key attr-name">SYSMANPASSWORD</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">password</span>"</span>
<span class="token key attr-name">DBSNMPPASSWORD</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">password</span>"</span>
<span class="token key attr-name">DATAFILEDESTINATION</span> <span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">+DATA</span>"</span>
<span class="token key attr-name">RECOVERYAREADESTINATION</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">+DATA</span>"</span>
<span class="token key attr-name">STORAGETYPE</span><span class="token punctuation">=</span><span class="token value attr-value">"<span class="token inner-value">ASM</span>"</span>
<span class="token key attr-name">CHARACTERSET</span> <span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">AL32UTF</span>"</span>
<span class="token key attr-name">NATIONALCHARACTERSET</span><span class="token punctuation">=</span> <span class="token value attr-value">"<span class="token inner-value">UTF8</span>"</span>
<span class="token key attr-name">DISKGROUPNAME</span><span class="token punctuation">=</span><span class="token value attr-value">DATA</span>
<span class="token key attr-name">OBFUSCATEDPASSWORDS</span><span class="token punctuation">=</span><span class="token value attr-value">FALSE</span>
<span class="token key attr-name">SAMPLESCHEMA</span><span class="token punctuation">=</span><span class="token value attr-value">FALSE</span></pre></div></code-block></li><li id="pQLu8ADAfgiVq7xs7CxMJR"><div class="marker"></div><span class="inline-wrap">使用<span class="jill"></span>dbca<span class="jill"></span>安装数据库</span><span class="inline-wrap">
</span><span class="inline-wrap">注：当节点一执行后，可在节点二的<span class="jill"></span>oracle<span class="jill"></span>用户（==ORALCE_SID=rac2==）实时查看新建的数据库</span><code-block id="cnQhotaFkEYmNDutCJ9yXS" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">dbca <span class="token parameter variable">-silent</span> <span class="token parameter variable">-createDatabase</span> <span class="token parameter variable">-responseFile</span> <span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/assistants/dbca/dbca.rsp</pre></div></code-block><div id="pSnouy1Giv2n8dugEGM41n" class="wolai-block wolai-text"><div><span class="inline-wrap">注：如果<span class="jill"></span>$?不是<span class="jill"></span>0，可以去/u01/app/oracle/cfgtoollogs/dbca<span class="jill"></span>查看日志</span></div></div></li></ol><h1 id="fiNtsu8Kkh9oyjQu6te9km" class="wolai-block"><span class="inline-wrap">五、结束</span></h1><div id="nHCwii1QY2bgHnxe2Akd43" class="wolai-block wolai-text"><div><span class="inline-wrap">到此安装结束！下面是部分命令</span></div></div><ul class="wolai-block"><li id="45XPWTCqp2W15oRFTY5LPk"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">检查<span class="jill"></span>RAC<span class="jill"></span>状态</span><span class="inline-wrap">
</span><span class="inline-wrap">注：启动/关闭集群需要<span class="jill"></span>root<span class="jill"></span>权限，可以把<span class="jill"></span>grid<span class="jill"></span>用户变量复制到<span class="jill"></span>root<span class="jill"></span>用户的.bash_profile<span class="jill"></span>下</span><code-block id="wb8DSonS6rmRCcekKxU59K" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token punctuation">[</span>grid@ora1 ~<span class="token punctuation">]</span>$ crs_stat <span class="token parameter variable">-t</span>
Name           Type           Target    State     Host        
------------------------------------------------------------
ora.DATA.dg    ora<span class="token punctuation">..</span><span class="token punctuation">..</span>up.type ONLINE    ONLINE    ora1        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>ER.lsnr ora<span class="token punctuation">..</span><span class="token punctuation">..</span>er.type ONLINE    ONLINE    ora1        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>N1.lsnr ora<span class="token punctuation">..</span><span class="token punctuation">..</span>er.type ONLINE    ONLINE    ora2        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>N2.lsnr ora<span class="token punctuation">..</span><span class="token punctuation">..</span>er.type ONLINE    ONLINE    ora1        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>N3.lsnr ora<span class="token punctuation">..</span><span class="token punctuation">..</span>er.type ONLINE    ONLINE    ora1        
ora.asm        ora.asm.type   ONLINE    ONLINE    ora1        
ora.cvu        ora.cvu.type   ONLINE    ONLINE    ora1        
ora.gsd        ora.gsd.type   OFFLINE   OFFLINE    
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>network ora<span class="token punctuation">..</span><span class="token punctuation">..</span>rk.type ONLINE    ONLINE    ora1        
ora.oc4j       ora.oc4j.type  ONLINE    ONLINE    ora1        
ora.ons        ora.ons.type   ONLINE    ONLINE    ora1        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>SM1.asm application    ONLINE    ONLINE    ora1        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>A1.lsnr application    ONLINE    ONLINE    ora1        
ora.ora1.gsd   application    OFFLINE   OFFLINE               
ora.ora1.ons   application    ONLINE    ONLINE    ora1        
ora.ora1.vip   ora<span class="token punctuation">..</span><span class="token punctuation">..</span>t1.type ONLINE    ONLINE    ora1        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>SM2.asm application    ONLINE    ONLINE    ora2        
ora<span class="token punctuation">..</span><span class="token punctuation">..</span>A2.lsnr application    ONLINE    ONLINE    ora2        
ora.ora2.gsd   application    OFFLINE   OFFLINE               
ora.ora2.ons   application    ONLINE    ONLINE    ora2        
ora.ora2.vip   ora<span class="token punctuation">..</span><span class="token punctuation">..</span>t1.type ONLINE    ONLINE    ora2        
ora.scan1.vip  ora<span class="token punctuation">..</span><span class="token punctuation">..</span>ip.type ONLINE    ONLINE    ora2        
ora.scan2.vip  ora<span class="token punctuation">..</span><span class="token punctuation">..</span>ip.type ONLINE    ONLINE    ora1        
ora.scan3.vip  ora<span class="token punctuation">..</span><span class="token punctuation">..</span>ip.type ONLINE    ONLINE    ora1

<span class="token punctuation">[</span>grid@ora1 ~<span class="token punctuation">]</span>$ crsctl check crs
CRS-4638: Oracle High Availability Services is online
CRS-4537: Cluster Ready Services is online
CRS-4529: Cluster Synchronization Services is online
CRS-4533: Event Manager is online</pre></div></code-block><div id="wWvmBcEP8bfHiEQAC5nakm" class="wolai-block wolai-text"><div><span class="inline-wrap">注：gsd<span class="jill"></span>结尾项状态为<span class="jill"></span>OFFLINE<span class="jill"></span>是正常</span></div></div></li><li id="7rH7srR6ZhypitzMoGMyLs"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">用<span class="jill"></span>root<span class="jill"></span>用户直接关闭并启动集群</span><code-block id="uUhBfLN7LK9qnA2EhZnC32" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"># 关得快
<span class="token punctuation">[</span>root@ora1 <span class="token operator">~</span><span class="token punctuation">]</span># crsctl stop cluster <span class="token operator">-</span>all
# 启动慢
<span class="token punctuation">[</span>root@ora1 <span class="token operator">~</span><span class="token punctuation">]</span># crsctl start cluster <span class="token operator">-</span>all</pre></div></code-block></li></ul></article><footer></footer></body></html>