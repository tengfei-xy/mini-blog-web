<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>Oracle执行计划概览 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Oracle执行计划概览" class="main-title"></div></div></header><article><div id="uEdE4tfCoo2mB1z4ykdqVk" class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划是<span class="jill"></span>SQL<span class="jill"></span>优化的基础。在执行（查询、插入等）语句之前，优化器会将分析语句并按照一定的顺序，分步骤完成执行。通过分析执行计划可以知道到底执行了什么内容，进而开始<span class="jill"></span>SQL<span class="jill"></span>优化第一步。那么问题来了，如何看？在哪看？</span></div></div><h2 id="vqn32Ra4k9dtNFZhbH8U4c" class="wolai-block"><span class="inline-wrap">准备工作（用户授权与开启）</span></h2><h3 id="iNccSKckvrif81d2bGCUPJ" class="wolai-block"><span class="inline-wrap">方式<span class="jill"></span>1：使用<span class="jill"></span>SQL<span class="jill"></span>审核工具查看执行计划</span></h3><div id="trz2tkATE4pypww2QHjpuH" class="wolai-block wolai-text"><div><span class="inline-wrap">在“线上审核”中查看“风险<span class="jill"></span>SQL”，根据“SQL_ID”，点击具体风险<span class="jill"></span>SQL。</span></div></div><div id="kHGgNkCPpBPvXHhQ8GyGkz" class="wolai-block wolai-text"><div><span class="inline-wrap">![image-20210628095059227](/Users/tengfei/Library/Application Support/typora-user-images/image-20210628095059227.png)</span></div></div><div id="7HsL7cANRhGT7br8y5g8AZ" class="wolai-block wolai-text"><div><span class="inline-wrap">在“SQL<span class="jill"></span>详情”中点击“执行计划”进行查看。</span></div></div><div id="pvEk7MVHW72HVLSAp89GUd" class="wolai-block wolai-text"><div><span class="inline-wrap">![image-20210628095134592](/Users/tengfei/Library/Application Support/typora-user-images/image-20210628095134592.png)</span></div></div><h3 id="vrZmieZNmcG8bx8oyDtbpL" class="wolai-block"><span class="inline-wrap">方式<span class="jill"></span>2：使用命令（以</span><span class="inline-wrap"><b>AUTOTRACE</b></span><span class="inline-wrap">方式）</span></h3><div id="byvVXLQSVY1WiT1u3mHaEx" class="wolai-block wolai-text"><div><span class="inline-wrap">使用<span class="jill"></span>DBA<span class="jill"></span>权限的用户引用<span class="jill"></span>plustrce.sql<span class="jill"></span>脚本进行创建<span class="jill"></span>plustrace<span class="jill"></span>角色</span></div></div><code-block id="wYBwCf9GXD2Ru3SMruq2iZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>SYS<span class="token variable">@oracle</span><span class="token operator">></span> @?<span class="token operator">/</span>sqlplus<span class="token operator">/</span>admin<span class="token operator">/</span>plustrce<span class="token punctuation">.</span><span class="token keyword">sql</span></pre></div></code-block><div id="ngEFaADW5wUS9Kaeb779xK" class="wolai-block wolai-text"><div><span class="inline-wrap">授权给</span><span class="inline-wrap"><b>目标问题表</b></span><span class="inline-wrap">的用户</span></div></div><code-block id="ic6KjL7YdSdhqBuV2w9G7Y" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>SYS<span class="token variable">@oracle</span><span class="token operator">></span> <span class="token keyword">grant</span> plustrace <span class="token keyword">to</span> tengfei<span class="token punctuation">;</span>
<span class="token keyword">Grant</span> succeeded<span class="token punctuation">.</span></pre></div></code-block><div id="4aRq42g2BvhXKvWbH3T5pH" class="wolai-block wolai-text"><div><span class="inline-wrap">连接到</span><span class="inline-wrap"><b>目标问题表</b></span><span class="inline-wrap">的用户后开启<span class="jill"></span>AUTOTRACE</span></div></div><code-block id="k4FuuFKKEjKf6aJzoRs9cn" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>TENGFEI<span class="token variable">@oracle</span><span class="token operator">></span>  <span class="token keyword">set</span> autotrace <span class="token keyword">on</span></pre></div></code-block><div id="84RYDAoEXuM1ykpEziifTV" class="wolai-block wolai-text"><div><span class="inline-wrap">最后执行<span class="jill"></span>SQL<span class="jill"></span>语句，如下方面命令所示</span></div></div><code-block id="74W3ZgEbMYUmgBgbD1KML3" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">TENGFEI</span>@oracle<span class="token operator">></span> select a <span class="token keyword module">from</span> b where a<span class="token operator">></span><span class="token number">9997</span> and b<span class="token operator">=</span><span class="token number">9999</span> order by a desc<span class="token punctuation">;</span></pre></div></code-block><div id="8ACXNpnioQzDuTXnBRFs3s" class="wolai-block wolai-text"><div><span class="inline-wrap">其他选项：</span></div></div><div id="mvgZivh5piqu1BoncMpix9" class="wolai-block wolai-text"><div><span class="inline-wrap">能够查看</span><span class="inline-wrap"><b>SQL<span class="jill"></span>语句的执行结果</b></span><span class="inline-wrap">和</span><span class="inline-wrap"><b>执行计划</b></span><span class="inline-wrap">、</span><span class="inline-wrap"><b>统计信息</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>SET AUTOTRACE ON</code></span></div></div><div id="wJuk3HAR7xS5X1XzmBTZoa" class="wolai-block wolai-text"><div><span class="inline-wrap">只显示</span><span class="inline-wrap"><b>统计信息</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>SET AUTOTRACE ON STATISTICS</code></span></div></div><div id="bReFzrz3JKadWtJYCm41zS" class="wolai-block wolai-text"><div><span class="inline-wrap">包含</span><span class="inline-wrap"><b>查询计划</b></span><span class="inline-wrap">和统计信息，不包含查询输出：</span><span class="inline-wrap"><code>AUTOTTRACE TRACEONLY</code></span></div></div><div id="uGcTtu1Pn2YeGM2qV8M4qm" class="wolai-block wolai-text"><div><span class="inline-wrap">只显示</span><span class="inline-wrap"><b>优化器执行路径报告</b></span><span class="inline-wrap">：</span><span class="inline-wrap"><code>SET AUTOTRACE TRACEONLY EXPLAIN</code></span></div></div><div id="ibZrr9QW1omC2FwRpTCPqd" class="wolai-block wolai-text"><div><span class="inline-wrap">关闭：</span><span class="inline-wrap"><code>SET AUTOTRACE OFF</code></span></div></div><h2 id="oT5FQ7WniZsUr2KBECXt6x" class="wolai-block"><span class="inline-wrap">计划报告解说</span></h2><code-block id="81z7theMgbrW6CZcE1YHm5" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre>Execution <span class="token keyword">Plan</span>
<span class="token comment">----------------------------------------------------------</span>
<span class="token keyword">Plan</span> <span class="token keyword">hash</span> <span class="token keyword">value</span>: <span class="token number">1078481729</span>

<span class="token comment">--------------------------------------------------------------------------------------</span>
<span class="token operator">|</span> Id  <span class="token operator">|</span> Operation		                 <span class="token operator">|</span> Name  <span class="token operator">|</span> <span class="token keyword">Rows</span>  <span class="token operator">|</span> Bytes <span class="token operator">|</span> Cost <span class="token punctuation">(</span><span class="token operator">%</span>CPU<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token keyword">Time</span>     <span class="token operator">|</span>
<span class="token comment">--------------------------------------------------------------------------------------</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> STATEMENT	           <span class="token operator">|</span>	     <span class="token operator">|</span>	   <span class="token number">1</span> <span class="token operator">|</span>	  <span class="token number">26</span> <span class="token operator">|</span>	   <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token keyword">TABLE</span> ACCESS <span class="token keyword">BY</span> <span class="token keyword">INDEX</span> ROWID <span class="token operator">|</span> B     <span class="token operator">|</span>	   <span class="token number">1</span> <span class="token operator">|</span>	  <span class="token number">26</span> <span class="token operator">|</span>	   <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">2</span> <span class="token operator">|</span>   <span class="token keyword">INDEX</span> RANGE SCAN DESCENDING<span class="token operator">|</span> IND_A <span class="token operator">|</span>	   <span class="token number">3</span> <span class="token operator">|</span>	     <span class="token operator">|</span>	   <span class="token number">2</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token comment">--------------------------------------------------------------------------------------</span>

Predicate Information <span class="token punctuation">(</span>identified <span class="token keyword">by</span> operation id<span class="token punctuation">)</span>:
<span class="token comment">---------------------------------------------------</span>

   <span class="token number">1</span> <span class="token operator">-</span> filter<span class="token punctuation">(</span><span class="token string">"B"</span><span class="token operator">=</span><span class="token number">9999</span><span class="token punctuation">)</span>
   <span class="token number">2</span> <span class="token operator">-</span> access<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token operator">></span><span class="token number">9997</span><span class="token punctuation">)</span>

Note
<span class="token comment">-----</span>
   <span class="token operator">-</span> dynamic sampling used <span class="token keyword">for</span> this statement <span class="token punctuation">(</span><span class="token keyword">level</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>


<span class="token keyword">Statistics</span>
<span class="token comment">----------------------------------------------------------</span>
	  <span class="token number">4</span>  recursive calls    <span class="token comment">-- 递归次数</span>
	  <span class="token number">0</span>  db block gets      <span class="token comment">-- 从缓冲区高速缓存中独缺的总块数</span>
	 <span class="token number">38</span>  <span class="token keyword">consistent</span> gets    <span class="token comment">-- 从缓冲区高速缓存中一个块被请求进行读取的次数</span>
	  <span class="token number">1</span>  physical <span class="token keyword">reads</span>     <span class="token comment">-- 从数据文件到缓存区告诉缓存物理读取的书目</span>
	  <span class="token number">0</span>  redo size          <span class="token comment">-- 语句执行过程中产生的重做信息字节数</span>
	<span class="token number">520</span>  bytes sent via <span class="token keyword">SQL</span><span class="token operator">*</span>Net <span class="token keyword">to</span> client ongoing <span class="token comment">-- 从服务器发送到客户端的字节数</span>
	<span class="token number">523</span>  bytes received via <span class="token keyword">SQL</span><span class="token operator">*</span>Net <span class="token keyword">from</span> client   <span class="token comment">-- 从客户端接收到的字节数</span>
	  <span class="token number">2</span>  <span class="token keyword">SQL</span><span class="token operator">*</span>Net roundtrips <span class="token keyword">to</span><span class="token operator">/</span><span class="token keyword">from</span> client        <span class="token comment">-- 从客户机发送和接收到SQL*Net消息的总数</span>
	  <span class="token number">0</span>  sorts <span class="token punctuation">(</span>memory<span class="token punctuation">)</span>     <span class="token comment">-- 在内存中排序次数</span>
	  <span class="token number">0</span>  sorts <span class="token punctuation">(</span><span class="token keyword">disk</span><span class="token punctuation">)</span>       <span class="token comment">-- 在磁盘中排序次数</span>
	  <span class="token number">1</span>  <span class="token keyword">rows</span> processed     <span class="token comment">-- 更改或选择返回的行数</span>
</pre></div></code-block><h3 id="gWV5rMu5vFDNvdD8uDFgMQ" class="wolai-block"><span class="inline-wrap">查询计划的列说明</span></h3><div id="9TLrXwQmHcgzUpDhGnV2CH" class="wolai-block wolai-text"><div><span class="inline-wrap">在上图中，本次执行此话包含<span class="jill"></span>3<span class="jill"></span>条<span class="jill"></span>Id。Opearion<span class="jill"></span>表示操作内容。Name<span class="jill"></span>则表示索引名或表名等信息。Rows<span class="jill"></span>表示该<span class="jill"></span>ID<span class="jill"></span>操作所返回的行数。Bytes<span class="jill"></span>是返回的字节数。Cost<span class="jill"></span>是优化器花费<span class="jill"></span>CPU<span class="jill"></span>的成本量化参考。ID<span class="jill"></span>前带有</span><span class="inline-wrap"><code>*</code></span><span class="inline-wrap">星号则表示该条是谓语条件，这一条<span class="jill"></span>ID<span class="jill"></span>进行的具体操作会展现在<span class="jill"></span>Predicate Information<span class="jill"></span>中。</span></div></div><h3 id="thsmwzb8xj191ZBCAosFSn" class="wolai-block"><span class="inline-wrap">Operation<span class="jill"></span>列</span></h3><div id="imneFU4fb8LWLE6n5zE43q" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>INDEX RANGE SCAN DESCENDING</code></span><span class="inline-wrap">表示进行的是按递减顺序进行索引范围扫描。</span></div></div><div id="euCQejHzx9PQLYsdxtHnqf" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>TABLE ACCESS BY INDEX ROWID</code></span><span class="inline-wrap">则表示通过索引<span class="jill"></span>ROWID<span class="jill"></span>扫描表</span></div></div><h3 id="3cZ5y6JZix7Wro95jh5Qw6" class="wolai-block"><span class="inline-wrap">路径访问的顺序</span></h3><div id="fZmiYbXueejqFj9AgxeWP7" class="wolai-block wolai-text"><div><span class="inline-wrap">自上而下、从左到右，寻找缩进层次最深且没有子节点的第一个节点开始</span></div></div></article><footer></footer></body></html>