<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>全表扫描第二版 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="全表扫描第二版" class="main-title"></div></div></header><article><h1 id="rDibZomD8C8v3AGH7fwi5v" class="wolai-block"><span class="inline-wrap">全表扫描</span></h1><h2 id="feFPmUohUpyWfsLqMAgXqj" class="wolai-block"><span class="inline-wrap">概念</span></h2><div id="2JY9ntFGThy2s4PhtRtNr1" class="wolai-block wolai-text"><div><span class="inline-wrap">在执行计划中<span class="jill"></span>Operation<span class="jill"></span>列的</span><span class="inline-wrap"><code>TABLE ACCESS FULL</code></span><span class="inline-wrap">便是堆表全表扫描。执行全表扫描时，服务器进程连续读取</span><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/TGSQL/img_text/GUID-5D9563AF-23D5-4172-B346-2E584EA6CCD7-print.htm"><span>高水平线（high water mark）</span></a></span><span class="inline-wrap">以下所有块。当分区表中的分区都被访问时<span class="jill"></span>Operation<span class="jill"></span>列分区全扫描</span><span class="inline-wrap"><code>PARTITION RANGE ALL</code></span><span class="inline-wrap">。</span></div></div><blockquote id="xvkoW5cKGrTRdwMLmyy3ef" class="wolai-block"><span class="inline-wrap"><a href="https://docs.oracle.com/cd/B19306_01/server.102/b14211/optimops.htm#i44851"><span><b>官方解释</b></span></a></span><span class="inline-wrap">
</span><span class="inline-wrap">This type of scan reads all rows from a table and filters out those that do not meet the selection criteria.During a full table scan, all blocks in the table that are under the high water mark are scanned. The high water mark indicates the amount of used space, or space that had been formatted to receive data. Each row is examined to determine whether it satisfies the statement&#39;s </span><span class="inline-wrap"><code>WHERE</code></span><span class="inline-wrap"> clause.</span></blockquote><h2 id="4kVYg98Fj3J9Qa5mirZVgi" class="wolai-block"><span class="inline-wrap">如何工作</span></h2><div id="23RLdCPxWixwRHSA5R4Qos" class="wolai-block wolai-text"><div><span class="inline-wrap">在下图中描述在数据库进行全表扫描时，会并跳过未使用、未格式化的数据块并按顺序将读取每一个<span class="jill"></span>HWM<span class="jill"></span>线以下的每个格式化的数据块，且只读一次。</span></div></div><div id="kp8YejbbywJaEiS5mWUqmE" class="wolai-block wolai-text"><div><span class="inline-wrap">![image-20210628162157158](/Users/tengfei/Library/Application Support/typora-user-images/image-20210628162157158.png)</span></div></div><h2 id="gYmopr3A92ro7zdzE4a8Zf" class="wolai-block"><span class="inline-wrap">TABLE ACCESS FULL<span class="jill"></span>出现场景</span></h2><blockquote id="htHqJbiF3EWqZZKqz9fqCE" class="wolai-block"><span class="inline-wrap">构造表语句：</span></blockquote><code-block id="j6coXRb1TLxRTgg9Rst61b" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> tbl_001 <span class="token punctuation">(</span> used_index varchar2<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>no_index varchar2<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_tab_001 <span class="token keyword">ON</span> tbl_001<span class="token punctuation">(</span>used_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">FOR</span> i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token number">.100</span> <span class="token keyword">LOOP</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_001<span class="token punctuation">(</span>used_index<span class="token punctuation">,</span>no_index<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span><span class="token punctuation">;</span> 
<span class="token operator">/</span></pre></div></code-block><ul class="wolai-block"><li id="jdNCtog6PMCo62TxvGeR5n"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">索引没有使用或失效</span><ol class="wolai-block"><li id="qCVtZVEEUvwPZDwTKSEi7c"><div class="marker"></div><span class="inline-wrap">当查询没有使用索引的，优化器就会使用全表扫描</span><span class="inline-wrap">
</span><span class="inline-wrap">SQL<span class="jill"></span>语句：</span><code-block id="fWc3Ph5Jj1fdGn5o5TDPdC" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl_001</pre></div></code-block><div id="dsxiD7QvrXgDhYEbNSH1f1" class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划：</span></div></div><code-block id="9KtHPvtJeJEHQ6WF5EveNs" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">Plan</span> <span class="token keyword">hash</span> <span class="token keyword">value</span>: <span class="token number">320693035</span>
 
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span> Id  <span class="token operator">|</span> Operation         <span class="token operator">|</span> Name    <span class="token operator">|</span> <span class="token keyword">Rows</span>  <span class="token operator">|</span> Bytes <span class="token operator">|</span> Cost <span class="token punctuation">(</span><span class="token operator">%</span>CPU<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token keyword">Time</span>     <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> STATEMENT  <span class="token operator">|</span>         <span class="token operator">|</span>   <span class="token number">100</span> <span class="token operator">|</span>   <span class="token number">400</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span>  <span class="token keyword">TABLE</span> ACCESS <span class="token keyword">FULL</span><span class="token operator">|</span> TBL_001 <span class="token operator">|</span>   <span class="token number">100</span> <span class="token operator">|</span>   <span class="token number">400</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
 </pre></div></code-block></li><li id="2DzA6H4godbrAeVeWneK5M"><div class="marker"></div><span class="inline-wrap">当查询时过滤列中使用函数</span><span class="inline-wrap">
</span><span class="inline-wrap">SQL<span class="jill"></span>语句：</span><code-block id="i9rdtGE9SsBHAckCJ5Femz" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> used_index <span class="token keyword">FROM</span> tbl_001 <span class="token keyword">WHERE</span> LTRIM<span class="token punctuation">(</span>used_index<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">;</span></pre></div></code-block><div id="h5o6KwAix5nTqxcr1DsY2s" class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划：</span></div></div><code-block id="i7tcsQvfmYbZpZ2CJqstj1" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">Plan</span> <span class="token keyword">hash</span> <span class="token keyword">value</span>: <span class="token number">320693035</span>
 
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span> Id  <span class="token operator">|</span> Operation         <span class="token operator">|</span> Name    <span class="token operator">|</span> <span class="token keyword">Rows</span>  <span class="token operator">|</span> Bytes <span class="token operator">|</span> Cost <span class="token punctuation">(</span><span class="token operator">%</span>CPU<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token keyword">Time</span>     <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> STATEMENT  <span class="token operator">|</span>         <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token keyword">TABLE</span> ACCESS <span class="token keyword">FULL</span><span class="token operator">|</span> TBL_001 <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
 
Predicate Information <span class="token punctuation">(</span>identified <span class="token keyword">by</span> operation id<span class="token punctuation">)</span>:
<span class="token comment">---------------------------------------------------</span>
 
   <span class="token number">1</span> <span class="token operator">-</span> filter<span class="token punctuation">(</span>LTRIM<span class="token punctuation">(</span><span class="token string">"USED_INDEX"</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">)</span>
 </pre></div></code-block></li><li id="wspoNrqhJpUQf9yDLXmmGq"><div class="marker"></div><span class="inline-wrap">查询时，索引列有空值</span><span class="inline-wrap">
</span><span class="inline-wrap">SQL<span class="jill"></span>语句：</span><code-block id="6udCt83ck5BKwqi345nwNm" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 准备数据</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_001<span class="token punctuation">(</span>no_index<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token string">'101'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> tbl_001 <span class="token keyword">WHERE</span> no_index <span class="token operator">=</span> <span class="token string">'101'</span><span class="token punctuation">;</span>

USED_ NO_IN
<span class="token comment">----- -----</span>
      <span class="token number">101</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> used_index <span class="token keyword">FROM</span> tbl_001 <span class="token keyword">WHERE</span> no_index <span class="token operator">=</span> <span class="token string">'101'</span><span class="token punctuation">;</span></pre></div></code-block><div id="w3AzB2ugNACD3eUBDdcGnK" class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划：</span></div></div><code-block id="cDBiCtx3GLwxfCPniT8KSF" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">Plan</span> <span class="token keyword">hash</span> <span class="token keyword">value</span>: <span class="token number">320693035</span>
 
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span> Id  <span class="token operator">|</span> Operation         <span class="token operator">|</span> Name    <span class="token operator">|</span> <span class="token keyword">Rows</span>  <span class="token operator">|</span> Bytes <span class="token operator">|</span> Cost <span class="token punctuation">(</span><span class="token operator">%</span>CPU<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token keyword">Time</span>     <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> STATEMENT  <span class="token operator">|</span>         <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token keyword">TABLE</span> ACCESS <span class="token keyword">FULL</span><span class="token operator">|</span> TBL_001 <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">8</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
 
Predicate Information <span class="token punctuation">(</span>identified <span class="token keyword">by</span> operation id<span class="token punctuation">)</span>:
<span class="token comment">---------------------------------------------------</span>
 
   <span class="token number">1</span> <span class="token operator">-</span> filter<span class="token punctuation">(</span><span class="token string">"NO_INDEX"</span><span class="token operator">=</span><span class="token string">'101'</span><span class="token punctuation">)</span>
 </pre></div></code-block></li></ol></li><li id="nm7cGTXpid1YjMXktkGsG5"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">访问绝大多数块</span><span class="inline-wrap">
</span><span class="inline-wrap">说明：当优化器认为查询需要访问大部分块时，即使索引是可用的</span><span class="inline-wrap">
</span><span class="inline-wrap">SQL<span class="jill"></span>语句：</span><code-block id="hxfg3axD5ez53oqjNSzict" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 增加数据</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">BEGIN</span> 
<span class="token keyword">FOR</span> i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token number">.50000</span> <span class="token keyword">LOOP</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_001<span class="token punctuation">(</span>used_index<span class="token punctuation">,</span>no_index<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span> 
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span><span class="token punctuation">;</span> 
<span class="token operator">/</span>
<span class="token comment">-- 索引</span>
<span class="token operator">></span> <span class="token keyword">SELECT</span>  no_index <span class="token keyword">FROM</span> tbl_001 <span class="token keyword">WHERE</span> used_index <span class="token operator">></span> <span class="token string">'100'</span><span class="token punctuation">;</span></pre></div></code-block><div id="4Byh2SjHjPqcRcFJGAjHMC" class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划：</span></div></div><code-block id="41fUnBhRQ28wgB3ZVGhzun" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">Plan</span> <span class="token keyword">hash</span> <span class="token keyword">value</span>: <span class="token number">320693035</span>
 
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span> Id  <span class="token operator">|</span> Operation         <span class="token operator">|</span> Name    <span class="token operator">|</span> <span class="token keyword">Rows</span>  <span class="token operator">|</span> Bytes <span class="token operator">|</span> Cost <span class="token punctuation">(</span><span class="token operator">%</span>CPU<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token keyword">Time</span>     <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> STATEMENT  <span class="token operator">|</span>         <span class="token operator">|</span>   <span class="token number">100</span>K<span class="token operator">|</span>   <span class="token number">977</span>K<span class="token operator">|</span>    <span class="token number">69</span>   <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token keyword">TABLE</span> ACCESS <span class="token keyword">FULL</span><span class="token operator">|</span> TBL_001 <span class="token operator">|</span>   <span class="token number">100</span>K<span class="token operator">|</span>   <span class="token number">977</span>K<span class="token operator">|</span>    <span class="token number">69</span>   <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
 
Predicate Information <span class="token punctuation">(</span>identified <span class="token keyword">by</span> operation id<span class="token punctuation">)</span>:
<span class="token comment">---------------------------------------------------</span>
 
   <span class="token number">1</span> <span class="token operator">-</span> filter<span class="token punctuation">(</span><span class="token string">"USED_INDEX"</span><span class="token operator">></span><span class="token string">'100'</span><span class="token punctuation">)</span></pre></div></code-block></li><li id="1WMxFQJHscfutGDcHhBLnu"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">小表</span><span class="inline-wrap">
</span><span class="inline-wrap">说明：当表包含小于初始参数中的</span><span class="inline-wrap"><code>DB_FILE_MULTIBLOCK_READ_COUNT</code></span><span class="inline-wrap">的高水平线的块时</span><span class="inline-wrap">
</span><span class="inline-wrap">SQL<span class="jill"></span>语句：</span><code-block id="vFiogzmb8ECP4NLYTdtWK9" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 查看当前参数</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">show</span> parameter DB_FILE_MULTIBLOCK_READ_COUNT

NAME				     <span class="token keyword">TYPE</span>	 <span class="token keyword">VALUE</span>
<span class="token comment">------------------------------------ ----------- ------------------------------</span>
db_file_multiblock_read_count	     <span class="token keyword">integer</span>	 <span class="token number">128</span>

<span class="token comment">-- 查看表含有多少数据块</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">analyze</span> <span class="token keyword">table</span> TBL_001 <span class="token keyword">compute</span> <span class="token keyword">statistics</span><span class="token punctuation">;</span>
<span class="token keyword">Table</span> analyzed<span class="token punctuation">.</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> a<span class="token punctuation">.</span>BLOCKS <span class="token keyword">from</span> user_tables a <span class="token keyword">where</span> a<span class="token punctuation">.</span>TABLE_NAME<span class="token operator">=</span><span class="token string">'TBL_001'</span><span class="token punctuation">;</span>
    BLOCKS
<span class="token comment">----------</span>
	 <span class="token number">5</span>
<span class="token comment">-- 增加数据</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">BEGIN</span> 
<span class="token keyword">FOR</span> i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token number">.50000</span> <span class="token keyword">LOOP</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_001<span class="token punctuation">(</span>used_index<span class="token punctuation">,</span>no_index<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span> 
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span><span class="token punctuation">;</span> 
<span class="token operator">/</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">BEGIN</span>
<span class="token keyword">FOR</span> i <span class="token operator">IN</span> <span class="token number">1.</span><span class="token number">.50000</span> <span class="token keyword">LOOP</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> tbl_001<span class="token punctuation">(</span>used_index<span class="token punctuation">,</span>no_index<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span> 
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span><span class="token punctuation">;</span> 
<span class="token operator">/</span>
<span class="token comment">-- 重新统计并查看块</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">analyze</span> <span class="token keyword">table</span> TBL_001 <span class="token keyword">compute</span> <span class="token keyword">statistics</span><span class="token punctuation">;</span>

<span class="token keyword">Table</span> analyzed<span class="token punctuation">.</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> a<span class="token punctuation">.</span>BLOCKS <span class="token keyword">from</span> user_tables a <span class="token keyword">where</span> a<span class="token punctuation">.</span>TABLE_NAME<span class="token operator">=</span><span class="token string">'TBL_001'</span><span class="token punctuation">;</span>

    BLOCKS
<span class="token comment">----------</span>
       <span class="token number">244</span>

<span class="token keyword">SQL</span><span class="token operator">></span> </pre></div></code-block></li><li id="2Aj4WrNMzH5AxJjp11mDww"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">使用<span class="jill"></span>hint</span><span class="inline-wrap">
</span><span class="inline-wrap">SQL<span class="jill"></span>语句：</span><code-block id="vjYzYcnqxRVSZgnV2Q3WGt" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> <span class="token comment">/*+ FULL(t) */</span> used_index <span class="token keyword">FROM</span> tbl_001 t <span class="token keyword">WHERE</span> used_index <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span></pre></div></code-block><div id="fLBycDu4aRdtaqR6DJRrJp" class="wolai-block wolai-text"><div><span class="inline-wrap">执行计划：</span></div></div><code-block id="2dLXPfwdVx3BTjZqG1xkJv" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">Plan</span> <span class="token keyword">hash</span> <span class="token keyword">value</span>: <span class="token number">320693035</span>
 
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span> Id  <span class="token operator">|</span> Operation         <span class="token operator">|</span> Name    <span class="token operator">|</span> <span class="token keyword">Rows</span>  <span class="token operator">|</span> Bytes <span class="token operator">|</span> Cost <span class="token punctuation">(</span><span class="token operator">%</span>CPU<span class="token punctuation">)</span><span class="token operator">|</span> <span class="token keyword">Time</span>     <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span> <span class="token keyword">SELECT</span> STATEMENT  <span class="token operator">|</span>         <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token operator">|</span><span class="token operator">*</span>  <span class="token number">1</span> <span class="token operator">|</span>  <span class="token keyword">TABLE</span> ACCESS <span class="token keyword">FULL</span><span class="token operator">|</span> TBL_001 <span class="token operator">|</span>     <span class="token number">1</span> <span class="token operator">|</span>     <span class="token number">4</span> <span class="token operator">|</span>     <span class="token number">3</span>   <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">|</span> <span class="token number">00</span>:<span class="token number">00</span>:<span class="token number">01</span> <span class="token operator">|</span>
<span class="token comment">-----------------------------------------------------------------------------</span>
 
Predicate Information <span class="token punctuation">(</span>identified <span class="token keyword">by</span> operation id<span class="token punctuation">)</span>:
<span class="token comment">---------------------------------------------------</span>
 
   <span class="token number">1</span> <span class="token operator">-</span> filter<span class="token punctuation">(</span><span class="token string">"USED_INDEX"</span><span class="token operator">=</span><span class="token string">'10'</span><span class="token punctuation">)</span>
 
Note
<span class="token comment">-----</span>
   <span class="token operator">-</span> dynamic sampling used <span class="token keyword">for</span> this statement <span class="token punctuation">(</span><span class="token keyword">level</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span></pre></div></code-block></li></ul><h2 id="pRp81h5exbYKye2xeaqr2Z" class="wolai-block"><span class="inline-wrap">PARTITION RANGE ALL 出现场景</span></h2><blockquote id="8udYYZ2AJNZX5f2igwuKW4" class="wolai-block"><span class="inline-wrap">构造分区表：</span></blockquote><code-block id="1e1PyyLanrQXwUPSLNEGfz" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 创建分区表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> TBL_002 <span class="token punctuation">(</span>
ID1 NUMBER<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
ID2 NUMBER<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> RANGE<span class="token punctuation">(</span>ID1<span class="token punctuation">)</span> <span class="token punctuation">(</span>
<span class="token keyword">PARTITION</span> P0200 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> P0400 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> P0600 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> P0800 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">PARTITION</span> P1000 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">-- 插入数据</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">FOR</span> I <span class="token operator">IN</span> <span class="token number">1.</span><span class="token number">.1200</span> <span class="token keyword">LOOP</span> 
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> TBL_002<span class="token punctuation">(</span>ID1<span class="token punctuation">,</span>ID2<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>I<span class="token punctuation">,</span>I<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span> 
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span> 
<span class="token operator">/</span></pre></div></code-block></article><footer></footer></body></html>