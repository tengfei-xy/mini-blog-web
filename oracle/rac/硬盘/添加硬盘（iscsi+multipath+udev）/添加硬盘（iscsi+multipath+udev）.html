<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>添加硬盘（iscsi+multipath+udev） - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="添加硬盘（iscsi+multipath+udev）" class="main-title"></div></div></header><article><h1 id="hXjKqaQb6vf66BGEiLWQtg" class="wolai-block"><span class="inline-wrap">添加硬盘<span class="jill"></span>iscsi+multipath+udev<span class="jill"></span>方式</span></h1><h2 id="fUNhVT79i5DgtjDHTBteoh" class="wolai-block"><span class="inline-wrap">iscsi<span class="jill"></span>设置</span></h2><div id="5ttnXuXXVyCsU4sMCFrSSd" class="wolai-block wolai-text"><div><span class="inline-wrap">注：在<span class="jill"></span>targetcli<span class="jill"></span>中执行正确均有绿色字回显，下文删除了输出日志。</span></div></div><ol class="wolai-block"><li id="t3M2MFkVJQKwg272JsQnJp"><div class="marker"></div><span class="inline-wrap">确定需要加到<span class="jill"></span>rac<span class="jill"></span>的硬盘，在例中使用</span><span class="inline-wrap"><code>/dev/sdc</code></span><code-block id="rWEzEUkM6Ko5knzgHUeMmn" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 crsd<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME             MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT
sda                <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk  
├─sda1             <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part  /boot
└─sda2             <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part  
  ├─centos-root  <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm   /
  └─centos-swap  <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm   <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb                <span class="token number">8</span>:16   <span class="token number">0</span>   20G  <span class="token number">0</span> disk  
├─sdb1             <span class="token number">8</span>:17   <span class="token number">0</span>    6G  <span class="token number">0</span> part  
├─sdb2             <span class="token number">8</span>:18   <span class="token number">0</span>    6G  <span class="token number">0</span> part  
└─sdb3             <span class="token number">8</span>:19   <span class="token number">0</span>    8G  <span class="token number">0</span> part  
sdc                <span class="token number">8</span>:32   <span class="token number">0</span>    5G  <span class="token number">0</span> disk  
sdd                <span class="token number">8</span>:48   <span class="token number">0</span>    6G  <span class="token number">0</span> disk  
└─RAC-OCRVOTE    <span class="token number">253</span>:2    <span class="token number">0</span>    6G  <span class="token number">0</span> mpath 
  └─RAC-OCRVOTE1 <span class="token number">253</span>:6    <span class="token number">0</span>    6G  <span class="token number">0</span> part  
sde                <span class="token number">8</span>:64   <span class="token number">0</span>    8G  <span class="token number">0</span> disk  
└─RAC-FRA        <span class="token number">253</span>:4    <span class="token number">0</span>    8G  <span class="token number">0</span> mpath 
  └─RAC-FRA1     <span class="token number">253</span>:7    <span class="token number">0</span>    8G  <span class="token number">0</span> part  
sdf                <span class="token number">8</span>:80   <span class="token number">0</span>    6G  <span class="token number">0</span> disk  
└─RAC-DATA       <span class="token number">253</span>:3    <span class="token number">0</span>    6G  <span class="token number">0</span> mpath 
  └─RAC-DATA1    <span class="token number">253</span>:5    <span class="token number">0</span>    6G  <span class="token number">0</span> part  
sr0               <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom </pre></div></code-block></li><li id="og8UvWDmej4cfebfF2eRb1"><div class="marker"></div><span class="inline-wrap">对/dev/sdc<span class="jill"></span>分区</span><code-block id="gqGs5hhzMiQ5zm1NZQz3Gw" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 crsd<span class="token punctuation">]</span><span class="token comment"># fdisk /dev/sdc</span>
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：n
Select <span class="token punctuation">(</span>default p<span class="token punctuation">)</span>: p
分区号 <span class="token punctuation">(</span><span class="token number">1</span>-4，默认 <span class="token number">1</span><span class="token punctuation">)</span>：1
起始 扇区 <span class="token punctuation">(</span><span class="token number">2048</span>-10485759，默认为 <span class="token number">2048</span><span class="token punctuation">)</span>：2048
Last 扇区, +扇区 or +size<span class="token punctuation">{</span>K,M,G<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token number">2048</span>-10485759，默认为 <span class="token number">10485759</span><span class="token punctuation">)</span>：10485759
命令<span class="token punctuation">(</span>输入 m 获取帮助<span class="token punctuation">)</span>：w
正在同步磁盘。</pre></div></code-block></li><li id="3S6EHYRYUVHSTwQsdJv6tf"><div class="marker"></div><span class="inline-wrap">将目标磁盘添加到<span class="jill"></span>iscsi<span class="jill"></span>服务端</span><span class="inline-wrap">
</span><span class="inline-wrap">可以看到，</span><span class="inline-wrap"><code>/backstores/block/</code></span><span class="inline-wrap">下有<span class="jill"></span>DB1、DB2、DB3</span><code-block id="e9kdT6KgabYNhqnvMSbMQC" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 crsd<span class="token punctuation">]</span># targetcli 
<span class="token operator">/</span><span class="token operator">></span> ls <span class="token operator">/</span>backstores<span class="token operator">/</span>block
o<span class="token operator">-</span> block <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Storage</span> <span class="token maybe-class-name">Objects</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span>
  o<span class="token operator">-</span> <span class="token constant">DB1</span> <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token operator">/</span>dev<span class="token operator">/</span><span class="token function">sdb1</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">.</span>0GiB<span class="token punctuation">)</span> write<span class="token operator">-</span>thru activated<span class="token punctuation">]</span>
  <span class="token operator">|</span> o<span class="token operator">-</span> alua <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span><span class="token constant">ALUA</span> <span class="token literal-property property">Groups</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token operator">|</span>   o<span class="token operator">-</span> default_tg_pt_gp <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token constant">ALUA</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token maybe-class-name">Active</span><span class="token operator">/</span>optimized<span class="token punctuation">]</span>
  o<span class="token operator">-</span> <span class="token constant">DB2</span> <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token operator">/</span>dev<span class="token operator">/</span><span class="token function">sdb2</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">.</span>0GiB<span class="token punctuation">)</span> write<span class="token operator">-</span>thru activated<span class="token punctuation">]</span>
  <span class="token operator">|</span> o<span class="token operator">-</span> alua <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span><span class="token constant">ALUA</span> <span class="token literal-property property">Groups</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token operator">|</span>   o<span class="token operator">-</span> default_tg_pt_gp <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token constant">ALUA</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token maybe-class-name">Active</span><span class="token operator">/</span>optimized<span class="token punctuation">]</span>
  o<span class="token operator">-</span> <span class="token constant">DB3</span> <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token operator">/</span>dev<span class="token operator">/</span><span class="token function">sdb3</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">.</span>0GiB<span class="token punctuation">)</span> write<span class="token operator">-</span>thru activated<span class="token punctuation">]</span>
    o<span class="token operator">-</span> alua <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span><span class="token constant">ALUA</span> <span class="token literal-property property">Groups</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
      o<span class="token operator">-</span> default_tg_pt_gp <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token constant">ALUA</span> <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token maybe-class-name">Active</span><span class="token operator">/</span>optimized<span class="token punctuation">]</span></pre></div></code-block><div id="nyBGaE1CbfuavCo54sBRoJ" class="wolai-block wolai-text"><div><span class="inline-wrap">创建新块,/dev/sdc1<span class="jill"></span>是第二步分区的结果</span></div></div><code-block id="jfa8c77GvHSX6mi9kgYMH6" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token operator">/</span><span class="token operator">></span>  <span class="token operator">/</span>backstores<span class="token operator">/</span>block create <span class="token constant">DB4</span> <span class="token operator">/</span>dev<span class="token operator">/</span>sdc1
<span class="token maybe-class-name">Created</span> block storage object <span class="token constant">DB4</span> using <span class="token operator">/</span>dev<span class="token operator">/</span>sdc1<span class="token punctuation">.</span></pre></div></code-block></li><li id="mWAPfu3tFRw68CyxYcfUwJ"><div class="marker"></div><span class="inline-wrap">查看<span class="jill"></span>iscsi<span class="jill"></span>使用的<span class="jill"></span>iqn，在下图中使用的是<span class="jill"></span>iqn.2021-07.02.com.oracle（即行<span class="jill"></span>3）</span><code-block id="wEEgxgvVtQE7NqXx8fi8uB" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token operator">/</span><span class="token operator">></span> ls <span class="token operator">/</span>iscsi<span class="token operator">/</span>
o<span class="token operator">-</span> iscsi <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Targets</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
  o<span class="token operator">-</span> iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">07.02</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span> <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span><span class="token maybe-class-name">TPGs</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
    o<span class="token operator">-</span> tpg1 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>no<span class="token operator">-</span>gen<span class="token operator">-</span>acls<span class="token punctuation">,</span> no<span class="token operator">-</span>auth<span class="token punctuation">]</span>
      o<span class="token operator">-</span> acls <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token maybe-class-name">ACLs</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token operator">|</span> o<span class="token operator">-</span> iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">07.02</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">:</span>ora1 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Mapped</span> <span class="token maybe-class-name">LUNs</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span>
      <span class="token operator">|</span>   o<span class="token operator">-</span> mapped_lun0 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>lun0 block<span class="token operator">/</span><span class="token constant">DB1</span> <span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token operator">|</span>   o<span class="token operator">-</span> mapped_lun1 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>lun1 block<span class="token operator">/</span><span class="token constant">DB2</span> <span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token operator">|</span>   o<span class="token operator">-</span> mapped_lun2 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>lun2 block<span class="token operator">/</span><span class="token constant">DB3</span> <span class="token punctuation">(</span>rw<span class="token punctuation">)</span><span class="token punctuation">]</span>
      o<span class="token operator">-</span> luns <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token maybe-class-name">LUNs</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">]</span>
      <span class="token operator">|</span> o<span class="token operator">-</span> lun0 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>block<span class="token operator">/</span><span class="token constant">DB1</span> <span class="token punctuation">(</span><span class="token operator">/</span>dev<span class="token operator">/</span>sdb1<span class="token punctuation">)</span> <span class="token punctuation">(</span>default_tg_pt_gp<span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token operator">|</span> o<span class="token operator">-</span> lun1 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>block<span class="token operator">/</span><span class="token constant">DB2</span> <span class="token punctuation">(</span><span class="token operator">/</span>dev<span class="token operator">/</span>sdb2<span class="token punctuation">)</span> <span class="token punctuation">(</span>default_tg_pt_gp<span class="token punctuation">)</span><span class="token punctuation">]</span>
      <span class="token operator">|</span> o<span class="token operator">-</span> lun2 <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span>block<span class="token operator">/</span><span class="token constant">DB3</span> <span class="token punctuation">(</span><span class="token operator">/</span>dev<span class="token operator">/</span>sdb3<span class="token punctuation">)</span> <span class="token punctuation">(</span>default_tg_pt_gp<span class="token punctuation">)</span><span class="token punctuation">]</span>
      o<span class="token operator">-</span> portals <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token maybe-class-name">Portals</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">]</span>
        o<span class="token operator">-</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">3260</span> <span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span><span class="token spread operator">...</span> <span class="token punctuation">[</span><span class="token constant">OK</span><span class="token punctuation">]</span>
<span class="token operator">/</span><span class="token operator">></span> cd <span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">2021</span><span class="token operator">-</span><span class="token number">07.02</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">/</span>tpg1<span class="token operator">/</span>luns<span class="token operator">/</span>
<span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">20.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token property-access">cle</span><span class="token operator">/</span>tpg1<span class="token operator">/</span>luns<span class="token operator">></span>create <span class="token operator">/</span>backstores<span class="token operator">/</span>block<span class="token operator">/</span><span class="token constant">DB4</span></pre></div></code-block></li><li id="ws7kViqTN6fD4e9KHraQLb"><div class="marker"></div><span class="inline-wrap">退出并重启服务</span><code-block id="xo19MK3JqEDdJDv1suTEC4" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token operator">/</span>iscsi<span class="token operator">/</span>iqn<span class="token punctuation">.</span><span class="token number">20.</span><span class="token punctuation">.</span><span class="token number">.02</span><span class="token punctuation">.</span><span class="token property-access">com</span><span class="token punctuation">.</span><span class="token property-access">oracle</span><span class="token operator">></span> exit
<span class="token punctuation">[</span>root@ora1 crsd<span class="token punctuation">]</span>#  systemctl restart target</pre></div></code-block><div id="wWmYqBVNyN8ToPjZg1Ygir" class="wolai-block wolai-text"><div><span class="inline-wrap">注：此时查看应登录<span class="jill"></span>iscsi<span class="jill"></span>的<span class="jill"></span>rac<span class="jill"></span>节点上，应有看到新增的共享盘</span></div></div></li></ol><h2 id="wHjbE4y9wfJEW5ZLwkk65Z" class="wolai-block"><span class="inline-wrap">multipath<span class="jill"></span>设置(每个节点执行)</span></h2><ol class="wolai-block"><li id="8ihL5LHetL1z7JVLRnWWky"><div class="marker"></div><span class="inline-wrap">添加共享硬盘到<span class="jill"></span>wwids</span><code-block id="vVTjm3LuuthY4yRY3vbzzk" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 etc<span class="token punctuation">]</span><span class="token comment"># multipath -a /dev/sdg</span>
wwid <span class="token string">'36001405181030e174b74aceb74af1647'</span> added</pre></div></code-block></li><li id="njJGGZ3r4ZAujNYb87sCCq"><div class="marker"></div><span class="inline-wrap">编辑<span class="jill"></span>multipath.conf，将新硬盘的<span class="jill"></span>wwid<span class="jill"></span>添加到多路径软件下</span><code-block id="2g5NC7FdShZptfNU8XydtJ" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 etc<span class="token punctuation">]</span># cat <span class="token operator">/</span>etc<span class="token operator">/</span>multipath<span class="token punctuation">.</span><span class="token property-access">conf</span>
defaults <span class="token punctuation">{</span>
        user_friendly_names yes
        path_grouping_policy multibus 
        find_multipaths yes
        path_selector <span class="token string">"round-robin 0"</span>
        failback manual
        rr_weight priorities
        no_path_retry <span class="token number">5</span>
<span class="token punctuation">}</span>

blacklist <span class="token punctuation">{</span>
       devnode <span class="token string">"^sd[ab]"</span> 
       devnode <span class="token string">"sr0"</span>
<span class="token punctuation">}</span>
multipaths <span class="token punctuation">{</span>
       multipath <span class="token punctuation">{</span>
              wwid 3600140579f3599c229346da8e86734e4
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">OCRVOTE</span> 
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405faacac4444884193b7de477e6
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">FRA</span>
       <span class="token punctuation">}</span>
       multipath <span class="token punctuation">{</span>
              wwid 36001405c8e49d885e6843d9bdc448d26
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">DATA</span>
       <span class="token punctuation">}</span>
       # 下方内容为新增内容
       multipath <span class="token punctuation">{</span>
              wwid 36001405181030e174b74aceb74af1647
              alias <span class="token constant">RAC</span><span class="token operator">-</span><span class="token constant">DATA2</span>
	     <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></li><li id="75wc7dGP3B6HaWhCmNomHP"><div class="marker"></div><span class="inline-wrap">重启服务</span><code-block id="o87mb9GMpShPfsXVhsYkA6" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 etc<span class="token punctuation">]</span># systemctl restart multipathd</pre></div></code-block></li><li id="46MJCmsG6A1hPh5KSFXdxm"><div class="marker"></div><span class="inline-wrap">查看新增的硬盘，可以看到</span><span class="inline-wrap"><code>/dev/sdg</code></span><span class="inline-wrap">下已有</span><span class="inline-wrap"><code>RAC-DATA2</code></span><code-block id="p1NrYV9Hd7FWXcE88vEP3u" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 etc<span class="token punctuation">]</span><span class="token comment"># lsblk</span>
NAME             MAJ:MIN RM  SIZE RO TYPE  MOUNTPOINT
sda                <span class="token number">8</span>:0    <span class="token number">0</span>   50G  <span class="token number">0</span> disk  
├─sda1             <span class="token number">8</span>:1    <span class="token number">0</span>    1G  <span class="token number">0</span> part  /boot
└─sda2             <span class="token number">8</span>:2    <span class="token number">0</span>   49G  <span class="token number">0</span> part  
  ├─centos-root  <span class="token number">253</span>:0    <span class="token number">0</span> <span class="token number">45</span>.1G  <span class="token number">0</span> lvm   /
  └─centos-swap  <span class="token number">253</span>:1    <span class="token number">0</span>  <span class="token number">3</span>.9G  <span class="token number">0</span> lvm   <span class="token punctuation">[</span>SWAP<span class="token punctuation">]</span>
sdb                <span class="token number">8</span>:16   <span class="token number">0</span>   20G  <span class="token number">0</span> disk  
├─sdb1             <span class="token number">8</span>:17   <span class="token number">0</span>    6G  <span class="token number">0</span> part  
├─sdb2             <span class="token number">8</span>:18   <span class="token number">0</span>    6G  <span class="token number">0</span> part  
└─sdb3             <span class="token number">8</span>:19   <span class="token number">0</span>    8G  <span class="token number">0</span> part  
sdc                <span class="token number">8</span>:32   <span class="token number">0</span>    5G  <span class="token number">0</span> disk  
└─sdc1             <span class="token number">8</span>:33   <span class="token number">0</span>    5G  <span class="token number">0</span> part  
sdd                <span class="token number">8</span>:48   <span class="token number">0</span>    6G  <span class="token number">0</span> disk  
└─RAC-OCRVOTE    <span class="token number">253</span>:2    <span class="token number">0</span>    6G  <span class="token number">0</span> mpath 
  └─RAC-OCRVOTE1 <span class="token number">253</span>:6    <span class="token number">0</span>    6G  <span class="token number">0</span> part  
sde                <span class="token number">8</span>:64   <span class="token number">0</span>    8G  <span class="token number">0</span> disk  
└─RAC-FRA        <span class="token number">253</span>:4    <span class="token number">0</span>    8G  <span class="token number">0</span> mpath 
  └─RAC-FRA1     <span class="token number">253</span>:7    <span class="token number">0</span>    8G  <span class="token number">0</span> part  
sdf                <span class="token number">8</span>:80   <span class="token number">0</span>    6G  <span class="token number">0</span> disk  
└─RAC-DATA       <span class="token number">253</span>:3    <span class="token number">0</span>    6G  <span class="token number">0</span> mpath 
  └─RAC-DATA1    <span class="token number">253</span>:5    <span class="token number">0</span>    6G  <span class="token number">0</span> part  
sdg                <span class="token number">8</span>:96   <span class="token number">0</span>    5G  <span class="token number">0</span> disk  
└─RAC-DATA2      <span class="token number">253</span>:8    <span class="token number">0</span>    5G  <span class="token number">0</span> mpath 
sr0               <span class="token number">11</span>:0    <span class="token number">1</span>  <span class="token number">4</span>.5G  <span class="token number">0</span> rom</pre></div></code-block></li></ol><h2 id="tQ48E7AFTH6rnMB23aQiKp" class="wolai-block"><span class="inline-wrap">配置<span class="jill"></span>udev（双节点执行）</span></h2><ol class="wolai-block"><li id="iAe79CY7evyJHK6Xqwuf2V"><div class="marker"></div><span class="inline-wrap">查询<span class="jill"></span>DM_UUID</span><code-block id="fEWGdn7LyaqcDLX2qzKgoz" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token punctuation">[</span>root@ora1 etc<span class="token punctuation">]</span><span class="token comment">#udevadm info --query=all --name=/dev/mapper/RAC-DATA2  |grep -i -o dm_uuid.*</span>
<span class="token assign-left variable">DM_UUID</span><span class="token operator">=</span>mpath-36001405181030e174b74aceb74af1647</pre></div></code-block></li><li id="6SSTm69firouySkqvHXvyA"><div class="marker"></div><span class="inline-wrap">编辑<span class="jill"></span>udev<span class="jill"></span>规则，在/etc/udev/rules.d<span class="jill"></span>目录下根据原来<span class="jill"></span>rules<span class="jill"></span>文件,添加一下内容</span><code-block id="a5bNed1Uh5a2cC2czET2Av" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">KERNEL</span><span class="token operator">==</span><span class="token string">"dm-*"</span><span class="token punctuation">,</span><span class="token constant">ENV</span><span class="token punctuation">{</span><span class="token constant">DM_UUID</span><span class="token punctuation">}</span><span class="token operator">==</span><span class="token string">"mpath-36001405181030e174b74aceb74af1647"</span><span class="token punctuation">,</span><span class="token constant">OWNER</span><span class="token operator">=</span><span class="token string">"grid"</span><span class="token punctuation">,</span><span class="token constant">GROUP</span><span class="token operator">=</span><span class="token string">"asmadmin"</span><span class="token punctuation">,</span><span class="token constant">MODE</span><span class="token operator">=</span><span class="token string">"0660"</span></pre></div></code-block></li><li id="4hbj1L5qXCbxcQvHpNGdEL"><div class="marker"></div><span class="inline-wrap">重启<span class="jill"></span>udev<span class="jill"></span>服务</span><code-block id="hmFou7yYgr4JU3iwDSUzY1" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>udevadm control <span class="token operator">--</span>reload<span class="token operator">-</span>rules
udevadm trigger <span class="token operator">--</span>type<span class="token operator">=</span>devices <span class="token operator">--</span>action<span class="token operator">=</span>change</pre></div></code-block></li></ol><h2 id="eZgqbWH4QWRLpYL7zo5s7H" class="wolai-block"><span class="inline-wrap">sqlplus<span class="jill"></span>添加硬盘</span></h2><ol class="wolai-block"><li id="t8BbopGgCAsvSuLSTxMXvk"><div class="marker"></div><span class="inline-wrap">以<span class="jill"></span>grid<span class="jill"></span>身份运行</span><code-block id="jmhJ1fZQeCaofbD1bW5DNy" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>sqlplus <span class="token operator">/</span> <span class="token keyword module">as</span> sysasm</pre></div></code-block></li><li id="3e9AffV6h3FdxzmWutgxtn"><div class="marker"></div><span class="inline-wrap">查看当前硬盘组容量</span><code-block id="pA5FNVLBN994HFiDHhf93k" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">SQL</span><span class="token operator">></span> select name<span class="token punctuation">,</span>state<span class="token punctuation">,</span>total_mb<span class="token punctuation">,</span>free_mb <span class="token keyword module">from</span> v$asm_diskgroup where name<span class="token operator">=</span><span class="token string">'DATA'</span><span class="token punctuation">;</span>
<span class="token constant">NAME</span>			       <span class="token constant">STATE</span>	     <span class="token constant">TOTAL_MB</span>	 <span class="token constant">FREE_MB</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token constant">DATA</span>			       <span class="token constant">MOUNTED</span>		 <span class="token number">6140</span>	    <span class="token number">4476</span></pre></div></code-block></li><li id="1fP6TrzBkhPhEEMPgf2dDD"><div class="marker"></div><span class="inline-wrap">添加硬盘</span><code-block id="w369ps8S3pBH4n6vutCCwU" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre> sql<span class="token operator">></span> <span class="token constant">ALTER</span> <span class="token constant">DISKGROUP</span> data <span class="token constant">ADD</span> <span class="token constant">DISK</span> <span class="token string">'/dev/dm-8'</span><span class="token punctuation">;</span>
 <span class="token maybe-class-name">Diskgroup</span> altered<span class="token punctuation">.</span></pre></div></code-block></li><li id="5oRd5QFW8hDqe1LMYVGeNs"><div class="marker"></div><span class="inline-wrap">查看</span><ul class="wolai-block"><li id="eGBza5npRZ2Sasu8KTKqk1"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">当前空余空间</span></li></ul><code-block id="8Yo6igUyKCicArBf2JWKvq" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">SQL</span><span class="token operator">></span> select name<span class="token punctuation">,</span>state<span class="token punctuation">,</span>total_mb<span class="token punctuation">,</span>free_mb <span class="token keyword module">from</span> v$asm_diskgroup where name<span class="token operator">=</span><span class="token string">'DATA'</span><span class="token punctuation">;</span>

<span class="token constant">NAME</span>			       <span class="token constant">STATE</span>	     <span class="token constant">TOTAL_MB</span>	 <span class="token constant">FREE_MB</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token constant">DATA</span>			       <span class="token constant">MOUNTED</span>		<span class="token number">11259</span>	    <span class="token number">9593</span></pre></div></code-block><ul class="wolai-block"><li id="2QKZKj8TqvT1Hm4uZkHgbe"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">查看磁盘组的文件</span></li></ul><code-block id="uqeFGQHsBLyACQqeaUJc5Z" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token constant">SQL</span><span class="token operator">></span> select name<span class="token punctuation">,</span><span class="token constant">PATH</span> <span class="token keyword module">from</span> v$asm_disk<span class="token punctuation">;</span>

<span class="token constant">NAME</span>             <span class="token constant">PATH</span>
<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
<span class="token constant">FRA_0000</span>         <span class="token operator">/</span>dev<span class="token operator">/</span>dm<span class="token operator">-</span><span class="token number">7</span>
<span class="token constant">OCRVOTE_0000</span>     <span class="token operator">/</span>dev<span class="token operator">/</span>dm<span class="token operator">-</span><span class="token number">6</span>
<span class="token constant">DATA_0000</span>        <span class="token operator">/</span>dev<span class="token operator">/</span>dm<span class="token operator">-</span><span class="token number">5</span>
<span class="token constant">DATA_0001</span>        <span class="token operator">/</span>dev<span class="token operator">/</span>dm<span class="token operator">-</span><span class="token number">8</span></pre></div></code-block></li></ol></article><footer></footer></body></html>