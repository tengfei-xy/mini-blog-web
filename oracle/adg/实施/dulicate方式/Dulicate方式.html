<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../../css/wolai.css"/><title>Dulicate方式 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="Dulicate方式" class="main-title"></div></div></header><article><h1 id="amDnuCtH4zAy7MQoxwVYGN" class="wolai-block"><span class="inline-wrap">一、基本信息</span></h1><div id="58kzxiUhkrWdaTjAByGkvL" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 246.66666666666666px"><span class="inline-wrap">名称</span></th><th style="width: 246.66666666666666px"><span class="inline-wrap">主库</span></th><th style="width: 246.66666666666666px"><span class="inline-wrap">备库</span></th></tr></thead><tbody><tr><td><span class="inline-wrap">ORACLE_SID</span></td><td><span class="inline-wrap">oracle</span></td><td><span class="inline-wrap">oracle</span></td></tr><tr><td><span class="inline-wrap">DB_UNIQUE_NAME</span></td><td><span class="inline-wrap">ora_src</span></td><td><span class="inline-wrap">ora_dst</span></td></tr><tr><td><span class="inline-wrap">IP</span></td><td><span class="inline-wrap">192.168.207.5</span></td><td><span class="inline-wrap">192.168.207.6</span></td></tr><tr><td><span class="inline-wrap">TNSNAME</span></td><td><span class="inline-wrap">tns_ora_src</span></td><td><span class="inline-wrap">tns_ora_dst</span></td></tr></tbody></table></div><h1 id="icEnDhPbLHcUtWr7SyYmiE" class="wolai-block"><span class="inline-wrap">二、数据库配置</span></h1><h2 id="dHs7P5GzSsNog7MPvjDNCU" class="wolai-block"><span class="inline-wrap">2.1 配置双库</span></h2><div id="iJS2wNaScrVhhbMWEBrzqB" class="wolai-block wolai-text"><div><span class="inline-wrap">强制记录日志</span></div></div><code-block id="hroL6rasEDv5uG1pv1gPe6" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> startup mount
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">force</span> logging<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> archivelog<span class="token punctuation">;</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> log_mode<span class="token punctuation">,</span>force_logging <span class="token keyword">from</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>

LOG_MODE     <span class="token keyword">FOR</span>
<span class="token comment">------------ ---</span>
ARCHIVELOG   YES</pre></div></code-block><div id="mx8hMNGFQ5paBmSV4FRgtZ" class="wolai-block wolai-text"><div><span class="inline-wrap">修改<span class="jill"></span>$ORACLE_HOME/network/admin/tnsnames.ora</span></div></div><code-block id="nQgxwEvttxMqTMcXSnUR3v" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre><span class="token key attr-name">tns_ora_src</span><span class="token punctuation">=</span>
  <span class="token key attr-name">(DESCRIPTION</span> <span class="token punctuation">=</span>
    <span class="token key attr-name">(ADDRESS</span> <span class="token punctuation">=</span> <span class="token value attr-value">(PROTOCOL = TCP)(HOST = 192.168.207.5)(PORT = 1521))</span>
    <span class="token key attr-name">(CONNECT_DATA</span> <span class="token punctuation">=</span>
      <span class="token key attr-name">(SERVER</span> <span class="token punctuation">=</span> <span class="token value attr-value">DEDICATED)</span>
      <span class="token key attr-name">(SERVICE_NAME</span> <span class="token punctuation">=</span> <span class="token value attr-value">ora_src)</span>
      <span class="token key attr-name">(UR</span><span class="token punctuation">=</span><span class="token value attr-value">A)</span>
    )
  )
<span class="token key attr-name">tns_ora_dst</span><span class="token punctuation">=</span>  
  <span class="token key attr-name">(DESCRIPTION</span> <span class="token punctuation">=</span>
    <span class="token key attr-name">(ADDRESS</span> <span class="token punctuation">=</span> <span class="token value attr-value">(PROTOCOL = TCP)(HOST = 192.168.207.6)(PORT = 1521))</span>
    <span class="token key attr-name">(CONNECT_DATA</span> <span class="token punctuation">=</span>
      <span class="token key attr-name">(SERVER</span> <span class="token punctuation">=</span> <span class="token value attr-value">DEDICATED)</span>
      <span class="token key attr-name">(SERVICE_NAME</span> <span class="token punctuation">=</span> <span class="token value attr-value">ora_dst)</span>
      <span class="token key attr-name">(UR</span><span class="token punctuation">=</span><span class="token value attr-value">A)</span>
    )
  )</pre></div></code-block><div id="gxzRAyehF1uDfucYaX4597" class="wolai-block wolai-text"><div><span class="inline-wrap">测试连接</span></div></div><code-block id="sAER2grGLd4Mh4Q2Vda1Bk" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>sqlplus sys<span class="token operator">/</span><span class="token maybe-class-name">Password1</span>@tns_ora_src <span class="token keyword module">as</span> sysdba
sqlplus sys<span class="token operator">/</span><span class="token maybe-class-name">Password1</span>@tns_ora_dst <span class="token keyword module">as</span> sysdba</pre></div></code-block><h2 id="mYhHsgYcP1zz5GytpnDvxr" class="wolai-block"><span class="inline-wrap">2.2 配置主库</span></h2><ol class="wolai-block"><li id="8QbVJSXWHSHKqo4JrtEPUk"><div class="marker"></div><span class="inline-wrap">设置数据库参数</span><span class="inline-wrap">
</span><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-3547C937-5DDA-49FF-A9F9-14FF306545D8.htm#REFRN10242"><span>db_unique_name</span></a></span><span class="inline-wrap">：数据库唯一名。</span><span class="inline-wrap">
</span><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-983A9C52-3046-4286-AEA7-800741EE0561.htm#REFRN10087"><span>log_archive_dest_state_1</span></a></span><span class="inline-wrap">：默认<span class="jill"></span>enable</span><span class="inline-wrap">
</span><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-983A9C52-3046-4286-AEA7-800741EE0561.htm#REFRN10087"><span>log_archive_dest_state_2</span></a></span><span class="inline-wrap">：默认<span class="jill"></span>enable</span><code-block id="vSqceiuxCNFfaZ4K614oUS" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> db_unique_name<span class="token operator">=</span><span class="token string">'ora_src'</span> scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">shutdown</span> immediate
<span class="token keyword">SQL</span><span class="token operator">></span> startup</pre></div></code-block><div id="7WXnBy8vGETBbe2k82drMj" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-4DABDBE9-04B6-44D2-B93D-DAB15EA71427.htm#REFRN10237"><span>log_archive_config</span></a></span><span class="inline-wrap">：启用或禁用将<span class="jill"></span>redo<span class="jill"></span>日志发送到远程目标和接收远程重做日志，并配置为主库与备库指定唯一的数据库名称(DB_UNIQUE_NAME)，12c<span class="jill"></span>最多<span class="jill"></span>30<span class="jill"></span>个并逗号隔开。</span></div></div><code-block id="rjyjhyi8Svre2yZ6kTo5Ck" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- alter system set log_archive_config='dg_config=(,,,...)' scope=both;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_config<span class="token operator">=</span><span class="token string">'dg_config=(ora_src,ora_dst)'</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span></pre></div></code-block><div id="t52P8p9cVSky9jHvEBabcc" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-10BD97BF-6295-4E85-A1A3-854E15E05A44.htm#REFRN10086"><span>log_archive_dest_1</span></a></span><span class="inline-wrap">：主库的存档位置(通过</span><span class="inline-wrap"><code>show parameter log_archive_dest_1</code></span><span class="inline-wrap">查看)、db_unique_name：主库名称</span></div></div><code-block id="bweMbbgph7DcQ1c6aBQo2x" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest_1<span class="token operator">=</span><span class="token string">'location=/u01/app/oracle/oradata valid_for=(all_logfiles,all_roles) db_unique_name=ora_src'</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest_state_1<span class="token operator">=</span><span class="token keyword">enable</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span></pre></div></code-block><div id="tvtVgJSrdqSD3vMkuakyK2" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-10BD97BF-6295-4E85-A1A3-854E15E05A44.htm#REFRN10086"><span>log_archive_dest_2</span></a></span><span class="inline-wrap">：备库的<span class="jill"></span>TNSNAME、db_unique_name：备库名称</span></div></div><code-block id="mMHDSpitvEGhcvS4LeWCSP" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest_2<span class="token operator">=</span><span class="token string">'service=tns_ora_dst lgwr async valid_for=(online_logfiles,primary_role) db_unique_name=ora_dst'</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> log_archive_dest_state_2<span class="token operator">=</span><span class="token keyword">enable</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span></pre></div></code-block><div id="oymUtKZwXQzqvqm5MmCkAL" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-4F034B79-AE2A-44E3-8485-E055AA2DDD29.htm#REFRN10056"><span>fal_server</span></a></span><span class="inline-wrap">：备库的<span class="jill"></span>TNSNAME、fal_client：主库的<span class="jill"></span>TNSNAME</span></div></div><code-block id="dsWKzXpAjj2w5kh2UHiLkw" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> fal_server<span class="token operator">=</span><span class="token string">'tns_ora_src'</span> scope<span class="token operator">=</span>both<span class="token punctuation">;</span></pre></div></code-block><div id="dUwWkgkWpwrYMWDtnwCDMF" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-E8B4E0EA-B073-4349-9EA9-E053F499FB9E.htm#REFRN10038"><span>db_file_name_convert</span></a></span><span class="inline-wrap">：备库数据文件目录，其次是主库数据文件目录,</span></div></div><code-block id="tCXMGGM1S2MCW9gKKKMjPv" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> db_file_name_convert<span class="token operator">=</span><span class="token string">'/u01/app/oracle'</span><span class="token punctuation">,</span><span class="token string">'/u01/app/oracle'</span> scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span></pre></div></code-block><div id="2QHu4mS1jrnxwShuGy1pmy" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-3D5894EF-C33D-4687-978F-F640174F6FCC.htm#REFRN10098"><span>log_file_name_convert</span></a></span><span class="inline-wrap">：备库归档日志目录，其次是主库归档日志目录</span></div></div><code-block id="5XqLjuK42VXPimrVuNqkSZ" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system <span class="token keyword">set</span> log_file_name_convert<span class="token operator">=</span><span class="token string">'/u01/app/oracle/oradata'</span><span class="token punctuation">,</span><span class="token string">'/u01/app/oracle/oradata'</span> scope<span class="token operator">=</span>spfile<span class="token punctuation">;</span></pre></div></code-block><div id="aBHoz6R4uLLDCKvkQxBhxi" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://docs.oracle.com/database/121/REFRN/GUID-BD652D33-31C7-47C9-8019-7A4B79A9D974.htm#REFRN10212"><span>standby_file_management</span></a></span><span class="inline-wrap">：设置为<span class="jill"></span>auto<span class="jill"></span>可以自动管理<span class="jill"></span>standby file<span class="jill"></span>文件，设置为<span class="jill"></span>manual<span class="jill"></span>需要手动删除</span></div></div><code-block id="pSWhkbN49vxNHVHpPsxzP3" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">alter</span> system <span class="token keyword">set</span> standby_file_management<span class="token operator">=</span>auto scope<span class="token operator">=</span>both<span class="token punctuation">;</span>
<span class="token comment">-- alter system set standby_file_management=manual scope=both;</span></pre></div></code-block></li><li id="nsrYEiXydTPbeGez5cNoED"><div class="marker"></div><span class="inline-wrap">主库重启</span><code-block id="a6eaJcw6QJ6F1wAgpfu2Mk" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">shutdown</span> immediate
<span class="token keyword">SQL</span><span class="token operator">></span> startup
<span class="token comment"># 可发现数据库配置已被更改</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">show</span> parameter name</pre></div></code-block></li><li id="tnui6VA5Qwh8mUHZw9AgY6"><div class="marker"></div><span class="inline-wrap">主库上创建备库的<span class="jill"></span>pfile</span><code-block id="9goqPtdMe1kiTToeWD1Xgq" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> pfile<span class="token operator">=</span><span class="token string">'/home/oracle/ora_dst_pfile'</span> <span class="token keyword">from</span> spfile<span class="token punctuation">;</span></pre></div></code-block><div id="w7f6q2qoDCZwaSEC5cr3Us" class="wolai-block wolai-text"><div><span class="inline-wrap">编辑/home/oracle/ora_dst_pfile，如果<span class="jill"></span>ORALCE_SID<span class="jill"></span>不同,修改<span class="jill"></span>control_files<span class="jill"></span>等参数的路径</span></div></div><code-block id="wWWXXgLEV6uGcNTuX4zDna" class="wolai-block"><div class="wolai-pre"><div data-lang="Ini" class="marker"></div><pre><span class="token key attr-name">*.db_unique_name</span><span class="token punctuation">=</span><span class="token value attr-value">'<span class="token inner-value">ora_dst</span>'</span>
<span class="token key attr-name">*.control_files</span><span class="token punctuation">=</span><span class="token value attr-value">'<span class="token inner-value">/u01/app/oracle/oradata/oracle/control01.ctl','/u01/app/oracle/flash_recovery_area/oracle/control02.ctl</span>'</span>
<span class="token key attr-name">*.log_archive_dest_1</span><span class="token punctuation">=</span><span class="token value attr-value">'<span class="token inner-value">location=/u01/app/oracle/oradata valid_for=(all_logfiles,all_roles) db_unique_name=ora_dst</span>'</span>
<span class="token key attr-name">*.log_archive_dest_2</span><span class="token punctuation">=</span><span class="token value attr-value">'<span class="token inner-value">service=tns_ora_src lgwr async valid_for=(online_logfiles,primary_role) db_unique_name=ora_src</span>'</span></pre></div></code-block></li><li id="fw9v4ofnUSLykeL224sbFP"><div class="marker"></div><span class="inline-wrap">复制<span class="jill"></span>pfile<span class="jill"></span>到备库</span><code-block id="qhhwdE8hHYHL1Njc3xTLna" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">scp</span> /home/oracle/ora_dst_pfile oracle@192.168.207.6:</pre></div></code-block></li></ol><h2 id="1i1AGRnjB57kGYXr4G8k2c" class="wolai-block"><span class="inline-wrap">2.3 配置备库</span></h2><ol class="wolai-block"><li id="qjN3fRvugTTAYHHRC1nPKo"><div class="marker"></div><span class="inline-wrap">通过<span class="jill"></span>pfile<span class="jill"></span>启动到<span class="jill"></span>nomount<span class="jill"></span>模式（注意备份参数文件）</span><code-block id="rEjKthWfpQGvJ1z9THRUEv" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> startup nomount pfile<span class="token operator">=</span><span class="token operator">/</span>home<span class="token operator">/</span>oracle<span class="token operator">/</span>ora_dst_pfile<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">create</span> spfile <span class="token keyword">from</span> pfile<span class="token operator">=</span><span class="token string">'/home/oracle/ora_dst_pfile'</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="iyV985LP7fJrT52L5MUfDT"><div class="marker"></div><span class="inline-wrap">检查参数，能够看到变化的参数</span><code-block id="aEaTWbHepfXvZuAgpeKitS" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">show</span> parameter name</pre></div></code-block></li><li id="aQSQ9cZVy88rVDC1dnvcYt"><div class="marker"></div><span class="inline-wrap">修改数据库角色</span><code-block id="kHEV2CLbBnoer3u8RD1znF" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- mount状态下</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">SELECT</span> database_role <span class="token keyword">FROM</span> v$<span class="token keyword">database</span><span class="token punctuation">;</span>
DATABASE_ROLE
<span class="token comment">----------------</span>
<span class="token keyword">PRIMARY</span>

<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> <span class="token keyword">CONVERT</span> <span class="token keyword">TO</span> PHYSICAL STANDBY<span class="token punctuation">;</span>
<span class="token keyword">Database</span> altered<span class="token punctuation">.</span></pre></div></code-block></li></ol><h1 id="wpts1RBdtHKD3mgo9Tcxms" class="wolai-block"><span class="inline-wrap">三、初始化数据（主库-&gt;备库）</span></h1><h2 id="m2wseZ7NqMJ2dLPuWM7EZ7" class="wolai-block"><span class="inline-wrap">3.1 复制数据文件</span></h2><div id="cUeYoKMeNFS7iHXVEtr4qD" class="wolai-block wolai-text"><div><span class="inline-wrap">主库执行（主库<span class="jill"></span>read write<span class="jill"></span>状态，备库<span class="jill"></span>nomount<span class="jill"></span>状态）</span></div></div><code-block id="wRU5RmLzGHr3Ftx4NoTYye" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token punctuation">[</span>oracle@ora1 admin<span class="token punctuation">]</span>$ rman target sys/Password1@tns_ora_src auxiliary sys/Password1@tns_ora_dst
connected to target database: ORACLE <span class="token punctuation">(</span>DBID<span class="token operator">=</span><span class="token number">1956275221</span><span class="token punctuation">)</span>
connected to auxiliary database: ORACLE <span class="token punctuation">(</span>not mounted<span class="token punctuation">)</span>
rman target sys/password@tns_ora_src auxiliary sys/password@tns_ora_dst
rman<span class="token operator">></span> DUPLICATE TARGET DATABASE FOR STANDBY FROM ACTIVE DATABASE NOFILENAMECHECK<span class="token punctuation">;</span></pre></div></code-block><div id="fHisfXimPTB7v3rCJmjyxC" class="wolai-block wolai-text"><div><span class="inline-wrap">备库执行</span></div></div><code-block id="ugiKVxvmpqTghzSAZemQWE" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token keyword">group</span><span class="token comment">#,status from v$standby_log;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">1</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo1.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">2</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo2.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> 
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">3</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo3.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> 
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">4</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo4.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> 
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">5</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo5.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> 
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">6</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo6.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> 
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">7</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo7.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> 
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">add</span> standby logfile thread <span class="token number">1</span> <span class="token keyword">group</span> <span class="token number">8</span><span class="token punctuation">(</span><span class="token string">'/u01/app/oracle/oradata/redo8.log'</span><span class="token punctuation">)</span> size <span class="token number">200</span>M<span class="token punctuation">;</span> </pre></div></code-block><div id="g93nswuYwsu9WvTZAurDdB" class="wolai-block wolai-text"><div><span class="inline-wrap">实时应用，备库开启至<span class="jill"></span>open<span class="jill"></span>状态</span></div></div><code-block id="ex1X72n5AsxUawqsD7bUdt" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> recover managed standby <span class="token keyword">database</span> <span class="token keyword">using</span> <span class="token keyword">current</span> logfile disconnect <span class="token keyword">from</span> <span class="token keyword">session</span><span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> recover managed standby <span class="token keyword">database</span> cancel<span class="token punctuation">;</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token keyword">open</span> <span class="token keyword">read</span> only<span class="token punctuation">;</span></pre></div></code-block><div id="4uoFAN1YKwCfP55ecMC7Pq" class="wolai-block wolai-text"><div><span class="inline-wrap">此时可以插入数据，查看是否同步</span></div></div><h2 id="da4CiD63L3i1qmFLjw4kdb" class="wolai-block"><span class="inline-wrap">3.2 快速测试</span></h2><div id="6PN4TvpoiQn6BKkoN2n4ra" class="wolai-block wolai-text"><div><span class="inline-wrap">主库</span></div></div><code-block id="vVF9oiVNNkoCwU2jjWuD9C" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">alter</span> system switch logfile</pre></div></code-block><div id="tYK56JRHPLNcmUDBWhBe1f" class="wolai-block wolai-text"><div><span class="inline-wrap">主库、备库查看序列号同步情况</span></div></div><code-block id="bcaP9L8YCGNAfM2BpgiXjw" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token comment">-- 11g</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sequence<span class="token comment">#) from v$log;</span>
<span class="token comment">-- 12c,不要使用archive log list查看(Doc ID 2041137.1)</span>
<span class="token keyword">SQL</span><span class="token operator">></span> <span class="token keyword">select</span> <span class="token function">max</span><span class="token punctuation">(</span>sequence<span class="token comment">#) from v$archived_log;</span></pre></div></code-block><hr id="3CqMRLEzbCdsAHFvFmj5dm" class="wolai-block"/><div id="v5H356hDKkR5ppEtvHGP5d" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文档：</span></div></div><div id="wcHJpxsY4cJY9kw8ApdZwK" class="wolai-bookmark wolai-block"><a href="https://mp.weixin.qq.com/s/m1S-ElWOYf_h2kcrre5HNA">https://mp.weixin.qq.com/s/m1S-ElWOYf_h2kcrre5HNA</a><div class="info-box"><div class="text-pane"><div data-title="https://mp.weixin.qq.com/s/m1S-ElWOYf_h2kcrre5HNA"></div><div class="icon-host"></div></div><div class="preview-pane"></div></div></div><div id="vQh2puQbZeMEjSC3eMzy5M" class="wolai-bookmark wolai-block"><a href="https://www.modb.pro/db/37720">https://www.modb.pro/db/37720</a><div class="info-box"><div class="text-pane"><div data-title="https://www.modb.pro/db/37720"></div><div class="icon-host"></div></div><div class="preview-pane"></div></div></div><div id="u9ftdWkor4TnwfELdVrbBw" class="wolai-bookmark wolai-block"><a href="https://docs.oracle.com/database/121/REFRN/GUID-10BD97BF-6295-4E85-A1A3-854E15E05A44.htm#REFRN10086">https://docs.oracle.com/database/121/REFRN/GUID-10BD97BF-6295-4E85-A1A3-854E15E05A44.htm#REFRN10086</a><div class="info-box"><div class="text-pane"><div data-title="https://docs.oracle.com/database/121/REFRN/GUID-10BD97BF-6295-4E85-A1A3-854E15E05A44.htm#REFRN10086"></div><div class="icon-host"></div></div><div class="preview-pane"></div></div></div><div id="pgHg4KnGpEpRTRktbpvnSW" class="wolai-bookmark wolai-block"><a href="https://www.oracle.com/technetwork/database/availability/active-data-guard-wp-12c-1896127.pdf">https://www.oracle.com/technetwork/database/availability/active-data-guard-wp-12c-1896127.pdf</a><div class="info-box"><div class="text-pane"><div data-title="https://www.oracle.com/technetwork/database/availability/active-data-guard-wp-12c-1896127.pdf"></div><div class="icon-host"></div></div><div class="preview-pane"></div></div></div><div id="4DcKWR5QwXHoouvnpr2XTZ" class="wolai-bookmark wolai-block"><a href="https://docs.oracle.com/database/121/HABPT/config_dg.htm#HABPT4876">https://docs.oracle.com/database/121/HABPT/config_dg.htm#HABPT4876</a><div class="info-box"><div class="text-pane"><div data-title="https://docs.oracle.com/database/121/HABPT/config_dg.htm#HABPT4876"></div><div class="icon-host"></div></div><div class="preview-pane"></div></div></div></article><footer></footer></body></html>