<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>json - wolai ç¬”è®°</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="json" class="main-title"></div></div></header><article><details id="t779WQxDHVLGvtpFbgaTqR" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">è‡ªå»ºåº“</span></summary><aside id="shCZcfAB2puFA9Y5kmzmco" class="bg-cultured wolai-block"><div data-symbol="ğŸ“Œ" class="icon"></div><span class="inline-wrap">åŸºäºé€’å½’è§£æ<span class="jill"></span>json</span></aside><details id="2JBeMUSZEGDDsKMLpB5S6n" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">å®‰è£…</span></summary><details id="sxJTVP1ap5c1jUJHWvF7c2" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">.h</span></summary><code-block id="wBpFYho6d6ZAsgbwYbdrX" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>limits<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>stdbool<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>ctype<span class="token punctuation">.</span>h<span class="token operator">></span>

#include <span class="token string">"strings.h"</span>

#define <span class="token constant">JSON_TYPE_NULL</span> <span class="token number">0</span>
#define <span class="token constant">JSON_TYPE_STRING</span> <span class="token number">1</span>
#define <span class="token constant">JSON_TYPE_INT</span> <span class="token number">2</span>
#define <span class="token constant">JSON_TYPE_LONG</span> <span class="token number">3</span>
#define <span class="token constant">JSON_TYPE_BOOL</span> <span class="token number">4</span>
#define <span class="token constant">JSON_TYPE_EXTAND</span> <span class="token number">10</span>
#define <span class="token constant">JSON_TYPE_ARRAY</span> <span class="token number">11</span>
#define <span class="token constant">JSON_TYPE_ELEMENT</span> <span class="token number">12</span>

#define <span class="token constant">KEY_STATUS_RESET</span> <span class="token number">0</span>
#define <span class="token constant">KEY_STATUS_ENTER</span> <span class="token number">1</span>
#define <span class="token constant">KEY_STATUS_EXIT</span> <span class="token number">2</span>

#define <span class="token constant">JSON_STATUS_FIND_OUT</span> <span class="token number">0</span>
#define <span class="token constant">JSON_STATUS_NO_KEY</span> <span class="token number">1</span>
#define <span class="token constant">JSON_STATUS_NO_TYPE</span> <span class="token number">2</span>
#define <span class="token constant">JSON_STATUS_PARSE_FAILED</span> <span class="token number">3</span>
#define <span class="token constant">JSON_STATUS_READ_FAILED</span> <span class="token number">4</span>

#define <span class="token constant">JSON_FOUND_NO</span> <span class="token number">0</span>
#define <span class="token constant">JSON_FOUND_KEY</span> <span class="token number">1</span>
#define <span class="token constant">JSON_FOUND_WORD</span> <span class="token number">2</span>

#define <span class="token constant">JSON_ERROR_BOOL</span> <span class="token string">"parse bool type error"</span>
#define <span class="token constant">JSON_ERROR_FONND_FILED</span> <span class="token string">"Field not found"</span>
#define <span class="token constant">JSON_ERROR_STRING_NULL</span> <span class="token string">"Invalid target string"</span>

#ifndef <span class="token constant">AJSON_STRUCT</span>
#define <span class="token constant">AJSON_STRUCT</span>
typedef <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>

    int value_type<span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>value_str<span class="token punctuation">;</span>
    int value_int<span class="token punctuation">;</span>
    long value_long<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> value_bool<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>extant<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>array<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>element<span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token constant">AJSON</span><span class="token punctuation">;</span>

#endif

<span class="token comment">// ä½œç”¨: è¿”å›æ–°ç»“æ„ä½“,å¹¶åˆå§‹åŒ–</span>
<span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: å°è£…JSON</span>
void <span class="token function">json_packaging</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> void <span class="token operator">*</span>value<span class="token punctuation">,</span> int <span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: é‡Šæ”¾å°è£…çš„JSON</span>
<span class="token comment">// void json_packaging_free(AJSON *json);</span>

<span class="token comment">// ä½œç”¨: æ•°æ®ç»“æ„é‡Šæ”¾</span>
void <span class="token function">json_free</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_free_nolloc</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_free_base</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">bool</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: è¾“å‡ºå­—ç¬¦ä¸²åˆ°str</span>
<span class="token comment">// void json_string(AJSON *json, char *str);</span>

<span class="token comment">// ä½œç”¨: è¾“å‡ºå­—ç¬¦ä¸²åˆ°str</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">json_string</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_string_base</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">str</span><span class="token punctuation">,</span> int str_total_size<span class="token punctuation">,</span> <span class="token keyword">bool</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: é‡Šæ”¾json_string()çš„å­—ç¬¦ä¸²</span>
void <span class="token function">json_string_free</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>json_str<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: è®¡ç®—ç›®æ ‡JSONçš„åºåˆ—åŒ–åçš„é•¿åº¦</span>
<span class="token comment">// ç”¨æ³•: </span>
<span class="token comment">// int total = json_sizeof(json, false);total +=1;</span>
int <span class="token function">json_sizeof</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">bool</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: æ‰“å°</span>
<span class="token comment">// å‚æ•°: é¦–æ¬¡è°ƒç”¨æ—¶,prev_depth=0,array=false,pretty ä½œä¸ºäººæ€§åŒ–è¾“å‡º</span>
<span class="token comment">// è¿”å›: jsonå­—ç¬¦æ•°</span>
<span class="token comment">// ç”¨æ³•:</span>
<span class="token comment">// json_print(ret, 0, true, false, 0, 0, 0);</span>
int <span class="token function">json_print</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> int symbol<span class="token punctuation">,</span> <span class="token keyword">bool</span> pretty<span class="token punctuation">,</span> <span class="token keyword">bool</span> array<span class="token punctuation">,</span> int element_seq<span class="token punctuation">,</span> int depth<span class="token punctuation">,</span> int <span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: æŸ¥è¯¢æŒ‡å®šå­—æ®µ</span>
<span class="token comment">// å‚æ•°: queryå‚è€ƒjqå‘½ä»¤çš„ç”¨æ³•</span>
<span class="token comment">// æ³¨æ„: keyç›¸åŒæ—¶ï¼Œè¿›æŸ¥è¯¢ç¬¬ä¸€æ¡keyï¼Œæ²¡æœ‰åŒ¹é…å€¼æ—¶è¿”å›NULL</span>
<span class="token comment">// ç”¨æ³•:</span>
<span class="token comment">// int:    *(int *)json_read(json, query )</span>
<span class="token comment">// string: (char *)json_read(json, query )</span>
<span class="token comment">// bool: (*(bool*)(json_read(json, query))</span>
void <span class="token operator">*</span><span class="token function">json_read</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token function">json_extract</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: è®¡ç®—æ•°ç»„é•¿åº¦</span>
<span class="token comment">// æ³¨æ„: æ— æ³•åŒ¹é…åˆ°keyæ—¶è¿”å›0,æŸ¥è¯¢çš„jsonéœ€è¦æ˜¯arraryç±»å‹</span>
<span class="token comment">// ç”¨æ³•:</span>
<span class="token comment">// char query[] = ".data";</span>
<span class="token comment">// int length = json_length(json, query));</span>
int <span class="token function">json_length</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨:è§£æ</span>
<span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token function">json_decoding</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>now_json<span class="token punctuation">,</span> <span class="token constant">AJSON</span> <span class="token operator">*</span>prev_json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> int <span class="token operator">*</span>pop<span class="token punctuation">,</span> int <span class="token operator">*</span>recursion_seq<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: ä½œä¸ºå­—ç¬¦ä¸²æŸ¥è¯¢æ—¶çš„åˆ‡å‰²æ–¹æ³•</span>
<span class="token comment">// è¿”å›: 0å¯ä»¥ç»§ç»­åˆ†éš”,1=æœ«å°¾å­—æ®µ</span>
<span class="token keyword">bool</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token keyword">char</span> symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: ç”¨äºåœ¨json_readä¸­,åˆ¤æ–­æŒ‡å‘å­—ç¬¦ä¸²æ˜¯å¦ä½äºé¦–ä¸ªåˆ†éš”å­—æ®µä¸­</span>
<span class="token keyword">bool</span> <span class="token function">json_compare_word</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>left<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ä½œç”¨: ä»…ä»…ç”¨äºå‡½æ•°æµ‹è¯•å’Œå‡½æ•°ç”¨æ³•å±•ç¤º</span>
void <span class="token function">json_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></details><details id="js6r3AMzFk7wRoiF2ZwazR" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">.c</span></summary><code-block id="ek2cCA7Ppeyr4HgYUsKY2w" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"json.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"strings.h"</span></span>
bool json_debug <span class="token operator">=</span> false<span class="token punctuation">;</span>
<span class="token keyword">int</span> json_total_new <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> json_total_free <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

AJSON <span class="token operator">*</span><span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AJSON <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>AJSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>AJSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json_debug<span class="token punctuation">)</span>
        json_total_new<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_packaging</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AJSON <span class="token operator">*</span>prev_json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> JSON_TYPE_ELEMENT<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        AJSON <span class="token operator">*</span>element <span class="token operator">=</span> <span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            prev_json <span class="token operator">=</span> json<span class="token punctuation">;</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        json<span class="token operator">-></span>element <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type <span class="token operator">!=</span> JSON_TYPE_NULL<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        prev_json <span class="token operator">=</span> json<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            prev_json <span class="token operator">=</span> json<span class="token punctuation">;</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        json<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token operator">-></span>next<span class="token operator">-></span>prev <span class="token operator">=</span> json<span class="token punctuation">;</span> <span class="token comment">// è®¾ç½®ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„prevæŒ‡é’ˆä¸ºå½“å‰èŠ‚ç‚¹</span>
        json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        json<span class="token operator">-></span>prev <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™prevæŒ‡é’ˆè®¾ä¸ºNULL</span>
    <span class="token punctuation">}</span>

    json<span class="token operator">-></span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
    json<span class="token operator">-></span>value_type <span class="token operator">=</span> type<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
        json<span class="token operator">-></span>value_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
        json<span class="token operator">-></span>value_int <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
        json<span class="token operator">-></span>value_long <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
        json<span class="token operator">-></span>value_type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        json<span class="token operator">-></span>array <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
        json<span class="token operator">-></span>value_type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        json<span class="token operator">-></span>extant <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">json_string</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> false<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>json_str <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token function">json_string_base</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> json_str<span class="token punctuation">,</span> total<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> json_str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_string_base</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> str_total_size<span class="token punctuation">,</span> bool array<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">'['</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">'{'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\"%s\":"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\"%s\""</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%ld"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
            <span class="token function">json_string_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> str<span class="token punctuation">,</span> str_total_size<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
            <span class="token function">json_string_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> str<span class="token punctuation">,</span> str_total_size<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ELEMENT<span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            AJSON <span class="token operator">*</span>ele <span class="token operator">=</span> json<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ele<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ele <span class="token operator">=</span> ele<span class="token operator">-></span>element<span class="token punctuation">;</span>
                <span class="token function">json_string_base</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> str<span class="token punctuation">,</span> str_total_size<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            str<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">'}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">json_string_free</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>json_str<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">free</span><span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> bool array<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"{"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"\"%s\":"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"\"%s\""</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%ld"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ELEMENT<span class="token operator">:</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            AJSON <span class="token operator">*</span>ele <span class="token operator">=</span> json<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ele<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ele <span class="token operator">=</span> ele<span class="token operator">-></span>element<span class="token punctuation">;</span>
                len <span class="token operator">+=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
                len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            len <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">json_print</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">int</span> symbol<span class="token punctuation">,</span> bool pretty<span class="token punctuation">,</span> bool array<span class="token punctuation">,</span> <span class="token keyword">int</span> element_seq<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"(NULL)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty <span class="token operator">&amp;&amp;</span> type <span class="token operator">!=</span> JSON_TYPE_ARRAY <span class="token operator">&amp;&amp;</span> type <span class="token operator">!=</span> JSON_TYPE_EXTAND<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"      "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"{"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\"%s\": "</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\"%s\":"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\"%s\""</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_BOOL<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_bool <span class="token operator">?</span> <span class="token string">"true"</span> <span class="token operator">:</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> false<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> true<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>next<span class="token punctuation">,</span> symbol <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> false<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> depth<span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"      "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> total<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>element_seq<span class="token operator">++</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>element<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> false<span class="token punctuation">,</span> element_seq<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> total<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">json_read</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>word <span class="token operator">=</span> query<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>bool end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        <span class="token comment">// printf("åˆ†å‰²å­—æ®µ:%s,æŒ‡å‘å­—æ®µ:%s\n", word, json->key);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token operator">-></span>key<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">json_compare_word</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">char</span> <span class="token operator">*</span>c <span class="token operator">=</span> word<span class="token punctuation">;</span>
            <span class="token comment">// printf("åˆ†å‰²å­—æ®µ:%s,æŒ‡å‘å­—æ®µ:%s è¿›å…¥\n", c, json->key);</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">'['</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">char</span> <span class="token operator">*</span>index <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">++</span>c <span class="token operator">!=</span> <span class="token char">']'</span><span class="token punctuation">)</span>
                    index<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>c<span class="token punctuation">;</span>
                json <span class="token operator">=</span> json<span class="token operator">-></span>array<span class="token operator">-></span>element<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> z <span class="token operator">&lt;</span> <span class="token function">atoi</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> z<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
                <span class="token function">free</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">)</span>
                json <span class="token operator">=</span> json<span class="token operator">-></span>extant<span class="token punctuation">;</span>
            end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// printf("å½“å‰å­—æ®µ:%s,å€¼ç±»å‹:%d\n", word, json->value_type);</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
        <span class="token keyword">return</span> json<span class="token operator">-></span>value_str<span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_BOOL<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">json_length</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">int</span> retval<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>word <span class="token operator">=</span> query<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>bool end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// printf("åˆ†å‰²å­—æ®µ:%s,æŒ‡å‘å­—æ®µ:%s\n", word, json->key);</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_compare</span><span class="token punctuation">(</span>json<span class="token operator">-></span>key<span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type <span class="token operator">!=</span> JSON_TYPE_ARRAY<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>retval <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> json <span class="token operator">=</span> json<span class="token operator">-></span>array<span class="token punctuation">;</span> json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> retval<span class="token operator">++</span><span class="token punctuation">)</span>
        json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
    <span class="token keyword">return</span> retval<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
AJSON <span class="token operator">*</span><span class="token function">json_extract</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">int</span> head <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>word <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> head<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// printf("%d:åˆ†å‰²å­—æ®µ:%s,æŒ‡å‘å­—æ®µ:%s\n", head, word, json->key);</span>

        <span class="token keyword">char</span> <span class="token operator">*</span>c <span class="token operator">=</span> word<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">'['</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token keyword">char</span> <span class="token operator">*</span>index <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">++</span>c <span class="token operator">!=</span> <span class="token char">']'</span><span class="token punctuation">)</span>
                    index<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>c<span class="token punctuation">;</span>

                <span class="token keyword">int</span> depth <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">free</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_hasprefix</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>

                    json <span class="token operator">=</span> json<span class="token operator">-></span>array<span class="token operator">-></span>element<span class="token punctuation">;</span>

                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                            json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                word <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_compare</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> found_status <span class="token operator">=</span> JSON_FOUND_NO<span class="token punctuation">;</span>
        AJSON <span class="token operator">*</span>j <span class="token operator">=</span> json<span class="token punctuation">;</span>
        bool stop_strok <span class="token operator">=</span> false<span class="token punctuation">;</span>
        <span class="token keyword">char</span> <span class="token operator">*</span>word_save<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_hasprefix</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> j<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                json <span class="token operator">=</span> j<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    found_status <span class="token operator">=</span> JSON_FOUND_KEY<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop_strok<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        word_save <span class="token operator">=</span> word<span class="token punctuation">;</span>
                        word <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            word <span class="token operator">=</span> word_save<span class="token punctuation">;</span>
                            stop_strok <span class="token operator">=</span> true<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    found_status <span class="token operator">=</span> JSON_FOUND_WORD<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                j <span class="token operator">=</span> j<span class="token operator">-></span>next<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>found_status <span class="token operator">==</span> JSON_FOUND_KEY<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>found_status <span class="token operator">==</span> JSON_FOUND_NO<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
        <span class="token keyword">return</span> json<span class="token operator">-></span>array<span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
        <span class="token keyword">return</span> json<span class="token operator">-></span>extant<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">json_free_base</span><span class="token punctuation">(</span><span class="token operator">*</span>json<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">json_free_</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free_nolloc</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">json_free_base</span><span class="token punctuation">(</span><span class="token operator">*</span>json<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">json_free_</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free_</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// printf("é‡Šæ”¾:%p\n", *json);</span>
    <span class="token function">free</span><span class="token punctuation">(</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json_debug<span class="token punctuation">)</span>
        json_total_free<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free_base</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> bool lloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">)</span>
        <span class="token comment">// printf("é‡Šæ”¾è¿›å…¥ é”®:%s å€¼ç±»å‹:%d å¾ªç¯\n", json->key, json->value_type);</span>
        <span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// printf("é‡Šæ”¾è¿›å…¥ é”®:%s å€¼ç±»å‹:%d \n", json->key, json->value_type);</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lloc<span class="token punctuation">)</span>
                <span class="token function">free</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json<span class="token operator">-></span>value_str <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
            json<span class="token operator">-></span>value_int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
            json<span class="token operator">-></span>value_long <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
            <span class="token function">json_free_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>extant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json<span class="token operator">-></span>extant <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
            <span class="token function">json_free_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json<span class="token operator">-></span>array <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">json_free_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>element<span class="token punctuation">,</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">&amp;&amp;</span> lloc<span class="token punctuation">)</span>
            <span class="token function">free</span><span class="token punctuation">(</span>json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        json<span class="token operator">-></span>key <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>prev<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>prev<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next<span class="token punctuation">)</span>
                <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
AJSON <span class="token operator">*</span><span class="token function">json_decoding</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>now_json<span class="token punctuation">,</span> AJSON <span class="token operator">*</span>prev_json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>pop<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>recursion_seq<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>errmsg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// fmt_status</span>
    <span class="token comment">// 0   => é‡åˆ° {   è½¬å˜1ã€ èµ·å§‹ä¸ºJSONå¼€å¤´</span>
    <span class="token comment">// 0   => é‡åˆ° [   è½¬å˜12ã€èµ·å§‹ä¸ºæ•°ç»„å¼€å¤´</span>
    <span class="token comment">// 1   => é‡åˆ° "   è½¬å˜2ã€ é”®å¼€å¤´</span>
    <span class="token comment">// 2   => é‡åˆ° "   è½¬å˜3ã€ é”®ç»“å°¾</span>
    <span class="token comment">// 3   => é‡åˆ° :   è½¬å˜4</span>
    <span class="token comment">// 4   => é‡åˆ° "   è½¬å˜5ã€ å€¼ä¸ºå­—ç¬¦ä¸²çš„å¼€å¤´</span>
    <span class="token comment">// 4   => é‡åˆ° 0-9 è½¬å˜6ã€ å€¼ä¸ºæ•°å­—ç±»å‹å¼€å¤´</span>
    <span class="token comment">// 4   => é‡åˆ° {   è½¬å˜10ã€å€¼ä¸ºJSONå¼€å¤´</span>
    <span class="token comment">// 4   => é‡åˆ° [   è½¬å˜11ã€å€¼ä¸ºæ•°ç»„å¼€å¤´</span>
    <span class="token comment">// 4   => é‡åˆ° t   è½¬å˜7ã€å€¼ä¸ºboolå¼€å¤´</span>
    <span class="token comment">// 4   => é‡åˆ° f   è½¬å˜8ã€å€¼ä¸ºboolå¼€å¤´</span>
    <span class="token comment">// 5   => å­—ç¬¦ä¸²   è½¬å˜100</span>
    <span class="token comment">// 6   => æ•°å­—     è½¬å˜100</span>
    <span class="token comment">// 7   => true    è½¬å˜100</span>
    <span class="token comment">// 8   => false   è½¬å˜100</span>
    <span class="token comment">// 10  => JSON     è½¬å˜100</span>
    <span class="token comment">// 11  => æ•°ç»„å…ƒç´   è½¬å˜100</span>
    <span class="token comment">// 12  => æ•°ç»„è§£æ  è½¬å˜100</span>
    <span class="token comment">// 100 => å­—æ®µå®Œæˆ  è¿”å›</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        errmsg <span class="token operator">=</span> JSON_ERROR_STRING_NULL<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fmt_status <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>j <span class="token operator">=</span> json <span class="token operator">+</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
    <span class="token keyword">int</span> word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> enter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">*</span>j <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// é“¾è¡¨æ¬¡åº=JSONä¸­çš„å­—æ®µæ•°</span>
        <span class="token comment">// printf("é“¾è¡¨æ¬¡åº:%d fmt_status=%0d key_status=%0d j='%c' pop=%0d\n", *recursion_seq, fmt_status, key_status, *j, *pop);</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>fmt_status<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">'['</span><span class="token operator">:</span>
                <span class="token comment">// json_depth++;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'{'</span><span class="token operator">:</span>
                <span class="token comment">// json_depth++;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>key_status<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> KEY_STATUS_ENTER<span class="token operator">:</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                    key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
                    now_json<span class="token operator">-></span>key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>word_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">&lt;</span> word_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span>
                        now_json<span class="token operator">-></span>key<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> json<span class="token punctuation">[</span><span class="token operator">*</span>pop <span class="token operator">-</span> word_len <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token comment">// printf("é“¾è¡¨æ¬¡åº:%d key=%s\n", *recursion_seq, now_json->key);</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
                    word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">':'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
            word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_STRING<span class="token punctuation">;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'0'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'1'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'3'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'5'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'7'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'8'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'9'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'{'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
                j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'['</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
                j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'t'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'f'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>key_status<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> KEY_STATUS_ENTER<span class="token operator">:</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                    key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
                    now_json<span class="token operator">-></span>value_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>word_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">&lt;</span> word_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span>
                        now_json<span class="token operator">-></span>value_str<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> json<span class="token punctuation">[</span><span class="token operator">*</span>pop <span class="token operator">-</span> word_len <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token comment">// printf("é“¾è¡¨æ¬¡åº:%d value=%s(string)\n", *recursion_seq, now_json->value_str);</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>key_status<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> KEY_STATUS_ENTER<span class="token operator">:</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'0'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'1'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'3'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'5'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'7'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'8'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'9'</span><span class="token operator">:</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'}'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">','</span><span class="token operator">:</span>
                    key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
                    <span class="token keyword">char</span> <span class="token operator">*</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>word_len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">&lt;</span> word_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span>
                        array<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> json<span class="token punctuation">[</span><span class="token operator">*</span>pop <span class="token operator">-</span> word_len <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token function">atol</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">></span> INT_MAX<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        now_json<span class="token operator">-></span>value_long <span class="token operator">=</span> l<span class="token punctuation">;</span>
                        now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_LONG<span class="token punctuation">;</span>
                        <span class="token comment">// printf("é“¾è¡¨æ¬¡åº:%d value=%ld(long)\n", *recursion_seq, now_json->value_long);</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        now_json<span class="token operator">-></span>value_int <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_INT<span class="token punctuation">;</span>
                        <span class="token comment">// printf("é“¾è¡¨æ¬¡åº:%d value=%d(int)\n", *recursion_seq, now_json->value_int);</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">free</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
                    j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token comment">// error</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>

            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">'r'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'u'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'e'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                errmsg <span class="token operator">=</span> JSON_ERROR_BOOL<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_BOOL<span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>value_bool <span class="token operator">=</span> true<span class="token punctuation">;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">'a'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'l'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'e'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                errmsg <span class="token operator">=</span> JSON_ERROR_BOOL<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_BOOL<span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>value_bool <span class="token operator">=</span> false<span class="token punctuation">;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span><span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>extand_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            word_len <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
            <span class="token function">json_decoding</span><span class="token punctuation">(</span>extand_json<span class="token punctuation">,</span> now_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_EXTAND<span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>extant <span class="token operator">=</span> extand_json<span class="token punctuation">;</span>

            j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> word_len<span class="token punctuation">;</span>

            word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span><span class="token punctuation">;</span>

            AJSON <span class="token operator">*</span>array_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            word_len <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
            <span class="token function">json_decoding</span><span class="token punctuation">(</span>array_json<span class="token punctuation">,</span> now_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_ARRAY<span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>array <span class="token operator">=</span> array_json<span class="token punctuation">;</span>

            j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> word_len<span class="token punctuation">;</span>

            word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span><span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>element_now_json<span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>element_prev_json<span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>element_first_json<span class="token punctuation">;</span>
            bool has_element <span class="token operator">=</span> false<span class="token punctuation">;</span>

            <span class="token keyword">int</span> seq <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>bool exec <span class="token operator">=</span> true<span class="token punctuation">;</span> exec <span class="token operator">==</span> true<span class="token punctuation">;</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'{'</span><span class="token operator">:</span>
                    word_len <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>seq <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        element_now_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        element_first_json <span class="token operator">=</span> element_now_json<span class="token punctuation">;</span>
                        element_prev_json <span class="token operator">=</span> now_json<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        element_prev_json <span class="token operator">=</span> element_now_json<span class="token punctuation">;</span>
                        element_now_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        element_prev_json<span class="token operator">-></span>element <span class="token operator">=</span> element_now_json<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token function">json_decoding</span><span class="token punctuation">(</span>element_now_json<span class="token punctuation">,</span> element_prev_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    has_element <span class="token operator">=</span> true<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
                    j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> word_len<span class="token punctuation">;</span>

                    seq<span class="token operator">++</span><span class="token punctuation">;</span>

                    word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">','</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'}'</span><span class="token operator">:</span>
                    j<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token char">']'</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>has_element<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_ELEMENT<span class="token punctuation">;</span>
                        now_json<span class="token operator">-></span>element <span class="token operator">=</span> element_first_json<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
                    j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                    exec <span class="token operator">=</span> false<span class="token punctuation">;</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    exec <span class="token operator">=</span> false<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">100</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">','</span><span class="token operator">:</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>next<span class="token operator">-></span>prev <span class="token operator">=</span> now_json<span class="token punctuation">;</span>
                <span class="token function">json_decoding</span><span class="token punctuation">(</span>now_json<span class="token operator">-></span>next<span class="token punctuation">,</span> now_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
                now_json <span class="token operator">=</span> now_json<span class="token operator">-></span>next<span class="token punctuation">;</span>
                j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> tmp<span class="token punctuation">;</span>
                j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'}'</span><span class="token operator">:</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token char">']'</span><span class="token operator">:</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
bool <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">char</span> symbol<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>str <span class="token operator">==</span> <span class="token char">'\0'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    bool has <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>str<span class="token punctuation">;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> symbol<span class="token punctuation">)</span>
            has <span class="token operator">=</span> true<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>has<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>has<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>bool has_sysmbol <span class="token operator">=</span> true<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>str <span class="token operator">==</span> symbol<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>str<span class="token punctuation">;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> symbol<span class="token punctuation">)</span>
                    has_sysmbol <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token keyword">return</span> has_sysmbol<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>str <span class="token operator">==</span> <span class="token char">'\0'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
bool <span class="token function">json_compare_word</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>left<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>right<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// printf("å¯¹æ¯”å­—æ®µ %s %s\n", left, right);</span>

    <span class="token comment">// ok:data   ,data</span>
    <span class="token comment">// ok:data.a ,data</span>
    <span class="token comment">// no:a.data ,data</span>
    bool ok <span class="token operator">=</span> <span class="token function">string_hasprefix</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ok<span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>

    <span class="token comment">// ok:data   ,data</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>

    <span class="token comment">// ok:data[0].a   ,data</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>left<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'['</span> <span class="token operator">||</span> left<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'.'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>

    <span class="token keyword">return</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>errmsg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token comment">// char *str = "{\"data\":[{\"id\":\"binzhou30\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou29\",\"state\":0,\"timeout\":18976},{\"id\":\"binzhou28\",\"state\":0,\"timeout\":49019},{\"id\":\"binzhou03\",\"state\":0,\"timeout\":659},{\"id\":\"binzhou06\",\"state\":0,\"timeout\":475},{\"id\":\"binzhou07\",\"state\":0,\"timeout\":18729},{\"id\":\"binzhou10\",\"state\":0,\"timeout\":473},{\"id\":\"binzhou13\",\"state\":0,\"timeout\":91246},{\"id\":\"binzhou16\",\"state\":0,\"timeout\":473},{\"id\":\"binzhou21\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou22\",\"state\":0,\"timeout\":44304},{\"id\":\"binzhou24\",\"state\":0,\"timeout\":18235},{\"id\":\"binzhou26\",\"state\":0,\"timeout\":471},{\"id\":\"binzhou09\",\"state\":0,\"timeout\":474},{\"id\":\"binzhou19\",\"state\":0,\"timeout\":1829}],\"messages\":\"success\",\"status\":true}";</span>
    <span class="token comment">// char *str = "{\"data\":[{\"id\":\"binzhou30\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou29\",\"state\":0,\"timeout\":18976},{\"id\":\"binzhou28\",\"state\":0,\"timeout\":49019}],\"data2\":[{\"id\":\"binzhou1\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou2\",\"state\":0,\"timeout\":18976},{\"id\":\"binzhou3\",\"state\":0,\"timeout\":49019}],\"messages\":\"success\",\"status\":true}";</span>
    <span class="token comment">// char *str = "{\"errcode\":\"0\",\"msg\":\"success\",\"data\":{\"vmname\":\"zhiweid09\",\"vmprdid\":\"61\",\"vpspassword\":\"zhiweidata\",\"endtime\":\"2023-11-03 19:27:13\",\"conninfo\":\"wenzhou01.263vps.cn:20601\",\"adslname\":\"057781205941\",\"adslpass\":\"648307\",\"cpurl\":\"106.14.117.11:8001\",\"runstatus\":\"1\",\"status\":\"æ­£å¸¸\",\"osid\":\"0\",\"cityid\":\"0\",\"cityname\":\"\"}}";</span>
    <span class="token comment">// char *str = "{\"data\":{\"vmname\":\"zhiweid09\",\"vmprdid\":\"61\",\"vpspassword\":\"zhiweidata\",\"endtime\":\"2023-11-03 19:27:13\",\"conninfo\":\"wenzhou01.263vps.cn:20601\",\"adslname\":\"057781205941\",\"adslpass\":\"648307\",\"cpurl\":\"106.14.117.11:8001\",\"runstatus\":\"1\",\"status\":\"æ­£å¸¸\",\"osid\":\"0\",\"cityid\":\"0\",\"cityname\":\"\"},\"errcode\":\"0\",\"msg\":\"success\"}";</span>

    <span class="token comment">// è§£æç”¨æ³•</span>
    <span class="token comment">// AJSON *aj = json_new();</span>
    <span class="token comment">// int start = 0;</span>
    <span class="token comment">// int recursion_seq = 0;</span>
    <span class="token comment">// json_decoding(aj, aj, str, &amp;start, &amp;recursion_seq, errmsg);</span>
    <span class="token comment">// if (errmsg != NULL)</span>
    <span class="token comment">// {</span>
    <span class="token comment">//     printf("decode error: %s\n", errmsg);</span>
    <span class="token comment">// }</span>

    <span class="token comment">// // å°è£… æ•°ç»„</span>
    <span class="token comment">// AJSON *json = json_new();</span>
    <span class="token comment">// AJSON *array_json = json_new();</span>
    <span class="token comment">// json_packaging(json, "data", array_json, JSON_TYPE_ARRAY);</span>
    <span class="token comment">// for (int i = 0; i &lt;= 1; i++)</span>
    <span class="token comment">// {</span>
    <span class="token comment">//     AJSON *vps_json = json_new();</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_ISP", (void *)"2", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_PRODUCT", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_NAME", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_INTERNAL_ID", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_EXTERNAL_ID", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_REMOTE_ADDRESS", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_LAN", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_ISP_ACCOUNT", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_ISP_PASSWORD", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_GROUP", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_RESTART_TIMESTAMP", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_RESTART_COUNT", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(array_json, NULL, vps_json, JSON_TYPE_ELEMENT);</span>
    <span class="token comment">// }</span>
    <span class="token comment">// // è¾“å‡ºå­—ç¬¦ä¸²</span>
    <span class="token comment">// char *json_str = json_string(json);</span>
    <span class="token comment">// printf("%s\n", json_str);</span>
    <span class="token comment">// json_string_free(json_str);</span>

    <span class="token comment">// ç›´æ¥æ‰“å°</span>
    <span class="token comment">// printf("%s\n",json->array->element->element->next->key);</span>
    <span class="token comment">// printf("%s\n",json->array->element->element->next->value_str);</span>
    <span class="token comment">// printf("%s\n", aj->next->prev->value_str);</span>
    <span class="token comment">// printf("%d\n", aj->next->next->prev->value_int);</span>

    <span class="token comment">// æ‰“å°json</span>
    <span class="token comment">// json_print(json, 0, true, false, 0, 0, 0);</span>
    <span class="token comment">// printf("\n---------------\n");</span>

    <span class="token comment">// æŸ¥è¯¢ int</span>
    <span class="token comment">// int *i = json_read(aj, ".data[1].timeout");</span>
    <span class="token comment">// printf("%d\n", *i);</span>

    <span class="token comment">// æŸ¥è¯¢ string</span>
    <span class="token comment">// char *remote_address = json_read(aj, ".data.conninfo");</span>
    <span class="token comment">// char *isp_account = json_read(aj, ".data.adslname");</span>
    <span class="token comment">// char *isp_password = json_read(aj, ".data.adslpass");</span>
    <span class="token comment">// char *external_id = json_read(aj, ".data.vmname");</span>
    <span class="token comment">// char *internal_id = json_read(aj, ".data.vmprdid");</span>
    <span class="token comment">// printf("%s\n", remote_address);</span>
    <span class="token comment">// printf("%s\n", isp_account);</span>
    <span class="token comment">// printf("%s\n", isp_password);</span>
    <span class="token comment">// printf("%s\n", external_id);</span>
    <span class="token comment">// printf("%s\n", internal_id);</span>

    <span class="token comment">// æå–</span>
    <span class="token comment">// char query[] = ".data";</span>
    <span class="token comment">// AJSON *ret = json_extract(aj, query);</span>
    <span class="token comment">// json_print(ret, 0, true, false, 0, 0, 0);</span>
    <span class="token comment">// printf("%d",string_hasprefix("data[0]","data"));</span>

    <span class="token comment">// è®¡ç®—é•¿åº¦</span>
    <span class="token comment">// int data_len = json_length(aj, ".data");</span>
    <span class="token comment">// printf("%d\n", data_len);</span>

    <span class="token comment">// json_free(&amp;aj);</span>

    <span class="token comment">// if (json_debug)</span>
    <span class="token comment">//     printf("è·å–æ¬¡æ•°:%d é‡Šæ”¾æ¬¡æ•°:%d", json_total_new, json_total_free);</span>

    <span class="token comment">// json_free_nolloc(&amp;json);</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="HKAAn9xG14CBwLAYiXHUq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">ç”¨æ³•</span></summary><div id="aPT6CK5UhaBrGa8akTswo" class="wolai-block wolai-text"><div><span class="inline-wrap">å‚è€ƒå¤´æ–‡ä»¶</span></div></div></details></details><div id="qRs9hhaXBmLUhN28Hvjwc9" class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>