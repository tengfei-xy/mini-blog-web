<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>指标 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="指标" class="main-title"></div></div></header><article><div id="do6bj3T961qQCNqzx2GTeR" class="wolai-block wolai-text"><div><span class="blue inline-wrap">指标</span><span class="inline-wrap">：是通俗易懂的数字测量。用户想要测量的内容因应用程序而异。对于 Web 服务器，它可能是请求时间;对于数据库，它可以是活动连接数或活动查询数，依此类推。</span></div></div><div id="5rncrHjYqAcaZ5cfRdTCMJ" class="wolai-block wolai-text"><div><span class="blue inline-wrap">时间序列</span><span class="inline-wrap">：指记录随时间变化的情况。</span></div></div><details id="886a2c4biDLkpzzrtG4ABv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">类型</span></summary><details id="cie1UiZWogxgYaEKaQyGLJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Counter / 累积指标</span></summary><div id="g1HddQPNbdN61LzgiYTE9y" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：表示单个单调递增的计数器，其值只能增加或在重启时重置为零。</span></div></div><div id="wVE7ag6w9hofg8u83jSsSW" class="wolai-block wolai-text"><div><span class="blue inline-wrap">用途</span><span class="inline-wrap">：表示事件数量、资源使用量等</span></div></div><div id="44F6qBZ9WN4NFXzxfrrbpj" class="wolai-block wolai-text"><div><span class="blue inline-wrap">示例</span><span class="inline-wrap">：HTTP 请求的总数、已使用的内存量</span></div></div><details id="hreTyCAmntbawaidSjhVgd" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建</span></summary><details id="iuPuycU9bTscCVnNrsnL5r" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">rust</span></summary><div class="block-ref"><div class="decorator"></div><code-block id="87Z7P8sPLy5vKbtycmfzoc" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">use</span> <span class="token namespace">prometheus<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Counter</span><span class="token punctuation">,</span> <span class="token class-name">CounterVec</span><span class="token punctuation">,</span> <span class="token class-name">Opts</span><span class="token punctuation">,</span> <span class="token class-name">Registry</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> opts <span class="token operator">=</span> <span class="token class-name">Opts</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"my_counter"</span><span class="token punctuation">,</span> <span class="token string">"My counter help"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">"my_namespace"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token class-name">Counter</span><span class="token punctuation">::</span><span class="token function">with_opts</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

counter<span class="token punctuation">.</span><span class="token function">inc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></div></details></details></details><details id="bU5ZZDzYNgDVwA7XjkdL6i" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Gauge / </span><span class="inline-wrap">数值指标</span></summary><div id="mGny8PRGFrGNRYk6DTWcum" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap">其值可以增加或减少。Gauge 通常用于表示当前状态、资源可用性等。</span></div></div><div id="6dni1wfmgxURt2TurRcVzz" class="wolai-block wolai-text"><div><span class="blue inline-wrap">用途</span><span class="inline-wrap">：表示当前状态、资源可用性等</span></div></div><div id="5hTe3qWg3Zsah9kHAxZU3Z" class="wolai-block wolai-text"><div><span class="blue inline-wrap">示例</span><span class="inline-wrap">：CPU 的使用率、可用磁盘空间的大小</span></div></div><details id="eREtonu4GCBJp6ehiuSmSy" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建</span></summary><details id="dGbsH15a75cLz6TkrhqdAq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">rust</span></summary><div class="block-ref"><div class="decorator"></div><code-block id="kkd3EPiRuhmbj9n35c2gZX" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">use</span> <span class="token namespace">prometheus<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Gauge</span><span class="token punctuation">,</span> <span class="token class-name">Opts</span><span class="token punctuation">,</span> <span class="token class-name">Registry</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> opts <span class="token operator">=</span> <span class="token class-name">Opts</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"my_gauge"</span><span class="token punctuation">,</span> <span class="token string">"My gauge help"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">"my_namespace"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> gauge <span class="token operator">=</span> <span class="token class-name">Gauge</span><span class="token punctuation">::</span><span class="token function">with_opts</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gauge<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></div></details></details></details><details id="73skbKaTTtLFgBu9qsLBJK" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Histogram / 直方图指标</span></summary><div id="3TAECrQAvuhKbpjix3ZNiM" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：</span><span class="inline-wrap">表示一组数据的分布情况。Histogram 将数据划分为多个区间，并记录每个区间内的数据量。</span></div></div><div id="4AG16JCkDejxoyXktKUeYk" class="wolai-block wolai-text"><div><span class="blue inline-wrap">用途</span><span class="inline-wrap">：表示一组数据的分布情况</span></div></div><div id="841hYyG2Y7n3n8jB9jmR1U" class="wolai-block wolai-text"><div><span class="blue inline-wrap">示例</span><span class="inline-wrap">： HTTP 请求的延迟、响应时间</span></div></div><details id="mpps5bQhUgifJjSBU3zhqt" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建</span></summary><details id="bPGoQAGpm6mRwNqjxwArg6" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">rust</span></summary><div class="block-ref"><div class="decorator"></div><code-block id="2EA7DnYuHNA1HM2ix72HFY" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">use</span> <span class="token namespace">prometheus<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Histogram</span><span class="token punctuation">,</span> <span class="token class-name">HistogramOpts</span><span class="token punctuation">,</span> <span class="token class-name">HistogramVec</span><span class="token punctuation">,</span> <span class="token class-name">Opts</span><span class="token punctuation">,</span> <span class="token class-name">Registry</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> opts <span class="token operator">=</span> <span class="token class-name">HistogramOpts</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"my_histogram"</span><span class="token punctuation">,</span> <span class="token string">"My histogram help"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">"my_namespace"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> histogram <span class="token operator">=</span> <span class="token class-name">Histogram</span><span class="token punctuation">::</span><span class="token function">with_opts</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

histogram<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></div></details></details></details><details id="ctPiq5TRyNACXdfEQYHR8z" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Summary / 概要指标</span></summary><div id="fiA4CT1JZ8mdALrNxxLibe" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：类似于 Histogram，但它提供了更精细的统计信息，例如平均值、标准差、分位数等。</span></div></div><div id="oEU316rgtkLjzityefDbHo" class="wolai-block wolai-text"><div><span class="blue inline-wrap">用途</span><span class="inline-wrap">：提供更精细的统计信息</span></div></div><div id="Sd8hMWrHS7XRf34LfUXfw" class="wolai-block wolai-text"><div><span class="blue inline-wrap">示例</span><span class="inline-wrap">：提供 HTTP 请求延迟的统计信息，例如平均值、标准差、分位数等；响应时间的统计信息，例如平均值、标准差、分位数等</span></div></div><details id="pSLhGAN8gw8mJdKXoHtysQ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">创建</span></summary><details id="vKXxyTG1qpd14bt1e99Abo" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">rust</span></summary><div class="block-ref"><div class="decorator"></div><code-block id="twrYHZiZS1aK5V3N3gmDup" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">use</span> <span class="token namespace">prometheus<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Opts</span><span class="token punctuation">,</span> <span class="token class-name">Registry</span><span class="token punctuation">,</span> <span class="token class-name">Summary</span><span class="token punctuation">,</span> <span class="token class-name">SummaryOpts</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> opts <span class="token operator">=</span> <span class="token class-name">SummaryOpts</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"my_summary"</span><span class="token punctuation">,</span> <span class="token string">"My summary help"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">"my_namespace"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> summary <span class="token operator">=</span> <span class="token class-name">Summary</span><span class="token punctuation">::</span><span class="token function">with_opts</span><span class="token punctuation">(</span>opts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

summary<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block></div></details></details></details></details><details id="uKvWavjMxjduD2wY9N38DX" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">格式</span></summary><details id="vWTSYYSQ5jH6DyN2hpLkdt" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">文本格式</span></summary><details id="hkxw6y2kNwWgZ47F2NumYL" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">简化格式</span></summary><aside id="p3BS8KUzTsmBtrXvtJXX4s" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">Prometheus 从 2.18 版本开始支持这种简化格式。</span></aside><code-block id="cx62pyuKVhbV3VLuRXqcds" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token operator">&lt;</span>metric_name<span class="token operator">></span><span class="token punctuation">{</span><span class="token operator">&lt;</span>label_name<span class="token operator">>=</span><span class="token operator">&lt;</span>label_value<span class="token operator">></span>, <span class="token punctuation">..</span>.<span class="token punctuation">}</span> <span class="token operator">&lt;</span>metric_value<span class="token operator">></span>

<span class="token comment"># &lt;metric_name> 是指标的名称。</span>
<span class="token comment"># &lt;label_name> 和 &lt;label_value> 是指标的标签（可选）。标签用于标识指标的不同维度，例如，可以使用标签来区分不同的服务器或应用程序实例。</span>
<span class="token comment"># &lt;metric_value> 是指标的数值。</span>
</pre></div></code-block></details><details id="6uLspFqQMKvFMgkgGf472D" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">标准格式</span></summary><details id="fS3zteeuAdSAVo5x3ifbcv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">概念</span></summary><details id="dwVsRxUUTzjFAVgrSuvVph" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">指标名称</span></summary><div id="rivcoGT42mEh7UTQxvQZVg" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：指标名称是唯一的，用于标识一个指标。</span></div></div><details id="nWgP8sVkiqNtjthGvNiJru" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">规则</span></summary><ul class="wolai-block"><li id="pfhdzJHjyadBzuF9zbpNSM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">只能包含字母、数字、下划线和点号。</span></li><li id="2me3fSevQJSJCRUZooZyrS"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">不能以数字开头。</span></li><li id="dyZLdqAyyiw4RSTmgHdKfE"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">不能包含空格。</span></li></ul></details></details><details id="f2r7XaQbBCX56CcB97nxWc" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">标签</span></summary><div id="4EeePmyZqVAQXeMx6vnjfM" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：标签用于描述指标的维度。标签可以有多个，每个标签由一个标签名称和一个标签值组成。</span></div></div><details id="4Z6VwHF15BDoju5FNeQt4w" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">规则</span></summary><ul class="wolai-block"><li id="amnJ88CxFra81eHpTnaQbV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">只能包含字母、数字、下划线和点号。</span></li><li id="npSfnEhDjq1D12pYyf1S8V"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">不能以数字开头。</span></li><li id="5jgihhGDwEA2NZQQAaT5Nv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">不能包含空格。</span></li></ul></details></details><details id="ehki1KeeSiAcgPjkP3An57" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">样本</span></summary><div id="sQQKZZs7ndwSJqz71hSSb4" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义</span><span class="inline-wrap">：样本是指一个指标的具体值。</span></div></div><div id="dpkndo8q2Y2KM3F1rpr3T5" class="wolai-block wolai-text"><div><span class="blue inline-wrap">格式</span><span class="inline-wrap">：样本由一个浮点数值和一个时间戳组成。时间戳表示样本的采集时间单位为毫秒。</span></div></div></details></details><details id="qG8pjUv5xFX5ER7srLg8ES" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">格式</span></summary><code-block id="aPeqkEjm5VQmd5KpiZsQoM" class="wolai-block"><div class="wolai-pre"><div data-lang="YAML" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">指标名称
标签1=标签值1<span class="token punctuation">,</span>标签2=标签值2
样本1
样本2</pre></div></code-block><div id="d3wjLbaVSvqhT2Zm1f4HQq" class="wolai-block wolai-text"><div><span class="inline-wrap">示例</span></div></div><code-block id="aHgQUrXmJxAZEG5tEoB2tf" class="wolai-block"><div class="wolai-pre"><div data-lang="YAML" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token key atrule">指标名称</span><span class="token punctuation">:</span> cpu_usage_percent
<span class="token key atrule">标签</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">instance</span><span class="token punctuation">:</span> my_server
  <span class="token punctuation">-</span> <span class="token key atrule">pod</span><span class="token punctuation">:</span> my_pod
样本1
  <span class="token punctuation">-</span> <span class="token number">12.34</span>
样本2
  <span class="token punctuation">-</span> <span class="token number">13.45</span></pre></div></code-block><div id="mLE5vkK6hcoPWeaD6mjUQZ" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details></details></details><details id="3LvhiUacFVCtApAsqL6XuR" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">二进制模式（Protocol Buffers<span class="jill"></span>格式）</span></summary><aside id="sHYEDUM1AMUkBJZQAjVatg" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">从 Prometheus 2.0 版本开始，Protocol Buffers 格式将不再被支持。</span></aside><div id="dpLsCunQVPnmm69Y3UkNdw" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义</span><span class="inline-wrap">：Protocol Buffers 是一种二进制数据格式</span></div></div><div id="ed1VJ7quN3oCV6MC2UPQxE" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用</span><span class="inline-wrap">：此可以用于传输结构化数据。</span></div></div><details id="6tg3qmY3BbMMDdTmtssbfS" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">Prometheus 指标的格式与 Protocol Buffers 格式的区别</span></summary><div id="fYdAx7LqK2pUxkRWdTV3SH" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>数据格式</b></span><span class="inline-wrap">：Prometheus 指标的格式是基于文本的，而 Protocol Buffers 格式是二进制的。</span></div></div><div id="iZWXjUJzvuh6Qys4ZGqinM" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>编辑工具</b></span><span class="inline-wrap">：Prometheus 指标的格式可以用任何文本编辑器编辑，而 Protocol Buffers 格式需要使用 Protocol Buffers 编译器来编译。</span></div></div><div id="eajpeY1AFVPiU93doeM38G" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>兼容性</b></span><span class="inline-wrap">：Prometheus 指标的格式是开放的，可以被任何语言或工具使用，而 Protocol Buffers 格式是 Google 开发的，兼容性相对较差。</span></div></div></details></details></details><details id="dvUfrf1oXHSFvCa3DeGjWk" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">收集</span></summary><details id="6qzqcmm58pq6VnWLvSZt2k" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">拉取模式</span></summary><div id="8e9mBzrjqE2P3j2NQ4c8F8" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：是默认模式，Prometheus 定期从脚本中拉取指标数据。</span></div></div><details id="3FZHHKCnNGzxRe9JGpxxZK" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">实现步骤</span></summary><ol class="wolai-block"><li id="vJgg1KwzyRbQSSvNsFCnFe"><div class="marker"></div><span class="inline-wrap">Prometheus 服务器启动后，会加载配置文件。配置文件中包含需要监控的目标系统和 exporter 的地址。</span></li><li id="r1Az7qikpxoiP2iP8kMJDk"><div class="marker"></div><span class="inline-wrap">Prometheus 服务器会根据配置文件，创建一个或多个 scrape 任务。每个 scrape 任务对应一个被监控目标系统。</span></li><li id="onozfxXfqyygF6vVG3Lxru"><div class="marker"></div><span class="inline-wrap">Prometheus 服务器会定期执行 scrape 任务。</span></li><li id="aUzBnHHTgbmVWBx5Ssohpu"><div class="marker"></div><span class="inline-wrap">在执行 scrape 任务时，Prometheus 服务器会使用 HTTP 协议从被监控目标系统中拉取指标。</span></li><li id="v9shafT1moP4bUHF21aMCE"><div class="marker"></div><span class="inline-wrap">Prometheus 服务器会将拉取到的指标存储在本地数据库中。</span></li></ol></details><details id="kUjs5ebUtARHA9KCjAcNNc" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">适合场景</span></summary><div id="dC5sYCyJGyLJP2CY8Ewv71" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：拉取模式更适合监控实时性要求不高、指标数据量小、本地或可以轻松访问的指标数据。</span></div></div><ul class="wolai-block"><li id="p7zaBm49CrhMaqBbsJK4ft"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">少量指标数据。</span></li><li id="psA2s8ns1sj1geSYK4AbY8"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">指标数据变化不频繁。</span></li><li id="evaYTZLEVr5Mxx3C3x9rTy"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">本地系统或容器中的指标数据。</span></li><li id="f728ojb1pvEzCdno34QcGd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">可以轻松访问的指标数据。</span></li></ul></details></details><details id="5ZVf4Tof5w7TkwNTAjaEfT" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">推送模式</span></summary><div id="fNcm5yrJgDNDT88EoRpakR" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明</span><span class="inline-wrap">：主动将指标数据推送到 Prometheus。</span></div></div><aside id="3dXdruBabTGt7ob7cA9Z3X" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">prometheus<span class="jill"></span>本身无法支持推送，需要</span><span class="inline-wrap"><a href="https://github.com/prometheus/pushgateway"><span>pushgetway</span></a></span><span class="inline-wrap">，但是<span class="jill"></span>prometheus<span class="jill"></span>的安装包并不包含</span><span class="inline-wrap"><a href="https://github.com/prometheus/pushgateway"><span>pushgetway</span></a></span><span class="inline-wrap">，因此</span><span class="inline-wrap"><a href="https://github.com/prometheus/pushgateway"><span>pushgetway</span></a></span><span class="inline-wrap">需要单独安装</span></aside><div id="niuVZShEiYb5GiobUkVg9u" class="wolai-block wolai-text"><div><span class="blue inline-wrap">默认端口</span><span class="inline-wrap">：9091</span></div></div><details id="csz4q38nc1hmhTZrYrvsh3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">推送格式</span></summary><code-block id="jxunmbDFXjhNfbAaMzmuj1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">http://<span class="token operator">&lt;</span>Pushgateway_IP<span class="token operator">></span>:<span class="token operator">&lt;</span>Pushgateway_Port<span class="token operator">></span>/metrics/job/<span class="token operator">&lt;</span>JOB_NAME<span class="token operator">></span>/instance/<span class="token operator">&lt;</span>instance_name<span class="token operator">></span></pre></div></code-block><div id="o4gHq59W2zcP9fGfyaYi1A" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>&lt;Pushgateway_IP&gt;</code></span><span class="inline-wrap">：Pushgateway 的 IP 地址。</span></div></div><div id="4bU7oc1uQEYygdyEJYPXAE" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>&lt;Pushgateway_Port&gt;</code></span><span class="inline-wrap">：Pushgateway 的监听端口。</span></div></div><div id="719PDdyDLpLBMQ6F4DnLTY" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>&lt;JOB_NAME&gt;</code></span><span class="inline-wrap">：指标的 job 标签值。</span></div></div><div id="otN83jxyG9huNGHZ4jwFZ" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>&lt;instance_name&gt;</code></span><span class="inline-wrap">:默认为<span class="jill"></span>localhost</span></div></div></details><details id="p6Uny2Hsex3HLSL1wtGN9" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">适合场景</span></summary><div id="7RzgqwBDRHmtcaPGJaCHy6" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：推送模式更适合监控实时性要求高、指标数据量大、分布式或无法直接访问的指标数据。</span></div></div><ul class="wolai-block"><li id="qxDzdUmf49fKT3c7x271ej"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">实时的指标数据。</span></li><li id="2MsDBVFMKwpK9Tc28B1B8d"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">大量指标数据。</span></li><li id="r3UQt33GsBzJXXeCvQdusr"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">分布式系统或云环境中的指标数据。</span></li><li id="3eEuqkDXQcjCmS5atvdLCf"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">无法直接访问的指标数据，例如位于防火墙后面的指标数据。</span></li></ul></details></details></details></article><footer></footer></body></html>