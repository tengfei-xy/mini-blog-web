<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>icmp - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="icmp" class="main-title"></div></div></header><article><div id="c1mmGt4nKFLkVubmLytExA" class="wolai-block wolai-text"><div><span class="inline-wrap">官方文档：</span><span class="inline-wrap"><a href="https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/simple_checks#icmp-pings"><span>https://www.zabbix.com/documentation/current/en/manual/config/items/itemtypes/simple_checks#icmp-pings</span></a></span></div></div><div id="ara49Zd82VtwmiknC2oYby" class="wolai-block wolai-text"><div><span class="inline-wrap">icmpping、icmppingLost、icmppingsec<span class="jill"></span>依赖于<span class="jill"></span>fping，安装于<span class="jill"></span>zabbix_server。</span></div></div><code-block id="iuXgMY3CC71tMWRdYURLCx" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">wget</span> http://fping.org/dist/fping-3.15.tar.gz
<span class="token function">tar</span> xf fping-3.15.tar.gz <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> fping-3.15
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token parameter variable">-j4</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
<span class="token function">chown</span> root:zabbix  /usr/sbin/fping <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> <span class="token number">4710</span> /usr/sbin/fping
<span class="token comment"># zabbix 的登录shell保持/sbin/nologin</span></pre></div></code-block><blockquote id="a8fUv9Kfb9TVgKWct5igXh" class="wolai-block"><span class="inline-wrap">fping<span class="jill"></span>的安装路径注意：zabbix_server<span class="jill"></span>读取配置源于<span class="jill"></span>zabbix_server.conf<span class="jill"></span>的<span class="jill"></span>FpingLocation<span class="jill"></span>来作为<span class="jill"></span>fping<span class="jill"></span>的安装位置，默认是/usr/sbin/fping，因此配置时</span><span class="inline-wrap"><code>./configure --prefix=/usr</code></span><span class="inline-wrap">
</span><span class="inline-wrap">当<span class="jill"></span>zabbix_server.conf<span class="jill"></span>中的<span class="jill"></span>DebugLevel&gt;=4<span class="jill"></span>时才能看到<span class="jill"></span>fping<span class="jill"></span>的调用过程</span></blockquote><blockquote id="4toHrCBdrryzXCiHMWjvTH" class="wolai-block"><span class="inline-wrap">键值使用注意：该三者键依赖于<span class="jill"></span>server（表示需要从网页端设置），无法从<span class="jill"></span>zabbix_get<span class="jill"></span>或<span class="jill"></span>zabbix<span class="jill"></span>客户端或<span class="jill"></span>zabbix<span class="jill"></span>客户端（主动式）获取<span class="jill"></span>icmp<span class="jill"></span>的结果，否则报错 Invalid first parameter.</span></blockquote><h2 id="pbjYT8cKtRNUafAk7AfRKx" class="wolai-block"><span class="inline-wrap">icmpping</span></h2><div id="kGUpj4QV8pQe3MSFWVErSF" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：通过 ICMP ping 的主机可访问性。</span></div></div><div id="djU3tTytR3LWfX3mtAVsLr" class="wolai-block wolai-text"><div><span class="inline-wrap">格式</span></div></div><code-block id="aB55PgUBvCXMSdf7WU5PHc" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>icmpping<span class="token punctuation">[</span><span class="token operator">&lt;</span>target<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>packets<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>interval<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>size<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>timeout<span class="token operator">></span><span class="token punctuation">]</span></pre></div></code-block><div id="hLchtkECGTg1vmHLwDmpsq" class="wolai-block wolai-text"><div><span class="inline-wrap">参数说明</span></div></div><code-block id="aiJUPQvssU2BTem4xntNoB" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>target <span class="token operator">-</span> 主机 <span class="token constant">IP</span> 或 <span class="token constant">DNS</span> 名称
packets <span class="token operator">-</span> 数据包数量
interval <span class="token operator">-</span> 连续数据包之间的时间（以毫秒为单位）
size <span class="token operator">-</span> 数据包大小（以字节为单位）
timeout <span class="token operator">-</span> 超时（以毫秒为单位）</pre></div></code-block><div id="dmG3omNbxxAKhziaqjmMkS" class="wolai-block wolai-text"><div><span class="inline-wrap">返回值</span></div></div><code-block id="qSuFemohndjLuMpVTAC3MC" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre><span class="token number">0</span> <span class="token operator">-</span> <span class="token constant">ICMP</span> ping 失败
<span class="token number">1</span> <span class="token operator">-</span> <span class="token constant">ICMP</span> ping 成功</pre></div></code-block><div id="4SwkPT6YKHi7fPUMbPfKS2" class="wolai-block wolai-text"><div><span class="inline-wrap">常用指标</span></div></div><ul class="wolai-block"><li id="wVvmC2TwUPVuE7NZXtdK4w"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">四个<span class="jill"></span>ping<span class="jill"></span>包任意掉一个返回<span class="jill"></span>0</span><code-block id="c8vpAiazau6RqCovvt17Ei" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>icmpping<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span></pre></div></code-block></li></ul><h2 id="ugMcfSqcSu4XDxRzYb9Bp7" class="wolai-block"><span class="inline-wrap">icpmpinglost</span></h2><div id="cpka6T6AkwZDYC4eyVvMjr" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：丢失数据包的百分比。</span></div></div><div id="m9cL8Zn7VdSCFs6pvWxmo6" class="wolai-block wolai-text"><div><span class="inline-wrap">格式</span></div></div><code-block id="6WqsVvt1agTiDYijaL6KVY" class="wolai-block"><div class="wolai-pre"><div data-lang="纯文本" class="marker"></div><pre>icmpping<span class="token punctuation">[</span><span class="token operator">&lt;</span>target<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>packets<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>interval<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>size<span class="token operator">></span><span class="token punctuation">,</span><span class="token operator">&lt;</span>timeout<span class="token operator">></span><span class="token punctuation">]</span></pre></div></code-block><div id="kWQwxK1MCP7U3xf4XWASAk" class="wolai-block wolai-text"><div><span class="inline-wrap">返回：浮点值</span></div></div><h2 id="cGWcfMCapYSpkTZ2zgsYe9" class="wolai-block"><span class="inline-wrap">参数说明</span></h2><div id="w21jsu3Yc1NZCfrvRB9GUQ" class="wolai-block wolai-simple-table"><table><thead><tr><th style="width: 92.5px"><span class="inline-wrap">Parameter</span></th><th style="width: 92.5px"><span class="inline-wrap">Unit</span></th><th style="width: 92.5px"><span class="inline-wrap">Description</span></th><th style="width: 92.5px"><span class="inline-wrap">Fping&#39;s flag</span></th><th style="width: 92.5px"><span class="inline-wrap">Defaults-fping</span></th><th style="width: 92.5px"><span class="inline-wrap">Defaults-Zabbix</span></th><th style="width: 92.5px"><span class="inline-wrap">Zabbix-min</span></th><th style="width: 92.5px"><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>Zabbix-max</b></span></th></tr></thead><tbody><tr><td><span class="inline-wrap">packets</span></td><td><span class="inline-wrap">number</span></td><td><span class="inline-wrap">number of request packets to a target</span></td><td><span class="inline-wrap">-C</span></td><td><br/></td><td><span class="inline-wrap">3</span></td><td><span class="inline-wrap">1</span></td><td><span class="inline-wrap">10000</span></td></tr><tr><td><span class="inline-wrap">interval</span></td><td><span class="inline-wrap">milliseconds</span></td><td><span class="inline-wrap">time to wait between successive packets</span></td><td><span class="inline-wrap">-p</span></td><td><span class="inline-wrap">1000</span></td><td><br/></td><td><span class="inline-wrap">20</span></td><td><span class="inline-wrap">unlimited</span></td></tr><tr><td><span class="inline-wrap">size</span></td><td><span class="inline-wrap">bytes</span></td><td><span class="inline-wrap">packet size in bytes 56 bytes on x86, 68 bytes on x86_64</span></td><td><span class="inline-wrap">-b</span></td><td><span class="inline-wrap">56 or 68</span></td><td><br/></td><td><span class="inline-wrap">24</span></td><td><span class="inline-wrap">65507</span></td></tr><tr><td><span class="inline-wrap">timeout</span></td><td><span class="inline-wrap">milliseconds</span></td><td><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>fping v3.x</b></span><span class="inline-wrap"> - timeout to wait after last packet sent, affected by </span><span class="inline-wrap"><i></i></span><span class="inline-wrap"><i>-C</i></span><span class="inline-wrap"> flag </span><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>fping v4.x</b></span><span class="inline-wrap"> - individual timeout for each packet</span></td><td><span class="inline-wrap">-t</span></td><td><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>fping v3.x</b></span><span class="inline-wrap"> - 500 </span><span class="inline-wrap"><b></b></span><span class="inline-wrap"><b>fping v4.x</b></span><span class="inline-wrap"> - inherited from </span><span class="inline-wrap"><i></i></span><span class="inline-wrap"><i>-p</i></span><span class="inline-wrap">flag, but not more than 2000</span></td><td><br/></td><td><span class="inline-wrap">50</span></td><td><span class="inline-wrap">unlimited</span></td></tr></tbody></table></div></article><footer></footer></body></html>