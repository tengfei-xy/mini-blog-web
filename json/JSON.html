<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../css/wolai.css"/><title>JSON - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="JSON" class="main-title"></div></div></header><article><div id="dKDfAKyAstsuswBxFdjkxT" class="wolai-row"><div id="okRPcv8XF9XF4cVvhFrBS" class="wolai-col" style="flex-grow: 0.5"><div id="eECXdxoS3vbbSmW7h4mb7N" class="bg-pink_lavender wolai-block wolai-text"><div><span class="inline-wrap">语法</span></div></div></div><div id="7NR2TP3Xn3R1fTLtpt38R" class="wolai-col" style="flex-grow: 0.5"><div id="gnQrWXPrirPZ3wKa8AQPyq" class="bg-fluorescent_yellow wolai-block wolai-text"><div><span class="inline-wrap">参考工具</span></div></div><div id="ktCDk7ynhx9ZyoYZpswfWZ" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://oktools.net/json"><span>Json<span class="jill"></span>格式化</span></a></span></div></div></div></div><div id="hXkJFGRHGd9YiLvMypWBWe" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div><div id="bxCHY9Bs8Ma9rAHKj93d5G" class="bg-lightpink wolai-block wolai-text"><div><span class="inline-wrap">编程语言</span></div></div><details id="qe2gTiwDHzEAoNCVzUFKQf" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">golang</span></summary><div class="block-ref"><div class="decorator"></div><details id="kdDaPK6X13zSrZ3HRidd27" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">json</span></summary><details id="fmKqY3HxXjZCmBnawDrdkJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参考工具</span></summary><div id="4CSYQU4tWJNMwS1oc6eaZn" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://tooltt.com/json2go/"><span>json<span class="jill"></span>转结构体</span></a></span></div></div></details><details id="89jqSayp13bU1hcreCp6B" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><details id="u5mcb9zNieC65zMoCf5zgg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">标准库</span></summary><div id="psTryBhUXyptgTHRsC1EE5" class="wolai-sub-page wolai-block"><div class="page-icon"></div><a href="../golang/%E8%8E%B7%E5%8F%96key/%E8%8E%B7%E5%8F%96key.html"><span>获取key</span></a><div id="5Pykk1sn5MHRTurdZqVTPc" class="wolai-block wolai-text"><div><span class="inline-wrap">当有结构体的<span class="jill"></span>key<span class="jill"></span>不固定式，可使用如下方法解析并获取<span class="jill"></span>key</span></div></div><code-block id="Rps3qiHT1XGVEzhydyFy7" class="wolai-block"><div class="wolai-pre"><div data-lang="Go" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">"encoding/json"</span>
    <span class="token string">"fmt"</span>
    <span class="token string">"reflect"</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Data <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    Blocks <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token string">`json:"blocks"`</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data <span class="token operator">:=</span> <span class="token string">`{
        "blocks": {
            "field1": "value1",
            "field2": "value2",
            "field3": 123
        }
    }`</span>

    <span class="token keyword">var</span> d Data
    <span class="token keyword">if</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 使用反射获取blocks字段中的所有字段名</span>
    v <span class="token operator">:=</span> reflect<span class="token punctuation">.</span><span class="token function">ValueOf</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>Blocks<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> key <span class="token operator">:=</span> <span class="token keyword">range</span> v<span class="token punctuation">.</span><span class="token function">MapKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div></code-block></div></details></details></details></div></details><details id="ehJ76a1y2XYCrPr2hFAZ5M" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">rust</span></summary><div class="block-ref"><div class="decorator"></div><details id="Fpw5yRh6wzNaveJrTFH1" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">serde</span></summary><details id="aM6HDCD3y8zwSM9xEXfEFh" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参考文档</span></summary><div id="5x2oupywkt6ZZ1i3c4QXdT" class="wolai-block wolai-text"><div><span class="inline-wrap">包源：</span><span class="inline-wrap"><a href="https://crates.io/crates/serde"><span>https://crates.io/crates/serde</span></a></span></div></div><div id="97wBimdB3Rc7i4oxY5WtTR" class="wolai-block wolai-text"><div><span class="inline-wrap">文档：</span><span class="inline-wrap"><a href="https://docs.rs/serde/1.0.193/serde/"><span>https://docs.rs/serde/1.0.193/serde/</span></a></span></div></div><div id="rWPvH58cwHa4rq18eHiT6k" class="wolai-block wolai-text"><div><span class="inline-wrap">示例：</span><span class="inline-wrap"><a href="https://serde.rs/examples.html"><span>https://serde.rs/examples.html</span></a></span></div></div></details><details id="toSGzzaA5YtXsRMRgrnA27" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参考工具</span></summary><div id="p91Shvo7R5RANrMha5CoA6" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://tooltt.com/json2rust/"><span>json<span class="jill"></span>转<span class="jill"></span>rust<span class="jill"></span>结构体</span></a></span></div></div></details><details id="5hhkADnLB5693QTtrFMUYp" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">安装</span></summary><div id="uHpWpHVp1yRphKzPvBXbc8" class="wolai-block wolai-text"><div><span class="inline-wrap">首先，你需要将</span><span class="inline-wrap"><code>serde</code></span><span class="inline-wrap">添加到你的</span><span class="inline-wrap"><code>Cargo.toml</code></span><span class="inline-wrap">文件中的依赖项中：</span></div></div><code-block id="8AqiA6frXjctEaQWmSQpPC" class="wolai-block"><div class="wolai-pre"><div data-lang="Toml" class="marker"></div><pre><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.0.195"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span></pre></div></code-block><div id="bHN8y1xHkTdVjhSbQaF3sz" class="wolai-block wolai-text"><div><span class="inline-wrap">使用库</span></div></div><code-block id="kQgFc6Hf2Sy6MZsfB6tKWm" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Serialize</span><span class="token punctuation">,</span> <span class="token class-name">Deserialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre></div></code-block></details><details id="gHPNUWVEGHK2Po1g21k9Wv" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><details id="7u2Qp2jAyHcXVZmc85CZUs" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"> 序列化</span></summary><details id="orVhoF4wCNFouWQpa4kf5j" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">基本方法</span></summary><div id="ewNt7AFT7LPVbvzuRLmGRy" class="wolai-block wolai-text"><div><span class="inline-wrap">接下来，定义一个结构体并实现</span><span class="inline-wrap"><code>Serialize</code></span><span class="inline-wrap">和</span><span class="inline-wrap"><code>Deserialize</code></span><span class="inline-wrap"> trait：</span></div></div><code-block id="hTrvuxqXRnuCqqh3RTaZWj" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token attribute attr-name">#[derive(Serialize, Deserialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>
    address<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="jywk4QGzmU9au3N8cDFMtp" class="wolai-block wolai-text"><div><span class="inline-wrap">现在，你可以使用</span><span class="inline-wrap"><code>serde_json::to_string</code></span><span class="inline-wrap">函数将结构体转换为<span class="jill"></span>JSON<span class="jill"></span>字符串：</span></div></div><code-block id="tNQnTR1LAWebMFwgeasDuy" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
        address<span class="token punctuation">:</span> <span class="token string">"1234 Rust Lane"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> json<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="9miSADty4nHqDoz1kanno5" class="wolai-block wolai-text"><div><span class="inline-wrap">这将输出以下<span class="jill"></span>JSON<span class="jill"></span>字符串：</span></div></div><code-block id="62cm66VzK4UwH6erbojFHb" class="wolai-block"><div class="wolai-pre"><div data-lang="JSON" class="marker"></div><pre><span class="token punctuation">{</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"John Doe"</span><span class="token punctuation">,</span><span class="token property">"age"</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">,</span><span class="token property">"address"</span><span class="token operator">:</span><span class="token string">"1234 Rust Lane"</span><span class="token punctuation">}</span></pre></div></code-block></details></details><details id="pv641RS1afHimF6fHSjqz" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">反序列化</span></summary><details id="4EUUFreYn1RvTwp4Ngtm7u" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">基本方法</span></summary><div id="kEAfWc68g1D3tNcd6KMuZ2" class="wolai-block wolai-text"><div><span class="inline-wrap">如果你想要将<span class="jill"></span>JSON<span class="jill"></span>字符串解析回结构体，你可以使用</span><span class="inline-wrap"><code>serde_json::from_str</code></span><span class="inline-wrap">函数：</span></div></div><code-block id="9FdYPW6rc9dvQ9gKktSH9a" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">r#"{"name":"John Doe","age":30,"address":"1234 Rust Lane"}"#</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> person<span class="token punctuation">:</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Name: {}"</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Age: {}"</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Address: {}"</span><span class="token punctuation">,</span> person<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="aTABwjs29A7wBn5stPEdd2" class="wolai-block wolai-text"><div><span class="inline-wrap">这将输出：</span></div></div><code-block id="sTbjqaLvxPkfL5wtKVEGUQ" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>Name: John Doe
Age: <span class="token number">30</span>
Address: <span class="token number">1234</span> Rust Lane</pre></div></code-block></details><details id="muVfVa4WY4VWbq5Viz7WSH" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">可能存在多种结构</span></summary><div id="eCc7PhjBKLWRN3FFMVsvL7" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>Metadata</code></span><span class="inline-wrap">枚举将处理多种情况，需要</span><span class="inline-wrap"><code>#[serde(untagged)]</code></span></div></div><code-block id="iA6FPbFr3XcVVQYmbQMhCk" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, Deserialize, Serialize)]</span>
<span class="token attribute attr-name">#[serde(untagged)]</span>
<span class="token keyword">enum</span> <span class="token type-definition class-name">Metadata</span> <span class="token punctuation">{</span>
    <span class="token class-name">StructType</span> <span class="token punctuation">{</span> <span class="token attribute attr-name">#[serde(rename = <span class="token string">"type"</span>)]</span> struct_type<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token class-name">ArrayType</span> <span class="token punctuation">{</span> <span class="token attribute attr-name">#[serde(rename = <span class="token string">"array"</span>)]</span> array_type<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Debug, Deserialize, Serialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Data</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    metadata<span class="token punctuation">:</span> <span class="token class-name">Metadata</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> json_data <span class="token operator">=</span> <span class="token string">r#"
        {
            "value": 42,
            "metadata": {
                "type": "struct"
            }
        }
    "#</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> deserialized_data<span class="token punctuation">:</span> <span class="token class-name">Data</span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>json_data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> deserialized_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="axcEXReMoQenQ6ykrsPXbr" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">源数据的键和结构体的成员名采用不同名</span></summary><div id="pZN76rRPVUAFqJr4axChxq" class="wolai-block wolai-text"><div><span class="inline-wrap">在 Rust 的 serde 库中，你可以使用 </span><span class="inline-wrap"><code>#[serde(rename = &quot;new_name&quot;)]</code></span><span class="inline-wrap"> 属性来为源数据的键和结构体的成员名指定不同的名称。这个属性可以应用于结构体的字段或枚举的变体。</span></div></div><div id="8oemoJfXhGMQahREd7qTEK" class="wolai-block wolai-text"><div><span class="inline-wrap">下面是一个示例，演示了如何在 serde 库中使用不同的名称：</span></div></div><code-block id="a9uVCLjmSUqA2LLVe5qtep" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Deserialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">MyStruct</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[serde(rename = <span class="token string">"source_key"</span>)]</span>
    target_field<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> json <span class="token operator">=</span> <span class="token string">r#"{ "source_key": 42 }"#</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> my_struct<span class="token punctuation">:</span> <span class="token class-name">MyStruct</span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Value: {}"</span><span class="token punctuation">,</span> my_struct<span class="token punctuation">.</span>target_field<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="o9Si14cc3R9CNZygwPvy5y" class="wolai-block wolai-text"><div><span class="inline-wrap">在上面的示例中，我们使用了 </span><span class="inline-wrap"><code>#[serde(rename = &quot;source_key&quot;)]</code></span><span class="inline-wrap"> 属性来指定源数据中的键为 &quot;source_key&quot;，而将结构体的字段名指定为 &quot;target_field&quot;。这样，当使用 serde 库对 JSON 数据进行解析时，源数据中的键 &quot;source_key&quot; 的值将被赋给结构体的字段 &quot;target_field&quot;。</span></div></div><div id="bUJUotNQcRnDtp4vYWGaph" class="wolai-block wolai-text"><div><span class="inline-wrap">通过在结构体的字段上使用 </span><span class="inline-wrap"><code>#[serde(rename = &quot;new_name&quot;)]</code></span><span class="inline-wrap"> 属性，你可以灵活地控制源数据键和结构体成员名之间的映射关系。</span></div></div></details></details><details id="tvZfYH1qRFTfDsQMXauNxt" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">跳过解析</span></summary><code-block id="gu8nDngSBTPkypT1r2trcd" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token attribute attr-name">#[derive(Serialize, Deserialize)]</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">MyStruct</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[serde(skip)]</span>
    ignored_field<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    included_field<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="wepAjRWJmnGTzoh5qdu83X" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">读取值</span></summary><div id="wvcpEdGakneS1Tk8bxsN53" class="wolai-block wolai-text"><div><span class="inline-wrap">在上面的示例中，我们使用 serde_json 库将 JSON 数据解析为 </span><span class="inline-wrap"><code>serde_json::Value</code></span><span class="inline-wrap"> 类型。然后，我们可以使用 </span><span class="inline-wrap"><code>value.get()</code></span><span class="inline-wrap"> 方法直接读取 JSON 中的值，而不需要定义一个结构体来反序列化整个 JSON 数据。</span></div></div><div id="9sUH9BA5ocKAdj3p5Ztrwi" class="wolai-block wolai-text"><div><span class="inline-wrap">请注意，直接读取值而不解析到结构体可能会导致类型信息丢失，因为 </span><span class="inline-wrap"><code>serde_json::Value</code></span><span class="inline-wrap"> 是一个动态类型，可以表示任意 JSON 数据。如果你需要根据值的类型执行特定的操作，可能需要进行类型检查和转换。</span></div></div><code-block id="kEqiLsdWo9MhGtragQEFsy" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">use</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">r#"
        {
            "name": "John Doe",
            "age": 30,
            "city": "New York"
        }
    "#</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> value<span class="token punctuation">:</span> <span class="token class-name">Value</span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Name: {}"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span> <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Age: {}"</span><span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token operator">=</span> value<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"city"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"City: {}"</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details></details></div></details><details id="xu8eTQ45uwSjKZQUg9rsnd" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">java</span></summary><div class="block-ref"><div class="decorator"></div><details id="vSmR8D3VoWce5uqSDpALj8" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">gson</span></summary><details id="kybpdQdD1HUmTzQo4ruF7Q" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参考工具</span></summary><div id="88p14iBnoptPR1bB4bkYiR" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="http://www.esjson.com/jsontopojo.html"><span>json<span class="jill"></span>转实体类</span></a></span></div></div></details><details id="67jEHKKH5MukpA2V9vMVuh" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">安装</span></summary><code-block id="k1a4LoBTine5koeVTwHQ5F" class="wolai-block"><div class="wolai-pre"><div data-lang="XML" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.google.code.gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>gson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span></pre></div></code-block></details><details id="wB7TJRcjjrC41ksNmmZ2kb" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><details id="mQpEebmaE93Q5yUKSDsbp4" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">解析到<span class="jill"></span>class</span></summary><code-block id="iy17U9yXoXBa3kwsuFDaRg" class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token class-name">Gson</span> gson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Gson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">PlayUrlData</span> data <span class="token operator">=</span> gson<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">PlayUrlData</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block></details><details id="8RRLajDEdQrjFueuPocFpe" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">直接提取字段</span></summary><code-block id="h7okJPiavi3EiwYqSakA7" class="wolai-block"><div class="wolai-pre"><div data-lang="Java" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>gson<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GsonExtractFieldsExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token string">"{\"name\":\"John\",\"age\":30,\"city\":\"New York\"}"</span><span class="token punctuation">;</span>

        <span class="token class-name">JsonParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">JsonElement</span> element <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">isJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">JsonObject</span> jsonObject <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAsJsonObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">JsonElement</span> nameElement <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nameElement <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> nameElement<span class="token punctuation">.</span><span class="token function">isJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> name <span class="token operator">=</span> nameElement<span class="token punctuation">.</span><span class="token function">getAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Name: "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">JsonElement</span> ageElement <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ageElement <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> ageElement<span class="token punctuation">.</span><span class="token function">isJsonPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> age <span class="token operator">=</span> ageElement<span class="token punctuation">.</span><span class="token function">getAsInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Age: "</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details></details></div></details><details id="in1iKe1UyXhZXwcnp8WrbS" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">shell scirpt</span></summary><div class="block-ref"><div class="decorator"></div><details id="jUFSUu3dMCEmQ8chPVcBXH" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">jq</span></summary><details id="nSje9iKgqquEcQN4JmbD6Q" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">参考文档</span></summary><div id="3ySNE9m7jzW3NMTgzXYeCK" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://stedolan.github.io/jq/manual/v1.6/"><span>手册</span></a></span></div></div></details><details id="bF6ZyWqJ3n2tLwEAEDeoym" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">安装</span></summary><code-block id="umWK2RzxzR4o89rXopaKQ1" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token function">wget</span> https://github.com/stedolan/jq/releases/download/jq-1.6/jq-linux64 <span class="token parameter variable">-O</span> /usr/local/bin/jq <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x /usr/local/bin/jq</pre></div></code-block></details><details id="97Z7DCAXjAFa7H5WmkW6sP" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><div id="uTXui7QgQiKCszB4WbKLni" class="wolai-block wolai-text"><div><span class="inline-wrap">访问方式（大小写敏感）：</span></div></div><code-block id="qcG3icZPHZ9ccBjWoPuNJj" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">jq <span class="token string">'.Data[4].ChildNodeList[3].LookTime'</span></pre></div></code-block><div id="1mjZrbHHFCMMCxoFAktrqS" class="wolai-block wolai-text"><div><span class="inline-wrap">输出为字符串，而非格式化的<span class="jill"></span>JSON</span></div></div><code-block id="6qyqFJSFx5NvAJCHMLecuH" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">jq <span class="token string">'. | tostring'</span></pre></div></code-block><div id="rcRuBM4poAZHjsoXHCXHxe" class="wolai-block wolai-text"><div><span class="inline-wrap">多个对象合并</span></div></div><code-block id="6xcdcNe77Y7nq2R3z3G3Vd" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">jq <span class="token parameter variable">-s</span> <span class="token function">add</span></pre></div></code-block><details id="77SdneAHoi83H17VS76hp3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">数组</span></summary><div id="gvS7tJstcLng42yVzS2o9a" class="wolai-block wolai-text"><div><span class="inline-wrap">获取数组长度</span></div></div><code-block id="5bjHBzgFFs8hc3ToLYpJz9" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">jq <span class="token string">'.Data.list | length'</span></pre></div></code-block><div id="5mxKCxqJGMfsv2FcgXA68Z" class="wolai-block wolai-text"><div><span class="inline-wrap">合并数组，作为字符串</span></div></div><code-block id="jVQdT1LL6w4jMaUtefkQ75" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">jq <span class="token parameter variable">-r</span> <span class="token string">'.idList | join("")'</span></pre></div></code-block><div id="nzjGk18DHMhVxLTBZiwcM5" class="wolai-block wolai-text"><div><span class="inline-wrap">将字段合并为数组</span></div></div><code-block id="drcBrC3oDr1qqMDXZFv2qe" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token assign-left variable">data_array</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token assign-left variable">id1</span><span class="token operator">=</span><span class="token string">"86ce210c-ceda-4040-83a7-a6b07679975e"</span>
<span class="token assign-left variable">id2</span><span class="token operator">=</span><span class="token string">"ecb3ad80-5a04-4b18-a5c1-b2f97c72c9c8"</span>
<span class="token assign-left variable">ans1</span><span class="token operator">=</span><span class="token string">"A"</span>
<span class="token assign-left variable">ans2</span><span class="token operator">=</span><span class="token string">"B"</span>
<span class="token assign-left variable">data_array</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">"{<span class="token entity" title="\&quot;">\"</span>id<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">${id1}</span><span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>answer<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">${ans1}</span><span class="token entity" title="\&quot;">\"</span>}"</span><span class="token punctuation">)</span>
<span class="token assign-left variable">data_array</span><span class="token operator">+=</span><span class="token punctuation">(</span><span class="token string">"{<span class="token entity" title="\&quot;">\"</span>id<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">${id2}</span><span class="token entity" title="\&quot;">\"</span>,<span class="token entity" title="\&quot;">\"</span>answer<span class="token entity" title="\&quot;">\"</span>:<span class="token entity" title="\&quot;">\"</span><span class="token variable">${ans2}</span><span class="token entity" title="\&quot;">\"</span>}"</span><span class="token punctuation">)</span>

<span class="token assign-left variable">result</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${data_array<span class="token punctuation">[</span>@<span class="token punctuation">]</span>}</span>"</span>  <span class="token operator">|</span> jq <span class="token parameter variable">-s</span> <span class="token builtin class-name">.</span><span class="token variable">)</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$result</span>"</span>
</pre></div></code-block><div id="pGwsXw7xtD3hSbzwUW73d8" class="wolai-block wolai-text"><div><span class="inline-wrap">从数组中提取值</span></div></div><code-block id="6aBnBbTe8DiuFYw5642Ni3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token shebang important">#!/bin/bash</span>

<span class="token assign-left variable">data</span><span class="token operator">=</span><span class="token string">'{"activity_reads": [
        {
            "activity_id": 60002620192,
            "activity_type": "learning_activity",
            "completeness": "part",
            "created_by_id": 60000740050,
            "created_for_id": 60000740050,
            "data": {},
            "id": "65488696047f7460ba65d098",
            "last_visited_at": "2023-11-06T06:36:40.278Z"
        },
        {
            "activity_id": 1,
            "activity_type": "learning_activity",
            "completeness": "full",
            "created_by_id": 2,
            "created_for_id": 3,
            "data": {},
            "id": "4",
            "last_visited_at": "2023-11-06T06:36:40.278Z"
        }]
        }'</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$data</span>"</span>  <span class="token operator">|</span>jq <span class="token string">'.activity_reads[] | select(.activity_id == 60002620192).completeness'</span>
</pre></div></code-block></details><div id="kuiP6vBz9CqN5kSTKJG3TV" class="wolai-block wolai-text"><div><span class="inline-wrap"></span><br/></div></div></details></details></div></details><details id="2MriktLFhNRTANJg3E9kKC" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">C</span></summary><div class="block-ref"><div class="decorator"></div><details id="t779WQxDHVLGvtpFbgaTqR" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">自建库</span></summary><aside id="shCZcfAB2puFA9Y5kmzmco" class="bg-cultured wolai-block"><div data-symbol="📌" class="icon"></div><span class="inline-wrap">基于递归解析<span class="jill"></span>json</span></aside><details id="2JBeMUSZEGDDsKMLpB5S6n" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">安装</span></summary><details id="sxJTVP1ap5c1jUJHWvF7c2" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">.h</span></summary><code-block id="wBpFYho6d6ZAsgbwYbdrX" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all">#include <span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>stdlib<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>string<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>limits<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>stdbool<span class="token punctuation">.</span>h<span class="token operator">></span>
#include <span class="token operator">&lt;</span>ctype<span class="token punctuation">.</span>h<span class="token operator">></span>

#include <span class="token string">"strings.h"</span>

#define <span class="token constant">JSON_TYPE_NULL</span> <span class="token number">0</span>
#define <span class="token constant">JSON_TYPE_STRING</span> <span class="token number">1</span>
#define <span class="token constant">JSON_TYPE_INT</span> <span class="token number">2</span>
#define <span class="token constant">JSON_TYPE_LONG</span> <span class="token number">3</span>
#define <span class="token constant">JSON_TYPE_BOOL</span> <span class="token number">4</span>
#define <span class="token constant">JSON_TYPE_EXTAND</span> <span class="token number">10</span>
#define <span class="token constant">JSON_TYPE_ARRAY</span> <span class="token number">11</span>
#define <span class="token constant">JSON_TYPE_ELEMENT</span> <span class="token number">12</span>

#define <span class="token constant">KEY_STATUS_RESET</span> <span class="token number">0</span>
#define <span class="token constant">KEY_STATUS_ENTER</span> <span class="token number">1</span>
#define <span class="token constant">KEY_STATUS_EXIT</span> <span class="token number">2</span>

#define <span class="token constant">JSON_STATUS_FIND_OUT</span> <span class="token number">0</span>
#define <span class="token constant">JSON_STATUS_NO_KEY</span> <span class="token number">1</span>
#define <span class="token constant">JSON_STATUS_NO_TYPE</span> <span class="token number">2</span>
#define <span class="token constant">JSON_STATUS_PARSE_FAILED</span> <span class="token number">3</span>
#define <span class="token constant">JSON_STATUS_READ_FAILED</span> <span class="token number">4</span>

#define <span class="token constant">JSON_FOUND_NO</span> <span class="token number">0</span>
#define <span class="token constant">JSON_FOUND_KEY</span> <span class="token number">1</span>
#define <span class="token constant">JSON_FOUND_WORD</span> <span class="token number">2</span>

#define <span class="token constant">JSON_ERROR_BOOL</span> <span class="token string">"parse bool type error"</span>
#define <span class="token constant">JSON_ERROR_FONND_FILED</span> <span class="token string">"Field not found"</span>
#define <span class="token constant">JSON_ERROR_STRING_NULL</span> <span class="token string">"Invalid target string"</span>

#ifndef <span class="token constant">AJSON_STRUCT</span>
#define <span class="token constant">AJSON_STRUCT</span>
typedef <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span>
<span class="token punctuation">{</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>prev<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">;</span>

    int value_type<span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>value_str<span class="token punctuation">;</span>
    int value_int<span class="token punctuation">;</span>
    long value_long<span class="token punctuation">;</span>
    <span class="token keyword">bool</span> value_bool<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>extant<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>array<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token type-definition class-name">AJSON</span> <span class="token operator">*</span>element<span class="token punctuation">;</span>

<span class="token punctuation">}</span> <span class="token constant">AJSON</span><span class="token punctuation">;</span>

#endif

<span class="token comment">// 作用: 返回新结构体,并初始化</span>
<span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 封装JSON</span>
void <span class="token function">json_packaging</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> void <span class="token operator">*</span>value<span class="token punctuation">,</span> int <span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 释放封装的JSON</span>
<span class="token comment">// void json_packaging_free(AJSON *json);</span>

<span class="token comment">// 作用: 数据结构释放</span>
void <span class="token function">json_free</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_free_nolloc</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_free_base</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">bool</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 输出字符串到str</span>
<span class="token comment">// void json_string(AJSON *json, char *str);</span>

<span class="token comment">// 作用: 输出字符串到str</span>
<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">json_string</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
void <span class="token function">json_string_base</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token keyword">str</span><span class="token punctuation">,</span> int str_total_size<span class="token punctuation">,</span> <span class="token keyword">bool</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 释放json_string()的字符串</span>
void <span class="token function">json_string_free</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>json_str<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 计算目标JSON的序列化后的长度</span>
<span class="token comment">// 用法: </span>
<span class="token comment">// int total = json_sizeof(json, false);total +=1;</span>
int <span class="token function">json_sizeof</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">bool</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 打印</span>
<span class="token comment">// 参数: 首次调用时,prev_depth=0,array=false,pretty 作为人性化输出</span>
<span class="token comment">// 返回: json字符数</span>
<span class="token comment">// 用法:</span>
<span class="token comment">// json_print(ret, 0, true, false, 0, 0, 0);</span>
int <span class="token function">json_print</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> int symbol<span class="token punctuation">,</span> <span class="token keyword">bool</span> pretty<span class="token punctuation">,</span> <span class="token keyword">bool</span> array<span class="token punctuation">,</span> int element_seq<span class="token punctuation">,</span> int depth<span class="token punctuation">,</span> int <span class="token keyword">type</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 查询指定字段</span>
<span class="token comment">// 参数: query参考jq命令的用法</span>
<span class="token comment">// 注意: key相同时，进查询第一条key，没有匹配值时返回NULL</span>
<span class="token comment">// 用法:</span>
<span class="token comment">// int:    *(int *)json_read(json, query )</span>
<span class="token comment">// string: (char *)json_read(json, query )</span>
<span class="token comment">// bool: (*(bool*)(json_read(json, query))</span>
void <span class="token operator">*</span><span class="token function">json_read</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token function">json_extract</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 计算数组长度</span>
<span class="token comment">// 注意: 无法匹配到key时返回0,查询的json需要是arrary类型</span>
<span class="token comment">// 用法:</span>
<span class="token comment">// char query[] = ".data";</span>
<span class="token comment">// int length = json_length(json, query));</span>
int <span class="token function">json_length</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用:解析</span>
<span class="token constant">AJSON</span> <span class="token operator">*</span><span class="token function">json_decoding</span><span class="token punctuation">(</span><span class="token constant">AJSON</span> <span class="token operator">*</span>now_json<span class="token punctuation">,</span> <span class="token constant">AJSON</span> <span class="token operator">*</span>prev_json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> int <span class="token operator">*</span>pop<span class="token punctuation">,</span> int <span class="token operator">*</span>recursion_seq<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 作为字符串查询时的切割方法</span>
<span class="token comment">// 返回: 0可以继续分隔,1=末尾字段</span>
<span class="token keyword">bool</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token keyword">str</span><span class="token punctuation">,</span> <span class="token keyword">char</span> symbol<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 用于在json_read中,判断指向字符串是否位于首个分隔字段中</span>
<span class="token keyword">bool</span> <span class="token function">json_compare_word</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>left<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 作用: 仅仅用于函数测试和函数用法展示</span>
void <span class="token function">json_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></details><details id="js6r3AMzFk7wRoiF2ZwazR" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">.c</span></summary><code-block id="ek2cCA7Ppeyr4HgYUsKY2w" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"json.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"strings.h"</span></span>
bool json_debug <span class="token operator">=</span> false<span class="token punctuation">;</span>
<span class="token keyword">int</span> json_total_new <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> json_total_free <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

AJSON <span class="token operator">*</span><span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AJSON <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>AJSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>AJSON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json_debug<span class="token punctuation">)</span>
        json_total_new<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_packaging</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>value<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    AJSON <span class="token operator">*</span>prev_json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> JSON_TYPE_ELEMENT<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        AJSON <span class="token operator">*</span>element <span class="token operator">=</span> <span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            prev_json <span class="token operator">=</span> json<span class="token punctuation">;</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        json<span class="token operator">-></span>element <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type <span class="token operator">!=</span> JSON_TYPE_NULL<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        prev_json <span class="token operator">=</span> json<span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            prev_json <span class="token operator">=</span> json<span class="token punctuation">;</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        json<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        json<span class="token operator">-></span>next<span class="token operator">-></span>prev <span class="token operator">=</span> json<span class="token punctuation">;</span> <span class="token comment">// 设置下一个节点的prev指针为当前节点</span>
        json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
        json<span class="token operator">-></span>prev <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> <span class="token comment">// 如果是第一个节点，则prev指针设为NULL</span>
    <span class="token punctuation">}</span>

    json<span class="token operator">-></span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
    json<span class="token operator">-></span>value_type <span class="token operator">=</span> type<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
        json<span class="token operator">-></span>value_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
        json<span class="token operator">-></span>value_int <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
        json<span class="token operator">-></span>value_long <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span>value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
        json<span class="token operator">-></span>value_type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        json<span class="token operator">-></span>array <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
        json<span class="token operator">-></span>value_type <span class="token operator">=</span> type<span class="token punctuation">;</span>
        json<span class="token operator">-></span>extant <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span><span class="token function">json_string</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> false<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>json_str <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span>total<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json_str<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token function">json_string_base</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> json_str<span class="token punctuation">,</span> total<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> json_str<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_string_base</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">int</span> str_total_size<span class="token punctuation">,</span> bool array<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">'['</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">'{'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\"%s\":"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"\"%s\""</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
            <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%ld"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
            <span class="token function">json_string_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> str<span class="token punctuation">,</span> str_total_size<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
            <span class="token function">json_string_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> str<span class="token punctuation">,</span> str_total_size<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ELEMENT<span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            AJSON <span class="token operator">*</span>ele <span class="token operator">=</span> json<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ele<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ele <span class="token operator">=</span> ele<span class="token operator">-></span>element<span class="token punctuation">;</span>
                <span class="token function">json_string_base</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> str<span class="token punctuation">,</span> str_total_size<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            str<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">snprintf</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> str_total_size <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"%c"</span><span class="token punctuation">,</span> <span class="token char">'}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">json_string_free</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>json_str<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">free</span><span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> bool array<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"{"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"\"%s\":"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"\"%s\""</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%ld"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
            len <span class="token operator">+=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ELEMENT<span class="token operator">:</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            AJSON <span class="token operator">*</span>ele <span class="token operator">=</span> json<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>ele<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                ele <span class="token operator">=</span> ele<span class="token operator">-></span>element<span class="token punctuation">;</span>
                len <span class="token operator">+=</span> <span class="token function">json_sizeof</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
                len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            len <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        len <span class="token operator">+=</span> <span class="token function">snprintf</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">json_print</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">int</span> symbol<span class="token punctuation">,</span> bool pretty<span class="token punctuation">,</span> bool array<span class="token punctuation">,</span> <span class="token keyword">int</span> element_seq<span class="token punctuation">,</span> <span class="token keyword">int</span> depth<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"(NULL)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty <span class="token operator">&amp;&amp;</span> type <span class="token operator">!=</span> JSON_TYPE_ARRAY <span class="token operator">&amp;&amp;</span> type <span class="token operator">!=</span> JSON_TYPE_EXTAND<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"      "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"{"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\"%s\": "</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\"%s\":"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\"%s\""</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%ld"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_BOOL<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_bool <span class="token operator">?</span> <span class="token string">"true"</span> <span class="token operator">:</span> <span class="token string">"false"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> false<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> true<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>next<span class="token punctuation">,</span> symbol <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> false<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> depth<span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"      "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> total<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>element_seq<span class="token operator">++</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>pretty<span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        total <span class="token operator">+=</span> <span class="token function">json_print</span><span class="token punctuation">(</span>json<span class="token operator">-></span>element<span class="token punctuation">,</span> symbol<span class="token punctuation">,</span> pretty<span class="token punctuation">,</span> false<span class="token punctuation">,</span> element_seq<span class="token punctuation">,</span> depth<span class="token punctuation">,</span> json<span class="token operator">-></span>value_type<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> total<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>symbol <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>depth <span class="token operator">>=</span> <span class="token number">1</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            total <span class="token operator">+=</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> total<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">json_read</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>word <span class="token operator">=</span> query<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>bool end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>

        <span class="token comment">// printf("分割字段:%s,指向字段:%s\n", word, json->key);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token operator">-></span>key<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">json_compare_word</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">char</span> <span class="token operator">*</span>c <span class="token operator">=</span> word<span class="token punctuation">;</span>
            <span class="token comment">// printf("分割字段:%s,指向字段:%s 进入\n", c, json->key);</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">'['</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">char</span> <span class="token operator">*</span>index <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">++</span>c <span class="token operator">!=</span> <span class="token char">']'</span><span class="token punctuation">)</span>
                    index<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>c<span class="token punctuation">;</span>
                json <span class="token operator">=</span> json<span class="token operator">-></span>array<span class="token operator">-></span>element<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> z <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> z <span class="token operator">&lt;</span> <span class="token function">atoi</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span> z<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
                <span class="token function">free</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">)</span>
                json <span class="token operator">=</span> json<span class="token operator">-></span>extant<span class="token punctuation">;</span>
            end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// printf("当前字段:%s,值类型:%d\n", word, json->value_type);</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
        <span class="token keyword">return</span> json<span class="token operator">-></span>value_str<span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_int<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_long<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_BOOL<span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">json_length</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">int</span> retval<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>word <span class="token operator">=</span> query<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>bool end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> end <span class="token operator">=</span> <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>word<span class="token punctuation">,</span> <span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// printf("分割字段:%s,指向字段:%s\n", word, json->key);</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_compare</span><span class="token punctuation">(</span>json<span class="token operator">-></span>key<span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>end <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">continue</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type <span class="token operator">!=</span> JSON_TYPE_ARRAY<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>retval <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> json <span class="token operator">=</span> json<span class="token operator">-></span>array<span class="token punctuation">;</span> json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> retval<span class="token operator">++</span><span class="token punctuation">)</span>
        json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
    <span class="token keyword">return</span> retval<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
AJSON <span class="token operator">*</span><span class="token function">json_extract</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>query<span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token keyword">int</span> head <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>word <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span> head<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// printf("%d:分割字段:%s,指向字段:%s\n", head, word, json->key);</span>

        <span class="token keyword">char</span> <span class="token operator">*</span>c <span class="token operator">=</span> word<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>c <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">'['</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strchr</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token char">']'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token keyword">char</span> <span class="token operator">*</span>index <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">++</span>c <span class="token operator">!=</span> <span class="token char">']'</span><span class="token punctuation">)</span>
                    index<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">*</span>c<span class="token punctuation">;</span>

                <span class="token keyword">int</span> depth <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">free</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_hasprefix</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>

                    json <span class="token operator">=</span> json<span class="token operator">-></span>array<span class="token operator">-></span>element<span class="token punctuation">;</span>

                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> depth<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                            json <span class="token operator">=</span> json<span class="token operator">-></span>element<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                word <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_compare</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> found_status <span class="token operator">=</span> JSON_FOUND_NO<span class="token punctuation">;</span>
        AJSON <span class="token operator">*</span>j <span class="token operator">=</span> json<span class="token punctuation">;</span>
        bool stop_strok <span class="token operator">=</span> false<span class="token punctuation">;</span>
        <span class="token keyword">char</span> <span class="token operator">*</span>word_save<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>j <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">string_hasprefix</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> j<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                json <span class="token operator">=</span> j<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    found_status <span class="token operator">=</span> JSON_FOUND_KEY<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stop_strok<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        word_save <span class="token operator">=</span> word<span class="token punctuation">;</span>
                        word <span class="token operator">=</span> <span class="token function">strtok</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>word <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            word <span class="token operator">=</span> word_save<span class="token punctuation">;</span>
                            stop_strok <span class="token operator">=</span> true<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    found_status <span class="token operator">=</span> JSON_FOUND_WORD<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>j<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                j <span class="token operator">=</span> j<span class="token operator">-></span>next<span class="token punctuation">;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>found_status <span class="token operator">==</span> JSON_FOUND_KEY<span class="token punctuation">)</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>found_status <span class="token operator">==</span> JSON_FOUND_NO<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
        <span class="token keyword">return</span> json<span class="token operator">-></span>array<span class="token punctuation">;</span>
    <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
        <span class="token keyword">return</span> json<span class="token operator">-></span>extant<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">json_free_base</span><span class="token punctuation">(</span><span class="token operator">*</span>json<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">json_free_</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free_nolloc</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">json_free_base</span><span class="token punctuation">(</span><span class="token operator">*</span>json<span class="token punctuation">,</span> false<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">json_free_</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free_</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span><span class="token operator">*</span>json<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// printf("释放:%p\n", *json);</span>
    <span class="token function">free</span><span class="token punctuation">(</span><span class="token operator">*</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>json <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>json_debug<span class="token punctuation">)</span>
        json_total_free<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_free_base</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>json<span class="token punctuation">,</span> bool lloc<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> json<span class="token operator">-></span>next <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> json <span class="token operator">=</span> json<span class="token operator">-></span>next<span class="token punctuation">)</span>
        <span class="token comment">// printf("释放进入 键:%s 值类型:%d 循环\n", json->key, json->value_type);</span>
        <span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// printf("释放进入 键:%s 值类型:%d \n", json->key, json->value_type);</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>value_type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> JSON_TYPE_STRING<span class="token operator">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>lloc<span class="token punctuation">)</span>
                <span class="token function">free</span><span class="token punctuation">(</span>json<span class="token operator">-></span>value_str<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json<span class="token operator">-></span>value_str <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_INT<span class="token operator">:</span>
            json<span class="token operator">-></span>value_int <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_LONG<span class="token operator">:</span>
            json<span class="token operator">-></span>value_long <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_EXTAND<span class="token operator">:</span>
            <span class="token function">json_free_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>extant<span class="token punctuation">,</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>extant<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json<span class="token operator">-></span>extant <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> JSON_TYPE_ARRAY<span class="token operator">:</span>
            <span class="token function">json_free_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>array<span class="token punctuation">,</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json<span class="token operator">-></span>array <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>element<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">json_free_base</span><span class="token punctuation">(</span>json<span class="token operator">-></span>element<span class="token punctuation">,</span> lloc<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>key <span class="token operator">&amp;&amp;</span> lloc<span class="token punctuation">)</span>
            <span class="token function">free</span><span class="token punctuation">(</span>json<span class="token operator">-></span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        json<span class="token operator">-></span>key <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>prev<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            json <span class="token operator">=</span> json<span class="token operator">-></span>prev<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>json<span class="token operator">-></span>next<span class="token punctuation">)</span>
                <span class="token function">json_free_</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>json<span class="token operator">-></span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
AJSON <span class="token operator">*</span><span class="token function">json_decoding</span><span class="token punctuation">(</span>AJSON <span class="token operator">*</span>now_json<span class="token punctuation">,</span> AJSON <span class="token operator">*</span>prev_json<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>json<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>pop<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span>recursion_seq<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>errmsg<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// fmt_status</span>
    <span class="token comment">// 0   => 遇到 {   转变1、 起始为JSON开头</span>
    <span class="token comment">// 0   => 遇到 [   转变12、起始为数组开头</span>
    <span class="token comment">// 1   => 遇到 "   转变2、 键开头</span>
    <span class="token comment">// 2   => 遇到 "   转变3、 键结尾</span>
    <span class="token comment">// 3   => 遇到 :   转变4</span>
    <span class="token comment">// 4   => 遇到 "   转变5、 值为字符串的开头</span>
    <span class="token comment">// 4   => 遇到 0-9 转变6、 值为数字类型开头</span>
    <span class="token comment">// 4   => 遇到 {   转变10、值为JSON开头</span>
    <span class="token comment">// 4   => 遇到 [   转变11、值为数组开头</span>
    <span class="token comment">// 4   => 遇到 t   转变7、值为bool开头</span>
    <span class="token comment">// 4   => 遇到 f   转变8、值为bool开头</span>
    <span class="token comment">// 5   => 字符串   转变100</span>
    <span class="token comment">// 6   => 数字     转变100</span>
    <span class="token comment">// 7   => true    转变100</span>
    <span class="token comment">// 8   => false   转变100</span>
    <span class="token comment">// 10  => JSON     转变100</span>
    <span class="token comment">// 11  => 数组元素  转变100</span>
    <span class="token comment">// 12  => 数组解析  转变100</span>
    <span class="token comment">// 100 => 字段完成  返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        errmsg <span class="token operator">=</span> JSON_ERROR_STRING_NULL<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fmt_status <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>j <span class="token operator">=</span> json <span class="token operator">+</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
    <span class="token keyword">int</span> word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> enter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">*</span>j <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 链表次序=JSON中的字段数</span>
        <span class="token comment">// printf("链表次序:%d fmt_status=%0d key_status=%0d j='%c' pop=%0d\n", *recursion_seq, fmt_status, key_status, *j, *pop);</span>

        <span class="token keyword">switch</span> <span class="token punctuation">(</span>fmt_status<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">'['</span><span class="token operator">:</span>
                <span class="token comment">// json_depth++;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'{'</span><span class="token operator">:</span>
                <span class="token comment">// json_depth++;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>key_status<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> KEY_STATUS_ENTER<span class="token operator">:</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                    key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
                    now_json<span class="token operator">-></span>key <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>word_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">&lt;</span> word_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span>
                        now_json<span class="token operator">-></span>key<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> json<span class="token punctuation">[</span><span class="token operator">*</span>pop <span class="token operator">-</span> word_len <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token comment">// printf("链表次序:%d key=%s\n", *recursion_seq, now_json->key);</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
                    word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">':'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
            word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_STRING<span class="token punctuation">;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'0'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'1'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'3'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'5'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'7'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'8'</span><span class="token operator">:</span>
            <span class="token keyword">case</span> <span class="token char">'9'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
                key_status <span class="token operator">=</span> KEY_STATUS_ENTER<span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'{'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
                j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'['</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
                j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'t'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'f'</span><span class="token operator">:</span>
                fmt_status <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
                word_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>key_status<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> KEY_STATUS_ENTER<span class="token operator">:</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                    key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
                    now_json<span class="token operator">-></span>value_str <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>word_len<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">&lt;</span> word_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span>
                        now_json<span class="token operator">-></span>value_str<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> json<span class="token punctuation">[</span><span class="token operator">*</span>pop <span class="token operator">-</span> word_len <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token comment">// printf("链表次序:%d value=%s(string)\n", *recursion_seq, now_json->value_str);</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>key_status<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> KEY_STATUS_ENTER<span class="token operator">:</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'0'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'1'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'2'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'3'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'4'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'5'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'6'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'7'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'8'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'9'</span><span class="token operator">:</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'}'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">','</span><span class="token operator">:</span>
                    key_status <span class="token operator">=</span> KEY_STATUS_RESET<span class="token punctuation">;</span>
                    <span class="token keyword">char</span> <span class="token operator">*</span>array <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">calloc</span><span class="token punctuation">(</span>word_len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> b <span class="token operator">&lt;</span> word_len<span class="token punctuation">;</span> b<span class="token operator">++</span><span class="token punctuation">)</span>
                        array<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> json<span class="token punctuation">[</span><span class="token operator">*</span>pop <span class="token operator">-</span> word_len <span class="token operator">+</span> b<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token keyword">long</span> l <span class="token operator">=</span> <span class="token function">atol</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">></span> INT_MAX<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        now_json<span class="token operator">-></span>value_long <span class="token operator">=</span> l<span class="token punctuation">;</span>
                        now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_LONG<span class="token punctuation">;</span>
                        <span class="token comment">// printf("链表次序:%d value=%ld(long)\n", *recursion_seq, now_json->value_long);</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        now_json<span class="token operator">-></span>value_int <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_INT<span class="token punctuation">;</span>
                        <span class="token comment">// printf("链表次序:%d value=%d(int)\n", *recursion_seq, now_json->value_int);</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">free</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
                    j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token comment">// error</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>

            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">'r'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'u'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'e'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                errmsg <span class="token operator">=</span> JSON_ERROR_BOOL<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_BOOL<span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>value_bool <span class="token operator">=</span> true<span class="token punctuation">;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">'a'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'l'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'s'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'e'</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
                    word_len<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                errmsg <span class="token operator">=</span> JSON_ERROR_BOOL<span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>word_len <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_BOOL<span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>value_bool <span class="token operator">=</span> false<span class="token punctuation">;</span>
                fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span><span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>extand_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            word_len <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
            <span class="token function">json_decoding</span><span class="token punctuation">(</span>extand_json<span class="token punctuation">,</span> now_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_EXTAND<span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>extant <span class="token operator">=</span> extand_json<span class="token punctuation">;</span>

            j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> word_len<span class="token punctuation">;</span>

            word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span><span class="token punctuation">;</span>

            AJSON <span class="token operator">*</span>array_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            word_len <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
            <span class="token function">json_decoding</span><span class="token punctuation">(</span>array_json<span class="token punctuation">,</span> now_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_ARRAY<span class="token punctuation">;</span>
            now_json<span class="token operator">-></span>array <span class="token operator">=</span> array_json<span class="token punctuation">;</span>

            j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> word_len<span class="token punctuation">;</span>

            word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span><span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>element_now_json<span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>element_prev_json<span class="token punctuation">;</span>
            AJSON <span class="token operator">*</span>element_first_json<span class="token punctuation">;</span>
            bool has_element <span class="token operator">=</span> false<span class="token punctuation">;</span>

            <span class="token keyword">int</span> seq <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>bool exec <span class="token operator">=</span> true<span class="token punctuation">;</span> exec <span class="token operator">==</span> true<span class="token punctuation">;</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                <span class="token keyword">case</span> <span class="token char">'{'</span><span class="token operator">:</span>
                    word_len <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>

                    <span class="token keyword">if</span> <span class="token punctuation">(</span>seq <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        element_now_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        element_first_json <span class="token operator">=</span> element_now_json<span class="token punctuation">;</span>
                        element_prev_json <span class="token operator">=</span> now_json<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                        element_prev_json <span class="token operator">=</span> element_now_json<span class="token punctuation">;</span>
                        element_now_json <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        element_prev_json<span class="token operator">-></span>element <span class="token operator">=</span> element_now_json<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token function">json_decoding</span><span class="token punctuation">(</span>element_now_json<span class="token punctuation">,</span> element_prev_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    has_element <span class="token operator">=</span> true<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
                    j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> word_len<span class="token punctuation">;</span>

                    seq<span class="token operator">++</span><span class="token punctuation">;</span>

                    word_len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>

                <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">','</span><span class="token operator">:</span>
                <span class="token keyword">case</span> <span class="token char">'}'</span><span class="token operator">:</span>
                    j<span class="token operator">++</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token char">']'</span><span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>has_element<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        now_json<span class="token operator">-></span>value_type <span class="token operator">=</span> JSON_TYPE_ELEMENT<span class="token punctuation">;</span>
                        now_json<span class="token operator">-></span>element <span class="token operator">=</span> element_first_json<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    fmt_status <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
                    j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                    exec <span class="token operator">=</span> false<span class="token punctuation">;</span>

                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    exec <span class="token operator">=</span> false<span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">100</span><span class="token operator">:</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>j<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token char">' '</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">','</span><span class="token operator">:</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>pop<span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>next <span class="token operator">=</span> <span class="token function">json_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                now_json<span class="token operator">-></span>next<span class="token operator">-></span>prev <span class="token operator">=</span> now_json<span class="token punctuation">;</span>
                <span class="token function">json_decoding</span><span class="token punctuation">(</span>now_json<span class="token operator">-></span>next<span class="token punctuation">,</span> now_json<span class="token punctuation">,</span> json<span class="token punctuation">,</span> pop<span class="token punctuation">,</span> recursion_seq<span class="token punctuation">,</span> errmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
                now_json <span class="token operator">=</span> now_json<span class="token operator">-></span>next<span class="token punctuation">;</span>
                j <span class="token operator">+=</span> <span class="token operator">*</span>pop <span class="token operator">-</span> tmp<span class="token punctuation">;</span>
                j<span class="token operator">--</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">*</span>pop<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'"'</span><span class="token operator">:</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token char">'}'</span><span class="token operator">:</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>

            <span class="token keyword">case</span> <span class="token char">']'</span><span class="token operator">:</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>recursion_seq<span class="token punctuation">)</span><span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errmsg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> now_json<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
bool <span class="token function">json_split</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>str<span class="token punctuation">,</span> <span class="token keyword">char</span> symbol<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>str <span class="token operator">==</span> <span class="token char">'\0'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    bool has <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>str<span class="token punctuation">;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> symbol<span class="token punctuation">)</span>
            has <span class="token operator">=</span> true<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>has<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">!</span>has<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>bool has_sysmbol <span class="token operator">=</span> true<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>str <span class="token operator">==</span> symbol<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token punctuation">(</span><span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>str<span class="token punctuation">;</span> <span class="token operator">*</span>s <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span> s<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>s <span class="token operator">==</span> symbol<span class="token punctuation">)</span>
                    has_sysmbol <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token keyword">return</span> has_sysmbol<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token operator">*</span>str <span class="token operator">==</span> <span class="token char">'\0'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
bool <span class="token function">json_compare_word</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>left<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>right<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// printf("对比字段 %s %s\n", left, right);</span>

    <span class="token comment">// ok:data   ,data</span>
    <span class="token comment">// ok:data.a ,data</span>
    <span class="token comment">// no:a.data ,data</span>
    bool ok <span class="token operator">=</span> <span class="token function">string_hasprefix</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ok<span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>

    <span class="token comment">// ok:data   ,data</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">strlen</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>

    <span class="token comment">// ok:data[0].a   ,data</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>left<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'['</span> <span class="token operator">||</span> left<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'.'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> true<span class="token punctuation">;</span>

    <span class="token keyword">return</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">json_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>errmsg <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token comment">// char *str = "{\"data\":[{\"id\":\"binzhou30\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou29\",\"state\":0,\"timeout\":18976},{\"id\":\"binzhou28\",\"state\":0,\"timeout\":49019},{\"id\":\"binzhou03\",\"state\":0,\"timeout\":659},{\"id\":\"binzhou06\",\"state\":0,\"timeout\":475},{\"id\":\"binzhou07\",\"state\":0,\"timeout\":18729},{\"id\":\"binzhou10\",\"state\":0,\"timeout\":473},{\"id\":\"binzhou13\",\"state\":0,\"timeout\":91246},{\"id\":\"binzhou16\",\"state\":0,\"timeout\":473},{\"id\":\"binzhou21\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou22\",\"state\":0,\"timeout\":44304},{\"id\":\"binzhou24\",\"state\":0,\"timeout\":18235},{\"id\":\"binzhou26\",\"state\":0,\"timeout\":471},{\"id\":\"binzhou09\",\"state\":0,\"timeout\":474},{\"id\":\"binzhou19\",\"state\":0,\"timeout\":1829}],\"messages\":\"success\",\"status\":true}";</span>
    <span class="token comment">// char *str = "{\"data\":[{\"id\":\"binzhou30\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou29\",\"state\":0,\"timeout\":18976},{\"id\":\"binzhou28\",\"state\":0,\"timeout\":49019}],\"data2\":[{\"id\":\"binzhou1\",\"state\":0,\"timeout\":39169},{\"id\":\"binzhou2\",\"state\":0,\"timeout\":18976},{\"id\":\"binzhou3\",\"state\":0,\"timeout\":49019}],\"messages\":\"success\",\"status\":true}";</span>
    <span class="token comment">// char *str = "{\"errcode\":\"0\",\"msg\":\"success\",\"data\":{\"vmname\":\"zhiweid09\",\"vmprdid\":\"61\",\"vpspassword\":\"zhiweidata\",\"endtime\":\"2023-11-03 19:27:13\",\"conninfo\":\"wenzhou01.263vps.cn:20601\",\"adslname\":\"057781205941\",\"adslpass\":\"648307\",\"cpurl\":\"106.14.117.11:8001\",\"runstatus\":\"1\",\"status\":\"正常\",\"osid\":\"0\",\"cityid\":\"0\",\"cityname\":\"\"}}";</span>
    <span class="token comment">// char *str = "{\"data\":{\"vmname\":\"zhiweid09\",\"vmprdid\":\"61\",\"vpspassword\":\"zhiweidata\",\"endtime\":\"2023-11-03 19:27:13\",\"conninfo\":\"wenzhou01.263vps.cn:20601\",\"adslname\":\"057781205941\",\"adslpass\":\"648307\",\"cpurl\":\"106.14.117.11:8001\",\"runstatus\":\"1\",\"status\":\"正常\",\"osid\":\"0\",\"cityid\":\"0\",\"cityname\":\"\"},\"errcode\":\"0\",\"msg\":\"success\"}";</span>

    <span class="token comment">// 解析用法</span>
    <span class="token comment">// AJSON *aj = json_new();</span>
    <span class="token comment">// int start = 0;</span>
    <span class="token comment">// int recursion_seq = 0;</span>
    <span class="token comment">// json_decoding(aj, aj, str, &amp;start, &amp;recursion_seq, errmsg);</span>
    <span class="token comment">// if (errmsg != NULL)</span>
    <span class="token comment">// {</span>
    <span class="token comment">//     printf("decode error: %s\n", errmsg);</span>
    <span class="token comment">// }</span>

    <span class="token comment">// // 封装 数组</span>
    <span class="token comment">// AJSON *json = json_new();</span>
    <span class="token comment">// AJSON *array_json = json_new();</span>
    <span class="token comment">// json_packaging(json, "data", array_json, JSON_TYPE_ARRAY);</span>
    <span class="token comment">// for (int i = 0; i &lt;= 1; i++)</span>
    <span class="token comment">// {</span>
    <span class="token comment">//     AJSON *vps_json = json_new();</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_ISP", (void *)"2", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_PRODUCT", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_NAME", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_INTERNAL_ID", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_EXTERNAL_ID", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_REMOTE_ADDRESS", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_LAN", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_ISP_ACCOUNT", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_ISP_PASSWORD", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_GROUP", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_RESTART_TIMESTAMP", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(vps_json, "OPT_KEY_VPS_RESTART_COUNT", (void *)"1", JSON_TYPE_STRING);</span>
    <span class="token comment">//     json_packaging(array_json, NULL, vps_json, JSON_TYPE_ELEMENT);</span>
    <span class="token comment">// }</span>
    <span class="token comment">// // 输出字符串</span>
    <span class="token comment">// char *json_str = json_string(json);</span>
    <span class="token comment">// printf("%s\n", json_str);</span>
    <span class="token comment">// json_string_free(json_str);</span>

    <span class="token comment">// 直接打印</span>
    <span class="token comment">// printf("%s\n",json->array->element->element->next->key);</span>
    <span class="token comment">// printf("%s\n",json->array->element->element->next->value_str);</span>
    <span class="token comment">// printf("%s\n", aj->next->prev->value_str);</span>
    <span class="token comment">// printf("%d\n", aj->next->next->prev->value_int);</span>

    <span class="token comment">// 打印json</span>
    <span class="token comment">// json_print(json, 0, true, false, 0, 0, 0);</span>
    <span class="token comment">// printf("\n---------------\n");</span>

    <span class="token comment">// 查询 int</span>
    <span class="token comment">// int *i = json_read(aj, ".data[1].timeout");</span>
    <span class="token comment">// printf("%d\n", *i);</span>

    <span class="token comment">// 查询 string</span>
    <span class="token comment">// char *remote_address = json_read(aj, ".data.conninfo");</span>
    <span class="token comment">// char *isp_account = json_read(aj, ".data.adslname");</span>
    <span class="token comment">// char *isp_password = json_read(aj, ".data.adslpass");</span>
    <span class="token comment">// char *external_id = json_read(aj, ".data.vmname");</span>
    <span class="token comment">// char *internal_id = json_read(aj, ".data.vmprdid");</span>
    <span class="token comment">// printf("%s\n", remote_address);</span>
    <span class="token comment">// printf("%s\n", isp_account);</span>
    <span class="token comment">// printf("%s\n", isp_password);</span>
    <span class="token comment">// printf("%s\n", external_id);</span>
    <span class="token comment">// printf("%s\n", internal_id);</span>

    <span class="token comment">// 提取</span>
    <span class="token comment">// char query[] = ".data";</span>
    <span class="token comment">// AJSON *ret = json_extract(aj, query);</span>
    <span class="token comment">// json_print(ret, 0, true, false, 0, 0, 0);</span>
    <span class="token comment">// printf("%d",string_hasprefix("data[0]","data"));</span>

    <span class="token comment">// 计算长度</span>
    <span class="token comment">// int data_len = json_length(aj, ".data");</span>
    <span class="token comment">// printf("%d\n", data_len);</span>

    <span class="token comment">// json_free(&amp;aj);</span>

    <span class="token comment">// if (json_debug)</span>
    <span class="token comment">//     printf("获取次数:%d 释放次数:%d", json_total_new, json_total_free);</span>

    <span class="token comment">// json_free_nolloc(&amp;json);</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="HKAAn9xG14CBwLAYiXHUq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">用法</span></summary><div id="aPT6CK5UhaBrGa8akTswo" class="wolai-block wolai-text"><div><span class="inline-wrap">参考头文件</span></div></div></details></details></div></details><details id="ipiFvEnN6uTGTKgjDYQqtE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">swift</span></summary><div class="block-ref"><div class="decorator"></div><div id="54oaNafdpNS8zzVkCoQD5C" class="wolai-sub-page wolai-block"><div class="page-icon"></div><a href="../swift/json/json.html"><span>JSON</span></a></div></div></details></article><footer></footer></body></html>