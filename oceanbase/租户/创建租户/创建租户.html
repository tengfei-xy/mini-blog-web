<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../../css/wolai.css"/><title>创建租户 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font less-lead"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="创建租户" class="main-title"></div></div></header><article><div id="9bM7QAUXbBckD33zVShpdS" class="wolai-block wolai-text"><div><span class="inline-wrap">参考文档：</span><span class="inline-wrap"><a href="https://www.codenong.com/cs105991814/"><span>https://www.codenong.com/cs105991814/</span></a></span></div></div><h1 id="tb1scezeiJddxisk9GnVUQ" class="wolai-block"><span class="inline-wrap">创建资源池</span></h1><ol class="wolai-block"><li id="kVFMbDeeGaMEqbFtivqfwx"><div class="marker"></div><span class="inline-wrap">连接到集群中</span></li></ol><code-block id="cBxiE1WUJptN4q4qgTYLey" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre> obclient <span class="token operator">-</span>h192<span class="token punctuation">.</span><span class="token number">168.3</span><span class="token number">.71</span> <span class="token operator">-</span>uroot<span class="token variable">@sys</span><span class="token comment">#obdemo -P2883 -A -pbb123456</span></pre></div></code-block><ol class="wolai-block"><li id="37AdYiXBAL6YT3PZMeDdGp"><div class="marker"></div><span class="inline-wrap">首先查看资源池</span></li></ol><code-block id="s1e2APoKL9uphfdH3AXj2P" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>use oceanbase<span class="token punctuation">;</span>
<span class="token keyword">select</span>
    zone,
    sum<span class="token punctuation">(</span>cpu_total<span class="token punctuation">)</span> - sum<span class="token punctuation">(</span>cpu_max_assigned<span class="token punctuation">)</span> as <span class="token string">'CPU remaining C'</span>,
    <span class="token punctuation">(</span>sum<span class="token punctuation">(</span>mem_total<span class="token punctuation">)</span> - sum<span class="token punctuation">(</span>mem_max_assigned<span class="token punctuation">))</span>/ <span class="token number">1024</span> / <span class="token number">1024</span> / <span class="token number">1024</span> as <span class="token string">'Memory remaining G'</span>
from __all_virtual_server_stat
group by zone<span class="token punctuation">;</span></pre></div></code-block><div id="wTU42qYELnJiCP7P4cfsKQ" class="wolai-block wolai-text"><div><span class="inline-wrap">如果<span class="jill"></span>CPU remaining C<span class="jill"></span>输出-1<span class="jill"></span>可查看</span></div></div><code-block id="rBaDv9F54JMgP44BWYM7yU" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token keyword">select</span> sum<span class="token punctuation">(</span>cpu_total<span class="token punctuation">)</span>,sum<span class="token punctuation">(</span>cpu_max_assigned<span class="token punctuation">)</span> from __all_virtual_server_stat<span class="token punctuation">;</span></pre></div></code-block><ol class="wolai-block"><li id="qfbGe3VxnQ9bewRe7E9pBh"><div class="marker"></div><span class="inline-wrap">定义资源规则</span></li></ol><code-block id="e3PQaaLDWqNbqEvP8iimWm" class="wolai-block"><div class="wolai-pre"><div data-lang="Sql" class="marker"></div><pre><span class="token keyword">create</span> resource unit unit_config_01 max_cpu<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> min_cpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max_memory<span class="token operator">=</span><span class="token string">'3G'</span><span class="token punctuation">,</span> min_memory<span class="token operator">=</span><span class="token string">'3G'</span><span class="token punctuation">,</span> max_iops<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> min_iops<span class="token operator">=</span><span class="token number">6000</span><span class="token punctuation">,</span> max_session_num<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> max_disk_size<span class="token operator">=</span><span class="token string">'50G'</span><span class="token punctuation">;</span>

<span class="token keyword">create</span> resource unit unit_config_02 max_cpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> min_cpu<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> max_memory<span class="token operator">=</span><span class="token string">'7G'</span><span class="token punctuation">,</span> min_memory<span class="token operator">=</span><span class="token string">'7G'</span><span class="token punctuation">,</span> max_iops<span class="token operator">=</span><span class="token number">10000</span><span class="token punctuation">,</span> min_iops<span class="token operator">=</span><span class="token number">6000</span><span class="token punctuation">,</span> max_session_num<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">,</span> max_disk_size<span class="token operator">=</span><span class="token string">'60G'</span><span class="token punctuation">;</span>

<span class="token comment">-- 查询: select * from oceanbase.`__all_unit_config`</span>
<span class="token comment">-- 修改: ALTER RESOURCE UNIT unit_config_01 max_cpu=3;</span>
<span class="token comment">-- 删除: drop resource unit unit_config_01;</span>
</pre></div></code-block><ol class="wolai-block"><li id="fAvZSTadaTnh5iR1cedaeW"><div class="marker"></div><span class="inline-wrap">创建资源池(基于资源规则)</span></li></ol><code-block id="9QheDTGP2wLqVUwUsoaxHY" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>create resource pool pool_01 <span class="token assign-left variable">unit</span><span class="token operator">=</span>unit_config_01, <span class="token assign-left variable">unit_num</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></pre></div></code-block><blockquote id="ciPLcBTr64ergiAUVpXV3R" class="wolai-block"><span class="inline-wrap">只有用<span class="jill"></span>root<span class="jill"></span>用户连接到<span class="jill"></span>sys<span class="jill"></span>租户(root@sys)才能执行<span class="jill"></span>CREATE TENANT<span class="jill"></span>创建租户。</span><span class="inline-wrap">
</span><span class="inline-wrap">连接到指定租户的方法是在用户名中指定，其格式为：用户<span class="jill"></span>@<span class="jill"></span>租户名#集群。如果直连<span class="jill"></span>OBserver，不需要集群名。</span><span class="inline-wrap">
</span><span class="inline-wrap">sys<span class="jill"></span>租户的默认用户是<span class="jill"></span>root，密码为空。</span></blockquote><ul class="wolai-block"><li id="1L5569hYyA9cE7o5Bop23m"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">创建<span class="jill"></span>mysql<span class="jill"></span>租户，租户名：obmy</span><blockquote id="v3HXEtf8rp6dEy8EFcUFrP" class="wolai-block"><span class="inline-wrap"><a href="https://www.modb.pro/db/29021"><span>配置文档</span></a></span><span class="inline-wrap">
</span><span class="inline-wrap">mysql<span class="jill"></span>租户的默认用户是<span class="jill"></span>root，密码为空。</span></blockquote><code-block id="m54NuNxMWrXwNxz6wiR5Rf" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>create tenant <span class="token keyword">if</span> not exists obmy 
charset <span class="token operator">=</span> <span class="token string">'utf8mb4'</span>,
resource_pool_list <span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'pool_01'</span><span class="token punctuation">)</span>,
replica_num <span class="token operator">=</span> <span class="token number">1</span>,
<span class="token assign-left variable">zone_list</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'zone1;zone2;zone3'</span><span class="token punctuation">)</span>,
<span class="token assign-left variable">primary_zone</span><span class="token operator">=</span><span class="token string">'RANDOM'</span>,
comment <span class="token string">'mysql tenant 1#'</span> 
<span class="token builtin class-name">set</span> ob_tcp_invited_nodes <span class="token operator">=</span> <span class="token string">'%'</span>, ob_compatibility_mode <span class="token operator">=</span> <span class="token string">'mysql'</span><span class="token punctuation">;</span></pre></div></code-block><div id="dwbA3Vr2NN5HKDf8MJUR66" class="wolai-block wolai-text"><div><span class="inline-wrap">连接并修改密码</span></div></div><code-block id="hdMyPvw5YS85o54GRAHAD8" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>obclient <span class="token parameter variable">-h192.168.3.71</span> -uroot@obmy <span class="token parameter variable">-P2881</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-p</span>
alter user root identified by <span class="token string">'bb123456'</span><span class="token punctuation">;</span></pre></div></code-block></li><li id="5K7L1oAvGa75wLRdjsYp8Q"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">创建<span class="jill"></span>oracle<span class="jill"></span>租户，租户名：obor</span><blockquote id="gw9cvEeSzauxRWzX6eZckL" class="wolai-block"><span class="inline-wrap"><a href="https://www.modb.pro/db/29022"><span>配置文档</span></a></span><span class="inline-wrap">
</span><span class="inline-wrap">Oracle<span class="jill"></span>租户是不能直接用<span class="jill"></span>mysql<span class="jill"></span>客户端连接的，需要用<span class="jill"></span>obclient，否者报错。</span><span class="inline-wrap">
</span><span class="inline-wrap">oracle<span class="jill"></span>租户的默认用户是<span class="jill"></span>sys，密码为空。</span></blockquote><code-block id="5BmE44jxwBKr5uvWBvcqL4" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>create tenant <span class="token keyword">if</span> not exists obor 
resource_pool_list <span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'pool_02'</span><span class="token punctuation">)</span>,
replica_num <span class="token operator">=</span> <span class="token number">1</span>,
<span class="token assign-left variable">zone_list</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'zone1'</span><span class="token punctuation">)</span>,
<span class="token assign-left variable">primary_zone</span><span class="token operator">=</span><span class="token string">'RANDOM'</span>,
comment <span class="token string">'oracle tenant 1#'</span> 
<span class="token builtin class-name">set</span> ob_tcp_invited_nodes <span class="token operator">=</span> <span class="token string">'%'</span>, ob_compatibility_mode <span class="token operator">=</span> <span class="token string">'oracle'</span><span class="token punctuation">;</span></pre></div></code-block><div id="rpaVWK2wod7PexHcAY7zg8" class="wolai-block wolai-text"><div><span class="inline-wrap">修改密码</span></div></div><code-block id="czshew8vtFVkD7x85PVsBS" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>obclient <span class="token parameter variable">-h192.168.3.71</span> -usys@obor<span class="token comment">#obdemo -P2883 -A -p</span>
alter user sys identified by bb123456<span class="token punctuation">;</span></pre></div></code-block><blockquote id="tG4KVLoaV5sNX72p3MUKJ1" class="wolai-block"><span class="inline-wrap">如果提示<span class="jill"></span>ERROR 3118 (HY000): User locked，强制删除<span class="jill"></span>obor<span class="jill"></span>后再执行，命令如下</span></blockquote><code-block id="vK6PvqDhb8a1SZZk4rHUN3" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre>drop tenant 租户名 force<span class="token punctuation">;</span></pre></div></code-block></li></ul></article><footer></footer></body></html>