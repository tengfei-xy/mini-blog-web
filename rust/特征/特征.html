<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>特征 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="特征" class="main-title"></div></div></header><article><div id="k5spjhJjFdcVw1MZjyuKJV" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义：</span><span class="inline-wrap">不同的类型具有相同的行为</span></div></div><div id="bek6rdspNws85e9riEXs6J" class="wolai-block wolai-text"><div><span class="blue inline-wrap">目的：</span><span class="inline-wrap">为类型定义行为</span></div></div><div id="hf8nj3WtbNRrgkiX8jYhPf" class="wolai-block wolai-text"><div><span class="blue inline-wrap">注意：</span><span class="inline-wrap">特征只定义行为看起来是什么样的，而不定义行为具体是怎么样的。并且每一个实现这个特征的类型都需要具体实现该特征的相应方法，</span></div></div><details id="Vv6dGJpm1zVuwuwXC1zAV" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">孤儿原则</span></summary><div id="oQNMPMCJ76DBn81VZRTdDb" class="wolai-block wolai-text"><div><span class="inline-wrap">在<span class="jill"></span>Rust<span class="jill"></span>编程语言中，&quot;孤儿规则&quot;（orphan rule）是一项重要的特性。它规定了哪些<span class="jill"></span>trait<span class="jill"></span>可以被哪些类型实现。该规则的目的是确保类型的实现和<span class="jill"></span>trait<span class="jill"></span>定义都位于相同的<span class="jill"></span>crate（即模块）中，或者至少其中一个是本地<span class="jill"></span>crate。</span></div></div><div id="cpaetE9vdCXd4Gxr7Uh2vs" class="wolai-block wolai-text"><div><span class="inline-wrap">孤儿规则的意义在于解决了<span class="jill"></span>trait<span class="jill"></span>实现的一致性和可靠性问题。当<span class="jill"></span>trait<span class="jill"></span>和类型定义分布在不同的<span class="jill"></span>crate<span class="jill"></span>中时，如果任意一个<span class="jill"></span>crate<span class="jill"></span>都可以为任意类型实现<span class="jill"></span>trait，就可能出现冲突和不一致的情况。这可能导致代码的维护性和可读性下降，甚至可能引发不可预测的行为。</span></div></div><div id="kh5LydYkGz4zDqdkstjjUR" class="wolai-block wolai-text"><div><span class="inline-wrap">通过孤儿规则，Rust<span class="jill"></span>要求<span class="jill"></span>trait<span class="jill"></span>的实现者必须与<span class="jill"></span>trait<span class="jill"></span>定义者位于同一个<span class="jill"></span>crate<span class="jill"></span>或本地<span class="jill"></span>crate，以确保<span class="jill"></span>trait<span class="jill"></span>的实现是可预测和一致的。这种限制有助于减少潜在的冲突，使代码更易于理解和调试，并提高了编译器的性能。</span></div></div><div id="isioJJJaNd5ezf3RESpW1x" class="wolai-block wolai-text"><div><span class="inline-wrap">总的来说，孤儿规则在<span class="jill"></span>Rust<span class="jill"></span>中的意义是为了保证<span class="jill"></span>trait<span class="jill"></span>的实现是可控和可靠的，从而提高代码的可维护性和可靠性。</span></div></div></details><details id="ke1tmcz92gJE69XmtD4rBR" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">安全限制</span></summary><div id="mMJHivtfWNUArAD9XLU7Z1" class="wolai-block wolai-text"><div><span class="inline-wrap">当一个特征的所有方法都有如下属性时，它的对象才是安全的：</span></div></div><ul class="wolai-block"><li id="nmdGnFnhQSNWzz5HYMQquG"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">方法的返回类型不能是 </span><span class="inline-wrap"><code>Self</code></span></li><li id="tmaT6HdUSpxwSCbT5MWpp"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">方法没有任何泛型参数</span></li></ul></details><h1 id="dXN3fducrzXtKy1GYXkLcZ" class="wolai-block"><span class="inline-wrap">特征列举</span><div id="ku2zK4ioCFrNZiGAmsfDKL" class="wolai-sub-page wolai-block"><div class="page-icon"></div><a href="clone%E7%89%B9%E5%BE%81/clone%E7%89%B9%E5%BE%81.html"><span>Clone特征</span></a></div><div id="faHAx5unizTAk4ZCkkphWG" class="wolai-sub-page wolai-block"><div class="page-icon"></div><a href="copy%E7%89%B9%E5%BE%81/copy%E7%89%B9%E5%BE%81.html"><span>Copy特征</span></a></div></h1><h1 id="vGwU59FzGxKeLkL5eSbt34" class="wolai-block"><span class="inline-wrap">特征实现</span><details id="ne7vDkTsE22C4ueWShBgGJ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">声明方式</span></summary><code-block id="gvXaUn4u22yfRq9LrWAngE" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token comment">// 一般实现</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//  默认实现</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"(Read more...)"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div></code-block></details><details id="djRai2vZkrNbEKy9sTNFtN" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">作为方法</span></summary><details id="uCgiqew2Xozeouugjcv4Wg" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例一</span></summary><code-block id="wVAYWiEx6Q57iEL5CW2v1S" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token comment">// 声明</span>
<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Post</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> title<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// 标题</span>
    <span class="token keyword">pub</span> author<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// 作者</span>
    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token comment">// 内容</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Post</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"文章{}, 作者是{}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>author<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Weibo</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">Weibo</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"{}发表了微博{}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> post <span class="token operator">=</span> <span class="token class-name">Post</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">"Rust语言简介"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>author<span class="token punctuation">:</span> <span class="token string">"Sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">:</span> <span class="token string">"Rust棒极了!"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> weibo <span class="token operator">=</span> <span class="token class-name">Weibo</span><span class="token punctuation">{</span>username<span class="token punctuation">:</span> <span class="token string">"sunface"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>content<span class="token punctuation">:</span> <span class="token string">"好像微博没Tweet好用"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>post<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span>weibo<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></code-block></details><details id="qKQD86EQs3BRuBkCdWbbHM" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例二</span></summary><div id="hNSBT83ogJ2iHbC2hSEWEJ" class="wolai-block wolai-text"><div><span class="inline-wrap">定义了一个特征 </span><span class="inline-wrap"><code>Printable</code></span><span class="inline-wrap">，它有一个方法 </span><span class="inline-wrap"><code>print</code></span><span class="inline-wrap">。然后我们为 </span><span class="inline-wrap"><code>Person</code></span><span class="inline-wrap"> 结构体实现了 </span><span class="inline-wrap"><code>Printable</code></span><span class="inline-wrap"> 特征，并在 </span><span class="inline-wrap"><code>main</code></span><span class="inline-wrap"> 函数中调用了 </span><span class="inline-wrap"><code>print</code></span><span class="inline-wrap"> 方法。</span></div></div><code-block id="ww9Ho5zfbR7MohCKC3tc5z" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">trait</span> <span class="token type-definition class-name">Printable</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Printable</span> <span class="token keyword">for</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Name: {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    person<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><details id="iT4y6kbB5LVQ7zAMjFLkwU" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">作为函数参数</span></summary><div id="pRPj3BauTispURRbEJF22w" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明：</span><span class="inline-wrap">实现了</span><span class="inline-wrap"><code>Summary</code></span><span class="inline-wrap">特征 的 </span><span class="inline-wrap"><code>item</code></span><span class="inline-wrap"> 参数。</span></div></div><div id="fnfoLzFpPagsbGozrB3gjf" class="wolai-block wolai-text"><div><span class="blue inline-wrap">用处：</span><span class="inline-wrap">你可以使用任何实现了 </span><span class="inline-wrap"><code>Summary</code></span><span class="inline-wrap"> 特征的类型作为该函数的参数，同时在函数体内，还可以调用该特征的方法，</span></div></div><div id="4wT3mJqxBcSrvzbbaawNsx" class="wolai-block wolai-text"><div><span class="blue inline-wrap">举例：</span><span class="inline-wrap">例如 </span><span class="inline-wrap"><code>summarize</code></span><span class="inline-wrap"> 方法。具体的说，可以传递 </span><span class="inline-wrap"><code>Post</code></span><span class="inline-wrap"> 或 </span><span class="inline-wrap"><code>Weibo</code></span><span class="inline-wrap"> 的实例来作为参数，</span></div></div><code-block id="iMAHVmoDLrXv5cbQRvWJMm" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Breaking news! {}"</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></code-block></details><details id="rsjEqd4yhaarUrddbmPC7r" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">特征约束</span></summary><details id="81kV3gEo1sKFXcCxCBNcjV" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">多个特征的参数</span></summary><code-block id="mKkCNVKqHvvaeuYsYA6ns9" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item1<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">,</span> item2<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></pre></div></code-block></details><details id="ktV62bxGtZ2xGvzo2kLjEz" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">多重约束</span></summary><code-block id="aYhqhd6KvfmRKqEUCVyerq" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token comment">// 语法糖形式</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token class-name">Display</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// 特征约束形式</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token class-name">Display</span><span class="token operator">></span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</pre></div></code-block></details><details id="5BqE4ewbEPEkdVxqSzvtRZ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">where<span class="jill"></span>约束</span></summary><div id="atxtnSnG2smtoE4ZYasicR" class="wolai-block wolai-text"><div><span class="inline-wrap">当特征约束变得很多时，函数的签名将变得很复杂：</span></div></div><code-block id="4JyFJqigYJP8P9Y6rSBU7V" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></pre></div></code-block><div id="mjDx1VeM2fRPPsVZp9uGL7" class="wolai-block wolai-text"><div><span class="inline-wrap">严格来说，上面的例子还是不够复杂，但是我们还是能对其做一些形式上的改进，通过 </span><span class="inline-wrap"><code>where</code></span><span class="inline-wrap">：</span></div></div><code-block id="8Hnnk7SCNmbknZ1QcpeK1P" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre>`<span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">></span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">{</span>
  <span class="token keyword">where</span> <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span>
    <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span>
<span class="token punctuation">}</span>
</pre></div></code-block></details><details id="psd1YrKMPLu1A7DfF2BZHY" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">有条件地实现方法或特征</span></summary><div id="mH3eP7jBqRQQ83bH3Fw9Hw" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：对于</span><span class="inline-wrap"><code>cmp_display</code></span><span class="inline-wrap">方法，只有 </span><span class="inline-wrap"><code>T</code></span><span class="inline-wrap"> 同时实现了 </span><span class="inline-wrap"><code>Display + PartialOrd</code></span><span class="inline-wrap"> 的 </span><span class="inline-wrap"><code>Pair&lt;T&gt;</code></span><span class="inline-wrap"> 才可以拥有此方法。</span></div></div><code-block id="c7xkSZ3FjUpHiN9R8upNi9" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span>
            x<span class="token punctuation">,</span>
            y<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">PartialOrd</span><span class="token operator">></span> <span class="token class-name">Pair</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">cmp_display</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x <span class="token operator">>=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is x = {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The largest member is y = {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><h1 id="9JhY9Z26d1yqqjF6w5eRyZ" class="wolai-block"><span class="inline-wrap">特征对象实现</span><div id="hqyjGis21xoSQzuNDAEPHW" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用：</span><span class="inline-wrap">一个统一的类型来应用于变量，是特征约束的集合</span></div></div><div id="oA5uLjQ8Sfw4swhTJn1Vmd" class="wolai-block wolai-text"><div><span class="blue inline-wrap">性质：</span><span class="inline-wrap">动态分发（当使用特征对象时，Rust 必须使用动态分发。编译器无法知晓所有可能用于特征对象代码的类型，所以它也不知道应该调用哪个类型的哪个方法实现。）</span></div></div><details id="qa2SCyB1Um3Mpif2Kneb2y" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例一</span></summary><code-block id="4Me9iKtGU5RQp6xkHScrhs" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token comment">// 意义：只要组件实现了 Draw 特征，就可以调用 draw 方法来进行渲染。</span>
<span class="token keyword">trait</span> <span class="token type-definition class-name">Draw</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Draw</span> <span class="token keyword">for</span> <span class="token keyword">u8</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"u8: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Draw</span> <span class="token keyword">for</span> <span class="token keyword">f64</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">draw</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"f64: {}"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 若 T 实现了 Draw 特征</span>
<span class="token comment">// 则调用该函数时传入的 Box&lt;T> 可以被隐式转换成函数参数签名中的 Box&lt;dyn Draw></span>
<span class="token keyword">fn</span> <span class="token function-definition function">draw1</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Draw</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 由于实现了 Deref 特征，Box 智能指针会自动解引用为它所包裹的值，</span>
    <span class="token comment">// 然后调用该值对应的类型上定义的 `draw` 方法</span>
    x<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">draw2</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Draw</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">1.1f64</span><span class="token punctuation">;</span>
    <span class="token comment">// do_something(&amp;x);</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">8u8</span><span class="token punctuation">;</span>

    <span class="token comment">// x 和 y 的类型 T 都实现了 `Draw` 特征</span>
    <span class="token comment">// 因为 Box&lt;T> 可以在函数调用时隐式地被转换为特征对象 Box&lt;dyn Draw> </span>
    <span class="token comment">// 基于 x 的值创建一个 Box&lt;f64> 类型的智能指针，指针指向的数据被放置在了堆上</span>
    <span class="token function">draw1</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 基于 y 的值创建一个 Box&lt;u8> 类型的智能指针</span>
    <span class="token function">draw1</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">draw2</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">draw2</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre></div></code-block></details><details id="w7skp4qcnv2fwe7qgDcPH3" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例二</span></summary><div id="nNDvoKW8PxEn5skPAxYPdh" class="wolai-block wolai-text"><div><span class="inline-wrap">定义了一个 </span><span class="inline-wrap"><code>print_person</code></span><span class="inline-wrap"> 函数，它接收一个实现了 </span><span class="inline-wrap"><code>Printable</code></span><span class="inline-wrap"> 特征的对象作为参数，并调用其 </span><span class="inline-wrap"><code>print</code></span><span class="inline-wrap"> 方法。在 </span><span class="inline-wrap"><code>main</code></span><span class="inline-wrap">函数中，我们创建了一个 </span><span class="inline-wrap"><code>Person</code></span><span class="inline-wrap"> 对象，并将其传递给 </span><span class="inline-wrap"><code>print_person</code></span><span class="inline-wrap">函数进行打印。</span></div></div><code-block id="sZbBV5ccdWsYf1yddg4Yqk" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">trait</span> <span class="token type-definition class-name">Printable</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">Printable</span> <span class="token keyword">for</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">print</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Name: {}"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">print_person</span><span class="token punctuation">(</span>printable<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">dyn</span> <span class="token class-name">Printable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    printable<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Bob"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">print_person</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="hjVJMXtde2v4GNWmuAPyUL" class="wolai-block wolai-text"><div><span class="blue inline-wrap">注意：</span><span class="inline-wrap">特征对象实现使用了 </span><span class="inline-wrap"><code>&amp;dyn Printable</code></span><span class="inline-wrap"> 类型，这是 Rust 中用于引用特征对象的方式。通过特征对象实现，我们可以在运行时决定要调用的方法，这在某些情况下非常有用，但也会带来一些运行时开销。</span></div></div></details></h1></h1></article><footer></footer></body></html>