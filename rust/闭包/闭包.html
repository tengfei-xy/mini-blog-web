<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>闭包 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="闭包" class="main-title"></div></div></header><article><div id="9bzGCpVxbPc7uZ9XWWgTp3" class="wolai-block wolai-text"><div><span class="blue inline-wrap">定义：</span><span class="inline-wrap">是一种匿名函数，属于闭包类型（Closure Type），实现了<span class="jill"></span>Fn、FnMut<span class="jill"></span>或<span class="jill"></span>FnOnce<span class="jill"></span>这些特征（Traits）之一。</span></div></div><div id="t4QDJkADUD8NVDUBkuMEGr" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用：</span><span class="inline-wrap">将行为封装在一个可传递和可保存的对象中。它们允许您在需要时动态地创建函数，并且可以访问其创建时的环境。</span></div></div><details id="bJHQx9SiXG9RP1fDZiYLYm" class="wolai-block"><summary><div class="marker"></div><span class="blue inline-wrap">使用场景：</span><span class="inline-wrap">行为作为参数传递给其他函数或方法的情况下。</span></summary><div id="mMTyc2sR7o1K1Rx7Gx2vF2" class="wolai-block wolai-text"><div><span class="blue inline-wrap">迭代器和函数式编程：</span><span class="inline-wrap">在处理集合（如数组、向量等）时，使用闭包可以提供丰富的迭代器接口和函数式编程风格的操作。</span></div></div><div id="hb1N2YnfGjNQ7Vmx72pxKF" class="wolai-block wolai-text"><div><span class="blue inline-wrap">回调函数：</span><span class="inline-wrap">当您需要在某个事件发生时执行特定的行为时，可以使用闭包作为回调函数。例如，处理<span class="jill"></span>GUI<span class="jill"></span>事件、异步操作的回调等。</span></div></div><div id="WQvVu4n4xKWBg8YN8Qu49" class="wolai-block wolai-text"><div><span class="blue inline-wrap">条件行为：</span><span class="inline-wrap">当您需要根据某个条件选择不同的行为时，闭包可以提供一种灵活的方式来定义和传递相应的行为。</span></div></div><details id="6bMjykquCHYdh6ip2mtQ8L" class="wolai-block"><summary><div class="marker"></div><span class="blue inline-wrap">惰性求值 ：</span><span class="inline-wrap">是编程语言中的一个概念，闭包可以用于实现惰性求值，即允许表达式推迟求值，直到实际需要的时候进行计算。。惰性求值是延迟计算的一种形式，特指表达式的求值策略。</span></summary><div id="7kZHwvLGHNAt2aFhKT3cLF" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：闭包 </span><span class="inline-wrap"><code>|&amp;x| x % 2 == 0</code></span><span class="inline-wrap"> 捕获了外部变量 </span><span class="inline-wrap"><code>x</code></span><span class="inline-wrap">，并检查 </span><span class="inline-wrap"><code>x</code></span><span class="inline-wrap"> 是否为偶数。这个闭包没有立即执行，而是在迭代器被消费（例如在 </span><span class="inline-wrap"><code>for</code></span><span class="inline-wrap"> 循环中）时才会被调用。</span></div></div><code-block id="689tUqLP63UZPjYMwdsFtV" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> filtered_numbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Filtered numbers:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> num <span class="token keyword">in</span> filtered_numbers <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details><div id="686TnJ1H3WKE7mBx6FYxTh" class="wolai-block wolai-text"><div><span class="blue inline-wrap">延迟计算：</span><span class="inline-wrap">是一种策略，闭包可以用于延迟计算，只有在需要时才执行。这对于性能优化和资源管理非常有用，因为您可以推迟昂贵的计算或资源分配，直到实际需要的时候。</span></div></div><details id="h4BX2DhJcH9BgAY1eVnsSe" class="wolai-block"><summary><div class="marker"></div><span class="blue inline-wrap">并发编程：</span><span class="inline-wrap">闭包在并发编程中也非常有用。使用闭包，您可以方便地捕获线程之间的共享状态，并在不同线程上执行具有访问共享状态的逻辑。</span></summary><details id="b4QX1GJCF7d1Q4FhMUf2BZ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><div id="uo2m4FSs48JJxrqQjtrNmt" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：闭包中的 </span><span class="inline-wrap"><code>move</code></span><span class="inline-wrap"> 关键字用于将环境中的变量 </span><span class="inline-wrap"><code>i</code></span><span class="inline-wrap"> 移动到闭包内部，以便每个线程都拥有自己的 </span><span class="inline-wrap"><code>i</code></span><span class="inline-wrap"> 值。</span></div></div><code-block id="s7gW4noL9dBZAT3QpqYpan" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
<span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Here's a vector: {:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
handle<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></details></details></details><details id="wTckoQ4opQmyeUyfRNdA3p" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">作用</span></summary><div id="d3bihKgBbW5rYp2CAnxztn" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>捕获上下文变量</b></span><span class="inline-wrap">：闭包可以捕获其定义环境中的变量，即使这些变量在闭包被调用时已经超出了作用域。</span><span class="inline-wrap">这使得闭包可以在稍后使用捕获的变量，而不需要将它们作为参数传递给闭包。</span></div></div><div id="wyWTfTeoUW3G187movZYaW" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>代码重用</b></span><span class="inline-wrap">：闭包可以作为值传递、存储和使用，就像其他数据类型一样。这使得闭包可以用来实现代码的重用。你可以将闭包存储在变量中，然后在需要时调用它们，而无需重复编写相同的代码。</span></div></div><div id="8jHi5XJ5NoJcviDP9etD8r" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>灵活性和动态性</b></span><span class="inline-wrap">：闭包可以在运行时动态地创建和定义，使得代码更加灵活和动态。你可以根据需要定义闭包，根据不同的上下文使用不同的闭包逻辑。</span></div></div><div id="8PdwoUsj4d1gD6BK27M8t" class="wolai-block wolai-text"><div><span class="inline-wrap"><b>简化语法</b></span><span class="inline-wrap">：闭包提供了一种简洁的语法来定义匿名函数，避免了显式定义函数的过程。这对于编写短小的代码块或将函数作为参数传递的情况非常有用。</span></div></div></details><details id="3ovUVjyhkHVdmScbryEjzE" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">格式</span></summary><details id="js38af8wtZBPBkMguhAFFq" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">一般格式</span></summary><code-block id="utGpVKffx6bEgmTiVizJ9h" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>param1<span class="token punctuation">,</span> param2<span class="token punctuation">,</span><span class="token punctuation">...</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    语句<span class="token number">1</span><span class="token punctuation">;</span>
    语句<span class="token number">2</span><span class="token punctuation">;</span>
    返回表达式
<span class="token punctuation">}</span></pre></div></code-block></details><details id="mkpPTo6TjXbFjVgrFsufLH" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">一句返回表达式的简化定义格式</span></summary><code-block id="baPN2eteqbkkJNnNYBcNmN" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token operator">|</span>param1<span class="token operator">|</span> 返回表达式</pre></div></code-block><code-block id="k2uXsEJTHhJoexNiNevwPN" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span>  <span class="token function-definition function">add_one_v1</span>   <span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> add_one_v2 <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> add_one_v3 <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span>             <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> add_one_v4 <span class="token operator">=</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span>               x <span class="token operator">+</span> <span class="token number">1</span>  <span class="token punctuation">;</span></pre></div></code-block></details></details><details id="bum9hZRkktHUECZD75m7qK" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例对比</span></summary><details id="mokjTgzb1C1VXmWNNmefCx" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">对所有元素<span class="jill"></span>+1</span></summary><div id="2sWmSUXG29w5aHic1sxJ9m" class="wolai-block wolai-text"><div><span class="inline-wrap">一般函数</span></div></div><code-block id="ikk6hGGqyuj1jhWJLWv98Q" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">add_one</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">{</span>
    x <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> mapped_numbers<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">add_one</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> mapped_numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: [2, 3, 4, 5, 6]</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="oQJfmbCEvVzqMC6yAN3UM8" class="wolai-block wolai-text"><div><span class="inline-wrap">闭包实现</span></div></div><code-block id="eZ9CKdT8ZQyzgFG8Dj3mG6" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> mapped_numbers<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{:?}"</span><span class="token punctuation">,</span> mapped_numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: [2, 3, 4, 5, 6]</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="wWFiK2jedmT4JateRf1CLz" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">计数器</span></summary><div id="3cToCVyUSGioxjL5gVGRcv" class="wolai-block wolai-text"><div><span class="inline-wrap">一般实现</span></div></div><code-block id="c6EHtNt68Rie1xcr7yHMP5" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">create_counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">FnMut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 一般函数</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        count
    <span class="token punctuation">}</span>

    counter
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> <span class="token function">create_counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 1</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 2</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="e5KZAKYmbLwj6vwgJpRFfZ" class="wolai-block wolai-text"><div><span class="inline-wrap">闭包实现</span></div></div><code-block id="6RCLz8vZG61eQdMPggae6F" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">fn</span> <span class="token function-definition function">create_counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">impl</span> <span class="token class-name">FnMut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 闭包</span>
    <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">{</span>
        count <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        count
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    counter
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> counter <span class="token operator">=</span> <span class="token function">create_counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 1</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"{}"</span><span class="token punctuation">,</span> <span class="token function">counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 2</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details><h1 id="nhd9sbo845fc1fdxm63L6n" class="wolai-block"><span class="inline-wrap">move<span class="jill"></span>关键词</span><div id="tbxKgiwwhMkoqNJLkqtiPU" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用：</span><span class="inline-wrap">强制闭包取得捕获变量的所有权</span></div></div><div id="kobPXdfY8JFjT2M8Eycqte" class="wolai-block wolai-text"><div><span class="blue inline-wrap">使用场景：</span><span class="inline-wrap">用于闭包的生命周期大于捕获变量的生命周期时，例如将闭包返回或移入其他线程。</span></div></div><div class="block-ref"><div class="decorator"></div><details id="b4QX1GJCF7d1Q4FhMUf2BZ" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><div id="uo2m4FSs48JJxrqQjtrNmt" class="wolai-block wolai-text"><div><span class="inline-wrap">说明：闭包中的 </span><span class="inline-wrap"><code>move</code></span><span class="inline-wrap"> 关键字用于将环境中的变量 </span><span class="inline-wrap"><code>i</code></span><span class="inline-wrap"> 移动到闭包内部，以便每个线程都拥有自己的 </span><span class="inline-wrap"><code>i</code></span><span class="inline-wrap"> 值。</span></div></div><code-block id="s7gW4noL9dBZAT3QpqYpan" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span>
<span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Here's a vector: {:?}"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
handle<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block></details></div></h1><div id="ijD7PpxAQ1nPpJtbkgnFxX" class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>