<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="../../css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="../../css/prism.min.css"/><link rel="stylesheet" type="text/css" href="../../css/katex.min.css"/><link rel="stylesheet" type="text/css" href="../../css/wolai.css"/><title>引用 - wolai 笔记</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="full-width small-font"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="引用" class="main-title"></div></div></header><article><div id="8ogjXZawxp2gG7qFdqdj2Q" class="wolai-block wolai-text"><div><span class="blue inline-wrap">引用特点：</span><span class="inline-wrap">同一时刻，你只能拥有要么一个可变引用, 要么任意多个不可变引用。引用必须总是有效的。是一个东西。</span></div></div><div id="b6tt65S5x4GqxrnhxBeG6r" class="wolai-block wolai-text"><div><span class="blue inline-wrap">借用(borrowing)：</span><span class="inline-wrap">获取变量的引用。是一个动作，</span></div></div><h1 id="s2GkiX3VavoTyhoWX4LPo1" class="wolai-block"><span class="inline-wrap">不可变引用</span><details id="hsLPRMF6qFTSQzBrVErtgP" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>&amp;</code></span><span class="inline-wrap">方式</span></summary><div id="iqA3DLKxZA3QRGZDEkxnb8" class="wolai-block wolai-text"><div><span class="blue inline-wrap">符号说明：</span><span class="inline-wrap">它们允许你使用值，但是不获取所有权</span></div></div><div id="ukjcKwy2ADVgeJET9xr5Jb" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明：</span><span class="inline-wrap"> </span><span class="inline-wrap"><code>s1</code></span><span class="inline-wrap"> 的引用作为参数传递给 </span><span class="inline-wrap"><code>calculate_length</code></span><span class="inline-wrap"> 函数，而不是把 </span><span class="inline-wrap"><code>s1</code></span><span class="inline-wrap"> 的所有权转移给该函数</span></div></div><code-block id="v11FvSFVs2B76tTn2iqScr" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token function">calculate_length</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"The length of '{}' is {}."</span><span class="token punctuation">,</span> s1<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// &amp;String 是不可变引用</span>
<span class="token keyword">fn</span> <span class="token function-definition function">calculate_length</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">usize</span> <span class="token punctuation">{</span>
    s<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></pre></div></code-block></details><details id="v7St4Hq6dgmweAuFX1Dn2h" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap">方式</span></summary><div id="2Pv5pyykAUAnFGwWBk3RVP" class="wolai-block wolai-text"><div><span class="blue inline-wrap">作用：</span><span class="inline-wrap">用于获取对变量的引用。它通常与模式匹配结合使用，以便在模式匹配过程中获取引用而不是对值进行所有权转移。</span></div></div><details id="9woGMEsW78d8GgSLK86E7X" class="wolai-block"><summary><div class="marker"></div><span class="inline-wrap">示例</span></summary><div id="tSRTGWaqKBVWZyzs4fzxW5" class="wolai-block wolai-text"><div><span class="blue inline-wrap">说明：</span><span class="inline-wrap">在下面的代码中，使用 </span><span class="inline-wrap"><code>ref</code></span><span class="inline-wrap"> 关键字来创建一个名为 </span><span class="inline-wrap"><code>v</code></span><span class="inline-wrap"> 的引用，它引用了变量 </span><span class="inline-wrap"><code>value</code></span><span class="inline-wrap"> 的值。通过在模式中使用 </span><span class="inline-wrap"><code>ref v</code></span><span class="inline-wrap">，我们获得了 </span><span class="inline-wrap"><code>value</code></span><span class="inline-wrap"> 的引用，并在 </span><span class="inline-wrap"><code>match</code></span><span class="inline-wrap"> 表达式中打印了它。</span></div></div><div id="3ojQXWzVSCemEwBSk4Brmm" class="wolai-block wolai-text"><div><span class="blue inline-wrap">优势：</span><span class="inline-wrap">我们可以在模式匹配中使用变量的引用，而不是将值移动到模式中。这对于需要在模式匹配的多个分支中重复使用同一个值的情况非常有用。</span></div></div><code-block id="gXdbugiZjFcYLr3936NJc7" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> value <span class="token punctuation">{</span>
        <span class="token keyword">ref</span> v <span class="token operator">=></span> <span class="token punctuation">{</span>
            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Got a reference: {}"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block></details></details></h1><h1 id="arb6dusXDCFT4BHuaDmdwF" class="wolai-block"><span class="inline-wrap">可变引用</span><div id="5Zw7bW99iv9utwxBA7b7YV" class="wolai-block wolai-text"><div><span class="inline-wrap">特点：同一个作用域中同一个数据只能有一个可变引用；</span></div></div><div id="8esYqT5y5DG4icXRzJV4YH" class="wolai-block wolai-text"><div><span class="inline-wrap">示例代码</span></div></div><code-block id="fjbGuqG4x8WwjpaHFpL44z" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">change</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// some_string: &amp;mut String 是可变引用</span>
<span class="token keyword">fn</span> <span class="token function-definition function">change</span><span class="token punctuation">(</span>some_string<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    some_string<span class="token punctuation">.</span><span class="token function">push_str</span><span class="token punctuation">(</span><span class="token string">", world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="5exJ5BQWMngeTKphNCjDKW" class="wolai-block wolai-text"><div><span class="inline-wrap"><a href="https://course.rs/basic/ownership/borrowing.html#可变引用与不可变引用不能同时存在"><span>已借用了不可变后，无法借用可变。</span></a></span></div></div></h1><h1 id="38375kzt3XyqqxeRtck37s" class="wolai-block"><span class="inline-wrap">解引用</span><div id="f2tekUr3iPZGEUUtMw5NRK" class="wolai-block wolai-text"><div><span class="blue inline-wrap">解引用：</span><span class="inline-wrap">使用</span><span class="inline-wrap"><code>*y</code></span><span class="inline-wrap">来引用指向的值</span></div></div><div id="s5JiyqVJdi1b3DWuoqKRCX" class="wolai-block wolai-text"><div><span class="inline-wrap">示例代码：</span></div></div><code-block id="otdYJxqbBLw4zSohAuBuqY" class="wolai-block"><div class="wolai-pre"><div data-lang="Rust" class="marker"></div><pre style="white-space: pre-wrap; word-break: break-all"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token operator">&amp;</span>x<span class="token punctuation">;</span>

    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">*</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></pre></div></code-block></h1></article><footer></footer></body></html>